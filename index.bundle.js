!function(t){function e(e){for(var r,s,a=e[0],u=e[1],c=e[2],l=0,f=[];l<a.length;l++)s=a[l],i[s]&&f.push(i[s][0]),i[s]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);for(h&&h(e);f.length;)f.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,a=1;a<n.length;a++){var u=n[a];0!==i[u]&&(r=!1)}r&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var r={},i={0:0},o=[];function s(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=r,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(n,r,function(e){return t[e]}.bind(null,r));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],u=a.push.bind(a);a.push=e,a=a.slice();for(var c=0;c<a.length;c++)e(a[c]);var h=u;o.push([14,1]),n()}([,function(t,e,n){t.exports=n.p+"src/images/laptop-unsplash.jpg"},function(t,e,n){t.exports=n.p+"src/images/tablet.png"},,function(t,e,n){(function(r,i,o){var s,a,u;function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}u=function(){"use strict";!function(t){if(!t.fetch){var e={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(t){return t&&DataView.prototype.isPrototypeOf(t)},i=ArrayBuffer.isView||function(t){return t&&n.indexOf(Object.prototype.toString.call(t))>-1};h.prototype.append=function(t,e){t=a(t),e=u(e);var n=this.map[t];this.map[t]=n?n+","+e:e},h.prototype.delete=function(t){delete this.map[a(t)]},h.prototype.get=function(t){return t=a(t),this.has(t)?this.map[t]:null},h.prototype.has=function(t){return this.map.hasOwnProperty(a(t))},h.prototype.set=function(t,e){this.map[a(t)]=u(e)},h.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},h.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),c(t)},h.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),c(t)},h.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),c(t)},e.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},y.call(m.prototype),y.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},v.error=function(){var t=new v(null,{status:0,statusText:""});return t.type="error",t};var s=[301,302,303,307,308];v.redirect=function(t,e){if(-1===s.indexOf(e))throw new RangeError("Invalid status code");return new v(null,{status:e,headers:{location:t}})},t.Headers=h,t.Request=m,t.Response=v,t.fetch=function(t,n){return new Promise(function(r,i){var o=new m(t,n),s=new XMLHttpRequest;s.onload=function(){var t,e,n={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",e=new h,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}}),e)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;r(new v(i,n))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials?s.withCredentials=!0:"omit"===o.credentials&&(s.withCredentials=!1),"responseType"in s&&e.blob&&(s.responseType="blob"),o.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),s.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}function a(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function u(t){return"string"!=typeof t&&(t=String(t)),t}function c(t){var n={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e.iterable&&(n[Symbol.iterator]=function(){return n}),n}function h(t){this.map={},t instanceof h?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function l(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function f(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function p(t){var e=new FileReader,n=f(e);return e.readAsArrayBuffer(t),n}function d(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(e.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(e.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(e.arrayBuffer&&e.blob&&r(t))this._bodyArrayBuffer=d(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!e.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!i(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=d(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},e.blob&&(this.blob=function(){var t=l(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?l(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var t,e,n,r=l(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,n=f(e=new FileReader),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},e.formData&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}function m(t,e){var n,r,i=(e=e||{}).body;if(t instanceof m){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new h(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new h(e.headers)),this.method=(r=(n=e.method||this.method||"GET").toUpperCase(),o.indexOf(r)>-1?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function g(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function v(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new h(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var e=setTimeout;function n(){}function s(t){if(!(this instanceof s))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function a(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,s._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void h(e.promise,t)}u(e.promise,r)}else(1===t._state?u:h)(e.promise,t._value)})):t._deferreds.push(e)}function u(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==c(e)||"function"==typeof e)){var n=e.then;if(e instanceof s)return t._state=3,t._value=e,void l(t);if("function"==typeof n)return void f((r=n,i=e,function(){r.apply(i,arguments)}),t)}t._state=1,t._value=e,l(t)}catch(e){h(t,e)}var r,i}function h(t,e){t._state=2,t._value=e,l(t)}function l(t){2===t._state&&0===t._deferreds.length&&s._immediateFn(function(){t._handled||s._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,u(e,t))},function(t){n||(n=!0,h(e,t))})}catch(t){if(n)return;n=!0,h(e,t)}}s.prototype.catch=function(t){return this.then(null,t)},s.prototype.then=function(t,e){var r=new this.constructor(n);return a(this,new function(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}(t,e,r)),r},s.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})},s.all=function(t){return new s(function(e,n){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function o(t,s){try{if(s&&("object"==c(s)||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){o(t,e)},n)}r[t]=s,0==--i&&e(r)}catch(t){n(t)}}for(var s=0;s<r.length;s++)o(s,r[s])})},s.resolve=function(t){return t&&"object"==c(t)&&t.constructor===s?t:new s(function(e){e(t)})},s.reject=function(t){return new s(function(e,n){n(t)})},s.race=function(t){return new s(function(e,n){for(var r=0,i=t.length;r<i;r++)t[r].then(e,n)})},s._immediateFn="function"==typeof r&&function(t){r(t)}||function(t){e(t,0)},s._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var p=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==i)return i;throw new Error("unable to locate global object")}();function d(t,e){return t(e={exports:{}},e.exports),e.exports}p.Promise||(p.Promise=s);var y=d(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),m=d(function(t){var e=t.exports={version:"2.5.5"};"number"==typeof __e&&(__e=e)}),g=(m.version,function(t){return"object"==c(t)?null!==t:"function"==typeof t}),v=function(t){if(!g(t))throw TypeError(t+" is not an object!");return t},b=function(t){try{return!!t()}catch(t){return!0}},_=!b(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),w=y.document,E=g(w)&&g(w.createElement),T=function(t){return E?w.createElement(t):{}},S=!_&&!b(function(){return 7!=Object.defineProperty(T("div"),"a",{get:function(){return 7}}).a}),I=function(t,e){if(!g(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!g(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},C=Object.defineProperty,N={f:_?Object.defineProperty:function(t,e,n){if(v(t),e=I(e,!0),v(n),S)try{return C(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},D=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},A=_?function(t,e,n){return N.f(t,e,D(1,n))}:function(t,e,n){return t[e]=n,t},k={}.hasOwnProperty,R=function(t,e){return k.call(t,e)},O=0,P=Math.random(),L=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++O+P).toString(36))},M=d(function(t){var e=L("src"),n=Function.toString,r=(""+n).split("toString");m.inspectSource=function(t){return n.call(t)},(t.exports=function(t,n,i,o){var s="function"==typeof i;s&&(R(i,"name")||A(i,"name",n)),t[n]!==i&&(s&&(R(i,e)||A(i,e,t[n]?""+t[n]:r.join(String(n)))),t===y?t[n]=i:o?t[n]?t[n]=i:A(t,n,i):(delete t[n],A(t,n,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[e]||n.call(this)})}),x=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},F=function t(e,n,r){var i,o,s,a,u=e&t.F,c=e&t.G,h=e&t.P,l=e&t.B,f=c?y:e&t.S?y[n]||(y[n]={}):(y[n]||{}).prototype,p=c?m:m[n]||(m[n]={}),d=p.prototype||(p.prototype={});for(i in c&&(r=n),r)s=((o=!u&&f&&void 0!==f[i])?f:r)[i],a=l&&o?x(s,y):h&&"function"==typeof s?x(Function.call,s):s,f&&M(f,i,s,e&t.U),p[i]!=s&&A(p,i,a),h&&d[i]!=s&&(d[i]=s)};y.core=m,F.F=1,F.G=2,F.S=4,F.P=8,F.B=16,F.W=32,F.U=64,F.R=128;var U=F,q={}.toString,B=function(t){return q.call(t).slice(8,-1)},V=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==B(t)?t.split(""):Object(t)},W=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},j=function(t){return Object(W(t))},K=Math.ceil,Q=Math.floor,H=function(t){return isNaN(t=+t)?0:(t>0?Q:K)(t)},G=Math.min,z=function(t){return t>0?G(H(t),9007199254740991):0},Y=Array.isArray||function(t){return"Array"==B(t)},X=y["__core-js_shared__"]||(y["__core-js_shared__"]={}),J=function(t){return X[t]||(X[t]={})},$=d(function(t){var e=J("wks"),n=y.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:L)("Symbol."+t))}).store=e}),Z=$("species"),tt=function(t,e){return new(function(t){var e;return Y(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!Y(e.prototype)||(e=void 0),g(e)&&null===(e=e[Z])&&(e=void 0)),void 0===e?Array:e}(t))(e)},et=function(t,e){var n=1==t,r=2==t,i=3==t,o=4==t,s=6==t,a=5==t||s,u=e||tt;return function(e,c,h){for(var l,f,p=j(e),d=V(p),y=x(c,h,3),m=z(d.length),g=0,v=n?u(e,m):r?u(e,0):void 0;m>g;g++)if((a||g in d)&&(f=y(l=d[g],g,p),t))if(n)v[g]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return g;case 2:v.push(l)}else if(o)return!1;return s?-1:i||o?o:v}},nt=$("unscopables"),rt=Array.prototype;null==rt[nt]&&A(rt,nt,{});var it=function(t){rt[nt][t]=!0},ot=et(5),st=!0;"find"in[]&&Array(1).find(function(){st=!1}),U(U.P+U.F*st,"Array",{find:function(t){return ot(this,t,arguments.length>1?arguments[1]:void 0)}}),it("find"),m.Array.find;var at=et(6),ut=!0;"findIndex"in[]&&Array(1).findIndex(function(){ut=!1}),U(U.P+U.F*ut,"Array",{findIndex:function(t){return at(this,t,arguments.length>1?arguments[1]:void 0)}}),it("findIndex"),m.Array.findIndex;var ct=function(t){return V(W(t))},ht=Math.max,lt=Math.min,ft=J("keys"),pt=function(t){return ft[t]||(ft[t]=L(t))},dt=(!1,function(t,e,n){var r=ct(t),i=z(r.length),o=function(t,e){return(t=H(t))<0?ht(t+e,0):lt(t,e)}(n,i);for(0;i>o;o++)if(o in r&&r[o]===e)return o||0;return-1}),yt=pt("IE_PROTO"),mt=function(t,e){var n,r=ct(t),i=0,o=[];for(n in r)n!=yt&&R(r,n)&&o.push(n);for(;e.length>i;)R(r,n=e[i++])&&(~dt(o,n)||o.push(n));return o},gt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),vt=Object.keys||function(t){return mt(t,gt)},bt={f:Object.getOwnPropertySymbols},_t={f:{}.propertyIsEnumerable},wt=Object.assign,Et=!wt||b(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=wt({},t)[n]||Object.keys(wt({},e)).join("")!=r})?function(t,e){for(var n=j(t),r=arguments.length,i=1,o=bt.f,s=_t.f;r>i;)for(var a,u=V(arguments[i++]),c=o?vt(u).concat(o(u)):vt(u),h=c.length,l=0;h>l;)s.call(u,a=c[l++])&&(n[a]=u[a]);return n}:wt;U(U.S+U.F,"Object",{assign:Et}),m.Object.assign;var Tt=$("match"),St=$("match"),It="".startsWith;U(U.P+U.F*function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[St]=!1,!"/./"[t](e)}catch(t){}}return!0}("startsWith"),"String",{startsWith:function(t){var e=function(t,e,n){if(g(r=e)&&(void 0!==(i=r[Tt])?i:"RegExp"==B(r)))throw TypeError("String#"+n+" doesn't accept regex!");var r,i;return String(W(t))}(this,t,"startsWith"),n=z(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return It?It.call(e,r,n):e.slice(n,n+r.length)===r}}),m.String.startsWith,U(U.P,"String",{repeat:function(t){var e=String(W(this)),n="",r=H(t);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}}),m.String.repeat;var Ct=d(function(t){var e=L("meta"),n=N.f,r=0,i=Object.isExtensible||function(){return!0},o=!b(function(){return i(Object.preventExtensions({}))}),s=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},a=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!g(t))return"symbol"==c(t)?t:("string"==typeof t?"S":"P")+t;if(!R(t,e)){if(!i(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!R(t,e)){if(!i(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return o&&a.NEED&&i(t)&&!R(t,e)&&s(t),t}}}),Nt=(Ct.KEY,Ct.NEED,Ct.fastKey,Ct.getWeak,Ct.onFreeze,N.f),Dt=$("toStringTag"),At=function(t,e,n){t&&!R(t=n?t:t.prototype,Dt)&&Nt(t,Dt,{configurable:!0,value:e})},kt={f:$},Rt=N.f,Ot=function(t){var e=m.Symbol||(m.Symbol=y.Symbol||{});"_"==t.charAt(0)||t in e||Rt(e,t,{value:kt.f(t)})},Pt=_?Object.defineProperties:function(t,e){v(t);for(var n,r=vt(e),i=r.length,o=0;i>o;)N.f(t,n=r[o++],e[n]);return t},Lt=y.document,Mt=Lt&&Lt.documentElement,xt=pt("IE_PROTO"),Ft=function(){},Ut=function(){var t,e=T("iframe"),n=gt.length;for(e.style.display="none",Mt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),Ut=t.F;n--;)delete Ut.prototype[gt[n]];return Ut()},qt=Object.create||function(t,e){var n;return null!==t?(Ft.prototype=v(t),n=new Ft,Ft.prototype=null,n[xt]=t):n=Ut(),void 0===e?n:Pt(n,e)},Bt=gt.concat("length","prototype"),Vt={f:Object.getOwnPropertyNames||function(t){return mt(t,Bt)}},Wt=Vt.f,jt={}.toString,Kt="object"==("undefined"==typeof window?"undefined":c(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Qt={f:function(t){return Kt&&"[object Window]"==jt.call(t)?function(t){try{return Wt(t)}catch(t){return Kt.slice()}}(t):Wt(ct(t))}},Ht=Object.getOwnPropertyDescriptor,Gt={f:_?Ht:function(t,e){if(t=ct(t),e=I(e,!0),S)try{return Ht(t,e)}catch(t){}if(R(t,e))return D(!_t.f.call(t,e),t[e])}},zt=Ct.KEY,Yt=Gt.f,Xt=N.f,Jt=Qt.f,$t=y.Symbol,Zt=y.JSON,te=Zt&&Zt.stringify,ee=$("_hidden"),ne=$("toPrimitive"),re={}.propertyIsEnumerable,ie=J("symbol-registry"),oe=J("symbols"),se=J("op-symbols"),ae=Object.prototype,ue="function"==typeof $t,ce=y.QObject,he=!ce||!ce.prototype||!ce.prototype.findChild,le=_&&b(function(){return 7!=qt(Xt({},"a",{get:function(){return Xt(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=Yt(ae,e);r&&delete ae[e],Xt(t,e,n),r&&t!==ae&&Xt(ae,e,r)}:Xt,fe=function(t){var e=oe[t]=qt($t.prototype);return e._k=t,e},pe=ue&&"symbol"==c($t.iterator)?function(t){return"symbol"==c(t)}:function(t){return t instanceof $t},de=function t(e,n,r){return e===ae&&t(se,n,r),v(e),n=I(n,!0),v(r),R(oe,n)?(r.enumerable?(R(e,ee)&&e[ee][n]&&(e[ee][n]=!1),r=qt(r,{enumerable:D(0,!1)})):(R(e,ee)||Xt(e,ee,D(1,{})),e[ee][n]=!0),le(e,n,r)):Xt(e,n,r)},ye=function(t,e){v(t);for(var n,r=function(t){var e=vt(t),n=bt.f;if(n)for(var r,i=n(t),o=_t.f,s=0;i.length>s;)o.call(t,r=i[s++])&&e.push(r);return e}(e=ct(e)),i=0,o=r.length;o>i;)de(t,n=r[i++],e[n]);return t},me=function(t){var e=re.call(this,t=I(t,!0));return!(this===ae&&R(oe,t)&&!R(se,t))&&(!(e||!R(this,t)||!R(oe,t)||R(this,ee)&&this[ee][t])||e)},ge=function(t,e){if(t=ct(t),e=I(e,!0),t!==ae||!R(oe,e)||R(se,e)){var n=Yt(t,e);return!n||!R(oe,e)||R(t,ee)&&t[ee][e]||(n.enumerable=!0),n}},ve=function(t){for(var e,n=Jt(ct(t)),r=[],i=0;n.length>i;)R(oe,e=n[i++])||e==ee||e==zt||r.push(e);return r},be=function(t){for(var e,n=t===ae,r=Jt(n?se:ct(t)),i=[],o=0;r.length>o;)!R(oe,e=r[o++])||n&&!R(ae,e)||i.push(oe[e]);return i};ue||(M(($t=function(){if(this instanceof $t)throw TypeError("Symbol is not a constructor!");var t=L(arguments.length>0?arguments[0]:void 0);return _&&he&&le(ae,t,{configurable:!0,set:function e(n){this===ae&&e.call(se,n),R(this,ee)&&R(this[ee],t)&&(this[ee][t]=!1),le(this,t,D(1,n))}}),fe(t)}).prototype,"toString",function(){return this._k}),Gt.f=ge,N.f=de,Vt.f=Qt.f=ve,_t.f=me,bt.f=be,_&&M(ae,"propertyIsEnumerable",me,!0),kt.f=function(t){return fe($(t))}),U(U.G+U.W+U.F*!ue,{Symbol:$t});for(var _e="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),we=0;_e.length>we;)$(_e[we++]);for(var Ee=vt($.store),Te=0;Ee.length>Te;)Ot(Ee[Te++]);U(U.S+U.F*!ue,"Symbol",{for:function(t){return R(ie,t+="")?ie[t]:ie[t]=$t(t)},keyFor:function(t){if(!pe(t))throw TypeError(t+" is not a symbol!");for(var e in ie)if(ie[e]===t)return e},useSetter:function(){he=!0},useSimple:function(){he=!1}}),U(U.S+U.F*!ue,"Object",{create:function(t,e){return void 0===e?qt(t):ye(qt(t),e)},defineProperty:de,defineProperties:ye,getOwnPropertyDescriptor:ge,getOwnPropertyNames:ve,getOwnPropertySymbols:be}),Zt&&U(U.S+U.F*(!ue||b(function(){var t=$t();return"[null]"!=te([t])||"{}"!=te({a:t})||"{}"!=te(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(g(e)||void 0!==t)&&!pe(t))return Y(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!pe(e))return e}),r[1]=e,te.apply(Zt,r)}}),$t.prototype[ne]||A($t.prototype,ne,$t.prototype.valueOf),At($t,"Symbol"),At(Math,"Math",!0),At(y.JSON,"JSON",!0);var Se=$("toStringTag"),Ie="Arguments"==B(function(){return arguments}()),Ce={};Ce[$("toStringTag")]="z",Ce+""!="[object z]"&&M(Object.prototype,"toString",function(){return"[object "+(void 0===this?"Undefined":null===this?"Null":"string"==typeof(e=function(t,e){try{return t[e]}catch(t){}}(t=Object(this),Se))?e:Ie?B(t):"Object"==(n=B(t))&&"function"==typeof t.callee?"Arguments":n)+"]";var t,e,n},!0),Ot("asyncIterator"),Ot("observable"),m.Symbol;var Ne={},De={};A(De,$("iterator"),function(){return this});var Ae=pt("IE_PROTO"),ke=Object.prototype,Re=Object.getPrototypeOf||function(t){return t=j(t),R(t,Ae)?t[Ae]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ke:null},Oe=$("iterator"),Pe=!([].keys&&"next"in[].keys()),Le=function(){return this},Me=function(t,e,n,r,i,o,s){!function(t,e,n){t.prototype=qt(De,{next:D(1,n)}),At(t,e+" Iterator")}(n,e,r);var a,u,c,h=function(t){if(!Pe&&t in d)return d[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},l=e+" Iterator",f="values"==i,p=!1,d=t.prototype,y=d[Oe]||d["@@iterator"]||i&&d[i],m=y||h(i),g=i?f?h("entries"):m:void 0,v="Array"==e&&d.entries||y;if(v&&(c=Re(v.call(new t)))!==Object.prototype&&c.next&&(At(c,l,!0),"function"!=typeof c[Oe]&&A(c,Oe,Le)),f&&y&&"values"!==y.name&&(p=!0,m=function(){return y.call(this)}),(Pe||p||!d[Oe])&&A(d,Oe,m),Ne[e]=m,Ne[l]=Le,i)if(a={values:f?m:h("values"),keys:o?m:h("keys"),entries:g},s)for(u in a)u in d||M(d,u,a[u]);else U(U.P+U.F*(Pe||p),e,a);return a},xe=(!0,function(t,e){var n,r,i=String(W(t)),o=H(e),s=i.length;return o<0||o>=s?"":(n=i.charCodeAt(o))<55296||n>56319||o+1===s||(r=i.charCodeAt(o+1))<56320||r>57343?i.charAt(o):i.slice(o,o+2)});Me(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=xe(e,n),this._i+=t.length,{value:t,done:!1})});var Fe=function(t,e){return{value:e,done:!!t}},Ue=Me(Array,"Array",function(t,e){this._t=ct(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,Fe(1)):Fe(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");Ne.Arguments=Ne.Array,it("keys"),it("values"),it("entries");for(var qe=$("iterator"),Be=$("toStringTag"),Ve=Ne.Array,We={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},je=vt(We),Ke=0;Ke<je.length;Ke++){var Qe,He=je[Ke],Ge=We[He],ze=y[He],Ye=ze&&ze.prototype;if(Ye&&(Ye[qe]||A(Ye,qe,Ve),Ye[Be]||A(Ye,Be,He),Ne[He]=Ve,Ge))for(Qe in Ue)Ye[Qe]||M(Ye,Qe,Ue[Qe],!0)}kt.f("iterator");var Xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function Je(t,e){function n(){this.constructor=t}Xe(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var $e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};function Ze(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})}function tn(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var en=function(t,e){if(!t)throw nn(e)},nn=function(t){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+t)},rn=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},on={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|a>>4,f=(15&a)<<2|c>>6,p=63&c;u||(p=64,s||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(rn(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();var c=o<<2|s>>4;if(r.push(c),64!=a){var h=s<<4&240|a>>2;if(r.push(h),64!=u){var l=a<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},sn=function(t){try{return on.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function an(t){return un(void 0,t)}function un(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=un(t[n],e[n]));return t}function cn(t,e,n){t[e]=n}var hn=function(){function t(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},t}(),ln=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")},fn=function(){return!1},pn="FirebaseError",dn=Error.captureStackTrace,yn=function(t,e){if(this.code=t,this.message=e,dn)dn(this,mn.prototype.create);else try{throw Error.apply(this,arguments)}catch(t){this.name=pn,Object.defineProperty(this,"stack",{get:function(){return t.stack}})}};yn.prototype=Object.create(Error.prototype),yn.prototype.constructor=yn,yn.prototype.name=pn;var mn=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return t.prototype.create=function(t,e){void 0===e&&(e={});var n,r=this.errors[t],i=this.service+"/"+t;n=void 0===r?"Error":r.replace(this.pattern,function(t,n){var r=e[n];return void 0!==r?r.toString():"<"+n+"?>"}),n=this.serviceName+": "+n+" ("+i+").";var o=new yn(i,n);for(var s in e)e.hasOwnProperty(s)&&"_"!==s.slice(-1)&&(o[s]=e[s]);return o},t}();function gn(t){return JSON.parse(t)}function vn(t){return JSON.stringify(t)}var bn=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=gn(sn(o[0])||""),n=gn(sn(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},_n=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},wn=function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},En=function(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])},Tn=function(t){return e={},En(t,function(t,n){e[t]=n}),e;var e},Sn=function(t){for(var e in t)return!1;return!0},In=function(t){var e=0;for(var n in t)e++;return e},Cn=function(t,e,n){var r={};for(var i in t)r[i]=e.call(n,t[i],i,t);return r},Nn=function(t,e,n){for(var r in t)if(e.call(n,t[r],r,t))return r},Dn=function(t){for(var e in t)return e},An=function(t){function e(){var e=t.call(this)||this;e.chain_=[],e.buf_=[],e.W_=[],e.pad_=[],e.inbuf_=0,e.total_=0,e.blockSize=64,e.pad_[0]=128;for(var n=1;n<e.blockSize;++n)e.pad_[n]=0;return e.reset(),e}return Je(e,t),e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)r<40?r<20?(o=h^u&(c^h),s=1518500249):(o=u^c^h,s=1859775393):r<60?(o=u&c|h&(u|c),s=2400959708):(o=u^c^h,s=3395469782),i=(a<<5|a>>>27)+o+l+s+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},e.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0==o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},e.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},e}(function(){this.blockSize=-1});function kn(t,e){var n=new Rn(t,e);return n.subscribe.bind(n)}var Rn=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=c(t)||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=On),void 0===r.error&&(r.error=On),void 0===r.complete&&(r.complete=On);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function On(){}var Pn=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function Ln(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+(r+" argument ")}function Mn(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Ln(t,e,r)+"must be a valid function.")}function xn(t,e,n,r){if((!r||n)&&("object"!=c(n)||null===n))throw new Error(Ln(t,e,r)+"must be a valid context object.")}var Fn=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e},Un=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},qn="[DEFAULT]",Bn=[],Vn=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled||!1,this.options_=an(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){Bn.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){Bn=Bn.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this._automaticDataCollectionEnabled},set:function(t){this.checkDestroyed_(),this._automaticDataCollectionEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);var e=[];return Object.keys(t.services_).forEach(function(n){Object.keys(t.services_[n]).forEach(function(r){e.push(t.services_[n][r])})}),Promise.all(e.map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=qn),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==qn?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;un(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(Bn.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),Bn=[])},t.prototype.checkDestroyed_=function(){this.isDeleted_&&Wn("app-deleted",{name:this.name_})},t}();function Wn(t,e){throw Kn.create(t,e)}Vn.prototype.name&&Vn.prototype.options||Vn.prototype.delete||console.log("dc");var jn,Kn=new mn("app","Firebase",{"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."}),Qn=function t(){var e={},n={},r={},i={__esModule:!0,initializeApp:function(t,n){(void 0===n&&(n={}),"object"!=c(n)||null===n)&&(n={name:n});var r=n;void 0===r.name&&(r.name=qn);var o=r.name;"string"==typeof o&&o||Wn("bad-app-name",{name:o+""}),Un(e,o)&&Wn("duplicate-app",{name:o});var s=new Vn(t,r,i);return e[o]=s,a(s,"create"),s},app:o,apps:null,Promise:Promise,SDK_VERSION:"5.6.0",INTERNAL:{registerService:function(t,e,a,u,c){n[t]&&Wn("duplicate-service",{name:t}),n[t]=e,u&&(r[t]=u,s().forEach(function(t){u("create",t)}));var h=function(e){return void 0===e&&(e=o()),"function"!=typeof e[t]&&Wn("invalid-app-argument",{name:t}),e[t]()};return void 0!==a&&un(h,a),i[t]=h,Vn.prototype[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._getService.bind(this,t).apply(this,c?e:[])},h},createFirebaseNamespace:t,extendNamespace:function(t){un(i,t)},createSubscribe:kn,ErrorFactory:mn,removeApp:function(t){a(e[t],"delete"),delete e[t]},factories:n,useAsService:u,Promise:Promise,deepExtend:un}};function o(t){return Un(e,t=t||qn)||Wn("no-app",{name:t}),e[t]}function s(){return Object.keys(e).map(function(t){return e[t]})}function a(t,e){Object.keys(n).forEach(function(n){var i=u(t,n);null!==i&&r[i]&&r[i](e,t)})}function u(t,e){if("serverAuth"===e)return null;var n=e;return t.options,n}return cn(i,"default",i),Object.defineProperty(i,"apps",{get:s}),cn(o,"App",Vn),i}();(function(){var t,e=e||{},n=this;function r(t){return"string"==typeof t}function i(t){return"boolean"==typeof t}function o(){}function s(t){var e=c(t);if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function a(t){return null===t}function u(t){return"array"==s(t)}function h(t){var e=s(t);return"array"==e||"object"==e&&"number"==typeof t.length}function l(t){return"function"==s(t)}function f(t){var e=c(t);return"object"==e&&null!=t||"function"==e}var p="closure_uid_"+(1e9*Math.random()>>>0),d=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function m(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function g(t,e,n){return(g=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:m).apply(null,arguments)}function v(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var b=Date.now||function(){return+new Date};function _(t,e){function n(){}n.prototype=e.prototype,t.nb=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.dd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function w(t){t.prototype.then=t.prototype.then,t.prototype.$goog_Thenable=!0}function E(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function T(t){if(Error.captureStackTrace)Error.captureStackTrace(this,T);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function S(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");T.call(this,n+t[r])}function I(t,e){throw new S("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function C(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function N(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function D(){this.b=this.a=null}_(T,Error),T.prototype.name="CustomError",_(S,T),S.prototype.name="AssertionError",C.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var A=new C(function(){return new R},function(t){t.reset()});function k(){var t=pt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function R(){this.next=this.b=this.a=null}D.prototype.add=function(t,e){var n=A.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},R.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},R.prototype.reset=function(){this.next=this.b=this.a=null};var O=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(r(t))return r(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},P=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var i=t.length,o=r(t)?t.split(""):t,s=0;s<i;s++)s in o&&e.call(n,o[s],s,t)},L=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=Array(n),o=r(t)?t.split(""):t,s=0;s<n;s++)s in o&&(i[s]=e.call(void 0,o[s],s,t));return i},M=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=r(t)?t.split(""):t,o=0;o<n;o++)if(o in i&&e.call(void 0,i[o],o,t))return!0;return!1};function x(t,e){return 0<=O(t,e)}function F(t,e){var n;return(n=0<=(e=O(t,e)))&&Array.prototype.splice.call(t,e,1),n}function U(t,e){!function(t,e){var n=t.length,i=r(t)?t.split(""):t;for(--n;0<=n;--n)n in i&&e.call(void 0,i[n],n,t)}(t,function(n,r){e.call(void 0,n,r,t)&&Array.prototype.splice.call(t,r,1).length})}function q(t){return Array.prototype.concat.apply([],arguments)}function B(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function V(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}var W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function j(t){return J.test(t)?(-1!=t.indexOf("&")&&(t=t.replace(Q,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(H,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(G,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(z,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(Y,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(X,"&#0;")),t):t}var K,Q=/&/g,H=/</g,G=/>/g,z=/"/g,Y=/'/g,X=/\x00/g,J=/[\x00&<>"']/;function $(t,e){return-1!=t.indexOf(e)}function Z(t,e){return t<e?-1:t>e?1:0}t:{var tt=n.navigator;if(tt){var et=tt.userAgent;if(et){K=et;break t}}K=""}function nt(t){return $(K,t)}function rt(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function it(t){for(var e in t)return!1;return!0}function ot(t){var e,n={};for(e in t)n[e]=t[e];return n}var st,at,ut="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ct(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ut.length;o++)n=ut[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ht(t){n.setTimeout(function(){throw t},0)}function lt(t,e){at||function(){if(n.Promise&&n.Promise.resolve){var t=n.Promise.resolve(void 0);at=function(){t.then(dt)}}else at=function(){var t=dt;!l(n.setImmediate)||n.Window&&n.Window.prototype&&!nt("Edge")&&n.Window.prototype.setImmediate==n.setImmediate?(st||(st=function(){var t=n.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!nt("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=g(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0!==t&&!nt("Trident")&&!nt("MSIE")){var e=new t,r={},i=r;return e.port1.onmessage=function(){if(void 0!==r.next){var t=(r=r.next).vb;r.vb=null,t()}},function(t){i.next={vb:t},i=i.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){n.setTimeout(t,0)}}()),st(t)):n.setImmediate(t)}}(),ft||(at(),ft=!0),pt.add(t,e)}var ft=!1,pt=new D;function dt(){for(var t;t=k();){try{t.a.call(t.b)}catch(t){ht(t)}N(A,t)}ft=!1}function yt(t,e){if(this.a=mt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=o)try{var n=this;t.call(e,function(t){Dt(n,gt,t)},function(t){if(!(t instanceof Mt))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}Dt(n,vt,t)})}catch(t){Dt(this,vt,t)}}var mt=0,gt=2,vt=3;function bt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}bt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var _t=new C(function(){return new bt},function(t){t.reset()});function wt(t,e,n){var r=_t.get();return r.g=t,r.b=e,r.f=n,r}function Et(t){if(t instanceof yt)return t;var e=new yt(o);return Dt(e,gt,t),e}function Tt(t){return new yt(function(e,n){n(t)})}function St(t,e,n){At(t,e,n,null)||lt(v(e,t))}function It(t){return new yt(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Cb:!0,value:o}:{Cb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)St(t[o],v(i,o,!0),v(i,o,!1));else e(r)})}function Ct(t,e){t.b||t.a!=gt&&t.a!=vt||kt(t),t.f?t.f.next=e:t.b=e,t.f=e}function Nt(t,e,n,r){var i=wt(null,null,null);return i.a=new yt(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(t){o(t)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof Mt?o(e):t(i)}catch(t){o(t)}}:o}),i.a.c=t,Ct(t,i),i.a}function Dt(t,e,n){t.a==mt&&(t===n&&(e=vt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,At(n,t.Mc,t.Nc,t)||(t.i=n,t.a=e,t.c=null,kt(t),e!=vt||n instanceof Mt||function(t,e){t.g=!0,lt(function(){t.g&&Lt.call(null,e)})}(t,n)))}function At(t,e,n,r){if(t instanceof yt)return Ct(t,wt(e||o,n||null,r)),!0;if(E(t))return t.then(e,n,r),!0;if(f(t))try{var i=t.then;if(l(i))return function(t,e,n,r,i){function o(t){s||(s=!0,r.call(i,t))}var s=!1;try{e.call(t,function(t){s||(s=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function kt(t){t.h||(t.h=!0,lt(t.Xb,t))}function Rt(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function Ot(t,e,n,r){if(n==vt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,Pt(e,n,r);else try{e.c?e.g.call(e.f):Pt(e,n,r)}catch(t){Lt.call(null,t)}N(_t,e)}function Pt(t,e,n){e==gt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}yt.prototype.then=function(t,e,n){return Nt(this,l(t)?t:null,l(e)?e:null,n)},w(yt),(t=yt.prototype).ia=function(t,e){return(t=wt(t,t,e)).c=!0,Ct(this,t),this},t.s=function(t,e){return Nt(this,null,t,e)},t.cancel=function(t){this.a==mt&&lt(function(){!function t(e,n){if(e.a==mt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,s=null,a=r.b;a&&(a.c||(i++,a.a==e&&(o=a),!(o&&1<i)));a=a.next)o||(s=a);o&&(r.a==mt&&1==i?t(r,n):(s?((i=s).next==r.f&&(r.f=i),i.next=i.next.next):Rt(r),Ot(r,o,vt,n)))}e.c=null}else Dt(e,vt,n)}(this,new Mt(t))},this)},t.Mc=function(t){this.a=mt,Dt(this,gt,t)},t.Nc=function(t){this.a=mt,Dt(this,vt,t)},t.Xb=function(){for(var t;t=Rt(this);)Ot(this,t,this.a,this.i);this.h=!1};var Lt=ht;function Mt(t){T.call(this,t)}function xt(){0!=Ft&&(Ut[this[p]||(this[p]=++d)]=this),this.pa=this.pa,this.ja=this.ja}_(Mt,T),Mt.prototype.name="cancel";var Ft=0,Ut={};function qt(t){if(!t.pa&&(t.pa=!0,t.ua(),0!=Ft)){var e=t[p]||(t[p]=++d);if(0!=Ft&&t.ja&&0<t.ja.length)throw Error(t+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Ut[e]}}function Bt(t){return Bt[" "](t),t}xt.prototype.pa=!1,xt.prototype.ua=function(){if(this.ja)for(;this.ja.length;)this.ja.shift()()},Bt[" "]=o;var Vt,Wt,jt=nt("Opera"),Kt=nt("Trident")||nt("MSIE"),Qt=nt("Edge"),Ht=Qt||Kt,Gt=nt("Gecko")&&!($(K.toLowerCase(),"webkit")&&!nt("Edge"))&&!(nt("Trident")||nt("MSIE"))&&!nt("Edge"),zt=$(K.toLowerCase(),"webkit")&&!nt("Edge");function Yt(){var t=n.document;return t?t.documentMode:void 0}t:{var Xt="",Jt=(Wt=K,Gt?/rv:([^\);]+)(\)|;)/.exec(Wt):Qt?/Edge\/([\d\.]+)/.exec(Wt):Kt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Wt):zt?/WebKit\/(\S+)/.exec(Wt):jt?/(?:Version)[ \/]?(\S+)/.exec(Wt):void 0);if(Jt&&(Xt=Jt?Jt[1]:""),Kt){var $t=Yt();if(null!=$t&&$t>parseFloat(Xt)){Vt=String($t);break t}}Vt=Xt}var Zt,te={};function ee(t){return function(t,e){var n=te;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=W(String(Vt)).split("."),r=W(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=Z(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||Z(0==s[2].length,0==a[2].length)||Z(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var ne=n.document;Zt=ne&&Kt?Yt()||("CSS1Compat"==ne.compatMode?parseInt(Vt,10):5):void 0;var re=Object.freeze||function(t){return t},ie=!Kt||9<=Number(Zt),oe=Kt&&!ee("9"),se=function(){if(!n.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});return n.addEventListener("test",o,e),n.removeEventListener("test",o,e),t}();function ae(t,e){this.type=t,this.b=this.target=e,this.Jb=!0}function ue(t,e){if(ae.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,i=t.changedTouches?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Gt){t:{try{Bt(e.nodeName);var o=!0;break t}catch(t){}o=!1}o||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,null===i?(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0):(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=r(t.pointerType)?t.pointerType:ce[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}ae.prototype.preventDefault=function(){this.Jb=!1},_(ue,ae);var ce=re({2:"touch",3:"pen",4:"mouse"});ue.prototype.preventDefault=function(){ue.nb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,oe)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},ue.prototype.f=function(){return this.a};var he="closure_listenable_"+(1e6*Math.random()|0),le=0;function fe(t){t.na=!0,t.listener=null,t.proxy=null,t.src=null,t.La=null}function pe(t){this.src=t,this.a={},this.b=0}function de(t,e){var n=e.type;n in t.a&&F(t.a[n],e)&&(fe(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function ye(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.na&&o.listener==e&&o.capture==!!n&&o.La==r)return i}return-1}pe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=ye(t,e,r,i);return-1<s?(e=t[s],n||(e.Ia=!1)):((e=new function(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.La=i,this.key=++le,this.na=this.Ia=!1}(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var me="closure_lm_"+(1e6*Math.random()|0),ge={};function ve(t,e,n,r,i){if(r&&r.once)_e(t,e,n,r,i);else if(u(e))for(var o=0;o<e.length;o++)ve(t,e[o],n,r,i);else n=Ae(n),t&&t[he]?Re(t,e,n,f(r)?!!r.capture:!!r,i):be(t,e,n,!1,r,i)}function be(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=f(i)?!!i.capture:!!i,a=Ne(t);if(a||(t[me]=a=new pe(t)),!(n=a.add(e,n,r,s,o)).proxy)if(r=function(){var t=Ce,e=ie?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)se||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Te(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function _e(t,e,n,r,i){if(u(e))for(var o=0;o<e.length;o++)_e(t,e[o],n,r,i);else n=Ae(n),t&&t[he]?Oe(t,e,n,f(r)?!!r.capture:!!r,i):be(t,e,n,!0,r,i)}function we(t,e,n,r,i){if(u(e))for(var o=0;o<e.length;o++)we(t,e[o],n,r,i);else r=f(r)?!!r.capture:!!r,n=Ae(n),t&&t[he]?(t=t.l,(e=String(e).toString())in t.a&&-1<(n=ye(o=t.a[e],n,r,i))&&(fe(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Ne(t))&&(e=t.a[e.toString()],t=-1,e&&(t=ye(e,n,r,i)),(n=-1<t?e[t]:null)&&Ee(n))}function Ee(t){if("number"!=typeof t&&t&&!t.na){var e=t.src;if(e&&e[he])de(e.l,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Te(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ne(e))?(de(n,t),0==n.b&&(n.src=null,e[me]=null)):fe(t)}}}function Te(t){return t in ge?ge[t]:ge[t]="on"+t}function Se(t,e,n,r){var i=!0;if((t=Ne(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.na&&(o=Ie(o,r),i=i&&!1!==o)}return i}function Ie(t,e){var n=t.listener,r=t.La||t.src;return t.Ia&&Ee(t),n.call(r,e)}function Ce(t,e){if(t.na)return!0;if(!ie){if(!e)t:{e=["window","event"];for(var r=n,i=0;i<e.length;i++)if(null==(r=r[e[i]])){e=null;break t}e=r}if(e=new ue(i=e,this),r=!0,!(0>i.keyCode||null!=i.returnValue)){t:{var o=!1;if(0==i.keyCode)try{i.keyCode=-1;break t}catch(t){o=!0}(o||null==i.returnValue)&&(i.returnValue=!0)}for(i=[],o=e.b;o;o=o.parentNode)i.push(o);for(t=t.type,o=i.length-1;0<=o;o--){e.b=i[o];var s=Se(i[o],t,!0,e);r=r&&s}for(o=0;o<i.length;o++)e.b=i[o],s=Se(i[o],t,!1,e),r=r&&s}return r}return Ie(t,new ue(e,this))}function Ne(t){return(t=t[me])instanceof pe?t:null}var De="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ae(t){return l(t)?t:(t[De]||(t[De]=function(e){return t.handleEvent(e)}),t[De])}function ke(){xt.call(this),this.l=new pe(this),this.Qb=this,this.Ua=null}function Re(t,e,n,r,i){t.l.add(String(e),n,!1,r,i)}function Oe(t,e,n,r,i){t.l.add(String(e),n,!0,r,i)}function Pe(t,e,n,r){if(!(e=t.l.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.na&&s.capture==n){var a=s.listener,u=s.La||s.src;s.Ia&&de(t.l,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Jb}function Le(t,e,r){if(l(t))r&&(t=g(t,r));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=g(t.handleEvent,t)}return 2147483647<Number(e)?-1:n.setTimeout(t,e||0)}function Me(t){var e=null;return new yt(function(n,r){-1==(e=Le(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw n.clearTimeout(e),t})}function xe(t){if(t.S&&"function"==typeof t.S)return t.S();if(r(t))return t.split("");if(h(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}function Fe(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(h(t)||r(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var i in e=[],n=0,t)e[n++]=i;return e}}function Ue(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ue)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Be(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Be(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Be(t,e){return Object.prototype.hasOwnProperty.call(t,e)}_(ke,xt),ke.prototype[he]=!0,ke.prototype.addEventListener=function(t,e,n,r){ve(this,t,e,n,r)},ke.prototype.removeEventListener=function(t,e,n,r){we(this,t,e,n,r)},ke.prototype.dispatchEvent=function(t){var e,n=this.Ua;if(n)for(e=[];n;n=n.Ua)e.push(n);n=this.Qb;var i=t.type||t;if(r(t))t=new ae(t,n);else if(t instanceof ae)t.target=t.target||n;else{var o=t;ct(t=new ae(i,n),o)}if(o=!0,e)for(var s=e.length-1;0<=s;s--){var a=t.b=e[s];o=Pe(a,i,!0,t)&&o}if(o=Pe(a=t.b=n,i,!0,t)&&o,o=Pe(a,i,!1,t)&&o,e)for(s=0;s<e.length;s++)o=Pe(a=t.b=e[s],i,!1,t)&&o;return o},ke.prototype.ua=function(){if(ke.nb.ua.call(this),this.l){var t,e=this.l;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)fe(n[r]);delete e.a[t],e.b--}}this.Ua=null},(t=Ue.prototype).S=function(){qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return qe(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return Be(this.b,t)?this.b[t]:e},t.set=function(t,e){Be(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ve=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function We(t,e){if(this.b=this.l=this.c="",this.i=null,this.h=this.g="",this.f=!1,t instanceof We){this.f=void 0!==e?e:t.f,je(this,t.c),this.l=t.l,this.b=t.b,Ke(this,t.i),this.g=t.g,e=t.a;var n=new on;n.c=e.c,e.a&&(n.a=new Ue(e.a),n.b=e.b),Qe(this,n),this.h=t.h}else t&&(n=String(t).match(Ve))?(this.f=!!e,je(this,n[1]||"",!0),this.l=Xe(n[2]||""),this.b=Xe(n[3]||"",!0),Ke(this,n[4]),this.g=Xe(n[5]||"",!0),Qe(this,n[6]||"",!0),this.h=Xe(n[7]||"")):(this.f=!!e,this.a=new on(null,this.f))}function je(t,e,n){t.c=n?Xe(e,!0):e,t.c&&(t.c=t.c.replace(/:$/,""))}function Ke(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Qe(t,e,n){e instanceof on?(t.a=e,function(t,e){e&&!t.f&&(sn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(un(this,e),hn(this,n,t))},t)),t.f=e}(t.a,t.f)):(n||(e=Je(e,nn)),t.a=new on(e,t.f))}function He(t,e,n){t.a.set(e,n)}function Ge(t,e){return t.a.get(e)}function ze(t){return t instanceof We?new We(t):new We(t,void 0)}function Ye(t,e){var n=new We(null,void 0);return je(n,"https"),t&&(n.b=t),e&&(n.g=e),n}function Xe(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Je(t,e,n){return r(t)?(t=encodeURI(t).replace(e,$e),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function $e(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}We.prototype.toString=function(){var t=[],e=this.c;e&&t.push(Je(e,Ze,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.l)&&t.push(Je(e,Ze,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.g)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Je(n,"/"==n.charAt(0)?en:tn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.h)&&t.push("#",Je(n,rn)),t.join("")};var Ze=/[#\/\?@]/g,tn=/[#\?:]/g,en=/[#\?]/g,nn=/[#\?@]/g,rn=/#/g;function on(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function sn(t){t.a||(t.a=new Ue,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function an(t){var e=Fe(t);if(void 0===e)throw Error("Keys are undefined");var n=new on(null,void 0);t=xe(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];u(o)?hn(n,i,o):n.add(i,o)}return n}function un(t,e){sn(t),e=ln(t,e),Be(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Be((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&qe(t)))}function cn(t,e){return sn(t),e=ln(t,e),Be(t.a.b,e)}function hn(t,e,n){un(t,e),0<n.length&&(t.c=null,t.a.set(ln(t,e),B(n)),t.b+=n.length)}function ln(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=on.prototype).add=function(t,e){sn(this),this.c=null,t=ln(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){sn(this),this.a.forEach(function(n,r){P(n,function(n){t.call(e,n,r,this)},this)},this)},t.U=function(){sn(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){sn(this);var e=[];if(r(t))cn(this,t)&&(e=q(e,this.a.get(ln(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=q(e,t[n])}return e},t.set=function(t,e){return sn(this),this.c=null,cn(this,t=ln(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return 0<(t=t?this.S(t):[]).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var fn=!Kt||9<=Number(Zt);function pn(){this.a="",this.b=yn}function dn(t){return t instanceof pn&&t.constructor===pn&&t.b===yn?t.a:(I("expected object of type Const, got '"+t+"'"),"type_error:Const")}pn.prototype.ma=!0,pn.prototype.la=function(){return this.a},pn.prototype.toString=function(){return"Const{"+this.a+"}"};var yn={};function mn(t){var e=new pn;return e.a=t,e}function gn(){this.a="",this.b=En}function vn(t){return t instanceof gn&&t.constructor===gn&&t.b===En?t.a:(I("expected object of type TrustedResourceUrl, got '"+t+"' of type "+s(t)),"type_error:TrustedResourceUrl")}function bn(t,e){var n=dn(t);if(!wn.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return function(t){var e=new gn;return e.a=t,e}(t=n.replace(_n,function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof pn?dn(t):encodeURIComponent(String(t))}))}mn(""),gn.prototype.ma=!0,gn.prototype.la=function(){return this.a},gn.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var _n=/%{(\w+)}/g,wn=/^(?:https:)?\/\/[0-9a-z.:[\]-]+\/|^\/[^\/\\]|^about:blank#/i,En={};function Tn(){this.a="",this.b=Nn}function Sn(t){return t instanceof Tn&&t.constructor===Tn&&t.b===Nn?t.a:(I("expected object of type SafeUrl, got '"+t+"' of type "+s(t)),"type_error:SafeUrl")}Tn.prototype.ma=!0,Tn.prototype.la=function(){return this.a},Tn.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var In=/^(?:(?:https?|mailto|ftp):|[^:\/?#]*(?:[\/?#]|$))/i;function Cn(t){return t instanceof Tn?t:(t=t.ma?t.la():String(t),In.test(t)||(t="about:invalid#zClosurez"),Dn(t))}var Nn={};function Dn(t){var e=new Tn;return e.a=t,e}function An(){this.a="",this.b=kn}Dn("about:blank"),An.prototype.ma=!0,An.prototype.la=function(){return this.a},An.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kn={};function Rn(t){var e=new An;return e.a=t,e}function On(t){var e=document;return r(t)?e.getElementById(t):t}function Pn(t,e){rt(e,function(e,n){e&&e.ma&&(e=e.la()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:Ln.hasOwnProperty(n)?t.setAttribute(Ln[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}Rn("<!DOCTYPE html>"),Rn(""),Rn("<br>");var Ln={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Mn(t){if(t&&"number"==typeof t.length){if(f(t))return"function"==typeof t.item||"string"==typeof t.item;if(l(t))return"function"==typeof t.item}return!1}function xn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==c(n)){if(u(n)){var i=n;n=i.length,r.push("[");for(var o="",s=0;s<n;s++)r.push(o),t(e,i[s],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&"function"!=typeof(s=n[i])&&(r.push(o),qn(i,r),r.push(":"),t(e,s,r),o=",");return void r.push("}")}n=n.valueOf()}switch(c(n)){case"string":qn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+c(n))}}}(new function(){},t,e),e.join("")}var Fn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Un=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function qn(t,e){e.push('"',t.replace(Un,function(t){var e=Fn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Fn[t]=e),e}),'"')}function Bn(){var t=or();return Kt&&!!Zt&&11==Zt||/Edge\/\d+/.test(t)}function Vn(){return n.window&&n.window.location.href||self&&self.location&&self.location.href||""}function Wn(t,e){e=e||n.window;var r="about:blank";t&&(r=Sn(Cn(t))),e.location.href=r}function jn(t){return!!((t=(t||or()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Kn(t){t=t||n.window;try{t.close()}catch(t){}}function Hn(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=or().toLowerCase(),r&&(e.target=r,$(n,"crios/")&&(e.target="_blank")),nr(or())==tr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof Tn?n:Cn(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((nt("iPhone")&&!nt("iPod")&&!nt("iPad")||nt("iPad")||nt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(a=r.document.createElement("A"),e instanceof Tn||e instanceof Tn||(e=e.ma?e.la():String(e),In.test(e)||(e="about:invalid#zClosurez"),e=Dn(e)),a.href=Sn(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=Sn(e),a&&(Ht&&$(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,mn("b/12014412, meta tag with sanitized URL"),t=Rn(t='<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+j(t)+'">'),a.document.write(function(t){return t instanceof An&&t.constructor===An&&t.b===kn?t.a:(I("expected object of type SafeHtml, got '"+t+"' of type "+s(t)),"type_error:SafeHtml")}(t)),a.document.close())):(a=r.open(Sn(e),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var Gn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;function zn(){var t=null;return new yt(function(e){"complete"==n.document.readyState?e():(t=function(){e()},_e(window,"load",t))}).s(function(e){throw we(window,"load",t),e})}function Yn(t){return t=t||or(),!("file:"!==hr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function Xn(){var t=n.window;try{return!(!t||t==t.top)}catch(t){return!1}}function Jn(){return"object"!=c(n.window)&&"function"==typeof n.importScripts}function $n(){return Qn.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":Qn.INTERNAL.hasOwnProperty("node")?"Node":Jn()?"Worker":"Browser"}function Zn(){var t=$n();return"ReactNative"===t||"Node"===t}var tr="Firefox",er="Chrome";function nr(t){var e=t.toLowerCase();return $(e,"opera/")||$(e,"opr/")||$(e,"opios/")?"Opera":$(e,"iemobile")?"IEMobile":$(e,"msie")||$(e,"trident/")?"IE":$(e,"edge/")?"Edge":$(e,"firefox/")?tr:$(e,"silk/")?"Silk":$(e,"blackberry")?"Blackberry":$(e,"webos")?"Webos":!$(e,"safari/")||$(e,"chrome/")||$(e,"crios/")||$(e,"android")?!$(e,"chrome/")&&!$(e,"crios/")||$(e,"edge/")?$(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":er:"Safari"}var rr={Tc:"FirebaseCore-web",Vc:"FirebaseUI-web"};function ir(t,e){e=e||[];var n,r=[],i={};for(n in rr)i[rr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=$n())?r=nr(i=or()):"Worker"===r&&(r=nr(i=or())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function or(){return n.navigator&&n.navigator.userAgent||""}function sr(t,e){t=t.split("."),e=e||n;for(var r=0;r<t.length&&"object"==c(e)&&null!=e;r++)e=e[t[r]];return r!=t.length&&(e=void 0),e}function ar(){try{var t=n.localStorage,e=yr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Bn()||!!n.indexedDB}catch(t){return Jn()&&!!n.indexedDB}return!1}function ur(){return(cr()||"chrome-extension:"===hr()||Yn())&&!Zn()&&ar()&&!Jn()}function cr(){return"http:"===hr()||"https:"===hr()}function hr(){return n.location&&n.location.protocol||null}function lr(t){return!jn(t=t||or())&&nr(t)!=tr}function fr(t){return void 0===t?null:xn(t)}function pr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function dr(t){if(null!==t)return JSON.parse(t)}function yr(t){return t||Math.floor(1e9*Math.random()).toString()}function mr(t){return"Safari"!=nr(t=t||or())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function gr(){var t=n.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var r=0;r<t.CP.length;r++)t.CP[r]=null}function vr(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=or(),e=$n(),this.b=jn(t)||"ReactNative"===e}function br(){var t=n.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function _r(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function wr(){return!(!sr("fireauth.oauthhelper",n)&&!sr("fireauth.iframe",n))}vr.prototype.get=function(){var t=n.navigator;return!t||"boolean"!=typeof t.onLine||!cr()&&"chrome-extension:"!==hr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Er,Tr={};function Sr(t){Tr[t]||(Tr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Ir={};Object.defineProperty(Ir,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Ir,"abcd",{configurable:!0,enumerable:!0,value:2}),Er=2==Ir.abcd}catch(Wt){Er=!1}function Cr(t,e,n){Er?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Nr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Cr(t,n,e[n])}function Dr(t){var e={};return Nr(e,t),e}function Ar(t){var e=t;if("object"==c(t)&&null!=t)for(var n in e="length"in t?[]:{},t)Cr(e,n,Ar(t[n]));return e}function kr(t,e){this.code=Or+t,this.message=e||Pr[t]||""}function Rr(t){var e=t&&t.code;return e?new kr(e.substring(Or.length),t.message):null}_(kr,Error),kr.prototype.D=function(){return{code:this.code,message:this.message}},kr.prototype.toJSON=function(){return this.D()};var Or="auth/",Pr={"argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Lr(t){var e=t[qr];if(void 0===e)throw new kr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new kr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Mr];if(n&&"object"==c(n)){e=n[Wr];var r=n[Br];if(n=n[Vr],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new kr("argument-error",Br+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new kr("argument-error",Vr+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new kr("argument-error",Wr+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new kr("missing-android-pkg-name")}}else if(void 0!==n)throw new kr("argument-error",Mr+" property must be a non null object when specified.");if(this.f=null,(e=t[Ur])&&"object"==c(e)){if("string"==typeof(e=e[jr])&&e.length)this.f=e;else if(void 0!==e)throw new kr("argument-error",jr+" property must be a non empty string when specified.")}else if(void 0!==e)throw new kr("argument-error",Ur+" property must be a non null object when specified.");if(void 0!==(e=t[Fr])&&"boolean"!=typeof e)throw new kr("argument-error",Fr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[xr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new kr("argument-error",xr+" property must be a non empty string when specified.");this.i=t||null}var Mr="android",xr="dynamicLinkDomain",Fr="handleCodeInApp",Ur="iOS",qr="url",Br="installApp",Vr="minimumVersion",Wr="packageName",jr="bundleId";function Kr(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var Qr=null,Hr=null;function Gr(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function zr(t){return(t=Yr(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Gr(t):null}function Yr(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(function(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=Hr[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!Qr){Qr={},Hr={};for(var t=0;65>t;t++)Qr[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),Hr[Qr[t]]=t,62<=t&&(Hr["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),s=n(64),a=n(64);if(64===a&&-1===i)break;e(i<<2|o>>4),64!=s&&(e(o<<4&240|s>>2),64!=a&&e(s<<6&192|a))}}(t,function(t){e+=String.fromCharCode(t)}),e}(t))}catch(t){}return null}Gr.prototype.f=function(){return this.b};var Xr="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Jr=["client_id","response_type","scope","redirect_uri","state"],$r={Uc:{Ma:"locale",Ba:500,Aa:600,Na:"facebook.com",gb:Jr},Wc:{Ma:null,Ba:500,Aa:620,Na:"github.com",gb:Jr},Xc:{Ma:"hl",Ba:515,Aa:680,Na:"google.com",gb:Jr},cd:{Ma:"lang",Ba:485,Aa:705,Na:"twitter.com",gb:Xr}};function Zr(t){for(var e in $r)if($r[e].Na==t)return $r[e];return null}function ti(t){var e={};e["facebook.com"]=oi,e["google.com"]=ai,e["github.com"]=si,e["twitter.com"]=ui;var n=t&&t[ni];try{if(n)return e[n]?new e[n](t):new ii(t);if(void 0!==t[ei])return new ri(t)}catch(t){}return null}var ei="idToken",ni="providerId";function ri(t){var e=t[ni];if(!e&&t[ei]){var n=zr(t[ei]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Cr(this,"providerId",e),Cr(this,"isNewUser",n)}function ii(t){ri.call(this,t),Cr(this,"profile",Ar((t=dr(t.rawUserInfo||"{}"))||{}))}function oi(t){if(ii.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function si(t){if(ii.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Cr(this,"username",this.profile&&this.profile.login||null)}function ai(t){if(ii.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function ui(t){if(ii.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Cr(this,"username",t.screenName||null)}function ci(t){var e=ze(t),n=Ge(e,"link"),r=Ge(ze(n),"link");return Ge(ze(e=Ge(e,"deep_link_id")),"link")||e||r||n||t}function hi(t,e){return t.then(function(t){if(t[Ko]){var n=zr(t[Ko]);if(!n||e!=n.c)throw new kr("user-mismatch");return t}throw new kr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Or+"user-not-found"?new kr("user-mismatch"):t})}function li(t,e,n){if(e.idToken||e.accessToken)e.idToken&&Cr(this,"idToken",e.idToken),e.accessToken&&Cr(this,"accessToken",e.accessToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new kr("internal-error","failed to construct a credential");Cr(this,"accessToken",e.oauthToken),Cr(this,"secret",e.oauthTokenSecret)}Cr(this,"providerId",t),Cr(this,"signInMethod",n)}function fi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,{postBody:an(e).toString(),requestUri:"http://localhost"}}function pi(t,e){this.Cc=e||[],Nr(this,{providerId:t,isOAuthProvider:!0}),this.xb={},this.bb=(Zr(t)||{}).Ma||null,this.Za=null}function di(t){pi.call(this,t,Jr),this.a=[]}function yi(){di.call(this,"facebook.com")}function mi(t){if(!t)throw new kr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return f(t)&&(e=t.accessToken),(new yi).credential(null,e)}function gi(){di.call(this,"github.com")}function vi(t){if(!t)throw new kr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return f(t)&&(e=t.accessToken),(new gi).credential(null,e)}function bi(){di.call(this,"google.com"),this.ta("profile")}function _i(t,e){var n=t;return f(t)&&(n=t.idToken,e=t.accessToken),(new bi).credential(n,e)}function wi(){pi.call(this,"twitter.com",Xr)}function Ei(t,e){var n=t;if(f(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new kr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new li("twitter.com",n,"twitter.com")}function Ti(t,e,n){this.a=t,this.b=e,Cr(this,"providerId","password"),Cr(this,"signInMethod",n===Si.EMAIL_LINK_SIGN_IN_METHOD?Si.EMAIL_LINK_SIGN_IN_METHOD:Si.EMAIL_PASSWORD_SIGN_IN_METHOD)}function Si(){Nr(this,{providerId:"password",isOAuthProvider:!1})}function Ii(t,e){if(!(e=Ci(e)))throw new kr("argument-error","Invalid email link!");return new Ti(t,e,Si.EMAIL_LINK_SIGN_IN_METHOD)}function Ci(t){var e=Ge((t=new function(t){this.a=ze(t)}(t=ci(t))).a,"oobCode")||null;return"signIn"===(Ge(t.a,"mode")||null)&&e?e:null}function Ni(t){if(!(t.Sa&&t.Ra||t.Fa&&t.$))throw new kr("internal-error");this.a=t,Cr(this,"providerId","phone"),Cr(this,"signInMethod","phone")}function Di(t){return t.a.Fa&&t.a.$?{temporaryProof:t.a.Fa,phoneNumber:t.a.$}:{sessionInfo:t.a.Sa,code:t.a.Ra}}function Ai(t){try{this.a=t||Qn.auth()}catch(t){throw new kr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Nr(this,{providerId:"phone",isOAuthProvider:!1})}function ki(t,e){if(!t)throw new kr("missing-verification-id");if(!e)throw new kr("missing-verification-code");return new Ni({Sa:t,Ra:e})}function Ri(t){if(t.temporaryProof&&t.phoneNumber)return new Ni({Fa:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret;t=t&&t.oauthIdToken;try{switch(e){case"google.com":return _i(t,n);case"facebook.com":return mi(n);case"github.com":return vi(n);case"twitter.com":return Ei(n,r);default:return new di(e).credential(t,n)}}catch(t){return null}}function Oi(t){if(!t.isOAuthProvider)throw new kr("invalid-oauth-provider")}function Pi(t,e,n,r,i){if(this.b=t,this.c=e||null,this.f=n||null,this.g=r||null,this.a=i||null,!this.f&&!this.a)throw new kr("invalid-auth-event");if(this.f&&this.a)throw new kr("invalid-auth-event");if(this.f&&!this.g)throw new kr("invalid-auth-event")}function Li(t){return(t=t||{}).type?new Pi(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Rr(t.error)):null}function Mi(){this.b=null,this.a=[]}_(ii,ri),_(oi,ii),_(si,ii),_(ai,ii),_(ui,ii),li.prototype.ya=function(t){return as(t,fi(this))},li.prototype.c=function(t,e){var n=fi(this);return n.idToken=e,us(t,n)},li.prototype.f=function(t,e){return hi(cs(t,fi(this)),e)},li.prototype.D=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),t},pi.prototype.Da=function(t){return this.xb=ot(t),this},_(di,pi),di.prototype.ta=function(t){return x(this.a,t)||this.a.push(t),this},di.prototype.Db=function(){return B(this.a)},di.prototype.credential=function(t,e){if(!t&&!e)throw new kr("argument-error","credential failed: must provide the ID token and/or the access token.");return new li(this.providerId,{idToken:t||null,accessToken:e||null},this.providerId)},_(yi,di),Cr(yi,"PROVIDER_ID","facebook.com"),Cr(yi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),_(gi,di),Cr(gi,"PROVIDER_ID","github.com"),Cr(gi,"GITHUB_SIGN_IN_METHOD","github.com"),_(bi,di),Cr(bi,"PROVIDER_ID","google.com"),Cr(bi,"GOOGLE_SIGN_IN_METHOD","google.com"),_(wi,pi),Cr(wi,"PROVIDER_ID","twitter.com"),Cr(wi,"TWITTER_SIGN_IN_METHOD","twitter.com"),Ti.prototype.ya=function(t){return this.signInMethod==Si.EMAIL_LINK_SIGN_IN_METHOD?Us(t,gs,{email:this.a,oobCode:this.b}):Us(t,Ls,{email:this.a,password:this.b})},Ti.prototype.c=function(t,e){return this.signInMethod==Si.EMAIL_LINK_SIGN_IN_METHOD?Us(t,vs,{idToken:e,email:this.a,oobCode:this.b}):Us(t,Ds,{idToken:e,email:this.a,password:this.b})},Ti.prototype.f=function(t,e){return hi(this.ya(t),e)},Ti.prototype.D=function(){return{email:this.a,password:this.b,signInMethod:this.signInMethod}},Nr(Si,{PROVIDER_ID:"password"}),Nr(Si,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Nr(Si,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Ni.prototype.ya=function(t){return t.Ta(Di(this))},Ni.prototype.c=function(t,e){var n=Di(this);return n.idToken=e,Us(t,xs,n)},Ni.prototype.f=function(t,e){var n=Di(this);return n.operation="REAUTH",hi(t=Us(t,Fs,n),e)},Ni.prototype.D=function(){var t={providerId:"phone"};return this.a.Sa&&(t.verificationId=this.a.Sa),this.a.Ra&&(t.verificationCode=this.a.Ra),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.$&&(t.phoneNumber=this.a.$),t},Ai.prototype.Ta=function(t,e){var n=this.a.b;return Et(e.verify()).then(function(i){if(!r(i))throw new kr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return Us(n,Cs,e)}(0,{phoneNumber:t,recaptchaToken:i}).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new kr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Nr(Ai,{PROVIDER_ID:"phone"}),Nr(Ai,{PHONE_SIGN_IN_METHOD:"phone"}),Pi.prototype.D=function(){return{type:this.b,eventId:this.c,urlResponse:this.f,sessionId:this.g,error:this.a&&this.a.D()}};var xi=null;function Fi(t){var e="unauthorized-domain",n=void 0,r=ze(t);t=r.b,"chrome-extension"==(r=r.c)?n=V("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=V("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",kr.call(this,e,n)}function Ui(t,e,n){kr.call(this,t,n),(t=e||{}).yb&&Cr(this,"email",t.yb),t.$&&Cr(this,"phoneNumber",t.$),t.credential&&Cr(this,"credential",t.credential)}function qi(t){if(t.code){var e=t.code||"";0==e.indexOf(Or)&&(e=e.substring(Or.length));var n={credential:Ri(t)};if(t.email)n.yb=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new kr(e,t.message||void 0);return new Ui(e,n,t.message)}return null}Mi.prototype.subscribe=function(t){var e=this;this.a.push(t),this.b||(this.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=sr("universalLinks.subscribe",n))&&t(null,this.b))},Mi.prototype.unsubscribe=function(t){U(this.a,function(e){return e==t})},_(Fi,kr),_(Ui,kr),Ui.prototype.D=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.D();return e&&ct(t,e),t},Ui.prototype.toJSON=function(){return this.D()};var Bi,Vi=/^[+a-zA-Z0-9_.!#$%&'*\/=?^`{|}~-]+@([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,63}$/;function Wi(){}function ji(t){return t.c||(t.c=t.b())}function Ki(){}function Qi(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function Hi(){}function Gi(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseText="",this.status=-1,this.statusText="",this.a.onload=g(this.dc,this),this.a.onerror=g(this.Eb,this),this.a.onprogress=g(this.ec,this),this.a.ontimeout=g(this.hc,this)}function zi(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Yi(t,e,n){this.reset(t,e,n,void 0,void 0)}function Xi(t){this.f=t,this.b=this.c=this.a=null}function Ji(t,e){this.name=t,this.value=e}Wi.prototype.c=null,_(Ki,Wi),Ki.prototype.a=function(){var t=Qi(this);return t?new ActiveXObject(t):new XMLHttpRequest},Ki.prototype.b=function(){var t={};return Qi(this)&&(t[0]=!0,t[1]=!0),t},Bi=new Ki,_(Hi,Wi),Hi.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Gi;throw Error("Unsupported browser")},Hi.prototype.b=function(){return{}},(t=Gi.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.dc=function(){this.status=200,this.responseText=this.a.responseText,zi(this,4)},t.Eb=function(){this.status=500,this.responseText="",zi(this,4)},t.hc=function(){this.Eb()},t.ec=function(){this.status=200,zi(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Yi.prototype.a=null,Yi.prototype.reset=function(t,e,n,r,i){delete this.a},Ji.prototype.toString=function(){return this.name};var $i=new Ji("SEVERE",1e3),Zi=new Ji("WARNING",900),to=new Ji("CONFIG",700),eo=new Ji("FINE",500);Xi.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(I("Root logger has no level set."),null)}(this).value)for(l(e)&&(e=e()),t=new Yi(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var no={},ro=null;function io(t){var e;if(ro||(ro=new Xi(""),no[""]=ro,ro.c=to),!(e=no[t])){e=new Xi(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=io(t.substr(0,n))).b||(n.b={}),n.b[r]=e,e.a=n,no[t]=e}return e}function oo(t,e){t&&t.log(eo,e,void 0)}function so(t){this.f=t}function ao(t){ke.call(this),this.i=t,this.readyState=uo,this.status=0,this.responseText=this.statusText="",this.onreadystatechange=null,this.g=new Headers,this.b=null,this.h="GET",this.c="",this.a=!1,this.f=io("goog.net.FetchXmlHttp")}_(so,Wi),so.prototype.a=function(){return new ao(this.f)},so.prototype.b=function(t){return function(){return t}}({}),_(ao,ke);var uo=0;function co(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function ho(t){ke.call(this),this.headers=new Ue,this.C=t||null,this.c=!1,this.w=this.a=null,this.h=this.N=this.m="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.o=lo,this.v=this.O=!1}(t=ao.prototype).open=function(t,e){if(this.readyState!=uo)throw this.abort(),Error("Error reopening a connection");this.h=t,this.c=e,this.readyState=1,co(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.g,method:this.h,credentials:void 0,cache:void 0};t&&(e.body=t),this.i.fetch(new Request(this.c,e)).then(this.gc.bind(this),this.Fb.bind(this))},t.abort=function(){this.responseText="",this.g=new Headers,this.status=0,1<=this.readyState&&this.a&&4!=this.readyState&&(this.readyState=4,this.a=!1,co(this)),this.readyState=uo},t.gc=function(t){this.a&&(this.b||(this.b=t.headers,this.readyState=2,co(this)),this.a&&(this.readyState=3,co(this),this.a&&t.text().then(this.fc.bind(this,t),this.Fb.bind(this))))},t.fc=function(t,e){this.a&&(this.status=t.status,this.statusText=t.statusText,this.responseText=e,this.readyState=4,co(this))},t.Fb=function(t){var e=this.f;e&&e.log(Zi,"Failed to fetch url "+this.c,t instanceof Error?t:Error(t)),this.a&&(this.readyState=4,co(this))},t.setRequestHeader=function(t,e){this.g.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.f)&&t.log(Zi,"Attempting to get response header but no headers have been received for url: "+this.c,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.f;return t&&t.log(Zi,"Attempting to get all response headers but no headers have been received for url: "+this.c,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},_(ho,ke);var lo="";ho.prototype.b=io("goog.net.XhrIo");var fo=/^https?$/i,po=["POST","PUT"];function yo(t,e,i,o,s){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.m+"; newUri="+e);i=i?i.toUpperCase():"GET",t.m=e,t.h="",t.N=i,t.G=!1,t.c=!0,t.a=t.C?t.C.a():Bi.a(),t.w=t.C?ji(t.C):ji(Bi),t.a.onreadystatechange=g(t.Ib,t);try{oo(t.b,So(t,"Opening Xhr")),t.I=!0,t.a.open(i,String(e),!0),t.I=!1}catch(e){return oo(t.b,So(t,"Error opening Xhr: "+e.message)),void go(t,e)}e=o||"";var a=new Ue(t.headers);s&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(h(t)||r(t))P(t,e,void 0);else for(var n=Fe(t),i=xe(t),o=i.length,s=0;s<o;s++)e.call(void 0,i[s],n&&n[s],t)}(s,function(t,e){a.set(e,t)}),s=function(t){t:{for(var e=mo,n=t.length,i=r(t)?t.split(""):t,o=0;o<n;o++)if(o in i&&e.call(void 0,i[o],o,t)){e=o;break t}e=-1}return 0>e?null:r(t)?t.charAt(e):t[e]}(a.U()),o=n.FormData&&e instanceof n.FormData,!x(po,i)||s||o||a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.o&&(t.a.responseType=t.o),"withCredentials"in t.a&&t.a.withCredentials!==t.O&&(t.a.withCredentials=t.O);try{wo(t),0<t.g&&(t.v=function(t){return Kt&&ee(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),oo(t.b,So(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=g(t.Ga,t)):t.u=Le(t.Ga,t.g,t)),oo(t.b,So(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){oo(t.b,So(t,"Send error: "+e.message)),go(t,e)}}function mo(t){return"content-type"==t.toLowerCase()}function go(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,vo(t),_o(t)}function vo(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function bo(t){if(t.c&&void 0!==e)if(t.w[1]&&4==Eo(t)&&2==To(t))oo(t.b,So(t,"Local request error detected and ignored"));else if(t.i&&4==Eo(t))Le(t.Ib,0,t);else if(t.dispatchEvent("readystatechange"),4==Eo(t)){oo(t.b,So(t,"Request complete")),t.c=!1;try{var r,i=To(t);t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break t;default:o=!1}if(!(r=o)){var s;if(s=0===i){var a=String(t.m).match(Ve)[1]||null;if(!a&&n.self&&n.self.location){var u=n.self.location.protocol;a=u.substr(0,u.length-1)}s=!fo.test(a?a.toLowerCase():"")}r=s}if(r)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<Eo(t)?t.a.statusText:""}catch(e){oo(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+To(t)+"]",vo(t)}}finally{_o(t)}}}function _o(t,e){if(t.a){wo(t);var n=t.a,r=t.w[0]?o:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log($i,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function wo(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(n.clearTimeout(t.u),t.u=null)}function Eo(t){return t.a?t.a.readyState:0}function To(t){try{return 2<Eo(t)?t.a.status:-1}catch(t){return-1}}function So(t,e){return e+" ["+t.N+" "+t.m+" "+To(t)+"]"}function Io(t,e){this.g=[],this.v=t,this.u=e||null,this.f=this.a=!1,this.c=void 0,this.m=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function Co(t,e,n){t.a=!0,t.c=n,t.f=!e,ko(t)}function No(t){if(t.a){if(!t.m)throw new Ro(t);t.m=!1}}function Do(t,e,n,r){t.g.push([e,n,r]),t.a&&ko(t)}function Ao(t){return M(t.g,function(t){return l(t[1])})}function ko(t){if(t.h&&t.a&&Ao(t)){var e=t.h,r=Lo[e];r&&(n.clearTimeout(r.a),delete Lo[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var i=r=!1;t.g.length&&!t.i;){var o=t.g.shift(),s=o[0],a=o[1];if(o=o[2],s=t.f?a:s)try{var u=s.call(o||t.u,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(E(e)||"function"==typeof n.Promise&&e instanceof n.Promise)&&(i=!0,t.i=!0)}catch(n){e=n,t.f=!0,Ao(t)||(r=!0)}}t.c=e,i&&(u=g(t.o,t,!0),i=g(t.o,t,!1),e instanceof Io?(Do(e,u,i),e.w=!0):e.then(u,i)),r&&(e=new Po(e),Lo[e.a]=e,t.h=e.a)}function Ro(){T.call(this)}function Oo(){T.call(this)}function Po(t){this.a=n.setTimeout(g(this.c,this),0),this.b=t}(t=ho.prototype).Ga=function(){void 0!==e&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",oo(this.b,So(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(oo(this.b,So(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),_o(this))},t.ua=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),_o(this,!0)),ho.nb.ua.call(this)},t.Ib=function(){this.pa||(this.I||this.i||this.f?bo(this):this.vc())},t.vc=function(){bo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.o){case lo:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log($i,"Response type "+this.o+" is not supported on this browser",void 0),null}catch(t){return oo(this.b,"Can not get response: "+t.message),null}},Io.prototype.cancel=function(t){if(this.a)this.c instanceof Io&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,0>=e.l&&e.cancel())}this.v?this.v.call(this.u,this):this.m=!0,this.a||(t=new Oo(this),No(this),Co(this,!1,t))}},Io.prototype.o=function(t,e){this.i=!1,Co(this,t,e)},Io.prototype.C=function(){No(this),Co(this,!0,null)},Io.prototype.then=function(t,e,n){var r,i,o=new yt(function(t,e){r=t,i=e});return Do(this,r,function(t){t instanceof Oo?o.cancel():i(t)}),o.then(t,e,n)},w(Io),_(Ro,T),Ro.prototype.message="Deferred has already fired",Ro.prototype.name="AlreadyCalledError",_(Oo,T),Oo.prototype.message="Deferred was canceled",Oo.prototype.name="CanceledError",Po.prototype.c=function(){throw delete Lo[this.a],this.b};var Lo={};function Mo(t){var e={},n=e.document||document,r=vn(t),i=document.createElement("SCRIPT"),o={Kb:i,Ga:void 0},s=new Io(xo,o),a=null,u=null!=e.timeout?e.timeout:5e3;return 0<u&&(a=window.setTimeout(function(){Fo(i,!0);var t=new Bo(qo,"Timeout reached for loading script "+r);No(s),Co(s,!1,t)},u),o.Ga=a),i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Fo(i,e.ed||!1,a),s.C())},i.onerror=function(){Fo(i,!0,a);var t=new Bo(Uo,"Error while loading script "+r);No(s),Co(s,!1,t)},ct(o=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),Pn(i,o),i.src=vn(t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function xo(){if(this&&this.Kb){var t=this.Kb;t&&"SCRIPT"==t.tagName&&Fo(t,!0,this.Ga)}}function Fo(t,e,r){null!=r&&n.clearTimeout(r),t.onload=o,t.onerror=o,t.onreadystatechange=o,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Uo=0,qo=1;function Bo(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),T.call(this,n),this.code=t}function Vo(t){this.f=t}function Wo(t,e,r){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.l=t.secureTokenTimeout||Qo,this.f=ot(t.secureTokenHeaders||Ho),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||Go,this.a=ot(t.firebaseHeaders||zo),r&&(this.a["X-Client-Version"]=r,this.f["X-Client-Version"]=r),r="Node"==$n(),!(r=n.XMLHttpRequest||r&&Qn.INTERNAL.node&&Qn.INTERNAL.node.XMLHttpRequest)&&!Jn())throw new kr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,Jn()?this.c=new so(self):Zn()?this.c=new Vo(r):this.c=new Hi}_(Bo,T),_(Vo,Wi),Vo.prototype.a=function(){return new this.f},Vo.prototype.b=function(){return{}};var jo,Ko="idToken",Qo=new vr(3e4,6e4),Ho={"Content-Type":"application/x-www-form-urlencoded"},Go=new vr(3e4,6e4),zo={"Content-Type":"application/json"};function Yo(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Xo(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function Jo(t,e,r,i,o,s,a){(function(){var t=or();return!((t=nr(t)!=er?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t||Kt&&Zt&&!(9<Zt))})()||Jn()?t=g(t.o,t):(jo||(jo=new yt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{n[Zo]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var r=bn($o,{onload:Zo});!function(t,e){Do(Mo(r),null,e,void 0)}(0,function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)})),t=g(t.m,t)),t(e,r,i,o,s,a)}Wo.prototype.o=function(t,e,r,i,o,s){if(Jn()&&(void 0===n.fetch||void 0===n.Headers||void 0===n.Request))throw new kr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new ho(this.c);if(s){a.g=Math.max(0,s);var u=setTimeout(function(){a.dispatchEvent("timeout")},s)}Re(a,"complete",function(){u&&clearTimeout(u);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return oo(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)}),Oe(a,"ready",function(){u&&clearTimeout(u),qt(this)}),Oe(a,"timeout",function(){u&&clearTimeout(u),qt(this),e&&e(null)}),yo(a,t,r,i,o)};var $o=mn("https://apis.google.com/js/client.js?onload=%{onload}"),Zo="__fcb"+Math.floor(1e6*Math.random()).toString();function ts(t){if(!Vi.test(t.email))throw new kr("invalid-email")}function es(t){"email"in t&&ts(t)}function ns(t){if(!t[Ko])throw new kr("internal-error")}function rs(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new kr("internal-error")}else{if(!t.sessionInfo)throw new kr("missing-verification-id");if(!t.code)throw new kr("missing-verification-code")}}Wo.prototype.m=function(t,e,n,r,i){var o=this;jo.then(function(){window.gapi.client.setApiKey(o.b);var s=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(s),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Wo.prototype.Pa=function(){return Us(this,As,{})},Wo.prototype.ob=function(t,e){return Us(this,Ns,{idToken:t,email:e})},Wo.prototype.pb=function(t,e){return Us(this,Ds,{idToken:t,password:e})};var is={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function os(t){if(!t.requestUri||!t.sessionId&&!t.postBody)throw new kr("internal-error")}function ss(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=qi(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=qi(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=qi(t)):t.errorMessage&&(e=qs(t.errorMessage)),e)throw e;if(!t[Ko])throw new kr("internal-error")}function as(t,e){return e.returnIdpCredential=!0,Us(t,ks,e)}function us(t,e){return e.returnIdpCredential=!0,Us(t,Os,e)}function cs(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Us(t,Rs,e)}function hs(t){if(!t.oobCode)throw new kr("invalid-action-code")}(t=Wo.prototype).qb=function(t,e){var n={idToken:t},r=[];return rt(is,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),Us(this,Ns,n)},t.jb=function(t,e){return ct(t={requestType:"PASSWORD_RESET",email:t},e),Us(this,Es,t)},t.kb=function(t,e){return ct(t={requestType:"EMAIL_SIGNIN",email:t},e),Us(this,_s,t)},t.ib=function(t,e){return ct(t={requestType:"VERIFY_EMAIL",idToken:t},e),Us(this,ws,t)},t.Ta=function(t){return Us(this,Ms,t)},t.Ya=function(t,e){return Us(this,Is,{oobCode:t,newPassword:e})},t.Ja=function(t){return Us(this,fs,{oobCode:t})},t.Va=function(t){return Us(this,ls,{oobCode:t})};var ls={endpoint:"setAccountInfo",B:hs,da:"email"},fs={endpoint:"resetPassword",B:hs,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new kr("internal-error")}},ps={endpoint:"signupNewUser",B:function(t){if(ts(t),!t.password)throw new kr("weak-password")},J:ns,R:!0},ds={endpoint:"createAuthUri"},ys={endpoint:"deleteAccount",T:["idToken"]},ms={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],B:function(t){if(!u(t.deleteProvider))throw new kr("internal-error")}},gs={endpoint:"emailLinkSignin",T:["email","oobCode"],B:ts,J:ns,R:!0},vs={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],B:ts,J:ns,R:!0},bs={endpoint:"getAccountInfo"},_s={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new kr("internal-error");ts(t)},da:"email"},ws={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],B:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new kr("internal-error")},da:"email"},Es={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("PASSWORD_RESET"!=t.requestType)throw new kr("internal-error");ts(t)},da:"email"},Ts={tb:!0,endpoint:"getProjectConfig",Hb:"GET"},Ss={tb:!0,endpoint:"getRecaptchaParam",Hb:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new kr("internal-error")}},Is={endpoint:"resetPassword",B:hs,da:"email"},Cs={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},Ns={endpoint:"setAccountInfo",T:["idToken"],B:es,R:!0},Ds={endpoint:"setAccountInfo",T:["idToken"],B:function(t){if(es(t),!t.password)throw new kr("weak-password")},J:ns,R:!0},As={endpoint:"signupNewUser",J:ns,R:!0},ks={endpoint:"verifyAssertion",B:os,J:ss,R:!0},Rs={endpoint:"verifyAssertion",B:os,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new kr("user-not-found");if(t.errorMessage)throw qs(t.errorMessage);if(!t[Ko])throw new kr("internal-error")},R:!0},Os={endpoint:"verifyAssertion",B:function(t){if(os(t),!t.idToken)throw new kr("internal-error")},J:ss,R:!0},Ps={endpoint:"verifyCustomToken",B:function(t){if(!t.token)throw new kr("invalid-custom-token")},J:ns,R:!0},Ls={endpoint:"verifyPassword",B:function(t){if(ts(t),!t.password)throw new kr("wrong-password")},J:ns,R:!0},Ms={endpoint:"verifyPhoneNumber",B:rs,J:ns},xs={endpoint:"verifyPhoneNumber",B:function(t){if(!t.idToken)throw new kr("internal-error");rs(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",qi(t);ns(t)}},Fs={Wb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",B:rs,J:ns};function Us(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Tt(new kr("internal-error"));var r,i=e.Hb||"POST";return Et(n).then(e.B).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,n,r,i,o){var s=ze(t.g+e);He(s,"key",t.b),o&&He(s,"cb",b().toString());var a="GET"==n;if(a)for(var u in r)r.hasOwnProperty(u)&&He(s,u,r[u]);return new yt(function(e,o){Jo(t,s.toString(),function(t){t?t.error?o(Bs(t,i||{})):e(t):o(new kr("network-request-failed"))},n,a?void 0:xn(pr(r)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Wb,e.tb||!1)}).then(function(t){return r=t}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new kr("internal-error");return r[e.da]})}function qs(t){return Bs({error:{errors:[{message:t}],code:400,message:t}})}function Bs(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new kr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",ct(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new kr(r[i],e);return!e&&t&&(e=fr(t)),new kr("internal-error",e)}var Vs,Ws={Zc:{$a:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",hb:"https://securetoken.googleapis.com/v1/token",id:"p"},ad:{$a:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",hb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},bd:{$a:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",hb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function js(t){for(var e in Ws)if(Ws[e].id===t)return{firebaseEndpoint:(t=Ws[e]).$a,secureTokenEndpoint:t.hb};return null}function Ks(t){this.b=t,this.a=null,this.eb=function(t){return(zs||(zs=new yt(function(t,e){function r(){gr(),sr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){gr(),e(Error("Network Error"))},timeout:Hs.get()})}if(sr("gapi.iframes.Iframe"))t();else if(sr("gapi.load"))r();else{var i="__iframefcb"+Math.floor(1e6*Math.random()).toString();n[i]=function(){sr("gapi.load")?r():e(Error("Network Error"))},Et(Mo(i=bn(Qs,{onload:i}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw zs=null,t}))).then(function(){return new yt(function(e,n){sr("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:sr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},Gs.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})})}(this)}Vs=js("__EID__")?"__EID__":void 0;var Qs=mn("https://apis.google.com/js/api.js?onload=%{onload}"),Hs=new vr(3e4,6e4),Gs=new vr(5e3,15e3),zs=null;function Ys(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Ye(this.i,"/__/auth/iframe"),He(this.a,"apiKey",this.g),He(this.a,"appName",this.h),this.b=null,this.c=[]}function Xs(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.l=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function Js(t){try{return Qn.app(t).auth().xa()}catch(t){return[]}}function $s(t,e,n,r,i){this.m=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.o=this.u=this.v=null,this.g=[],this.l=this.a=null}function Zs(t){var e=Vn();return function(t){return Us(t,Ts,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=ze(e),r=n.c;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],s=n,a=r;if(0==o.indexOf("chrome-extension://")?s=ze(o).b==s&&"chrome-extension"==a:"http"!=a&&"https"!=a?s=!1:Gn.test(o)?s=s==o:(o=o.split(".").join("\\."),s=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(s)),s){t=!0;break t}}t=!1}if(!t)throw new Fi(Vn())})}function ta(t){return t.l?t.l:(t.l=zn().then(function(){if(!t.u){var e=t.c,n=t.h,r=Js(t.b),i=new Ys(t.m,t.f,t.b);i.f=e,i.b=n,i.c=B(r||[]),t.u=i.toString()}t.i=new Ks(t.u),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.eb.then(function(){t.a.register("authEvent",e,sr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.i,function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=Li(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Et(n)}return n.status="ERROR",Et(n)})}(t)}),t.l)}function ea(t){return t.o||(t.v=t.c?ir(t.c,Js(t.b)):null,t.o=new Wo(t.f,js(t.h),t.v)),t.o}function na(t,e,n,r,i,o,s,a,u,c){return(t=new Xs(t,e,n,r,i)).i=o,t.g=s,t.h=a,t.b=ot(u||null),t.f=c,t.toString()}function ra(t){if(this.a=t||Qn.INTERNAL.reactNative&&Qn.INTERNAL.reactNative.AsyncStorage,!this.a)throw new kr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function ia(t){this.b=t,this.a={},this.c=g(this.f,this)}Ys.prototype.toString=function(){return this.f?He(this.a,"v",this.f):un(this.a.a,"v"),this.b?He(this.a,"eid",this.b):un(this.a.a,"eid"),this.c.length?He(this.a,"fw",this.c.join(",")):un(this.a.a,"fw"),this.a.toString()},Xs.prototype.toString=function(){var t=Ye(this.o,"/__/auth/handler");if(He(t,"apiKey",this.m),He(t,"appName",this.c),He(t,"authType",this.l),this.a.isOAuthProvider){var e=this.a;try{var n=Qn.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.Za=n,He(t,"providerId",this.a.providerId),n=pr((e=this.a).xb))n[r]=n[r].toString();r=e.Cc,n=ot(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.bb&&e.Za&&!n[e.bb]&&(n[e.bb]=e.Za),it(n)||He(t,"customParameters",fr(n))}if("function"==typeof this.a.Db&&(e=this.a.Db()).length&&He(t,"scopes",e.join(",")),this.i?He(t,"redirectUrl",this.i):un(t.a,"redirectUrl"),this.g?He(t,"eventId",this.g):un(t.a,"eventId"),this.h?He(t,"v",this.h):un(t.a,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!Ge(t,s)&&He(t,s,this.b[s]);return this.f?He(t,"eid",this.f):un(t.a,"eid"),(s=Js(this.c)).length&&He(t,"fw",s.join(",")),t.toString()},(t=$s.prototype).Ea=function(t,e,n){var r=new kr("popup-closed-by-user"),i=new kr("web-storage-unsupported"),o=this,s=!1;return this.ga().then(function(){(function(t){var e={type:"webStorageSupport"};return ta(t).then(function(){return function(t,e){return t.eb.then(function(){return new yt(function(n){t.a.send(e.type,e,n,sr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&Kn(t),e(i),s=!0)})}).s(function(){}).then(function(){if(!s)return function(t){return new yt(function(e){return function n(){Me(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!s)return Me(n).then(function(){e(r)})})},t.Lb=function(){var t=or();return!lr(t)&&!mr(t)},t.Gb=function(){return!1},t.Bb=function(t,e,n,r,i,o,s){if(!t)return Tt(new kr("popup-blocked"));if(s&&!lr())return this.ga().s(function(e){Kn(t),i(e)}),r(),Et();this.a||(this.a=Zs(ea(this)));var a=this;return this.a.then(function(){var e=a.ga().s(function(e){throw Kn(t),i(e),e});return r(),e}).then(function(){Oi(n),s||Wn(na(a.m,a.f,a.b,e,n,null,o,a.c,void 0,a.h),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(a.a=null),t})},t.Ca=function(t,e,n){this.a||(this.a=Zs(ea(this)));var r=this;return this.a.then(function(){Oi(e),Wn(na(r.m,r.f,r.b,t,e,Vn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.ga=function(){var t=this;return ta(this).then(function(){return t.i.eb}).s(function(){throw t.a=null,new kr("network-request-failed")})},t.Pb=function(){return!0},t.va=function(t){this.g.push(t)},t.Ka=function(t){U(this.g,function(e){return e==t})},(t=ra.prototype).get=function(t){return Et(this.a.getItem(t)).then(function(t){return t&&dr(t)})},t.set=function(t,e){return Et(this.a.setItem(t,fr(e)))},t.P=function(t){return Et(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var oa,sa=[];function aa(t){this.a=t}function ua(t){this.c=t,this.b=!1,this.a=[]}function ca(t,e,n,r){var i,o,s,a,u=n||{},c=null;if(t.b)return Tt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new yt(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),s=setTimeout(function(){r(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(s),a=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(a),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(s),clearTimeout(a),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return ha(t,c),e}).s(function(e){throw ha(t,c),e})}function ha(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),U(t.a,function(t){return t==e})}}function la(){if(!pa())throw new kr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.m=n.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.u=!1,this.h=null;var t=this;Jn()&&self?(this.l=function(){var t=Jn()?self:null;if(P(sa,function(n){n.b==t&&(e=n)}),!e){var e=new ia(t);sa.push(e)}return e}(),this.l.subscribe("keyChanged",function(e,n){return va(t).then(function(e){return 0<e.length&&P(t.a,function(t){t(e)}),{keyProcessed:x(e,n.key)}})}),this.l.subscribe("ping",function(){return Et(["keyChanged"])})):function(){var t=n.navigator;return t&&t.serviceWorker?Et().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Et(null)}().then(function(e){(t.h=e)&&(t.g=new ua(new aa(e)),ca(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&x(e[0].value,"keyChanged")&&(t.u=!0)}).s(function(){}))})}function fa(t){return t.o||(t.o=function t(e){return new yt(function(n,r){var i=e.m.open("firebaseLocalStorageDb",1);i.onerror=function(t){try{t.preventDefault()}catch(t){}r(Error(t.target.error))},i.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){r(t)}},i.onsuccess=function(i){(i=i.target.result).objectStoreNames.contains("firebaseLocalStorage")?n(i):function(t){return new yt(function(e,n){var r=t.m.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}})}(e).then(function(){return t(e)}).then(function(t){n(t)}).s(function(t){r(t)})}})}(t)),t.o}function pa(){try{return!!n.indexedDB}catch(t){return!1}}function da(t){return t.objectStore("firebaseLocalStorage")}function ya(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function ma(t){return new yt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function ga(t,e){return t.g&&t.h&&function(){var t=n.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?ca(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):Et()}function va(t){return fa(t).then(function(t){var e=da(ya(t,!1));return e.getAll?ma(e.getAll()):new yt(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?c(e[r])!=c(n[r])?i.push(r):"object"==c(e[r])&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function ba(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function _a(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Et().then(function(){if(pa()){var t=yr(),r="__sak"+t;return oa||(oa=new la),(n=oa).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.P(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.Y(function(t){P(e.a,function(e){e(t)})}),t})}function wa(){this.a={},this.type="inMemory"}function Ea(){if(!function(){var t="Node"==$n();if(!(t=Ta()||t&&Qn.INTERNAL.node&&Qn.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==$n())throw new kr("internal-error","The LocalStorage compatibility library was not found.");throw new kr("web-storage-unsupported")}this.a=Ta()||Qn.INTERNAL.node.localStorage,this.type="localStorage"}function Ta(){try{var t=n.localStorage,e=yr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Sa(){this.type="nullStorage"}function Ia(){if(!function(){var t="Node"==$n();if(!(t=Ca()||t&&Qn.INTERNAL.node&&Qn.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==$n())throw new kr("internal-error","The SessionStorage compatibility library was not found.");throw new kr("web-storage-unsupported")}this.a=Ca()||Qn.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Ca(){try{var t=n.sessionStorage,e=yr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}ia.prototype.f=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];P(r,function(e){i.push(Et().then(function(){return e(t.origin,t.data.data)}))}),It(i).then(function(r){var i=[];P(r,function(t){i.push({fulfilled:t.Cb,value:t.value,reason:t.reason?t.reason.message:void 0})}),P(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},ia.prototype.subscribe=function(t,e){it(this.a)&&this.b.addEventListener("message",this.c),void 0===this.a[t]&&(this.a[t]=[]),this.a[t].push(e)},ia.prototype.unsubscribe=function(t,e){void 0!==this.a[t]&&e?(U(this.a[t],function(t){return t==e}),0==this.a[t].length&&delete this.a[t]):e||delete this.a[t],it(this.a)&&this.b.removeEventListener("message",this.c)},aa.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},ua.prototype.close=function(){for(;0<this.a.length;)ha(this,this.a[0]);this.b=!0},(t=la.prototype).set=function(t,e){var n,r=!1,i=this;return fa(this).then(function(e){return ma((e=da(ya(n=e,!0))).get(t))}).then(function(o){var s=da(ya(n,!0));return o?(o.value=e,ma(s.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,ma(s.add(o)))}).then(function(){return i.c[t]=e,ga(i,t)}).ia(function(){r&&i.b--})},t.get=function(t){return fa(this).then(function(e){return ma(da(ya(e,!1)).get(t))}).then(function(t){return t&&t.value})},t.P=function(t){var e=!1,n=this;return fa(this).then(function(r){return e=!0,n.b++,ma(da(ya(r,!0)).delete(t))}).then(function(){return delete n.c[t],ga(n,t)}).ia(function(){e&&n.b--})},t.Y=function(t){0==this.a.length&&function(t){ba(t),function e(){t.f=setTimeout(function(){t.i=va(t).then(function(e){0<e.length&&P(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ca=function(t){U(this.a,function(e){return e==t}),0==this.a.length&&ba(this)},(t=_a.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},t.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},t.P=function(t){return this.b.then(function(e){return e.P(t)})},t.Y=function(t){this.a.push(t)},t.ca=function(t){U(this.a,function(e){return e==t})},(t=wa.prototype).get=function(t){return Et(this.a[t])},t.set=function(t,e){return this.a[t]=e,Et()},t.P=function(t){return delete this.a[t],Et()},t.Y=function(){},t.ca=function(){},(t=Ea.prototype).get=function(t){var e=this;return Et().then(function(){return dr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Et().then(function(){var r=fr(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return Et().then(function(){e.a.removeItem(t)})},t.Y=function(t){n.window&&ve(n.window,"storage",t)},t.ca=function(t){n.window&&we(n.window,"storage",t)},(t=Sa.prototype).get=function(){return Et(null)},t.set=function(){return Et()},t.P=function(){return Et()},t.Y=function(){},t.ca=function(){},(t=Ia.prototype).get=function(t){var e=this;return Et().then(function(){return dr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Et().then(function(){var r=fr(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return Et().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var Na,Da,Aa={A:Ea,Qa:Ia},ka={A:Ea,Qa:Ia},Ra={A:ra,Qa:Sa},Oa={A:Ea,Qa:Sa},Pa={Yc:"local",NONE:"none",$c:"session"};function La(){var t=!(mr(or())||!Xn()),e=lr(),r=ar();this.o=t,this.h=e,this.l=r,this.a={},Na||(Na=new function(){var t={};t.Browser=Aa,t.Node=ka,t.ReactNative=Ra,t.Worker=Oa,this.a=t[$n()]}),t=Na;try{this.g=!Bn()&&wr()||!n.indexedDB?new t.a.A:new _a(Jn()?new wa:new t.a.A)}catch(t){this.g=new wa,this.h=!0}try{this.i=new t.a.Qa}catch(t){this.i=new wa}this.m=new wa,this.f=g(this.Ob,this),this.b={}}function Ma(){return Da||(Da=new La),Da}function xa(t,e){switch(e){case"session":return t.i;case"none":return t.m;default:return t.g}}function Fa(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Ua(t,e,n){return n=Fa(e,n),"local"==e.A&&(t.b[n]=null),xa(t,e.A).P(n)}function qa(t){t.c&&(clearInterval(t.c),t.c=null)}(t=La.prototype).get=function(t,e){return xa(this,t.A).get(Fa(t,e))},t.set=function(t,e,n){var r=Fa(t,n),i=this,o=xa(this,t.A);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.A&&(i.b[r]=e)})},t.addListener=function(t,e,r){t=Fa(t,e),this.l&&(this.b[t]=n.localStorage.getItem(t)),it(this.a)&&(xa(this,"local").Y(this.f),this.h||(Bn()||!wr())&&n.indexedDB||!this.l||function(t){qa(t),t.c=setInterval(function(){for(var e in t.a){var r=n.localStorage.getItem(e),i=t.b[e];r!=i&&(t.b[e]=r,r=new ue({type:"storage",key:e,target:window,oldValue:i,newValue:r,a:!0}),t.Ob(r))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(r)},t.removeListener=function(t,e,n){t=Fa(t,e),this.a[t]&&(U(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),it(this.a)&&(xa(this,"local").ca(this.f),qa(this))},t.Ob=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var r in this.a){var i=this.b[r];void 0===i&&(i=null);var o=n.localStorage.getItem(r);o!==i&&(this.b[r]=o,this.Wa(r))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?xa(this,"local").ca(this.f):qa(this),this.o)if(r=n.localStorage.getItem(e),(i=t.a.newValue)!==r)null!==i?n.localStorage.setItem(e,i):n.localStorage.removeItem(e);else if(this.b[e]===i&&void 0===t.a.a)return;var s=this;r=function(){void 0===t.a.a&&s.b[e]===n.localStorage.getItem(e)||(s.b[e]=n.localStorage.getItem(e),s.Wa(e))},Kt&&Zt&&10==Zt&&n.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(r,10):r()}}else P(t,g(this.Wa,this))},t.Wa=function(t){this.a[t]&&P(this.a[t],function(t){t()})};var Ba,Va={name:"authEvent",A:"local"};function Wa(t,e){this.b=ja,this.f=n.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=n.Int32Array?new Int32Array(64):Array(64),void 0!==Ba||(Ba=n.Int32Array?new Int32Array(Xa):Xa),this.reset()}_(Wa,function(){this.b=-1});for(var ja=64,Ka=ja-1,Qa=[],Ha=0;Ha<Ka;Ha++)Qa[Ha]=0;var Ga=q(128,Qa);function za(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;64>e;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,s=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+s|0}r=0|t.a[0],i=0|t.a[1];var a=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&a^i&a)|0;s=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((s=(s=c&h^~c&l)+(0|Ba[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+s|0,u=a,a=i,i=r,r=s+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+a|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Ya(t,e,n){void 0===n&&(n=e.length);var i=0,o=t.c;if(r(e))for(;i<n;)t.f[o++]=e.charCodeAt(i++),o==t.b&&(za(t),o=0);else{if(!h(e))throw Error("message must be string or array");for(;i<n;){var s=e[i++];if(!("number"==typeof s&&0<=s&&255>=s&&s==(0|s)))throw Error("message must be a byte array");t.f[o++]=s,o==t.b&&(za(t),o=0)}}t.c=o,t.g+=n}Wa.prototype.reset=function(){this.g=this.c=0,this.a=n.Int32Array?new Int32Array(this.h):B(this.h)};var Xa=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Ja(){Wa.call(this,8,$a)}_(Ja,Wa);var $a=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Za(t,e,n,r,i){this.m=t,this.i=e,this.l=n,this.o=r||null,this.u=i||null,this.h=e+":"+n,this.v=new function(){this.a=Ma()},this.g=new function(t){this.a=t,this.b=Ma()}(this.h),this.f=null,this.b=[],this.a=this.c=null}function tu(t){return new kr("invalid-cordova-configuration",t)}function eu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function nu(t){return t.f||(t.f=t.ga().then(function(){return new yt(function(e){t.va(function n(r){return e(r),t.Ka(n),!1}),function(t){function e(e){i=!0,o&&o.cancel(),ru(t).then(function(n){var i=r;if(n&&e&&e.url){var o=null;-1!=(i=ci(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==c(o=dr(Ge(o=ze(i),"firebaseError")||null))?Rr(o):null)?new Pi(n.b,n.c,null,null,o):new Pi(n.b,n.c,i,n.g)),i=o||r}eu(t,i)})}var r=new Pi("unknown",null,null,null,new kr("no-auth-event")),i=!1,o=Me(500).then(function(){return ru(t).then(function(){i||eu(t,r)})}),s=n.handleOpenURL;n.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(sr("BuildInfo.packageName",n).toLowerCase()+"://")&&e({url:t}),"function"==typeof s)try{s(t)}catch(t){console.error(t)}},xi||(xi=new Mi),xi.subscribe(e)}(t)})})),t.f}function ru(t){var e=null;return function(t){return t.b.get(Va,t.a).then(function(t){return Li(t)})}(t.g).then(function(n){return e=n,Ua((n=t.g).b,Va,n.a)}).then(function(){return e})}(t=Za.prototype).ga=function(){return this.za?this.za:this.za=(Yn(void 0)?zn().then(function(){return new yt(function(t,e){var r=n.document,i=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);r.addEventListener("deviceready",function(){clearTimeout(i),t()},!1)})}):Tt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof sr("universalLinks.subscribe",n))throw tu("cordova-universal-links-plugin-fix is not installed");if(void 0===sr("BuildInfo.packageName",n))throw tu("cordova-plugin-buildinfo is not installed");if("function"!=typeof sr("cordova.plugins.browsertab.openUrl",n))throw tu("cordova-plugin-browsertab is not installed");if("function"!=typeof sr("cordova.InAppBrowser.open",n))throw tu("cordova-plugin-inappbrowser is not installed")},function(){throw new kr("cordova-not-ready")})},t.Ea=function(t,e){return e(new kr("operation-not-supported-in-this-environment")),Et()},t.Bb=function(){return Tt(new kr("operation-not-supported-in-this-environment"))},t.Pb=function(){return!1},t.Lb=function(){return!0},t.Gb=function(){return!0},t.Ca=function(t,e,r){if(this.c)return Tt(new kr("redirect-operation-pending"));var i=this,o=n.document,s=null,a=null,u=null,c=null;return this.c=Et().then(function(){return Oi(e),nu(i)}).then(function(){return function(t,e,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),s=new Pi(e,i,null,o,new kr("no-auth-event")),a=sr("BuildInfo.packageName",n);if("string"!=typeof a)throw new kr("invalid-cordova-configuration");var u=sr("BuildInfo.displayName",n),c={};if(or().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=a;else{if(!or().toLowerCase().match(/android/))return Tt(new kr("operation-not-supported-in-this-environment"));c.apn=a}u&&(c.appDisplayName=u),o=function(t){var e=new Ja;Ya(e,t),t=[];var n=8*e.g;56>e.c?Ya(e,Ga,56-e.c):Ya(e,Ga,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(za(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return L(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}(o),c.sessionId=o;var h=na(t.m,t.i,t.l,e,r,null,i,t.o,c,t.u);return t.ga().then(function(){var e=t.h;return t.v.a.set(Va,s.D(),e)}).then(function(){var e=sr("cordova.plugins.browsertab.isAvailable",n);if("function"!=typeof e)throw new kr("invalid-cordova-configuration");var r=null;e(function(e){if(e){if("function"!=typeof(r=sr("cordova.plugins.browsertab.openUrl",n)))throw new kr("invalid-cordova-configuration");r(h)}else{if("function"!=typeof(r=sr("cordova.InAppBrowser.open",n)))throw new kr("invalid-cordova-configuration");e=!(!(e=or()).match(/(iPad|iPhone|iPod).*OS 7_\d/i)&&!e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)),t.a=r(h,e?"_blank":"_system","location=yes")}})})}(i,t,e,r)}).then(function(){return new yt(function(t,e){a=function(){var e=sr("cordova.plugins.browsertab.close",n);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.va(a),u=function(){s||(s=Me(2e3).then(function(){e(new kr("redirect-cancelled-by-user"))}))},c=function(){br()&&u()},o.addEventListener("resume",u,!1),or().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return ru(i).then(function(){throw t})})}).ia(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),s&&s.cancel(),a&&i.Ka(a),i.c=null})},t.va=function(t){this.b.push(t),nu(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new Pi("unknown",null,null,null,new kr("no-auth-event")),t(e))})},t.Ka=function(t){U(this.b,function(e){return e==t})};var iu={name:"pendingRedirect",A:"session"};function ou(t){return Ua(t.b,iu,t.a)}function su(t,e,n){this.u=t,this.l=e,this.m=n,this.h=[],this.f=!1,this.i=g(this.ab,this),this.b=new mu,this.o=new _u,this.g=new function(t){this.a=t,this.b=Ma()}(this.l+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.o,this.c.linkViaPopup=this.o,this.c.reauthViaPopup=this.o,this.a=au(this.u,this.l,this.m,Vs)}function au(t,e,n,r){var i=Qn.SDK_VERSION||null;return Yn()?new Za(t,e,n,i,r):new $s(t,e,n,i,r)}function uu(t){t.f||(t.f=!0,t.a.va(t.i));var e=t.a;return t.a.ga().s(function(n){throw t.a==e&&t.reset(),n})}function cu(t){t.a.Lb()&&uu(t).s(function(e){var n=new Pi("unknown",null,null,null,new kr("operation-not-supported-in-this-environment"));pu(e)&&t.ab(n)}),t.a.Gb()||gu(t.b)}(t=su.prototype).reset=function(){this.f=!1,this.a.Ka(this.i),this.a=au(this.u,this.l,this.m)},t.Xa=function(){this.b.Xa()},t.subscribe=function(t){if(x(this.h,t)||this.h.push(t),!this.f){var e=this;(function(t){return t.b.get(iu,t.a).then(function(t){return"pending"==t})})(this.g).then(function(t){t?ou(e.g).then(function(){uu(e).s(function(t){var n=new Pi("unknown",null,null,null,new kr("operation-not-supported-in-this-environment"));pu(t)&&e.ab(n)})}):cu(e)}).s(function(){cu(e)})}},t.unsubscribe=function(t){U(this.h,function(e){return e==t})},t.ab=function(t){if(!t)throw new kr("invalid-auth-event");for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.ub(t.b,t.c)){(e=this.c[t.b])&&e.h(t,r),e=!0;break}}return gu(this.b),e};var hu=new vr(2e3,1e4),lu=new vr(3e4,6e4);function fu(t,e,n,r,i,o){return t.a.Bb(e,n,r,function(){t.f||(t.f=!0,t.a.va(t.i))},function(){t.reset()},i,o)}function pu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}su.prototype.fa=function(){return this.b.fa()},su.prototype.Ca=function(t,e,n){var r,i=this;return function(t){return t.b.set(iu,"pending",t.a)}(this.g).then(function(){return i.a.Ca(t,e,n).s(function(t){if(pu(t))throw new kr("operation-not-supported-in-this-environment");return r=t,ou(i.g).then(function(){throw r})}).then(function(){return i.a.Pb()?new yt(function(){}):ou(i.g).then(function(){return i.fa()}).then(function(){}).s(function(){})})})},su.prototype.Ea=function(t,e,n,r){return this.a.Ea(n,function(n){t.ha(e,null,n,r)},hu.get())};var du={};function yu(t,e,n){var r=e+":"+n;return du[r]||(du[r]=new su(t,e,n)),du[r]}function mu(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function gu(t){t.g||(t.g=!0,bu(t,!1,null,null))}function vu(t,e){if(t.b=function(){return Et(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function bu(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Tt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):vu(t,n):vu(t,{user:null}),t.f=[],t.c=[]}function _u(){}function wu(){this.rb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.rb},set:function(t){this.rb=t},enumerable:!1})}function Eu(t,e){this.a=e,Cr(this,"verificationId",t)}function Tu(t,e,n,r){return new Ai(t).Ta(e,n).then(function(t){return new Eu(t,r)})}function Su(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Iu(t){this.f=t,this.b=this.a=null,this.c=0}function Cu(t,e){var n=e[Ko],r=e.refreshToken;e=Nu(e.expiresIn),t.b=n,t.c=e,t.a=r}function Nu(t){return b()+1e3*parseInt(t,10)}function Du(t,e){this.a=t||null,this.b=e||null,Nr(this,{lastSignInTime:_r(e||null),creationTime:_r(t||null)})}function Au(t,e){for(var n in ae.call(this,t),e)this[n]=e[n]}function ku(t,e,n){this.G=[],this.m=t.apiKey,this.o=t.appName,this.u=t.authDomain||null,t=Qn.SDK_VERSION?ir(Qn.SDK_VERSION):null,this.b=new Wo(this.m,js(Vs),t),this.h=new Iu(this.b),Fu(this,e[Ko]),Cu(this.h,e),Cr(this,"refreshToken",this.h.a),Bu(this,n||{}),ke.call(this),this.I=!1,this.u&&ur()&&(this.a=yu(this.u,this.m,this.o)),this.N=[],this.i=null,this.w=function(t){return new Su(function(){return t.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=t.h.c-b()-3e5;return 0<e?e:0})}(this),this.V=g(this.Ha,this);var r=this;this.ka=null,this.sa=function(t){r.oa(t.g)},this.X=null,this.O=[],this.ra=function(t){Ou(r,t.c)},this.W=null}function Ru(t,e){t.X&&we(t.X,"languageCodeChanged",t.sa),(t.X=e)&&ve(e,"languageCodeChanged",t.sa)}function Ou(t,e){t.O=e,Xo(t.b,Qn.SDK_VERSION?ir(Qn.SDK_VERSION,t.O):null)}function Pu(t,e){t.W&&we(t.W,"frameworkChanged",t.ra),(t.W=e)&&ve(e,"frameworkChanged",t.ra)}function Lu(t){try{return Qn.app(t.o).auth()}catch(e){throw new kr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.o+"'!")}}function Mu(t){t.C||t.w.b||(t.w.start(),we(t,"tokenChanged",t.V),ve(t,"tokenChanged",t.V))}function xu(t){we(t,"tokenChanged",t.V),t.w.stop()}function Fu(t,e){t.qa=e,Cr(t,"_lat",e)}function Uu(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return It(e).then(function(){return t})}function qu(t){t.a&&!t.I&&(t.I=!0,t.a.subscribe(t))}function Bu(t,e){Nr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new Du(e.createdAt,e.lastLoginAt),providerData:[]})}function Vu(){}function Wu(t){return Et().then(function(){if(t.C)throw new kr("app-deleted")})}function ju(t){return L(t.providerData,function(t){return t.providerId})}function Ku(t,e){e&&(Qu(t,e.providerId),t.providerData.push(e))}function Qu(t,e){U(t.providerData,function(t){return t.providerId==e})}function Hu(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Cr(t,e,n)}function Gu(t,e){t!=e&&(Nr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,providerData:[]}),e.metadata?Cr(t,"metadata",function(t){return new Du(t.a,t.b)}(e.metadata)):Cr(t,"metadata",new Du),P(e.providerData,function(e){Ku(t,e)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.h,e.h),Cr(t,"refreshToken",t.h.a))}function zu(t){return t.F().then(function(e){var n=t.isAnonymous;return function(t,e){return Us(t.b,bs,{idToken:e}).then(g(t.wc,t))}(t,e).then(function(){return n||Hu(t,"isAnonymous",!1),e})})}function Yu(t,e){e[Ko]&&t.qa!=e[Ko]&&(Cu(t.h,e),t.dispatchEvent(new Au("tokenChanged")),Fu(t,e[Ko]),Hu(t,"refreshToken",t.h.a))}function Xu(t,e){return zu(t).then(function(){if(x(ju(t),e))return Uu(t).then(function(){throw new kr("provider-already-linked")})})}function Ju(t,e,n){return Dr({user:t,credential:Ri(e),additionalUserInfo:e=ti(e),operationType:n})}function $u(t,e){return Yu(t,e),t.reload().then(function(){return t})}function Zu(t,e,n,r,i){if(!ur())return Tt(new kr("operation-not-supported-in-this-environment"));if(t.i&&!i)return Tt(t.i);var o=Zr(n.providerId),s=yr(t.uid+":::"),a=null;(!lr()||Xn())&&t.u&&n.isOAuthProvider&&(a=na(t.u,t.m,t.o,e,n,null,s,Qn.SDK_VERSION||null));var u=Hn(a,o&&o.Ba,o&&o.Aa);return r=r().then(function(){if(ec(t),!i)return t.F().then(function(){})}).then(function(){return fu(t.a,u,e,n,s,!!a)}).then(function(){return new yt(function(n,r){t.ha(e,null,new kr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=s,t.c=t.a.Ea(t,e,u,s)})}).then(function(t){return u&&Kn(u),t?Dr(t):null}).s(function(t){throw u&&Kn(u),t}),nc(t,r,i)}function tc(t,e,n,r,i){if(!ur())return Tt(new kr("operation-not-supported-in-this-environment"));if(t.i&&!i)return Tt(t.i);var o=null,s=yr(t.uid+":::");return r=r().then(function(){if(ec(t),!i)return t.F().then(function(){})}).then(function(){return t.aa=s,Uu(t)}).then(function(e){return t.ba&&(e=(e=t.ba).b.set(ic,t.D(),e.a)),e}).then(function(){return t.a.Ca(e,n,s)}).s(function(e){if(o=e,t.ba)return oc(t.ba);throw o}).then(function(){if(o)throw o}),nc(t,r,i)}function ec(t){if(!t.a||!t.I){if(t.a&&!t.I)throw new kr("internal-error");throw new kr("auth-domain-config-required")}}function nc(t,e,n){var r=function(t,e,n){return t.i&&!n?(e.cancel(),Tt(t.i)):e.s(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.i||t.dispatchEvent(new Au("userInvalidated")),t.i=e),e})}(t,e,n);return t.G.push(r),r.ia(function(){F(t.G,r)}),r}function rc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Ko]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-b())/1e3;var r=new ku(e,n,t);return t.providerData&&P(t.providerData,function(t){t&&Ku(r,Dr(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}mu.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},mu.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.b,r=t.c,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(bu(this,!0,null,t.a),Et()):e.wa(n,r)?function(t,e,n){n=n.wa(e.b,e.c);var r=e.f,i=e.g,o=!!e.b.match(/Redirect$/);n(r,i).then(function(e){bu(t,o,e,null)}).s(function(e){bu(t,o,null,e)})}(this,t,e):Tt(new kr("invalid-auth-event")):(bu(this,!1,null,null),Et())}else Tt(new kr("invalid-auth-event"))},mu.prototype.Xa=function(){this.g&&!this.i&&bu(this,!1,null,null)},mu.prototype.fa=function(){var t=this;return new yt(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new kr("timeout");t.a&&t.a.cancel(),t.a=Me(lu.get()).then(function(){t.b||(t.g=!0,bu(t,!0,null,e))})}(t))})},_u.prototype.h=function(t,e){if(t){var n=t.b,r=t.c;t.a?(e.ha(t.b,null,t.a,t.c),Et()):e.wa(n,r)?function(t,e){var n=t.c,r=t.b;e.wa(r,n)(t.f,t.g).then(function(t){e.ha(r,t,null,n)}).s(function(t){e.ha(r,null,t,n)})}(t,e):Tt(new kr("invalid-auth-event"))}else Tt(new kr("invalid-auth-event"))},Eu.prototype.confirm=function(t){return t=ki(this.verificationId,t),this.a(t)},Su.prototype.start=function(){this.a=this.c,function t(e,r){e.stop(),e.b=Me(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,r)).then(function(){return t=n.document,e=null,br()||!t?Et():new yt(function(n){e=function(){br()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},Su.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Iu.prototype.D=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Iu.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Tt(new kr("user-token-expired")):t||!this.b||b()>this.c-3e4?this.a?function(t,e){return function(t,e){return new yt(function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?Jo(t,t.i+"?key="+encodeURIComponent(t.b),function(t){t?t.error?r(Bs(t)):t.access_token&&t.refresh_token?n(t):r(new kr("internal-error")):r(new kr("network-request-failed"))},"POST",an(e).toString(),t.f,t.l.get()):r(new kr("internal-error"))})}(t.f,e).then(function(e){return t.b=e.access_token,t.c=Nu(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}(this,{grant_type:"refresh_token",refresh_token:this.a}):Et(null):Et({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},Du.prototype.D=function(){return{lastLoginAt:this.b,createdAt:this.a}},_(Au,ae),_(ku,ke),ku.prototype.oa=function(t){this.ka=t,Yo(this.b,t)},ku.prototype.ea=function(){return this.ka},ku.prototype.xa=function(){return B(this.O)},ku.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},Cr(ku.prototype,"providerId","firebase"),(t=ku.prototype).reload=function(){var t=this;return nc(this,Wu(this).then(function(){return zu(t).then(function(){return Uu(t)}).then(Vu)}))},t.cc=function(t){return this.F(t).then(function(t){return new function(t){var e=Yr(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new kr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Nr(this,{token:t,expirationTime:_r(1e3*e.exp),authTime:_r(1e3*e.auth_time),issuedAtTime:_r(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}(t)})},t.F=function(t){var e=this;return nc(this,Wu(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new kr("internal-error");return t.accessToken!=e.qa&&(Fu(e,t.accessToken),e.dispatchEvent(new Au("tokenChanged"))),Hu(e,"refreshToken",t.refreshToken),t.accessToken}))},t.wc=function(t){if(!(t=t.users)||!t.length)throw new kr("internal-error");Bu(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?L(t,function(t){return new function(t,e,n,r,i,o){Nr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Ku(this,e[n]);Hu(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.fb=function(t){var e=this,n=null;return nc(this,t.f(this.b,this.uid).then(function(t){return Yu(e,t),n=Ju(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},t.xc=function(t){return Sr("firebase.User.prototype.reauthenticateWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential instead."),this.fb(t).then(function(){})},t.cb=function(t){var e=this,n=null;return nc(this,Xu(this,t.providerId).then(function(){return e.F()}).then(function(n){return t.c(e.b,n)}).then(function(t){return n=Ju(e,t,"link"),$u(e,t)}).then(function(){return n}))},t.oc=function(t){return Sr("firebase.User.prototype.linkWithCredential is deprecated. Please use firebase.User.prototype.linkAndRetrieveDataWithCredential instead."),this.cb(t).then(function(t){return t.user})},t.pc=function(t,e){var n=this;return nc(this,Xu(this,"phone").then(function(){return Tu(Lu(n),t,e,g(n.cb,n))}))},t.yc=function(t,e){var n=this;return nc(this,Et().then(function(){return Tu(Lu(n),t,e,g(n.fb,n))}),!0)},t.ob=function(t){var e=this;return nc(this,this.F().then(function(n){return e.b.ob(n,t)}).then(function(t){return Yu(e,t),e.reload()}))},t.Qc=function(t){var e=this;return nc(this,this.F().then(function(n){return t.c(e.b,n)}).then(function(t){return Yu(e,t),e.reload()}))},t.pb=function(t){var e=this;return nc(this,this.F().then(function(n){return e.b.pb(n,t)}).then(function(t){return Yu(e,t),e.reload()}))},t.qb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Wu(this);var e=this;return nc(this,this.F().then(function(n){return e.b.qb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return Yu(e,t),Hu(e,"displayName",t.displayName||null),Hu(e,"photoURL",t.photoUrl||null),P(e.providerData,function(t){"password"===t.providerId&&(Cr(t,"displayName",e.displayName),Cr(t,"photoURL",e.photoURL))}),Uu(e)}).then(Vu))},t.Oc=function(t){var e=this;return nc(this,zu(this).then(function(n){return x(ju(e),t)?function(t,e,n){return Us(t,ms,{idToken:e,deleteProvider:n})}(e.b,n,[t]).then(function(t){var n={};return P(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),P(ju(e),function(t){n[t]||Qu(e,t)}),n[Ai.PROVIDER_ID]||Cr(e,"phoneNumber",null),Uu(e)}):Uu(e).then(function(){throw new kr("no-such-provider")})}))},t.delete=function(){var t=this;return nc(this,this.F().then(function(e){return Us(t.b,ys,{idToken:e})}).then(function(){t.dispatchEvent(new Au("userDeleted"))})).then(function(){for(var e=0;e<t.G.length;e++)t.G[e].cancel("app-deleted");Ru(t,null),Pu(t,null),t.G=[],t.C=!0,xu(t),Cr(t,"refreshToken",null),t.a&&t.a.unsubscribe(t)})},t.ub=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ha=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.wa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?g(this.zb,this):"reauthViaPopup"==t&&e==(this.g||null)?g(this.Ab,this):"linkViaRedirect"==t&&(this.aa||null)==e?g(this.zb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?g(this.Ab,this):null},t.qc=function(t){var e=this;return Zu(this,"linkViaPopup",t,function(){return Xu(e,t.providerId).then(function(){return Uu(e)})},!1)},t.zc=function(t){return Zu(this,"reauthViaPopup",t,function(){return Et()},!0)},t.rc=function(t){var e=this;return tc(this,"linkViaRedirect",t,function(){return Xu(e,t.providerId)},!1)},t.Ac=function(t){return tc(this,"reauthViaRedirect",t,function(){return Et()},!0)},t.zb=function(t,e){var n=this;this.c&&(this.c.cancel(),this.c=null);var r=null;return nc(this,this.F().then(function(r){return us(n.b,{requestUri:t,sessionId:e,idToken:r})}).then(function(t){return r=Ju(n,t,"link"),$u(n,t)}).then(function(){return r}))},t.Ab=function(t,e){var n=this;this.c&&(this.c.cancel(),this.c=null);var r=null;return nc(this,Et().then(function(){return hi(cs(n.b,{requestUri:t,sessionId:e}),n.uid)}).then(function(t){return r=Ju(n,t,"reauthenticate"),Yu(n,t),n.i=null,n.reload()}).then(function(){return r}),!0)},t.ib=function(t){var e=this,n=null;return nc(this,this.F().then(function(e){return n=e,void 0===t||it(t)?{}:Kr(new Lr(t))}).then(function(t){return e.b.ib(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},t.toJSON=function(){return this.D()},t.D=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.m,appName:this.o,authDomain:this.u,stsTokenManager:this.h.D(),redirectEventId:this.aa||null};return this.metadata&&ct(t,this.metadata.D()),P(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var ic={name:"redirectUser",A:"session"};function oc(t){return Ua(t.b,ic,t.a)}function sc(t){this.a=t,this.b=Ma(),this.c=null,this.f=function(t){var e=cc("local"),r=cc("session"),i=cc("none");return function(t,e,r){var i=Fa(e,r),o=xa(t,e.A);return t.get(e,r).then(function(s){var a=null;try{a=dr(n.localStorage.getItem(i))}catch(t){}if(a&&!s)return n.localStorage.removeItem(i),t.set(e,a,r);a&&s&&"localStorage"!=o.type&&n.localStorage.removeItem(i)})}(t.b,e,t.a).then(function(){return t.b.get(r,t.a)}).then(function(n){return n?r:t.b.get(i,t.a).then(function(n){return n?i:t.b.get(e,t.a).then(function(n){return n?e:t.b.get(uc,t.a).then(function(t){return t?cc(t):e})})})}).then(function(e){return t.c=e,ac(t,e.A)}).s(function(){t.c||(t.c=e)})}(this),this.b.addListener(cc("local"),this.a,g(this.g,this))}function ac(t,e){var n,r=[];for(n in Pa)Pa[n]!==e&&r.push(Ua(t.b,cc(Pa[n]),t.a));return r.push(Ua(t.b,uc,t.a)),function(t){return new yt(function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},s=function(t){n(t)},a=0;a<t.length;a++)St(t[a],v(o,a),s);else e(i)})}(r)}sc.prototype.g=function(){var t=this,e=cc("local");pc(this,function(){return Et().then(function(){return t.c&&"local"!=t.c.A?t.b.get(e,t.a):null}).then(function(n){if(n)return ac(t,"local").then(function(){t.c=e})})})};var uc={name:"persistence",A:"session"};function cc(t){return{name:"authUser",A:t}}function hc(t,e){return pc(t,function(){return t.b.set(t.c,e.D(),t.a)})}function lc(t){return pc(t,function(){return Ua(t.b,t.c,t.a)})}function fc(t,e){return pc(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),rc(t||{})})})}function pc(t,e){return t.f=t.f.then(e,e),t.f}function dc(t){if(this.m=!1,Cr(this,"settings",new wu),Cr(this,"app",t),!wc(this).options||!wc(this).options.apiKey)throw new kr("invalid-api-key");t=Qn.SDK_VERSION?ir(Qn.SDK_VERSION):null,this.b=new Wo(wc(this).options&&wc(this).options.apiKey,js(Vs),t),this.N=[],this.o=[],this.I=[],this.Sb=Qn.INTERNAL.createSubscribe(g(this.kc,this)),this.O=void 0,this.Tb=Qn.INTERNAL.createSubscribe(g(this.mc,this)),bc(this,null),this.h=new sc(wc(this).options.apiKey+":"+wc(this).name),this.w=new function(t){this.a=t,this.b=Ma()}(wc(this).options.apiKey+":"+wc(this).name),this.V=Ic(this,function(t){var e=wc(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(ic,t.a).then(function(t){return t&&e&&(t.authDomain=e),rc(t||{})})}(t.w,wc(t).options.authDomain).then(function(e){return(t.C=e)&&(e.ba=t.w),oc(t.w)});return Ic(t,e)}(t).then(function(){return fc(t.h,e)}).then(function(e){return e?(e.ba=t.w,t.C&&(t.C.aa||null)==(e.aa||null)?e:e.reload().then(function(){return hc(t.h,e).then(function(){return e})}).s(function(n){return"auth/network-request-failed"==n.code?e:lc(t.h)})):null}).then(function(e){bc(t,e||null)});return Ic(t,n)}(this)),this.i=Ic(this,function(t){return t.V.then(function(){return t.fa()}).s(function(){}).then(function(){if(!t.m)return t.ka()}).s(function(){}).then(function(){if(!t.m){t.X=!0;var e=t.h;e.b.addListener(cc("local"),e.a,t.ka)}})}(this)),this.X=!1,this.ka=g(this.Lc,this),this.Ha=g(this.Z,this),this.qa=g(this.ac,this),this.ra=g(this.ic,this),this.sa=g(this.jc,this),function(t){var e=wc(t).options.authDomain,n=wc(t).options.apiKey;e&&ur()&&(t.Rb=t.V.then(function(){if(!t.m){if(t.a=yu(e,n,wc(t).name),t.a.subscribe(t),Ec(t)&&qu(Ec(t)),t.C){qu(t.C);var r=t.C;r.oa(t.ea()),Ru(r,t),Ou(r=t.C,t.G),Pu(r,t),t.C=null}return t.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=g(this.delete,this),this.INTERNAL.logFramework=g(this.sc,this),this.u=0,ke.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ea()},set:function(t){this.oa(t)},enumerable:!1}),t.W=null}(this),this.G=[]}function yc(t){ae.call(this,"languageCodeChanged"),this.g=t}function mc(t){ae.call(this,"frameworkChanged"),this.c=t}function gc(t){return t.Rb||Tt(new kr("auth-domain-config-required"))}function vc(t,e){var n={};return n.apiKey=wc(t).options.apiKey,n.authDomain=wc(t).options.authDomain,n.appName=wc(t).name,t.V.then(function(){return function(t,e,n,r){var i=new ku(t,e);return n&&(i.ba=n),r&&Ou(i,r),i.reload().then(function(){return i})}(n,e,t.w,t.xa())}).then(function(e){return Ec(t)&&e.uid==Ec(t).uid?(Gu(Ec(t),e),t.Z(e)):(bc(t,e),qu(e),t.Z(e))}).then(function(){Sc(t)})}function bc(t,e){Ec(t)&&(function(t,e){U(t.N,function(t){return t==e})}(Ec(t),t.Ha),we(Ec(t),"tokenChanged",t.qa),we(Ec(t),"userDeleted",t.ra),we(Ec(t),"userInvalidated",t.sa),xu(Ec(t))),e&&(e.N.push(t.Ha),ve(e,"tokenChanged",t.qa),ve(e,"userDeleted",t.ra),ve(e,"userInvalidated",t.sa),0<t.u&&Mu(e)),Cr(t,"currentUser",e),e&&(e.oa(t.ea()),Ru(e,t),Ou(e,t.G),Pu(e,t))}function _c(t,e){var n=null,r=null;return Ic(t,e.then(function(e){return n=Ri(e),r=ti(e),vc(t,e)}).then(function(){return Dr({user:Ec(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function wc(t){return t.app}function Ec(t){return t.currentUser}function Tc(t){return Ec(t)&&Ec(t)._lat||null}function Sc(t){if(t.X){for(var e=0;e<t.o.length;e++)t.o[e]&&t.o[e](Tc(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](Tc(t))}}function Ic(t,e){return t.N.push(e),e.ia(function(){F(t.N,e)}),e}function Cc(){}function Nc(){this.a={},this.b=1e12}sc.prototype.lb=function(t){var e=null,n=this;return function(t){var e=new kr("invalid-persistence-type"),n=new kr("unsupported-persistence-type");t:{for(r in Pa)if(Pa[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch($n()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!ar()&&"none"!==t)throw n}}(t),pc(this,function(){return t!=n.c.A?n.b.get(n.c,n.a).then(function(r){return e=r,ac(n,t)}).then(function(){if(n.c=cc(t),e)return n.b.set(n.c,e,n.a)}):Et()})},_(dc,ke),_(yc,ae),_(mc,ae),(t=dc.prototype).lb=function(t){return Ic(this,t=this.h.lb(t))},t.oa=function(t){this.W===t||this.m||(this.W=t,Yo(this.b,this.W),this.dispatchEvent(new yc(this.ea())))},t.ea=function(){return this.W},t.Rc=function(){var t=n.navigator;this.oa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.sc=function(t){this.G.push(t),Xo(this.b,Qn.SDK_VERSION?ir(Qn.SDK_VERSION,this.G):null),this.dispatchEvent(new mc(this.G))},t.xa=function(){return B(this.G)},t.toJSON=function(){return{apiKey:wc(this).options.apiKey,authDomain:wc(this).options.authDomain,appName:wc(this).name,currentUser:Ec(this)&&Ec(this).D()}},t.ub=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ha=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.wa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?g(this.$b,this):null},t.$b=function(t,e){var n=this;t={requestUri:t,sessionId:e},this.c&&(this.c.cancel(),this.c=null);var r=null,i=null,o=as(n.b,t).then(function(t){return r=Ri(t),i=ti(t),t});return Ic(this,t=n.V.then(function(){return o}).then(function(t){return vc(n,t)}).then(function(){return Dr({user:Ec(n),credential:r,additionalUserInfo:i,operationType:"signIn"})}))},t.Jc=function(t){if(!ur())return Tt(new kr("operation-not-supported-in-this-environment"));var e=this,n=Zr(t.providerId),r=yr(),i=null;(!lr()||Xn())&&wc(this).options.authDomain&&t.isOAuthProvider&&(i=na(wc(this).options.authDomain,wc(this).options.apiKey,wc(this).name,"signInViaPopup",t,null,r,Qn.SDK_VERSION||null));var o=Hn(i,n&&n.Ba,n&&n.Aa);return Ic(this,n=gc(this).then(function(e){return fu(e,o,"signInViaPopup",t,r,!!i)}).then(function(){return new yt(function(t,n){e.ha("signInViaPopup",null,new kr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.c=e.a.Ea(e,"signInViaPopup",o,r)})}).then(function(t){return o&&Kn(o),t?Dr(t):null}).s(function(t){throw o&&Kn(o),t}))},t.Kc=function(t){if(!ur())return Tt(new kr("operation-not-supported-in-this-environment"));var e=this;return Ic(this,gc(this).then(function(){return pc(t=e.h,function(){return t.b.set(uc,t.c.A,t.a)});var t}).then(function(){return e.a.Ca("signInViaRedirect",t)}))},t.fa=function(){if(!ur())return Tt(new kr("operation-not-supported-in-this-environment"));var t=this;return Ic(this,gc(this).then(function(){return t.a.fa()}).then(function(t){return t?Dr(t):null}))},t.Pc=function(t){if(!t)return Tt(new kr("null-user"));var e=this,n={};n.apiKey=wc(this).options.apiKey,n.authDomain=wc(this).options.authDomain,n.appName=wc(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.m,authDomain:t.u,appName:t.o};var i=t.h,o={};return o[Ko]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-b())/1e3,e=new ku(e,o),n&&(e.ba=n),r&&Ou(e,r),Gu(e,t),e}(t,n,e.w,e.xa());return Ic(this,this.i.then(function(){if(wc(e).options.apiKey!=t.m)return r.reload()}).then(function(){return Ec(e)&&t.uid==Ec(e).uid?(Gu(Ec(e),t),e.Z(t)):(bc(e,r),qu(r),e.Z(r))}).then(function(){Sc(e)}))},t.mb=function(){var t=this;return Ic(this,this.i.then(function(){return Ec(t)?(bc(t,null),lc(t.h).then(function(){Sc(t)})):Et()}))},t.Lc=function(){var t=this;return fc(this.h,wc(this).options.authDomain).then(function(e){if(!t.m){var n;if(n=Ec(t)&&e){n=Ec(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return Gu(Ec(t),e),Ec(t).F();(Ec(t)||e)&&(bc(t,e),e&&(qu(e),e.ba=t.w),t.a&&t.a.subscribe(t),Sc(t))}})},t.Z=function(t){return hc(this.h,t)},t.ac=function(){Sc(this),this.Z(Ec(this))},t.ic=function(){this.mb()},t.jc=function(){this.mb()},t.kc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Ec(e))})},t.mc=function(t){var e=this;!function(t,e){t.I.push(e),Ic(t,t.i.then(function(){!t.m&&x(t.I,e)&&t.O!==t.getUid()&&(t.O=t.getUid(),e(Tc(t)))}))}(this,function(){t.next(Ec(e))})},t.uc=function(t,e,n){var r=this;return this.X&&Qn.Promise.resolve().then(function(){l(t)?t(Ec(r)):l(t.next)&&t.next(Ec(r))}),this.Sb(t,e,n)},t.tc=function(t,e,n){var r=this;return this.X&&Qn.Promise.resolve().then(function(){r.O=r.getUid(),l(t)?t(Ec(r)):l(t.next)&&t.next(Ec(r))}),this.Tb(t,e,n)},t.bc=function(t){var e=this;return Ic(this,this.i.then(function(){return Ec(e)?Ec(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Mb=function(t){var e=this;return this.i.then(function(){return _c(e,Us(e.b,Ps,{token:t}))}).then(function(t){var n=t.user;return Hu(n,"isAnonymous",!1),e.Z(n),t})},t.Dc=function(t){return Sr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCustomToken is deprecated. Please use firebase.auth.Auth.prototype.signInWithCustomToken instead."),this.Mb(t)},t.Ec=function(t,e){return Sr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.signInWithEmailAndPassword instead."),this.Nb(t,e)},t.Nb=function(t,e){var n=this;return this.i.then(function(){return _c(n,Us(n.b,Ls,{email:t,password:e}))})},t.wb=function(t,e){var n=this;return this.i.then(function(){return _c(n,Us(n.b,ps,{email:t,password:e}))})},t.Vb=function(t,e){return Sr("firebase.auth.Auth.prototype.createUserAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.createUserWithEmailAndPassword instead."),this.wb(t,e)},t.Gc=function(t){return Sr("firebase.auth.Auth.prototype.signInWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential instead."),this.Oa(t).then(function(t){return t.user})},t.Oa=function(t){var e=this;return this.i.then(function(){return _c(e,t.ya(e.b))})},t.Pa=function(){var t=this;return this.i.then(function(){var e=Ec(t);return e&&e.isAnonymous?Dr({user:e,credential:null,additionalUserInfo:Dr({providerId:null,isNewUser:!1}),operationType:"signIn"}):_c(t,t.b.Pa()).then(function(e){var n=e.user;return Hu(n,"isAnonymous",!0),t.Z(n),e})})},t.Fc=function(){return Sr("firebase.auth.Auth.prototype.signInAnonymouslyAndRetrieveData is deprecated. Please use firebase.auth.Auth.prototype.signInAnonymously instead."),this.Pa()},t.getUid=function(){return Ec(this)&&Ec(this).uid||null},t.Ub=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&Ec(this)&&Mu(Ec(this))},t.Bc=function(t){var e=this;P(this.o,function(n){n==t&&e.u--}),0>this.u&&(this.u=0),0==this.u&&Ec(this)&&xu(Ec(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.o.push(t),Ic(this,this.i.then(function(){e.m||x(e.o,t)&&t(Tc(e))}))},t.removeAuthTokenListener=function(t){U(this.o,function(e){return e==t})},t.delete=function(){this.m=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener(cc("local"),t.a,this.ka),this.a&&(this.a.unsubscribe(this),this.a.Xa()),Qn.Promise.resolve()},t.Yb=function(t){return Sr("firebase.auth.Auth.prototype.fetchProvidersForEmail is deprecated. Please use firebase.auth.Auth.prototype.fetchSignInMethodsForEmail instead."),Ic(this,function(t,e){return Us(t,ds,{identifier:e,continueUri:cr()?Vn():"http://localhost"}).then(function(t){return t.allProviders||[]})}(this.b,t))},t.Zb=function(t){return Ic(this,function(t,e){return Us(t,ds,{identifier:e,continueUri:cr()?Vn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.nc=function(t){return!!Ci(t)},t.kb=function(t,e){var n=this;return Ic(this,Et().then(function(){var t=new Lr(e);if(!t.c)throw new kr("argument-error",Fr+" must be true when sending sign in link to email");return Kr(t)}).then(function(e){return n.b.kb(t,e)}).then(function(){}))},t.Sc=function(t){return this.Ja(t).then(function(t){return t.data.email})},t.Ya=function(t,e){return Ic(this,this.b.Ya(t,e).then(function(){}))},t.Ja=function(t){return Ic(this,this.b.Ja(t).then(function(t){return new function(t){var e={},n=t.email,r=t.newEmail;if(!(t=t.requestType)||"EMAIL_SIGNIN"!=t&&!n)throw Error("Invalid provider user info!");e.fromEmail=r||null,e.email=n||null,Cr(this,"operation",t),Cr(this,"data",Ar(e))}(t)}))},t.Va=function(t){return Ic(this,this.b.Va(t).then(function(){}))},t.jb=function(t,e){var n=this;return Ic(this,Et().then(function(){return void 0===e||it(e)?{}:Kr(new Lr(e))}).then(function(e){return n.b.jb(t,e)}).then(function(){}))},t.Ic=function(t,e){return Ic(this,Tu(this,t,e,g(this.Oa,this)))},t.Hc=function(t,e){var n=this;return Ic(this,Et().then(function(){var r=Ii(t,e||Vn());return n.Oa(r)}))},Cc.prototype.render=function(){},Cc.prototype.reset=function(){},Cc.prototype.getResponse=function(){},Cc.prototype.execute=function(){};var Dc=null;function Ac(t,e){return(e=kc(e))&&t.a[e]||null}function kc(t){return(t=void 0===t?1e12:t)?t.toString():null}function Rc(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=On(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():ve(this.f,"click",this.i)}function Oc(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Pc(){}Nc.prototype.render=function(t,e){return this.a[this.b.toString()]=new Rc(t,e),this.b++},Nc.prototype.reset=function(t){var e=Ac(this,t);t=kc(t),e&&t&&(e.delete(),delete this.a[t])},Nc.prototype.getResponse=function(t){return(t=Ac(this,t))?t.getResponse():null},Nc.prototype.execute=function(t){(t=Ac(this,t))&&t.execute()},Rc.prototype.getResponse=function(){return Oc(this),this.b},Rc.prototype.execute=function(){Oc(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(t){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()},6e4)},500))},Rc.prototype.delete=function(){Oc(this),this.g=!0,clearTimeout(this.a),this.a=null,we(this.f,"click",this.i)},Pc.prototype.g=function(){return Dc||(Dc=new Nc),Et(Dc)},Pc.prototype.c=function(){};var Lc=null;function Mc(){this.b=n.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var xc=mn("https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Fc=new vr(3e4,6e4);Mc.prototype.g=function(t){var e=this;return new yt(function(r,i){var o=setTimeout(function(){i(new kr("network-request-failed"))},Fc.get());!n.grecaptcha||t!==e.f&&!e.b?(n[e.a]=function(){if(n.grecaptcha){e.f=t;var s=n.grecaptcha.render;n.grecaptcha.render=function(t,n){return t=s(t,n),e.b++,t},clearTimeout(o),r(n.grecaptcha)}else clearTimeout(o),i(new kr("internal-error"));delete n[e.a]},Et(Mo(bn(xc,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(o),i(new kr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(o),r(n.grecaptcha))})},Mc.prototype.c=function(){this.b--};var Uc=null;function qc(t,e,r,i,o,s,a){if(Cr(this,"type","recaptcha"),this.c=this.f=null,this.C=!1,this.m=e,this.g=null,a?(Lc||(Lc=new Pc),a=Lc):(Uc||(Uc=new Mc),a=Uc),this.o=a,this.a=r||{theme:"light",type:"image"},this.h=[],this.a[Wc])throw new kr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[jc],!n.document)throw new kr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!On(e)||!this.i&&On(e).hasChildNodes())throw new kr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new Wo(t,s||null,o||null),this.v=i||function(){return null};var u=this;this.l=[];var c=this.a[Bc];this.a[Bc]=function(t){if(Kc(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=sr(c,n);"function"==typeof e&&e(t)}};var h=this.a[Vc];this.a[Vc]=function(){if(Kc(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=sr(h,n);"function"==typeof t&&t()}}}var Bc="callback",Vc="expired-callback",Wc="sitekey",jc="size";function Kc(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Qc(t,e){return t.h.push(e),e.ia(function(){F(t.h,e)}),e}function Hc(t){if(t.C)throw new kr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Gc(t,e,n){var r=!1;try{this.b=n||Qn.app()}catch(t){throw new kr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new kr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().xa()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=Qn.SDK_VERSION?ir(Qn.SDK_VERSION,o):null,qc.call(this,n,t,e,function(){try{var t=i.b.auth().ea()}catch(e){t=null}return t},o,js(Vs),r)}function zc(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,s=0;s<e.length;s++)if(e[s].optional)o=!0;else{if(o)throw new kr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],0>i||i>=Yc.length)throw new kr("internal-error","Argument validator received an unsupported number of arguments.");n=Yc[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new kr("argument-error",t+" failed: "+r)}(t=qc.prototype).za=function(){var t=this;return this.f?this.f:this.f=Qc(this,Et().then(function(){if(cr()&&!Jn())return zn();throw new kr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.o.g(t.v())}).then(function(e){return t.g=e,Us(t.u,Ss,{})}).then(function(e){t.a[Wc]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},t.render=function(){Hc(this);var t=this;return Qc(this,this.za().then(function(){if(null===t.c){var e=t.m;if(!t.i){var n=On(e);e=function(t,e,n){var i=arguments,o=document,s=String(i[0]),a=i[1];if(!fn&&a&&(a.name||a.type)){if(s=["<",s],a.name&&s.push(' name="',j(a.name),'"'),a.type){s.push(' type="',j(a.type),'"');var c={};ct(c,a),delete c.type,a=c}s.push(">"),s=s.join("")}return s=o.createElement(s),a&&(r(a)?s.className=a:u(a)?s.className=a.join(" "):Pn(s,a)),2<i.length&&function(t,e,n){function i(n){n&&e.appendChild(r(n)?t.createTextNode(n):n)}for(var o=2;o<n.length;o++){var s=n[o];!h(s)||f(s)&&0<s.nodeType?i(s):P(Mn(s)?B(s):s,i)}}(o,s,i),s}("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},t.verify=function(){Hc(this);var t=this;return Qc(this,this.render().then(function(e){return new yt(function(n){var r=t.g.getResponse(e);if(r)n(r);else{t.l.push(function e(r){r&&(function(t,e){U(t.l,function(t){return t==e})}(t,e),n(r))}),t.i&&t.g.execute(t.c)}})}))},t.reset=function(){Hc(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Hc(this),this.C=!0,this.o.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=On(this.m);for(var e;e=t.firstChild;)t.removeChild(e)}},_(Gc,qc);var Yc="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Xc(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:r}}function Jc(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:i}}function $c(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:f}}function Zc(t,e){return{name:t||"",K:"a function",optional:!!e,M:l}}function th(t,e){return{name:t||"",K:"null",optional:!!e,M:a}}function eh(t){return{name:t?t+"Credential":"credential",K:t?"a valid "+t+" credential":"a valid credential",optional:!1,M:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.ya||!n)}}}function nh(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&r(t.type)&&l(t.verify))}}}function rh(t,e,n,r){return{name:n||"",K:t.K+" or "+e.K,optional:!!r,M:function(n){return t.M(n)||e.M(n)}}}function ih(t,e){for(var n in e){var r=e[n].name;t[r]=ah(r,t[n],e[n].j)}}function oh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:v(function(t){return this[t]},n),set:v(function(t,e,n,r){zc(t,[n],[r],!0),this[e]=r},r,n,e[n].sb),enumerable:!0})}}function sh(t,e,n,r){t[e]=ah(e,n,r)}function ah(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return zc(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}ih(dc.prototype,{Va:{name:"applyActionCode",j:[Xc("code")]},Ja:{name:"checkActionCode",j:[Xc("code")]},Ya:{name:"confirmPasswordReset",j:[Xc("code"),Xc("newPassword")]},wb:{name:"createUserWithEmailAndPassword",j:[Xc("email"),Xc("password")]},Vb:{name:"createUserAndRetrieveDataWithEmailAndPassword",j:[Xc("email"),Xc("password")]},Yb:{name:"fetchProvidersForEmail",j:[Xc("email")]},Zb:{name:"fetchSignInMethodsForEmail",j:[Xc("email")]},fa:{name:"getRedirectResult",j:[]},nc:{name:"isSignInWithEmailLink",j:[Xc("emailLink")]},tc:{name:"onAuthStateChanged",j:[rh($c(),Zc(),"nextOrObserver"),Zc("opt_error",!0),Zc("opt_completed",!0)]},uc:{name:"onIdTokenChanged",j:[rh($c(),Zc(),"nextOrObserver"),Zc("opt_error",!0),Zc("opt_completed",!0)]},jb:{name:"sendPasswordResetEmail",j:[Xc("email"),rh($c("opt_actionCodeSettings",!0),th(null,!0),"opt_actionCodeSettings",!0)]},kb:{name:"sendSignInLinkToEmail",j:[Xc("email"),$c("actionCodeSettings")]},lb:{name:"setPersistence",j:[Xc("persistence")]},Oa:{name:"signInAndRetrieveDataWithCredential",j:[eh()]},Pa:{name:"signInAnonymously",j:[]},Fc:{name:"signInAnonymouslyAndRetrieveData",j:[]},Gc:{name:"signInWithCredential",j:[eh()]},Mb:{name:"signInWithCustomToken",j:[Xc("token")]},Dc:{name:"signInAndRetrieveDataWithCustomToken",j:[Xc("token")]},Nb:{name:"signInWithEmailAndPassword",j:[Xc("email"),Xc("password")]},Hc:{name:"signInWithEmailLink",j:[Xc("email"),Xc("emailLink",!0)]},Ec:{name:"signInAndRetrieveDataWithEmailAndPassword",j:[Xc("email"),Xc("password")]},Ic:{name:"signInWithPhoneNumber",j:[Xc("phoneNumber"),nh()]},Jc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Kc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Pc:{name:"updateCurrentUser",j:[rh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof ku)}},th(),"user")]},mb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Xc(null,!0)]},Rc:{name:"useDeviceLanguage",j:[]},Sc:{name:"verifyPasswordResetCode",j:[Xc("code")]}}),oh(dc.prototype,{lc:{name:"languageCode",sb:rh(Xc(),th(),"languageCode")}}),dc.Persistence=Pa,dc.Persistence.LOCAL="local",dc.Persistence.SESSION="session",dc.Persistence.NONE="none",ih(ku.prototype,{delete:{name:"delete",j:[]},cc:{name:"getIdTokenResult",j:[Jc("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Jc("opt_forceRefresh",!0)]},cb:{name:"linkAndRetrieveDataWithCredential",j:[eh()]},oc:{name:"linkWithCredential",j:[eh()]},pc:{name:"linkWithPhoneNumber",j:[Xc("phoneNumber"),nh()]},qc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},rc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},fb:{name:"reauthenticateAndRetrieveDataWithCredential",j:[eh()]},xc:{name:"reauthenticateWithCredential",j:[eh()]},yc:{name:"reauthenticateWithPhoneNumber",j:[Xc("phoneNumber"),nh()]},zc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},ib:{name:"sendEmailVerification",j:[rh($c("opt_actionCodeSettings",!0),th(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Xc(null,!0)]},Oc:{name:"unlink",j:[Xc("provider")]},ob:{name:"updateEmail",j:[Xc("email")]},pb:{name:"updatePassword",j:[Xc("password")]},Qc:{name:"updatePhoneNumber",j:[eh("phone")]},qb:{name:"updateProfile",j:[$c("profile")]}}),ih(Nc.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ih(Cc.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ih(yt.prototype,{ia:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),oh(wu.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",sb:Jc("appVerificationDisabledForTesting")}}),ih(Eu.prototype,{confirm:{name:"confirm",j:[Xc("verificationCode")]}}),sh(Si,"credential",function(t,e){return new Ti(t,e)},[Xc("email"),Xc("password")]),ih(yi.prototype,{ta:{name:"addScope",j:[Xc("scope")]},Da:{name:"setCustomParameters",j:[$c("customOAuthParameters")]}}),sh(yi,"credential",mi,[rh(Xc(),$c(),"token")]),sh(Si,"credentialWithLink",Ii,[Xc("email"),Xc("emailLink")]),ih(gi.prototype,{ta:{name:"addScope",j:[Xc("scope")]},Da:{name:"setCustomParameters",j:[$c("customOAuthParameters")]}}),sh(gi,"credential",vi,[rh(Xc(),$c(),"token")]),ih(bi.prototype,{ta:{name:"addScope",j:[Xc("scope")]},Da:{name:"setCustomParameters",j:[$c("customOAuthParameters")]}}),sh(bi,"credential",_i,[rh(Xc(),rh($c(),th()),"idToken"),rh(Xc(),th(),"accessToken",!0)]),ih(wi.prototype,{Da:{name:"setCustomParameters",j:[$c("customOAuthParameters")]}}),sh(wi,"credential",Ei,[rh(Xc(),$c(),"token"),Xc("secret",!0)]),ih(di.prototype,{ta:{name:"addScope",j:[Xc("scope")]},credential:{name:"credential",j:[rh(Xc(),th(),"idToken",!0),rh(Xc(),th(),"accessToken",!0)]},Da:{name:"setCustomParameters",j:[$c("customOAuthParameters")]}}),sh(Ai,"credential",ki,[Xc("verificationId"),Xc("verificationCode")]),ih(Ai.prototype,{Ta:{name:"verifyPhoneNumber",j:[Xc("phoneNumber"),nh()]}}),ih(kr.prototype,{toJSON:{name:"toJSON",j:[Xc(null,!0)]}}),ih(Ui.prototype,{toJSON:{name:"toJSON",j:[Xc(null,!0)]}}),ih(Fi.prototype,{toJSON:{name:"toJSON",j:[Xc(null,!0)]}}),ih(Gc.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===Qn||!Qn.INTERNAL||!Qn.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:dc,Error:kr};sh(t,"EmailAuthProvider",Si,[]),sh(t,"FacebookAuthProvider",yi,[]),sh(t,"GithubAuthProvider",gi,[]),sh(t,"GoogleAuthProvider",bi,[]),sh(t,"TwitterAuthProvider",wi,[]),sh(t,"OAuthProvider",di,[Xc("providerId")]),sh(t,"PhoneAuthProvider",Ai,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof dc)}}]),sh(t,"RecaptchaVerifier",Gc,[rh(Xc(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),$c("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof Qn.app.App)}}]),Qn.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:g((t=new dc(t)).getUid,t),getToken:g(t.bc,t),addAuthTokenListener:g(t.Ub,t),removeAuthTokenListener:g(t.Bc,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),Qn.INTERNAL.extendNamespace({User:ku})}()}).apply(void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(jn||(jn={}));var Hn,Gn,zn,Yn,Xn,Jn,$n,Zn,tr,er,nr=jn.INFO,rr=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case jn.DEBUG:case jn.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case jn.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case jn.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case jn.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},ir=function(){function t(t){this.name=t,this._logLevel=nr,this._logHandler=rr}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in jn))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,jn.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,jn.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,jn.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,jn.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,jn.ERROR].concat(t))},t}(),or=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),vn(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:gn(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),sr=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return _n(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),ar=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new or(e)}}catch(t){}return new sr},ur=ar("localStorage"),cr=ar("sessionStorage"),hr=new ir("@firebase/database"),lr=function(){var t=1;return function(){return t++}}(),fr=function(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var o=i-55296;en(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e}(t),n=new An;n.update(e);var r=n.digest();return on.encodeByteArray(r)},pr=function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r="",i=0;i<e.length;i++)Array.isArray(e[i])||e[i]&&"object"==c(e[i])&&"number"==typeof e[i].length?r+=t.apply(null,e[i]):"object"==c(e[i])?r+=vn(e[i]):r+=e[i],r+=" ";return r},dr=null,yr=!0,mr=function(t,e){en(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(hr.logLevel=jn.VERBOSE,dr=hr.log.bind(hr),e&&cr.set("logging_enabled",!0)):"function"==typeof t?dr=t:(dr=null,cr.remove("logging_enabled"))},gr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===yr&&(yr=!1,null===dr&&!0===cr.get("logging_enabled")&&mr(!0)),dr){var n=pr.apply(null,t);dr(n)}},vr=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];gr.apply(void 0,[t].concat(e))}},br=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+pr.apply(void 0,t);hr.error(n)},_r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+pr.apply(void 0,t);throw hr.error(n),new Error(n)},wr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+pr.apply(void 0,t);hr.warn(n)},Er=function(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)},Tr="[MIN_NAME]",Sr="[MAX_NAME]",Ir=function(t,e){if(t===e)return 0;if(t===Tr||e===Sr)return-1;if(e===Tr||t===Sr)return 1;var n=Pr(t),r=Pr(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Cr=function(t,e){return t===e?0:t<e?-1:1},Nr=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+vn(e))},Dr=function t(e){if("object"!=c(e)||null===e)return vn(e);var n=[];for(var r in e)n.push(r);n.sort();for(var i="{",o=0;o<n.length;o++)0!==o&&(i+=","),i+=vn(n[o]),i+=":",i+=t(e[n[o]]);return i+"}"},Ar=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r},kr=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;++n)e(n,t[n]);else En(t,function(t,n){return e(n,t)})},Rr=function(t){var e,n,r,i,o,s,a;for(en(!Er(t),"Invalid JSON number"),0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074)))),s=[],o=52;o;o-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(e?1:0),s.reverse(),a=s.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(a.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()},Or=new RegExp("^-?\\d{1,10}$"),Pr=function(t){if(Or.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},Lr=function(t){try{t()}catch(t){setTimeout(function(){var e=t.stack||"";throw wr("Exception was thrown by user callback.",e),t},Math.floor(0))}},Mr=function(){return("object"==("undefined"==typeof window?"undefined":c(window))&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},xr=function(t,e){var n=setTimeout(t,e);return"object"==c(n)&&n.unref&&n.unref(),n},Fr=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!0,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0)},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return t.relativePath(e.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Ir(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),Ur=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Fn(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Fn(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Fn(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),qr="long_polling",Br=function(){function t(t,e,n,r,i){void 0===i&&(i=""),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=ur.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&ur.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(en("string"==typeof t,"typeof type must == string"),en("object"==c(e),"typeof params must == object"),"websocket"===t)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==qr)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return En(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}(),Vr=function(t){var e=Wr(t),n=e.subdomain;"firebase"===e.domain&&_r(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||_r("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&wr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new Br(e.host,e.secure,n,r),path:new Fr(e.pathString)}},Wr=function(t){var e="",n="",r="",i="",o=!0,s="https",a=443;if("string"==typeof t){var u=t.indexOf("//");u>=0&&(s=t.substring(0,u-1),t=t.substring(u+2));var c=t.indexOf("/");-1===c&&(c=t.length);var h=t.indexOf("?");-1===h&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(c,h)));var l=function(t){var e={};"?"===t.charAt(0)&&(t=t.substring(1));for(var n=0,r=t.split("&");n<r.length;n++){var i=r[n];if(0!==i.length){var o=i.split("=");2===o.length?e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):wr("Invalid query segment '"+i+"' in query '"+t+"'")}}return e}(t.substring(Math.min(t.length,h)));(u=e.indexOf(":"))>=0?(o="https"===s||"wss"===s,a=parseInt(e.substring(u+1),10)):u=t.length;var f=e.split(".");3===f.length?(n=f[1],r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,u).toLowerCase()&&(n="localhost"),""===r&&"ns"in l&&(r=l.ns)}return{host:e,port:a,domain:n,subdomain:r,secure:o,scheme:s,pathString:i}},jr=/[\[\].#$\/\u0000-\u001F\u007F]/,Kr=/[\[\].#$\u0000-\u001F\u007F]/,Qr=function(t){return"string"==typeof t&&0!==t.length&&!jr.test(t)},Hr=function(t){return"string"==typeof t&&0!==t.length&&!Kr.test(t)},Gr=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!Er(t)||t&&"object"==c(t)&&_n(t,".sv")},zr=function(t,e,n,r,i){i&&void 0===n||Yr(Ln(t,e,i),n,r)},Yr=function t(e,n,r){var i=r instanceof Fr?new Ur(r,e):r;if(void 0===n)throw new Error(e+"contains undefined "+i.toErrorString());if("function"==typeof n)throw new Error(e+"contains a function "+i.toErrorString()+" with contents = "+n.toString());if(Er(n))throw new Error(e+"contains "+n.toString()+" "+i.toErrorString());if("string"==typeof n&&n.length>10485760/3&&Fn(n)>10485760)throw new Error(e+"contains a string greater than 10485760 utf8 bytes "+i.toErrorString()+" ('"+n.substring(0,50)+"...')");if(n&&"object"==c(n)){var o=!1,s=!1;if(En(n,function(n,r){if(".value"===n)o=!0;else if(".priority"!==n&&".sv"!==n&&(s=!0,!Qr(n)))throw new Error(e+" contains an invalid key ("+n+") "+i.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.push(n),t(e,r,i),i.pop()}),o&&s)throw new Error(e+' contains ".value" child '+i.toErrorString()+" in addition to actual children.")}},Xr=function(t,e,n,r,i){if(!i||void 0!==n){var o=Ln(t,e,i);if(!n||"object"!=c(n)||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var s=[];En(n,function(t,e){var n=new Fr(t);if(Yr(o,e,r.child(n)),".priority"===n.getBack()&&!Gr(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Qr(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Fr.comparePaths);var s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&s.contains(r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(o,s)}},Jr=function(t,e,n,r){if(!r||void 0!==n){if(Er(n))throw new Error(Ln(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Gr(n))throw new Error(Ln(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},$r=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Ln(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Zr=function(t,e,n,r){if(!(r&&void 0===n||Qr(n)))throw new Error(Ln(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ti=function(t,e,n,r){if(!(r&&void 0===n||Hr(n)))throw new Error(Ln(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ei=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},ni=function(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!Qr(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Hr(t)}(r))throw new Error(Ln(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},ri=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){Pn("OnDisconnect.cancel",0,1,arguments.length),Mn("OnDisconnect.cancel",1,t,!0);var e=new hn;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){Pn("OnDisconnect.remove",0,1,arguments.length),ei("OnDisconnect.remove",this.path_),Mn("OnDisconnect.remove",1,t,!0);var e=new hn;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){Pn("OnDisconnect.set",1,2,arguments.length),ei("OnDisconnect.set",this.path_),zr("OnDisconnect.set",1,t,this.path_,!1),Mn("OnDisconnect.set",2,e,!0);var n=new hn;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){Pn("OnDisconnect.setWithPriority",2,3,arguments.length),ei("OnDisconnect.setWithPriority",this.path_),zr("OnDisconnect.setWithPriority",1,t,this.path_,!1),Jr("OnDisconnect.setWithPriority",2,e,!1),Mn("OnDisconnect.setWithPriority",3,n,!0);var r=new hn;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(Pn("OnDisconnect.update",1,2,arguments.length),ei("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,wr("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Xr("OnDisconnect.update",1,t,this.path_,!1),Mn("OnDisconnect.update",2,e,!0);var i=new hn;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),ii=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return Pn("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),oi=(Hn="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Gn=0,zn=[],function(t){var e,n=t===Gn;Gn=t;var r=new Array(8);for(e=7;e>=0;e--)r[e]=Hn.charAt(t%64),t=Math.floor(t/64);en(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;e>=0&&63===zn[e];e--)zn[e]=0;zn[e]++}else for(e=0;e<12;e++)zn[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Hn.charAt(zn[e]);return en(20===i.length,"nextPushId: Length should be 20."),i}),si=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),ai=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new si(Tr,t),r=new si(Tr,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return si.MIN},t}(),ui=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return Yn},set:function(t){Yn=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return Ir(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw nn("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return si.MIN},e.prototype.maxPost=function(){return new si(Sr,Yn)},e.prototype.makePost=function(t,e){return en("string"==typeof t,"KeyIndex indexValue must always be a string."),new si(t,Yn)},e.prototype.toString=function(){return".key"},e}(ai),ci=new ui,hi=function(t){return"number"==typeof t?"number:"+Rr(t):"string:"+t},li=function(t){if(t.isLeafNode()){var e=t.val();en("string"==typeof e||"number"==typeof e||"object"==c(e)&&_n(e,".sv"),"Priority must be a string or number.")}else en(t===Xn||t.isEmpty(),"priority of unexpected type.");en(t===Xn||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},fi=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,en(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),li(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return Jn},set:function(t){Jn=t},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=e.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(en(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+hi(this.priorityNode_.val())+":");var e=c(this.value_);t+=e+":",t+="number"===e?Rr(this.value_):this.value_,this.lazyHash_=fr(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(en(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=c(e.value_),r=c(this.value_),i=t.VALUE_TYPE_ORDER.indexOf(n),o=t.VALUE_TYPE_ORDER.indexOf(r);return en(i>=0,"Unknown leaf type: "+n),en(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-i},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}(),pi=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Ir(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return si.MIN},e.prototype.maxPost=function(){return new si(Sr,new fi("[PRIORITY-POST]",Zn))},e.prototype.makePost=function(t,e){var n=$n(t);return new si(e,new fi("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(ai)),di=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),yi=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:gi.EMPTY_NODE,this.right=null!=o?o:gi.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return gi.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return gi.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),mi=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new yi(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),gi=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,yi.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,yi.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new di(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new di(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new di(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new di(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new mi,t}(),vi=Math.log(2),bi=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/vi,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),_i=function(t,e,n,r){t.sort(e);var i=function(e){for(var r=null,i=null,o=t.length,s=function(e,r){var i=o-e,s=o;o-=e;var u=function e(r,i){var o,s,a=i-r;if(0==a)return null;if(1==a)return o=t[r],s=n?n(o):o,new yi(s,o.node,yi.BLACK,null,null);var u=parseInt(a/2,10)+r,c=e(r,u),h=e(u+1,i);return o=t[u],s=n?n(o):o,new yi(s,o.node,yi.BLACK,c,h)}(i+1,s),c=t[i],h=n?n(c):c;a(new yi(h,c.node,r,null,u))},a=function(t){r?(r.left=t,r=t):(i=t,r=t)},u=0;u<e.count;++u){var c=e.nextBitIsOne(),h=Math.pow(2,e.count-(u+1));c?s(h,yi.BLACK):(s(h,yi.BLACK),s(h,yi.RED))}return i}(new bi(t.length));return new gi(r||e,i)},wi={},Ei=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return en(wi&&pi,"ChildrenNode.ts has not been loaded"),tr=tr||new t({".priority":wi},{".priority":pi})},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=wn(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e===wi?null:e},t.prototype.hasIndex=function(t){return _n(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){en(e!==ci,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],o=!1,s=n.getIterator(si.Wrap),a=s.getNext();a;)o=o||e.isDefinedOn(a.node),i.push(a),a=s.getNext();r=o?_i(i,e.getCompare()):wi;var u=e.toString(),c=Tn(this.indexSet_);c[u]=e;var h=Tn(this.indexes_);return h[u]=r,new t(h,c)},t.prototype.addToIndexes=function(e,n){var r=this;return new t(Cn(this.indexes_,function(t,i){var o=wn(r.indexSet_,i);if(en(o,"Missing index implementation for "+i),t===wi){if(o.isDefinedOn(e.node)){for(var s=[],a=n.getIterator(si.Wrap),u=a.getNext();u;)u.name!=e.name&&s.push(u),u=a.getNext();return s.push(e),_i(s,o.getCompare())}return wi}var c=n.get(e.name),h=t;return c&&(h=h.remove(new si(e.name,c))),h.insert(e,e.node)}),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(Cn(this.indexes_,function(t){if(t===wi)return t;var r=n.get(e.name);return r?t.remove(new si(e.name,r)):t}),this.indexSet_)},t}();function Ti(t,e){return Ir(t.name,e.name)}function Si(t,e){return Ir(t,e)}var Ii=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&li(this.priorityNode_),this.children_.isEmpty()&&en(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return er||(er=new t(new gi(Si),null,Ei.Default))},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||er},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?er:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(en(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r=new si(e,n),i=void 0,o=void 0;return n.isEmpty()?(i=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),o=this.indexMap_.addToIndexes(r,this.children_)),new t(i,i.isEmpty()?er:this.priorityNode_,o)},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;en(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(pi,function(s,a){n[s]=a.val(e),r++,o&&t.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1}),!e&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+hi(this.getPriority().val())+":"),this.forEachChild(pi,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":fr(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new si(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new si(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new si(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,si.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,si.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ci?-1:0},t.prototype.withIndex=function(e){if(e===ci||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===ci||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(pi),r=e.getIterator(pi),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===ci?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),Ci=new(function(t){function e(){return t.call(this,new gi(Si),Ii.EMPTY_NODE,Ei.Default)||this}return Je(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return Ii.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Ii));Object.defineProperties(si,{MIN:{value:new si(Tr,Ii.EMPTY_NODE)},MAX:{value:new si(Sr,Ci)}}),ui.__EMPTY_NODE=Ii.EMPTY_NODE,fi.__childrenNodeConstructor=Ii,Xn=Ci,Zn=Ci;var Ni=!0;function Di(t,e){if(void 0===e&&(e=null),null===t)return Ii.EMPTY_NODE;if("object"==c(t)&&".priority"in t&&(e=t[".priority"]),en(null===e||"string"==typeof e||"number"==typeof e||"object"==c(e)&&".sv"in e,"Invalid priority type found: "+c(e)),"object"==c(t)&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=c(t)||".sv"in t)return new fi(t,Di(e));if(t instanceof Array||!Ni){var n=Ii.EMPTY_NODE,r=t;return En(r,function(t,e){if(_n(r,t)&&"."!==t.substring(0,1)){var i=Di(e);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}}),n.updatePriority(Di(e))}var i=[],o=!1,s=t;if(En(s,function(t,e){if("string"!=typeof t||"."!==t.substring(0,1)){var n=Di(s[t]);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),i.push(new si(t,n)))}}),0==i.length)return Ii.EMPTY_NODE;var a=_i(i,Ti,function(t){return t.name},Si);if(o){var u=_i(i,pi.getCompare());return new Ii(a,Di(e),new Ei({".priority":u},{".priority":pi}))}return new Ii(a,Di(e),Ei.Default)}$n=Di;var Ai,ki,Ri=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Ir(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return si.MIN},e.prototype.maxPost=function(){return si.MAX},e.prototype.makePost=function(t,e){var n=Di(t);return new si(e,n)},e.prototype.toString=function(){return".value"},e}(ai)),Oi=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,en(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Je(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Ir(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=Di(t),r=Ii.EMPTY_NODE.updateChild(this.indexPath_,n);return new si(e,r)},e.prototype.maxPost=function(){var t=Ii.EMPTY_NODE.updateChild(this.indexPath_,Ci);return new si(Sr,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(ai),Pi=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return Pn("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return Pn("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return Pn("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return Pn("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){Pn("DataSnapshot.child",0,1,arguments.length),e=String(e),ti("DataSnapshot.child",1,e,!1);var n=new Fr(e),r=this.ref_.child(n);return new t(this.node_.getChild(n),r,pi)},t.prototype.hasChild=function(t){Pn("DataSnapshot.hasChild",1,1,arguments.length),ti("DataSnapshot.hasChild",1,t,!1);var e=new Fr(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return Pn("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this;return Pn("DataSnapshot.forEach",1,1,arguments.length),Mn("DataSnapshot.forEach",1,e,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(r,i){return e(new t(i,n.ref_.child(r),pi))})},t.prototype.hasChildren=function(){return Pn("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return Pn("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return Pn("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),Li=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+vn(this.snapshot.exportVal())},t}(),Mi=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),xi=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Li("value",this,new Pi(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){en(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Mi(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Fi=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,_n(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Mi(this,t,e):null},t.prototype.createEvent=function(t,e){en(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Li(t.type,this,new Pi(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){en(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var n=In(e.callbacks_);if(n===In(this.callbacks_)){if(1===n){var r=Dn(e.callbacks_),i=Dn(this.callbacks_);return!(i!==r||e.callbacks_[r]&&this.callbacks_[i]&&e.callbacks_[r]!==this.callbacks_[i])}return function(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&!e(n,t[n]))return!1;return!0}(this.callbacks_,function(t,n){return e.callbacks_[t]===n})}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Ui=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return en(Ai,"Reference.ts has not been loaded"),Ai},set:function(t){Ai=t},enumerable:!0,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===ci){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Tr)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=Sr)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===pi){if(null!=e&&!Gr(e)||null!=n&&!Gr(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(en(t.getIndex()instanceof Oi||t.getIndex()===Ri,"unknown index type."),null!=e&&"object"==c(e)||null!=n&&"object"==c(n))throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return Pn("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,r,i){Pn("Query.on",2,4,arguments.length),$r("Query.on",1,e,!1),Mn("Query.on",2,n,!1);var o=t.getCancelAndContextArgs_("Query.on",r,i);if("value"===e)this.onValueEvent(n,o.cancel,o.context);else{var s={};s[e]=n,this.onChildEvent(s,o.cancel,o.context)}return n},t.prototype.onValueEvent=function(t,e,n){var r=new xi(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},t.prototype.onChildEvent=function(t,e,n){var r=new Fi(t,e,n);this.repo.addEventCallbackForQuery(this,r)},t.prototype.off=function(t,e,n){Pn("Query.off",0,3,arguments.length),$r("Query.off",1,t,!0),Mn("Query.off",2,e,!0),xn("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new xi(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Fi(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},t.prototype.once=function(e,n,r,i){var o=this;Pn("Query.once",1,4,arguments.length),$r("Query.once",1,e,!1),Mn("Query.once",2,n,!0);var s=t.getCancelAndContextArgs_("Query.once",r,i),a=!0,u=new hn;u.promise.catch(function(){});var c=function t(r){a&&(a=!1,o.off(e,t),n&&n.bind(s.context)(r),u.resolve(r))};return this.on(e,c,function(t){o.off(e,c),s.cancel&&s.cancel.bind(s.context)(t),u.reject(t)}),u.promise},t.prototype.limitToFirst=function(e){if(Pn("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(Pn("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(Pn("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ti("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new Fr(e);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new Oi(n),i=this.queryParams_.orderBy(r);return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0)},t.prototype.orderByKey=function(){Pn("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(ci);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){Pn("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(pi);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){Pn("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Ri);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),Pn("Query.startAt",0,2,arguments.length),zr("Query.startAt",1,e,this.path,!0),Zr("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,n=null),new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),Pn("Query.endAt",0,2,arguments.length),zr("Query.endAt",1,e,this.path,!0),Zr("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(Pn("Query.equalTo",1,2,arguments.length),zr("Query.equalTo",1,t,this.path,!1),Zr("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return Pn("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return Pn("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Dr(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(Pn("Query.isEqual",1,1,arguments.length),!(e instanceof t))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var n=this.repo===e.repo,r=this.path.equals(e.path),i=this.queryIdentifier()===e.queryIdentifier();return n&&r&&i},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Mn(t,3,r.cancel,!0),r.context=n,xn(t,4,r.context,!0);else if(e)if("object"==c(e)&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Ln(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),qi=function(){function t(){this.set={}}return t.prototype.add=function(t,e){this.set[t]=null===e||e},t.prototype.contains=function(t){return _n(this.set,t)},t.prototype.get=function(t){return this.contains(t)?this.set[t]:void 0},t.prototype.remove=function(t){delete this.set[t]},t.prototype.clear=function(){this.set={}},t.prototype.isEmpty=function(){return Sn(this.set)},t.prototype.count=function(){return In(this.set)},t.prototype.each=function(t){En(this.set,function(e,n){return t(e,n)})},t.prototype.keys=function(){var t=[];return En(this.set,function(e){t.push(e)}),t},t}(),Bi=function(){function t(){this.value_=null,this.children_=null}return t.prototype.find=function(t){if(null!=this.value_)return this.value_.getChild(t);if(t.isEmpty()||null==this.children_)return null;var e=t.getFront();return t=t.popFront(),this.children_.contains(e)?this.children_.get(e).find(t):null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value_=n,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(e,n);else{null==this.children_&&(this.children_=new qi);var r=e.getFront();this.children_.contains(r)||this.children_.add(r,new t);var i=this.children_.get(r);e=e.popFront(),i.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value_=null,this.children_=null,!0;if(null!==this.value_){if(this.value_.isLeafNode())return!1;var e=this.value_;this.value_=null;var n=this;return e.forEachChild(pi,function(t,e){n.remember(new Fr(t),e)}),this.forget(t)}if(null!==this.children_){var r=t.getFront();return t=t.popFront(),this.children_.contains(r)&&this.children_.get(r).forget(t)&&this.children_.remove(r),!!this.children_.isEmpty()&&(this.children_=null,!0)}return!0},t.prototype.forEachTree=function(t,e){null!==this.value_?e(t,this.value_):this.forEachChild(function(n,r){var i=new Fr(t.toString()+"/"+n);r.forEachTree(i,e)})},t.prototype.forEachChild=function(t){null!==this.children_&&this.children_.each(function(e,n){t(e,n)})},t}(),Vi=function(t,e){return t&&"object"==c(t)?(en(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},Wi=function t(e,n){var r,i=e.getPriority().val(),o=Vi(i,n);if(e.isLeafNode()){var s=e,a=Vi(s.getValue(),n);return a!==s.getValue()||o!==s.getPriority().val()?new fi(a,Di(o)):e}var u=e;return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new fi(o))),u.forEachChild(pi,function(e,i){var o=t(i,n);o!==i&&(r=r.updateImmediateChild(e,o))}),r};!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(ki||(ki={}));var ji,Ki,Qi=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,en(!r||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),Hi=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=ki.ACK_USER_WRITE,this.source=Qi.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return en(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new Fr(e));return new t(Fr.Empty,n,this.revert)}return en(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),Gi=function(){return ji||(ji=new gi(Cr)),ji},zi=function(){function t(t,e){void 0===e&&(e=Gi()),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty;return En(e,function(t,e){n=n.set(new Fr(t),e)}),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Fr.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=i?{path:new Fr(n).child(i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),r=this.children.get(n);return null!==r?r.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),o=this.children.insert(r,i);return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),r=this.children.get(n);if(r){var i=r.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var r,i=e.getFront(),o=(this.children.get(i)||t.Empty).setTree(e.popFront(),n);return r=o.isEmpty()?this.children.remove(i):this.children.insert(i,o),new t(this.value,r)},t.prototype.fold=function(t){return this.fold_(Fr.Empty,t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(t.child(r),e)}),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Fr.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Fr.Empty,e)},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this;this.value&&r(n,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty},t.prototype.foreach=function(t){this.foreach_(Fr.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(t.child(n),e)}),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},t.Empty=new t(null),t}(),Yi=function(){function t(t,e){this.source=t,this.path=e,this.type=ki.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,Fr.Empty):new t(this.source,this.path.popFront())},t}(),Xi=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=ki.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,Fr.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),Ji=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=ki.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new Fr(e));return n.isEmpty()?null:n.value?new Xi(this.source,Fr.Empty,n.value):new t(this.source,Fr.Empty,n)}return en(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),$i=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),Zi=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,r){return new t(new $i(e,n,r),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new $i(e,n,r))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new $i(Ii.EMPTY_NODE,!1,!1),new $i(Ii.EMPTY_NODE,!1,!1)),t}(),to=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),eo=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,o){en(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=t.getImmediateChild(e);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(to.childRemovedChange(e,s)):en(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(to.childAddedChange(e,n)):o.trackChildChange(to.childChangedChange(e,n,s))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(pi,function(t,r){e.hasChild(t)||n.trackChildChange(to.childRemovedChange(t,r))}),e.isLeafNode()||e.forEachChild(pi,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(to.childChangedChange(e,r,i))}else n.trackChildChange(to.childAddedChange(e,r))})),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Ii.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),no=function(){function t(){this.changeMap_={}}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;en(e==to.CHILD_ADDED||e==to.CHILD_CHANGED||e==to.CHILD_REMOVED,"Only child changes supported for tracking"),en(".priority"!==n,"Only non-priority child changes can be tracked.");var r=wn(this.changeMap_,n);if(r){var i=r.type;if(e==to.CHILD_ADDED&&i==to.CHILD_REMOVED)this.changeMap_[n]=to.childChangedChange(n,t.snapshotNode,r.snapshotNode);else if(e==to.CHILD_REMOVED&&i==to.CHILD_ADDED)delete this.changeMap_[n];else if(e==to.CHILD_REMOVED&&i==to.CHILD_CHANGED)this.changeMap_[n]=to.childRemovedChange(n,r.oldSnap);else if(e==to.CHILD_CHANGED&&i==to.CHILD_ADDED)this.changeMap_[n]=to.childAddedChange(n,t.snapshotNode);else{if(e!=to.CHILD_CHANGED||i!=to.CHILD_CHANGED)throw nn("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap_[n]=to.childChangedChange(n,t.snapshotNode,r.oldSnap)}}else this.changeMap_[n]=t},t.prototype.getChanges=function(){return function(t){var e=[],n=0;for(var r in t)e[n++]=t[r];return e}(this.changeMap_)},t}(),ro=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),io=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new $i(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),oo=function(t,e){this.viewCache=t,this.changes=e},so=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){en(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),en(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,r,i){var o,s,a=new no;if(n.type===ki.OVERWRITE){var u=n;u.source.fromUser?o=this.applyUserOverwrite_(e,u.path,u.snap,r,i,a):(en(u.source.fromServer,"Unknown source."),s=u.source.tagged||e.getServerCache().isFiltered()&&!u.path.isEmpty(),o=this.applyServerOverwrite_(e,u.path,u.snap,r,i,s,a))}else if(n.type===ki.MERGE){var c=n;c.source.fromUser?o=this.applyUserMerge_(e,c.path,c.children,r,i,a):(en(c.source.fromServer,"Unknown source."),s=c.source.tagged||e.getServerCache().isFiltered(),o=this.applyServerMerge_(e,c.path,c.children,r,i,s,a))}else if(n.type===ki.ACK_USER_WRITE){var h=n;o=h.revert?this.revertUserWrite_(e,h.path,r,i,a):this.ackUserWrite_(e,h.path,h.affectedTree,r,i,a)}else{if(n.type!==ki.LISTEN_COMPLETE)throw nn("Unknown operation type: "+n.type);o=this.listenComplete_(e,n.path,r,a)}var l=a.getChanges();return t.maybeAddValueEvent_(e,o,l),new oo(o,l)},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(n.length>0||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(to.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var s=void 0,a=void 0;if(e.isEmpty())if(en(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof Ii?u:Ii.EMPTY_NODE,h=n.calcCompleteEventChildren(c);s=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());s=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){en(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();a=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,a);s=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){a=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),a);m=null!=g?o.getNode().getImmediateChild(f).updateChild(y,g):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());s=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(s,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,s){var a,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())a=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);a=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&e.getLength()>1)return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);a=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,ro,null)}var d=t.updateServerSnap(a,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new io(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,s)},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var s,a,u=t.getEventCache(),c=new io(r,t,i);if(e.isEmpty())a=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),s=t.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)a=this.filter_.updatePriority(t.getEventCache().getNode(),n),s=t.updateEventSnap(a,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Ii.EMPTY_NODE}if(f.equals(p))s=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);s=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return s},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,r,i,o,s){var a=this,u=e;return r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())&&(u=a.applyUserOverwrite_(u,h,c,i,o,s))}),r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())||(u=a.applyUserOverwrite_(u,h,c,i,o,s))}),u},t.prototype.applyMerge_=function(t,e){return e.foreach(function(e,n){t=t.updateChild(e,n)}),t},t.prototype.applyServerMerge_=function(t,e,n,r,i,o,s){var a=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:zi.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal(function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=a.applyMerge_(u,n);c=a.applyServerOverwrite_(c,new Fr(e),l,r,i,o,s)}}),u.children.inorderTraversal(function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=a.applyMerge_(l,n);c=a.applyServerOverwrite_(c,new Fr(e),f,r,i,o,s)}}),c},t.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var s=t.getServerCache().isFiltered(),a=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,a.getNode().getChild(e),r,i,s,o);if(e.isEmpty()){var u=zi.Empty;return a.getNode().forEachChild(ci,function(t,e){u=u.set(new Fr(t),e)}),this.applyServerMerge_(t,e,u,r,i,s,o)}return t}var c=zi.Empty;return n.foreach(function(t,n){var r=e.child(t);a.isCompleteForPath(r)&&(c=c.set(t,a.getNode().getChild(r)))}),this.applyServerMerge_(t,e,c,r,i,s,o)},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,ro,r)},t.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var s=new io(n,t,r),a=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();en(h instanceof Ii,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(a,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=a.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(a,l,f,e.popFront(),s,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(a,l,Ii.EMPTY_NODE,e.popFront(),s,i):a).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Fr.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},t}(),ao=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===to.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(to.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,to.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,to.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,to.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,to.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,to.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,s=n.filter(function(t){return t.type===e});s.sort(this.compareChanges_.bind(this)),s.forEach(function(e){var n=o.materializeSingleChange_(e,i);r.forEach(function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type?t:(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_),t)},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw nn("Should only compare child_ events.");var n=new si(t.childName,t.snapshotNode),r=new si(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),uo=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new eo(n.getIndex()),i=n.getNodeFilter();this.processor_=new so(i);var o=e.getServerCache(),s=e.getEventCache(),a=r.updateFullNode(Ii.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ii.EMPTY_NODE,s.getNode(),null),c=new $i(a,o.isFullyInitialized(),r.filtersNodes()),h=new $i(u,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Zi(h,c),this.eventGenerator_=new ao(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){en(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach(function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)})}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(s.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(s)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},t.prototype.applyOperation=function(t,e,n){t.type===ki.MERGE&&null!==t.source.queryId&&(en(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),en(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),en(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(pi,function(t,e){n.push(to.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(to.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),co=function(){function t(){this.views_={}}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return en(Ki,"Reference.ts has not been loaded"),Ki},set:function(t){en(!Ki,"__referenceConstructor has already been defined"),Ki=t},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return Sn(this.views_)},t.prototype.applyOperation=function(t,e,n){var r=t.source.queryId;if(null!==r){var i=wn(this.views_,r);return en(null!=i,"SyncTree gave us an op for an invalid query."),i.applyOperation(t,e,n)}var o=[];return En(this.views_,function(r,i){o=o.concat(i.applyOperation(t,e,n))}),o},t.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),s=wn(this.views_,o);if(!s){var a=n.calcCompleteEventCache(i?r:null),u=!1;a?u=!0:r instanceof Ii?(a=n.calcCompleteEventChildren(r),u=!1):(a=Ii.EMPTY_NODE,u=!1);var c=new Zi(new $i(a,u,!1),new $i(r,i,!1));s=new uo(t,c),this.views_[o]=s}return s.addEventRegistration(e),s.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,r){var i=e.queryIdentifier(),o=[],s=[],a=this.hasCompleteView();if("default"===i){var u=this;En(this.views_,function(t,e){s=s.concat(e.removeEventRegistration(n,r)),e.isEmpty()&&(delete u.views_[t],e.getQuery().getQueryParams().loadsAllData()||o.push(e.getQuery()))})}else{var c=wn(this.views_,i);c&&(s=s.concat(c.removeEventRegistration(n,r)),c.isEmpty()&&(delete this.views_[i],c.getQuery().getQueryParams().loadsAllData()||o.push(c.getQuery())))}return a&&!this.hasCompleteView()&&o.push(new t.__referenceConstructor(e.repo,e.path)),{removed:o,events:s}},t.prototype.getQueryViews=function(){var t=this;return Object.keys(this.views_).map(function(e){return t.views_[e]}).filter(function(t){return!t.getQuery().getQueryParams().loadsAllData()})},t.prototype.getCompleteServerCache=function(t){var e=null;return En(this.views_,function(n,r){e=e||r.getCompleteServerCache(t)}),e},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return wn(this.views_,e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e;return t=this.views_,(e=Nn(t,function(t){return t.getQuery().getQueryParams().loadsAllData()},void 0))&&t[e]||null},t}(),ho=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new zi(n));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,s=Fr.relativePath(i,e);return o=o.updateChild(s,n),new t(this.writeTree_.set(i,o))}var a=new zi(n);return new t(this.writeTree_.setTree(e,a))},t.prototype.addWrites=function(t,e){var n=this;return En(e,function(e,r){n=n.addWrite(t.child(e),r)}),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,zi.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Fr.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(pi,function(e,n){t.push(new si(e,n))}):this.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new si(e,n.value))}),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new zi(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(e){return t.applySubtreeWrite_(Fr.Empty,this.writeTree_,e)},t.Empty=new t(new zi(null)),t.applySubtreeWrite_=function(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal(function(n,o){".priority"===n?(en(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t.applySubtreeWrite_(e.child(n),o,r)}),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r},t}(),lo=function(){function t(){this.visibleWrites_=ho.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new fo(t,this)},t.prototype.addOverwrite=function(t,e,n,r){en(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){en(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex(function(e){return e.writeId===t});en(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,s=this.allWrites_.length-1;i&&s>=0;){var a=this.allWrites_[s];a.visible&&(s>=n&&this.recordContainsPath_(a,r.path)?i=!1:r.path.contains(a.path)&&(o=!0)),s--}if(i){if(o)return this.resetTree_(),!0;if(r.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(r.path);else{var u=r.children;En(u,function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))})}return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(e);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(Fr.Empty)){var s=t.layerTree_(this.allWrites_,function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return c=n||Ii.EMPTY_NODE,s.apply(c)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var u=this.visibleWrites_.childCompoundWrite(e);if(u.isEmpty())return n;if(null!=n||u.hasCompleteWrite(Fr.Empty)){var c=n||Ii.EMPTY_NODE;return u.apply(c)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=Ii.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(pi,function(t,e){n=n.updateImmediateChild(t,e)}),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(pi,function(t,e){var r=i.childCompoundWrite(new Fr(t)).apply(e);n=n.updateImmediateChild(t,r)}),i.getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){en(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var s,a=this.visibleWrites_.childCompoundWrite(t),u=a.getCompleteNode(Fr.Empty);if(null!=u)s=u;else{if(null==e)return[];s=a.apply(e)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?s.getReverseIteratorFrom(n,o):s.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},t.prototype.recordContainsPath_=function(t,e){return t.snap?t.path.contains(e):!!Nn(t.children,function(n,r){return t.path.child(r).contains(e)})},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,Fr.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var r=ho.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var s=o.path,a=void 0;if(o.snap)n.contains(s)?(a=Fr.relativePath(n,s),r=r.addWrite(a,o.snap)):s.contains(n)&&(a=Fr.relativePath(s,n),r=r.addWrite(Fr.Empty,o.snap.getChild(a)));else{if(!o.children)throw nn("WriteRecord should have .snap or .children");if(n.contains(s))a=Fr.relativePath(n,s),r=r.addWrites(a,o.children);else if(s.contains(n))if((a=Fr.relativePath(s,n)).isEmpty())r=r.addWrites(Fr.Empty,o.children);else{var u=wn(o.children,a.getFront());if(u){var c=u.getChild(a.popFront());r=r.addWrite(Fr.Empty,c)}}}}}return r},t}(),fo=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),po=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=zi.Empty,this.pendingWriteTree_=new lo,this.tagToQueryMap_={},this.queryToTagMap_={}}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new Xi(Qi.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=zi.fromObject(e);return this.applyOperationToSyncPoints_(new Ji(Qi.User,t,r))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=zi.Empty;return null!=n.snap?r=r.set(Fr.Empty,!0):En(n.children,function(t,e){r=r.set(new Fr(t),e)}),this.applyOperationToSyncPoints_(new Hi(n.path,r,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new Xi(Qi.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=zi.fromObject(e);return this.applyOperationToSyncPoints_(new Ji(Qi.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new Yi(Qi.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,u=Fr.relativePath(s,e),c=new Xi(Qi.forServerTaggedQuery(a),u,n);return this.applyTaggedOperation_(s,c)}return[]},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r);if(i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,u=Fr.relativePath(s,e),c=zi.fromObject(n),h=new Ji(Qi.forServerTaggedQuery(a),u,c);return this.applyTaggedOperation_(s,h)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n);if(r){var i=t.parseQueryKey_(r),o=i.path,s=i.queryId,a=Fr.relativePath(o,e),u=new Yi(Qi.forServerTaggedQuery(s),a);return this.applyTaggedOperation_(o,u)}return[]},t.prototype.addEventRegistration=function(e,n){var r=e.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Fr.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var s,a=this.syncPointTree_.get(r);a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(Fr.Empty)):(a=new co,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i?s=!0:(s=!1,i=Ii.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Fr.Empty);n&&(i=i.updateImmediateChild(t,n))}));var u=a.viewExistsForQuery(e);if(!u&&!e.getQueryParams().loadsAllData()){var c=t.makeQueryKey_(e);en(!(c in this.queryToTagMap_),"View does not exist, but we have a tag");var h=t.getNextQueryTag_();this.queryToTagMap_[c]=h,this.tagToQueryMap_["_"+h]=c}var l=this.pendingWriteTree_.childWrites(r),f=a.addEventRegistration(e,n,l,i,s);if(!u&&!o){var p=a.viewForQuery(e);f=f.concat(this.setupListener_(e,p))}return f},t.prototype.removeEventRegistration=function(e,n,r){var i=this,o=e.path,s=this.syncPointTree_.get(o),a=[];if(s&&("default"===e.queryIdentifier()||s.viewExistsForQuery(e))){var u=s.removeEventRegistration(e,n,r);s.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var c=u.removed;a=u.events;var h=-1!==c.findIndex(function(t){return t.getQueryParams().loadsAllData()}),l=this.syncPointTree_.findOnPath(o,function(t,e){return e.hasCompleteView()});if(h&&!l){var f=this.syncPointTree_.subtree(o);if(!f.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(f),d=0;d<p.length;++d){var y=p[d],m=y.getQuery(),g=this.createListenerForView_(y);this.listenProvider_.startListening(t.queryForListening_(m),this.tagForQuery_(m),g.hashFn,g.onComplete)}}!l&&c.length>0&&!r&&(h?this.listenProvider_.stopListening(t.queryForListening_(e),null):c.forEach(function(e){var n=i.queryToTagMap_[t.makeQueryKey_(e)];i.listenProvider_.stopListening(t.queryForListening_(e),n)})),this.removeTags_(c)}return a},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,function(e,n){var r=Fr.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(t,r,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),En(n,function(t,e){r=r.concat(e)}),r})},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n];if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),o=this.queryToTagMap_[i];delete this.queryToTagMap_[i],delete this.tagToQueryMap_["_"+o]}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var r=e.path,i=this.tagForQuery_(e),o=this.createListenerForView_(n),s=this.listenProvider_.startListening(t.queryForListening_(e),i,o.hashFn,o.onComplete),a=this.syncPointTree_.subtree(r);if(i)en(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),En(n,function(t,e){r=r.concat(e)}),r}),c=0;c<u.length;++c){var h=u[c];this.listenProvider_.stopListening(t.queryForListening_(h),this.tagForQuery_(h))}return s},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Ii.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return en(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Fr(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap_["_"+t]},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return wn(this.queryToTagMap_,n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);en(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Fr.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Fr.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Fr.Empty));var o=[],s=t.path.getFront(),a=t.operationForChild(s),u=e.children.get(s);if(u&&a){var c=n?n.getImmediateChild(s):null,h=r.child(s);o=o.concat(this.applyOperationHelper_(a,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(Fr.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(Fr.Empty));var s=[];return e.children.inorderTraversal(function(e,o){var a=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(s=s.concat(i.applyOperationDescendantsHelper_(c,o,a,u)))}),o&&(s=s.concat(o.applyOperation(t,r,n))),s},t.nextQueryTag_=1,t}(),yo=function(){function t(){this.rootNode_=Ii.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),mo=function(){function t(t){this.app_=t}return t.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(gr("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},t.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},t.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',wr(t)},t}(),go=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),_n(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return an(this.counters_)},t}(),vo=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new go),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),bo=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=Tn(t);return this.last_&&En(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},t}(),_o=1e4,wo=3e4,Eo=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new bo(t);var n=_o+(wo-_o)*Math.random();xr(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;En(e,function(e,i){i>0&&_n(t.statsToReport_,e)&&(n[e]=i,r=!0)}),r&&this.server_.reportStats(n),xr(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),To=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new So(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),So=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();dr&&gr("event: "+e.toString()),Lr(n)}}},t.prototype.getPath=function(){return this.path_},t}(),Io=function(){function t(t){this.allowedEvents_=t,this.listeners_={},en(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=this.listeners_[t].slice(),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){en(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},t}(),Co=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))},!1),r}return Je(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return en("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(Io),No=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||ln()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return Je(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return en("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(Io),Do=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&Lr(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},t}(),Ao="pLPCommand",ko="pRTLPCB",Ro=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=vr(t),this.stats_=vo.getCollection(e),this.urlFn=function(t){return e.connectionURL(qr,t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Do(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if(fn()||"complete"===document.readyState)t();else{var e=!1,n=function n(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new Oo(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1],o=t[2];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==r)n.id=i,n.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(i,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(r,i)},function(){n.onClosed_()},n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),!fn()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==("undefined"==typeof window?"undefined":c(window))&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==("undefined"==typeof Windows?"undefined":c(Windows))&&"object"==c(Windows.UI))&&!fn()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=vn(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n,r=(n=rn(e),on.encodeByteArray(n,!0)),i=Ar(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!fn()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=vn(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),Oo=function(){function t(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new qi,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,fn())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=lr(),window[Ao+this.uniqueCallbackIdentifier]=e,window[ko+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var o="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(o='<script>document.domain="'+document.domain+'";<\/script>');var s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(t){gr("frame writing exception"),t.stack&&gr(t.stack),gr(t)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||gr("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var e=this;if(this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0))),fn()&&this.myID){var n={disconn:"t"};n.id=this.myID,n.pw=this.myPW;var r=this.urlFn(n);t.nodeRestRequest(r)}var i=this.onDisconnect;i&&(this.onDisconnect=null,i())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e,1);var r=function(){n.outstandingRequests.remove(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},t.prototype.addTag=function(t,e){var n=this;fn()?this.doNodeLongPoll(t,e):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){gr("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}},Math.floor(1))},t}(),Po=null;"undefined"!=typeof MozWebSocket?Po=MozWebSocket:"undefined"!=typeof WebSocket&&(Po=WebSocket);var Lo=function(){function t(e,n,r,i){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=vr(this.connId),this.stats_=vo.getCollection(n),this.connURL=t.connectionURL_(n,r,i)}return t.connectionURL_=function(t,e,n){var r={v:"5"};return!fn()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL("websocket",r)},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ur.set("previous_websocket_failure",!0);try{if(fn()){var r={headers:{"User-Agent":"Firebase/5/"+Qn.SDK_VERSION+"/"+o.platform+"/Node"}},i=o.env,s=0==this.connURL.indexOf("wss://")?i.HTTPS_PROXY||i.https_proxy:i.HTTP_PROXY||i.http_proxy;s&&(r.proxy={origin:s}),this.mySock=new Po(this.connURL,[],r)}else this.mySock=new Po(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var a=t.message||t.data;return a&&this.log_(a),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Po&&!t.forceDisallow_},t.previouslyFailed=function(){return ur.isInMemoryStorage||!0===ur.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){ur.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=gn(e);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(en(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=vn(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Ar(e,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Mo=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[Ro,Lo]},enumerable:!0,configurable:!0}),t.prototype.initTransports_=function(e){var n=Lo&&Lo.isAvailable(),r=n&&!Lo.previouslyFailed();if(e.webSocketOnly&&(n||wr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Lo];else{var i=this.transports_=[];kr(t.ALL_TRANSPORTS,function(t,e){e&&e.isAvailable()&&i.push(e)})}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),xo=function(){function t(t,e,n,r,i,o,s){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=s,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=vr("c:"+this.id+":"),this.transportManager_=new Mo(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=xr(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!=e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=Nr("t",t),n=Nr("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=Nr("t",t),n=Nr("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=Nr("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?br("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):br("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&wr("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),xr(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):xr(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ur.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Fo=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Uo=1e3,qo=3e5,Bo=function(t){function e(n,r,i,o,s,a){var u=t.call(this)||this;if(u.repoInfo_=n,u.onDataUpdate_=r,u.onConnectStatus_=i,u.onServerInfoUpdate_=o,u.authTokenProvider_=s,u.authOverride_=a,u.id=e.nextPersistentConnectionId_++,u.log_=vr("p:"+u.id+":"),u.interruptReasons_={},u.listens_={},u.outstandingPuts_=[],u.outstandingPutCount_=0,u.onDisconnectRequestQueue_=[],u.connected_=!1,u.reconnectDelay_=Uo,u.maxReconnectDelay_=qo,u.securityDebugCallback_=null,u.lastSessionId=null,u.establishConnectionTimer_=null,u.visible_=!1,u.requestCBHash_={},u.requestNumber_=0,u.realtime_=null,u.authToken_=null,u.forceTokenRefresh_=!1,u.invalidAuthTokenCount_=0,u.firstConnection_=!0,u.lastConnectionAttemptTime_=null,u.lastConnectionEstablishedTime_=null,a&&!fn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return u.scheduleConnect_(0),Co.getInstance().on("visible",u.onVisible_,u),-1===n.host.indexOf("fblocal")&&No.getInstance().on("online",u.onOnline_,u),u}return Je(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(vn(i)),en(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},e.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens_[o]=this.listens_[o]||{},en(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),en(!this.listens_[o][i],"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:e,query:t,tag:n};this.listens_[o][i]=s,this.connected_&&this.sendListen_(s)},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var s={p:i};t.tag&&(s.q=r.queryObject(),s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,function(s){var a=s.d,u=s.s;e.warnOnListenWarnings_(a,r),(n.listens_[i]&&n.listens_[i][o])===t&&(n.log_("listen response",s),"ok"!==u&&n.removeListen_(i,o),t.onComplete&&t.onComplete(u,a))})},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==c(t)&&_n(t,"w")){var n=wn(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();wr("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){var e;(t&&40===t.length||"object"==c(e=bn(t).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t,e=this;if(this.connected_&&this.authToken_){var n=this.authToken_,r=(t=bn(n).claims)&&"object"==c(t)&&t.hasOwnProperty("iat")?"auth":"gauth",i={cred:n};null===this.authOverride_?i.noauth=!0:"object"==c(this.authOverride_)&&(i.authvar=this.authOverride_),this.sendRequest(r,i,function(t){var r=t.s,i=t.d||"error";e.authToken_===n&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),en(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+vn(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):br("Unrecognized action received from server: "+vn(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;en(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Uo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Uo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Uo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,o=this,s=this.lastSessionId,a=!1,u=null,c=function(){u?u.close():(a=!0,r())};this.realtime_={close:c,sendRequest:function(t){en(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(h).then(function(e){a?gr("getToken() completed but was canceled"):(gr("getToken() completed. Creating connection."),o.authToken_=e&&e.accessToken,u=new xo(i,o.repoInfo_,t,n,r,function(t){wr(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},s))}).then(null,function(t){o.log_("Failed to get token: "+t),a||c()})}},e.prototype.interrupt=function(t){gr("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){gr("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Sn(this.interruptReasons_)&&(this.reconnectDelay_=Uo,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Dr(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new Fr(t).toString();return void 0!==this.listens_[r]?(n=this.listens_[r][e],delete this.listens_[r][e],0===In(this.listens_[r])&&delete this.listens_[r]):n=void 0,n},e.prototype.onAuthRevoked_=function(t,e){gr("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t=this;this.tryAuth(),En(this.listens_,function(e,n){En(n,function(e,n){t.sendListen_(n)})});for(var e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js";t["sdk."+e+"."+Qn.SDK_VERSION.replace(/\./g,"-")]=1,ln()?t["framework.cordova"]=1:"object"==("undefined"==typeof navigator?"undefined":c(navigator))&&"ReactNative"===navigator.product&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=No.getInstance().currentlyOnline();return Sn(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(Fo),Vo=function(t){function e(e,n,r){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=vr("p:rest:"),i.listens_={},i}return Je(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(en(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,r,i){var o=this,s=t.path.toString();this.log_("Listen called for "+s+" "+t.queryIdentifier());var a=e.getListenId_(t,r),u={};this.listens_[a]=u;var c=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",c,function(t,e){var n=e;404===t&&(n=null,t=null),null===t&&o.onDataUpdate_(s,n,!1,r),wn(o.listens_,a)===u&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then(function(i){var o=i&&i.accessToken;o&&(e.auth=o);var s,a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?"+(s=[],En(e,function(t,e){Array.isArray(e)?e.forEach(function(e){s.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}):s.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),s.length?"&"+s.join("&"):"");r.log_("Sending REST request for "+a);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+a+" received. status:",u.status,"response:",u.responseText);var t=null;if(u.status>=200&&u.status<300){try{t=gn(u.responseText)}catch(t){wr("Failed to parse JSON response for "+a+": "+u.responseText)}n(null,t)}else 401!==u.status&&404!==u.status&&wr("Got unsuccessful REST response for "+a+" Status: "+u.status),n(u.status);n=null}},u.open("GET",a,!0),u.send()})},e}(Fo),Wo=function(){function t(t,e,n){var r=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new To,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Bi,this.persistentConnection_=null;var i=new mo(n);if(this.stats_=vo.getCollection(t),e||Mr())this.server_=new Vo(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=n.options.databaseAuthVariableOverride;if(null!=o){if("object"!=c(o))throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{vn(o)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Bo(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,o),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(t){r.server_.refreshAuthToken(t)}),this.statsReporter_=vo.getOrCreateReporter(t,function(){return new Eo(r.stats_,r.server_)}),this.transactions_init_(),this.infoData_=new yo,this.infoSyncTree_=new po({startListening:function(t,e,n,i){var o=[],s=r.infoData_.getNode(t.path);return s.isEmpty()||(o=r.infoSyncTree_.applyServerOverwrite(t.path,s),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new po({startListening:function(t,e,n,i){return r.server_.listen(t,n,e,function(e,n){var o=i(e,n);r.eventQueue_.raiseEventsForChangedPath(t.path,o)}),[]},stopListening:function(t,e){r.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new Fr(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Fr(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var s=Cn(e,function(t){return Di(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,s,r)}else{var a=Di(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,a,r)}else if(n){var u=Cn(e,function(t){return Di(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Di(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;o.length>0&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;kr(t,function(t,n){e.updateInfo_(n,t)})},t.prototype.updateInfo_=function(t,e){var n=new Fr("/.info/"+t),r=Di(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),s=Di(e,n),a=Wi(s,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,a,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),s.val(!0),function(e,n){var o="ok"===e;o||wr("set at "+t+" failed: "+e);var s=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,s),i.callOnCompleteCallback(r,e,n)});var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),s={};if(En(e,function(t,e){i=!1;var n=Di(e);s[t]=Wi(n,o)}),i)gr("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var a=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,s,a);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,function(e,i){var o="ok"===e;o||wr("update at "+t+" failed: "+e);var s=r.serverSyncTree_.ackUserWrite(a,!o),u=s.length>0?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,s),r.callOnCompleteCallback(n,e,i)}),En(e,function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=[];(function(t,e){var n=new Bi;return t.forEachTree(new Fr(""),function(t,r){n.remember(t,Wi(r,e))}),n})(this.onDisconnect_,e).forEachTree(Fr.Empty,function(e,r){n=n.concat(t.serverSyncTree_.applyServerOverwrite(e,r));var i=t.abortTransactions_(e);t.rerunTransactions_(i)}),this.onDisconnect_=new Bi,this.eventQueue_.raiseEventsForChangedPath(Fr.Empty,n)},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)})},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Di(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)})},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=Di(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)})},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(Sn(e))return gr("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,function(i,o){"ok"===i&&En(e,function(e,n){var i=Di(n);r.onDisconnect_.remember(t.child(e),i)}),r.callOnCompleteCallback(n,i,o)})},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new bo(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var n=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);En(e,function(t,e){for(var r=t.length;r<n+2;r++)t+=" ";console.log(t+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),gr.apply(void 0,[n].concat(t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&Lr(function(){if("ok"==e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new $o(this))},enumerable:!0,configurable:!0}),t}(),jo=function(){function t(e){this.indexedFilter_=new eo(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new si(e,n))||(n=Ii.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Ii.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Ii.EMPTY_NODE);var i=this;return e.forEachChild(pi,function(t,e){i.matches(new si(t,e))||(r=r.updateImmediateChild(t,Ii.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),Ko=function(){function t(t){this.rangedFilter_=new jo(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new si(e,n))||(n=Ii.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Ii.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Ii.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Ii.EMPTY_NODE);var a=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)s=i.getNext(),!l&&c(a,s)<=0&&(l=!0),l&&o<this.limit_&&c(s,u)<=0?o++:r=r.updateImmediateChild(s.name,Ii.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(t,e){return s(e,t)}}else o=this.index_.getCompare();var a=t;en(a.numChildren()==this.limit_,"");var u=new si(e,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(a.hasChild(e)){for(var l=a.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||a.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&p>=0)return null!=i&&i.trackChildChange(to.childChangedChange(e,n,l)),a.updateImmediateChild(e,n);null!=i&&i.trackChildChange(to.childRemovedChange(e,l));var d=a.updateImmediateChild(e,Ii.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(to.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&o(c,u)>=0?(null!=i&&(i.trackChildChange(to.childRemovedChange(c.name,c.node)),i.trackChildChange(to.childAddedChange(e,n))),a.updateImmediateChild(e,n).updateImmediateChild(c.name,Ii.EMPTY_NODE)):t},t}(),Qo=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=pi}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return en(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return en(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Tr},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return en(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return en(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Sr},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return en(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r}return this.index_!==pi&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==pi},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new eo(this.getIndex()):this.hasLimit()?new Ko(this):new jo(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={};return this.isDefault()?r:(this.index_===pi?e=n.PRIORITY_INDEX:this.index_===Ri?e=n.VALUE_INDEX:this.index_===ci?e=n.KEY_INDEX:(en(this.index_ instanceof Oi,"Unrecognized index type!"),e=this.index_.toString()),r[n.ORDER_BY]=vn(e),this.startSet_&&(r[n.START_AT]=vn(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+vn(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=vn(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+vn(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_),r)},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),Ho=function(t){function e(e,n){if(!(e instanceof Wo))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,n,Qo.DEFAULT,!1)||this}return Je(e,t),e.prototype.getKey=function(){return Pn("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return Pn("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Fr||(null===this.path.getFront()?((n=t)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ti("Reference.child",1,n,!1)):ti("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t));var n},e.prototype.getParent=function(){Pn("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){Pn("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){Pn("Reference.set",1,2,arguments.length),ei("Reference.set",this.path),zr("Reference.set",1,t,this.path,!1),Mn("Reference.set",2,e,!0);var n=new hn;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(Pn("Reference.update",1,2,arguments.length),ei("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,wr("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Xr("Reference.update",1,t,this.path,!1),Mn("Reference.update",2,e,!0);var i=new hn;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},e.prototype.setWithPriority=function(t,e,n){if(Pn("Reference.setWithPriority",2,3,arguments.length),ei("Reference.setWithPriority",this.path),zr("Reference.setWithPriority",1,t,this.path,!1),Jr("Reference.setWithPriority",2,e,!1),Mn("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new hn;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},e.prototype.remove=function(t){return Pn("Reference.remove",0,1,arguments.length),ei("Reference.remove",this.path),Mn("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(Pn("Reference.transaction",1,3,arguments.length),ei("Reference.transaction",this.path),Mn("Reference.transaction",1,t,!1),Mn("Reference.transaction",2,e,!0),function(t,e,n,r){if(void 0!==n&&"boolean"!=typeof n)throw new Error(Ln("Reference.transaction",3,!0)+"must be a boolean.")}(0,0,n),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new hn;return"function"==typeof e&&r.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,n,i){t?r.reject(t):r.resolve(new ii(n,i)),"function"==typeof e&&e(t,n,i)},n),r.promise},e.prototype.setPriority=function(t,e){Pn("Reference.setPriority",1,2,arguments.length),ei("Reference.setPriority",this.path),Jr("Reference.setPriority",1,t,!1),Mn("Reference.setPriority",2,e,!0);var n=new hn;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){Pn("Reference.push",0,2,arguments.length),ei("Reference.push",this.path),zr("Reference.push",1,t,this.path,!0),Mn("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=oi(r),o=this.child(i),s=this.child(i);return n=null!=t?o.set(t,e).then(function(){return s}):Promise.resolve(s),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},e.prototype.onDisconnect=function(){return ei("Reference.onDisconnect",this.path),new ri(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),e}(Ui);Ui.__referenceConstructor=Ho,co.__referenceConstructor=Ho;var Go,zo=function(){this.children={},this.childCount=0,this.value=null},Yo=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new zo),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n,r=e instanceof Fr?e:new Fr(e),i=this;null!==(n=r.getFront());)i=new t(n,i,wn(i.node_.children,n)||new zo),r=r.popFront();return i},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){en(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this;En(this.node_.children,function(r,i){e(new t(r,n,i))})},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,n)}),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},t.prototype.path=function(){return new Fr(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=_n(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();!function(t){t[t.RUN=0]="RUN",t[t.SENT=1]="SENT",t[t.COMPLETED=2]="COMPLETED",t[t.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",t[t.NEEDS_ABORT=4]="NEEDS_ABORT"}(Go||(Go={})),Wo.MAX_TRANSACTION_RETRIES_=25,Wo.prototype.transactions_init_=function(){this.transactionQueueTree_=new Yo},Wo.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var i=function(){},o=new Ho(this,t);o.on("value",i);var s={path:t,update:e,onComplete:n,status:null,order:lr(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=this.getLatestState_(t);s.currentInputSnapshot=a;var u=s.update(a.val());if(void 0===u){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var h=new Pi(s.currentInputSnapshot,new Ho(this,s.path),pi);s.onComplete(null,!1,h)}}else{Yr("transaction failed: Data returned ",u,s.path),s.status=Go.RUN;var l=this.transactionQueueTree_.subTree(t),f=l.getValue()||[];f.push(s),l.setValue(f);var p=void 0;"object"==c(u)&&null!==u&&_n(u,".priority")?(p=wn(u,".priority"),en(Gr(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(this.serverSyncTree_.calcCompleteEventCache(t)||Ii.EMPTY_NODE).getPriority().val(),p=p;var d=this.generateServerValues(),y=Di(u,p),m=Wi(y,d);s.currentOutputSnapshotRaw=y,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_();var g=this.serverSyncTree_.applyUserOverwrite(t,m,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,g),this.sendReadyTransactions_()}},Wo.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Ii.EMPTY_NODE},Wo.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);en(n.length>0,"Sending zero length transaction queue"),n.every(function(t){return t.status===Go.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Wo.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map(function(t){return t.currentWriteId}),i=this.getLatestState_(t,r),o=i,s=i.hash(),a=0;a<e.length;a++){var u=e[a];en(u.status===Go.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=Go.SENT,u.retryCount++;var c=Fr.relativePath(t,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var h=o.val(!0),l=t;this.server_.put(l.toString(),h,function(r){n.log_("transaction put response",{path:l.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=0;s<e.length;s++){if(e[s].status=Go.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[s].currentWriteId)),e[s].onComplete){var a=e[s].currentOutputSnapshotResolved,u=new Ho(n,e[s].path),c=new Pi(a,u,pi);o.push(e[s].onComplete.bind(null,null,!0,c))}e[s].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i),s=0;s<o.length;s++)Lr(o[s])}else{if("datastale"===r)for(s=0;s<e.length;s++)e[s].status===Go.SENT_NEEDS_ABORT?e[s].status=Go.NEEDS_ABORT:e[s].status=Go.RUN;else for(wr("transaction at "+l.toString()+" failed: "+r),s=0;s<e.length;s++)e[s].status=Go.NEEDS_ABORT,e[s].abortReason=r;n.rerunTransactions_(t)}},s)},Wo.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Wo.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===Go.RUN}).map(function(t){return t.currentWriteId}),s=0;s<t.length;s++){var a=t[s],u=Fr.relativePath(e,a.path),h=!1,l=void 0;if(en(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===Go.NEEDS_ABORT)h=!0,l=a.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===Go.RUN)if(a.retryCount>=Wo.MAX_TRANSACTION_RETRIES_)h=!0,l="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var f=this.getLatestState_(a.path,o);a.currentInputSnapshot=f;var p=t[s].update(f.val());if(void 0!==p){Yr("transaction failed: Data returned ",p,a.path);var d=Di(p);"object"==c(p)&&null!=p&&_n(p,".priority")||(d=d.updatePriority(f.getPriority()));var y=a.currentWriteId,m=this.generateServerValues(),g=Wi(d,m);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=g,a.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(y),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(a.path,g,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(y,!0))}else h=!0,l="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],h&&(t[s].status=Go.COMPLETED,n=t[s].unwatcher,setTimeout(n,Math.floor(0)),t[s].onComplete))if("nodata"===l){var v=new Ho(this,t[s].path),b=t[s].currentInputSnapshot,_=new Pi(b,v,pi);r.push(t[s].onComplete.bind(null,null,!1,_))}else r.push(t[s].onComplete.bind(null,new Error(l),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),s=0;s<r.length;s++)Lr(r[s]);this.sendReadyTransactions_()}},Wo.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Wo.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Wo.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Wo.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Go.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(n.length>0?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Wo.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Wo.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)e[o].status===Go.SENT_NEEDS_ABORT||(e[o].status===Go.SENT?(en(i===o-1,"All SENT items should be at beginning of queue."),i=o,e[o].status=Go.SENT_NEEDS_ABORT,e[o].abortReason="set"):(en(e[o].status===Go.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r),o=0;o<n.length;o++)Lr(n[o])}};var Xo,Jo=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return Xo||(Xo=new t),Xo},t.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},t.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},t.prototype.databaseFromApp=function(t,e){var n=e||t.options.databaseURL;void 0===n&&_r("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var r=Vr(n),i=r.repoInfo;return ni("Invalid Firebase Database URL",1,r),r.path.isEmpty()||_r("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},t.prototype.deleteRepo=function(t){var e=wn(this.repos_,t.app.name);e&&wn(e,t.repoInfo_.toURLString())===t||_r("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e){var n=wn(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=wn(n,t.toURLString());return r&&_r("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Wo(t,this.useRestClient_,e),n[t.toURLString()]=r,r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),$o=function(){function t(t){this.repo_=t,t instanceof Wo||_r("Don't call new Database() directly - please use firebase.database()."),this.root_=new Ho(t,Fr.Empty),this.INTERNAL=new Zo(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),Pn("database.ref",0,1,arguments.length),t instanceof Ho?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Pn(e,1,1,arguments.length);var n=Vr(t);ni(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&_r(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&_r("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){Pn("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){Pn("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),Zo=function(){function t(t){this.database=t}return t.prototype.delete=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.database.checkDeleted_("delete"),Jo.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},t}(),ts=Object.freeze({forceLongPolling:function(){Lo.forceDisallow(),Ro.forceAllow()},forceWebSockets:function(){Ro.forceDisallow()},isWebSocketsAvailable:function(){return Lo.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),es=Bo;Bo.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Bo.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var ns,rs=xo,is=Br,os=Object.freeze({DataConnection:es,RealTimeConnection:rs,hijackHash:function(t){var e=Bo.prototype.put;return Bo.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){Bo.prototype.put=e}},ConnectionTarget:is,queryIdentifier:function(t){return t.queryIdentifier()},listens:function(t){return t.repo.persistentConnection_.listens_},forceRestClient:function(t){Jo.getInstance().forceRestClient(t)}}),ss=$o.ServerValue;ns=Qn.INTERNAL.registerService("database",function(t,e,n){return Jo.getInstance().databaseFromApp(t,n)},{Reference:Ho,Query:Ui,Database:$o,enableLogging:mr,INTERNAL:ts,ServerValue:ss,TEST_ACCESS:os},null,!0),fn()&&(t.exports=ns);var as,us="undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:{},cs=cs||{},hs=us;function ls(t){return"string"==typeof t}function fs(t,e){t=t.split("."),e=e||hs;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function ps(){}function ds(t){var e=c(t);if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function ys(t){return"array"==ds(t)}function ms(t){var e=ds(t);return"array"==e||"object"==e&&"number"==typeof t.length}function gs(t){return"function"==ds(t)}function vs(t){var e=c(t);return"object"==e&&null!=t||"function"==e}var bs="closure_uid_"+(1e9*Math.random()>>>0),_s=0;function ws(t,e,n){return t.call.apply(t.bind,arguments)}function Es(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Ts(t,e,n){return(Ts=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ws:Es).apply(null,arguments)}function Ss(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var Is=Date.now||function(){return+new Date};function Cs(t,e){function n(){}n.prototype=e.prototype,t.L=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.mh=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Ns(t){if(Error.captureStackTrace)Error.captureStackTrace(this,Ns);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function Ds(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");Ns.call(this,n+t[r])}function As(){0!=ks&&(Rs[this[bs]||(this[bs]=++_s)]=this),this.Ka=this.Ka,this.Qa=this.Qa}Cs(Ns,Error),Ns.prototype.name="CustomError",Cs(Ds,Ns),Ds.prototype.name="AssertionError";var ks=0,Rs={};As.prototype.Ka=!1,As.prototype.bb=function(){if(!this.Ka&&(this.Ka=!0,this.F(),0!=ks)){var t=this[bs]||(this[bs]=++_s);if(0!=ks&&this.Qa&&0<this.Qa.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Rs[t]}},As.prototype.F=function(){if(this.Qa)for(;this.Qa.length;)this.Qa.shift()()};var Os=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(ls(t))return ls(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Ps=Array.prototype.lastIndexOf?function(t,e){return Array.prototype.lastIndexOf.call(t,e,t.length-1)}:function(t,e){var n=t.length-1;if(0>n&&(n=Math.max(0,t.length+n)),ls(t))return ls(e)&&1==e.length?t.lastIndexOf(e,n):-1;for(;0<=n;n--)if(n in t&&t[n]===e)return n;return-1},Ls=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=ls(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)},Ms=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=ls(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function xs(t){if(!ys(t))for(var e=t.length-1;0<=e;e--)delete t[e];t.length=0}function Fs(t,e){var n;return(n=0<=(e=Os(t,e)))&&Array.prototype.splice.call(t,e,1),n}function Us(t){return Array.prototype.concat.apply([],arguments)}function qs(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Bs(t){return/^[\s\xa0]*$/.test(t)}var Vs,Ws=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function js(t,e){return t<e?-1:t>e?1:0}t:{var Ks=hs.navigator;if(Ks){var Qs=Ks.userAgent;if(Qs){Vs=Qs;break t}}Vs=""}function Hs(t){return-1!=Vs.indexOf(t)}function Gs(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function zs(t){var e,n=[],r=0;for(e in t)n[r++]=t[e];return n}function Ys(t){var e,n=[],r=0;for(e in t)n[r++]=e;return n}function Xs(t){var e,n={};for(e in t)n[e]=t[e];return n}var Js="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $s(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Js.length;o++)n=Js[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Zs(t){return Zs[" "](t),t}Zs[" "]=ps;var ta,ea,na=Hs("Opera"),ra=Hs("Trident")||Hs("MSIE"),ia=Hs("Edge"),oa=ia||ra,sa=Hs("Gecko")&&!(-1!=Vs.toLowerCase().indexOf("webkit")&&!Hs("Edge"))&&!(Hs("Trident")||Hs("MSIE"))&&!Hs("Edge"),aa=-1!=Vs.toLowerCase().indexOf("webkit")&&!Hs("Edge");function ua(){var t=hs.document;return t?t.documentMode:void 0}t:{var ca="",ha=(ea=Vs,sa?/rv:([^\);]+)(\)|;)/.exec(ea):ia?/Edge\/([\d\.]+)/.exec(ea):ra?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ea):aa?/WebKit\/(\S+)/.exec(ea):na?/(?:Version)[ \/]?(\S+)/.exec(ea):void 0);if(ha&&(ca=ha?ha[1]:""),ra){var la=ua();if(null!=la&&la>parseFloat(ca)){ta=String(la);break t}}ta=ca}var fa,pa={};function da(t){return function(t,e){var n=pa;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=Ws(String(ta)).split("."),r=Ws(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=js(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||js(0==s[2].length,0==a[2].length)||js(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var ya=hs.document;fa=ya&&ra?ua()||("CSS1Compat"==ya.compatMode?parseInt(ta,10):5):void 0;var ma=Object.freeze||function(t){return t},ga=!ra||9<=Number(fa),va=ra&&!da("9"),ba=function(){if(!hs.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{hs.addEventListener("test",ps,e),hs.removeEventListener("test",ps,e)}catch(t){}return t}();function _a(t,e){this.type=t,this.currentTarget=this.target=e,this.defaultPrevented=this.Ea=!1,this.Be=!0}function wa(t,e){_a.call(this,t?t.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.key="",this.charCode=this.keyCode=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.fb=null,t&&this.Kf(t,e)}_a.prototype.stopPropagation=function(){this.Ea=!0},_a.prototype.preventDefault=function(){this.defaultPrevented=!0,this.Be=!1},Cs(wa,_a);var Ea=ma({2:"touch",3:"pen",4:"mouse"});wa.prototype.Kf=function(t,e){var n=this.type=t.type,r=t.changedTouches?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.currentTarget=e,e=t.relatedTarget){if(sa){t:{try{Zs(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,null===r?(this.offsetX=aa||void 0!==t.offsetX?t.offsetX:t.layerX,this.offsetY=aa||void 0!==t.offsetY?t.offsetY:t.layerY,this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0):(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0),this.button=t.button,this.keyCode=t.keyCode||0,this.key=t.key||"",this.charCode=t.charCode||("keypress"==n?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=ls(t.pointerType)?t.pointerType:Ea[t.pointerType]||"",this.state=t.state,this.fb=t,t.defaultPrevented&&this.preventDefault()},wa.prototype.stopPropagation=function(){wa.L.stopPropagation.call(this),this.fb.stopPropagation?this.fb.stopPropagation():this.fb.cancelBubble=!0},wa.prototype.preventDefault=function(){wa.L.preventDefault.call(this);var t=this.fb;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,va)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var Ta="closure_listenable_"+(1e6*Math.random()|0);function Sa(t){return!(!t||!t[Ta])}var Ia=0;function Ca(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Ob=i,this.key=++Ia,this.Sa=this.Eb=!1}function Na(t){this.src=t,this.J={},this.xb=0}function Da(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Sa&&o.listener==e&&o.capture==!!n&&o.Ob==r)return i}return-1}Ca.prototype.Vb=function(){this.Sa=!0,this.Ob=this.src=this.proxy=this.listener=null},(as=Na.prototype).add=function(t,e,n,r,i){var o=t.toString();(t=this.J[o])||(t=this.J[o]=[],this.xb++);var s=Da(t,e,r,i);return-1<s?(e=t[s],n||(e.Eb=!1)):((e=new Ca(e,this.src,o,!!r,i)).Eb=n,t.push(e)),e},as.remove=function(t,e,n,r){if(!((t=t.toString())in this.J))return!1;var i=this.J[t];return-1<(e=Da(i,e,n,r))&&(i[e].Vb(),Array.prototype.splice.call(i,e,1),0==i.length&&(delete this.J[t],this.xb--),!0)},as.ye=function(t){var e=t.type;e in this.J&&Fs(this.J[e],t)&&(t.Vb(),0==this.J[e].length&&(delete this.J[e],this.xb--))},as.pb=function(t){var e;for(e in t=t&&t.toString(),this.J)if(!t||e==t){for(var n=this.J[e],r=0;r<n.length;r++)n[r].Vb();delete this.J[e],this.xb--}},as.jb=function(t,e,n,r){var i=-1;return(t=this.J[t.toString()])&&(i=Da(t,e,n,r)),-1<i?t[i]:null};var Aa="closure_lm_"+(1e6*Math.random()|0),ka={};function Ra(t,e,n,r,i){if(r&&r.once)return Pa(t,e,n,r,i);if(ys(e)){for(var o=0;o<e.length;o++)Ra(t,e[o],n,r,i);return null}return n=Va(n),Sa(t)?t.nb(e,n,vs(r)?!!r.capture:!!r,i):Oa(t,e,n,!1,r,i)}function Oa(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=vs(i)?!!i.capture:!!i,a=qa(t);if(a||(t[Aa]=a=new Na(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Ua,e=ga?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)ba||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ma(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Pa(t,e,n,r,i){if(ys(e)){for(var o=0;o<e.length;o++)Pa(t,e[o],n,r,i);return null}return n=Va(n),Sa(t)?t.Oc(e,n,vs(r)?!!r.capture:!!r,i):Oa(t,e,n,!0,r,i)}function La(t){if("number"!=typeof t&&t&&!t.Sa){var e=t.src;if(Sa(e))e.Le(t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ma(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=qa(e))?(n.ye(t),0==n.xb&&(n.src=null,e[Aa]=null)):t.Vb()}}}function Ma(t){return t in ka?ka[t]:ka[t]="on"+t}function xa(t,e,n,r){var i=!0;if((t=qa(t))&&(e=t.J[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.Sa&&(o=Fa(o,r),i=i&&!1!==o)}return i}function Fa(t,e){var n=t.listener,r=t.Ob||t.src;return t.Eb&&La(t),n.call(r,e)}function Ua(t,e){if(t.Sa)return!0;if(!ga){var n=e||fs("window.event");e=new wa(n,this);var r=!0;if(!(0>n.keyCode||null!=n.returnValue)){t:{var i=!1;if(0==n.keyCode)try{n.keyCode=-1;break t}catch(t){i=!0}(i||null==n.returnValue)&&(n.returnValue=!0)}for(n=[],i=e.currentTarget;i;i=i.parentNode)n.push(i);for(t=t.type,i=n.length-1;!e.Ea&&0<=i;i--){e.currentTarget=n[i];var o=xa(n[i],t,!0,e);r=r&&o}for(i=0;!e.Ea&&i<n.length;i++)e.currentTarget=n[i],o=xa(n[i],t,!1,e),r=r&&o}return r}return Fa(t,new wa(e,this))}function qa(t){return(t=t[Aa])instanceof Na?t:null}var Ba="__closure_events_fn_"+(1e9*Math.random()>>>0);function Va(t){return gs(t)?t:(t[Ba]||(t[Ba]=function(e){return t.handleEvent(e)}),t[Ba])}function Wa(){As.call(this),this.ka=new Na(this),this.Pe=this,this.Uc=null}Cs(Wa,As),Wa.prototype[Ta]=!0,(as=Wa.prototype).addEventListener=function(t,e,n,r){Ra(this,t,e,n,r)},as.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(ys(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=vs(i)?!!i.capture:!!i,r=Va(r),Sa(e)?e.ed(n,r,i,o):e&&(e=qa(e))&&(n=e.jb(n,r,i,o))&&La(n)}(this,t,e,n,r)},as.dispatchEvent=function(t){var e,n=this.Uc;if(n)for(e=[];n;n=n.Uc)e.push(n);n=this.Pe;var r=t.type||t;if(ls(t))t=new _a(t,n);else if(t instanceof _a)t.target=t.target||n;else{var i=t;$s(t=new _a(r,n),i)}if(i=!0,e)for(var o=e.length-1;!t.Ea&&0<=o;o--){var s=t.currentTarget=e[o];i=s.Lb(r,!0,t)&&i}if(t.Ea||(i=(s=t.currentTarget=n).Lb(r,!0,t)&&i,t.Ea||(i=s.Lb(r,!1,t)&&i)),e)for(o=0;!t.Ea&&o<e.length;o++)i=(s=t.currentTarget=e[o]).Lb(r,!1,t)&&i;return i},as.F=function(){Wa.L.F.call(this),this.pg(),this.Uc=null},as.nb=function(t,e,n,r){return this.ka.add(String(t),e,!1,n,r)},as.Oc=function(t,e,n,r){return this.ka.add(String(t),e,!0,n,r)},as.ed=function(t,e,n,r){this.ka.remove(String(t),e,n,r)},as.Le=function(t){this.ka.ye(t)},as.pg=function(){this.ka&&this.ka.pb(void 0)},as.Lb=function(t,e,n){if(!(t=this.ka.J[String(t)]))return!0;t=t.concat();for(var r=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.Sa&&o.capture==e){var s=o.listener,a=o.Ob||o.src;o.Eb&&this.Le(o),r=!1!==s.call(a,n)&&r}}return r&&0!=n.Be},as.jb=function(t,e,n,r){return this.ka.jb(String(t),e,n,r)};var ja=hs.JSON.stringify;function Ka(t,e){this.Sf=100,this.ef=t,this.ug=e,this.Zb=0,this.Pb=null}function Qa(){this.lc=this.Va=null}Ka.prototype.get=function(){if(0<this.Zb){this.Zb--;var t=this.Pb;this.Pb=t.next,t.next=null}else t=this.ef();return t},Ka.prototype.put=function(t){this.ug(t),this.Zb<this.Sf&&(this.Zb++,t.next=this.Pb,this.Pb=t)};var Ha,Ga,za=new Ka(function(){return new Ya},function(t){t.reset()});function Ya(){this.next=this.scope=this.Gc=null}function Xa(t){hs.setTimeout(function(){throw t},0)}Qa.prototype.add=function(t,e){var n=this.Af();n.set(t,e),this.lc?this.lc.next=n:this.Va=n,this.lc=n},Qa.prototype.remove=function(){var t=null;return this.Va&&(t=this.Va,this.Va=this.Va.next,this.Va||(this.lc=null),t.next=null),t},Qa.prototype.wg=function(t){za.put(t)},Qa.prototype.Af=function(){return za.get()},Ya.prototype.set=function(t,e){this.Gc=t,this.scope=e,this.next=null},Ya.prototype.reset=function(){this.next=this.scope=this.Gc=null};var Ja=!1,$a=new Qa;function Za(){for(var t;t=$a.remove();){try{t.Gc.call(t.scope)}catch(t){Xa(t)}$a.wg(t)}Ja=!1}function tu(t,e){Wa.call(this),this.Na=t||1,this.wb=e||hs,this.nd=Ts(this.Rg,this),this.ie=Is()}function eu(t,e,n){if(gs(t))n&&(t=Ts(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Ts(t.handleEvent,t)}return 2147483647<Number(e)?-1:hs.setTimeout(t,e||0)}function nu(t,e,n){As.call(this),this.Uf=null!=n?Ts(t,n):t,this.Na=e,this.Xe=Ts(this.fg,this),this.qc=[]}function ru(t){As.call(this),this.i=t,this.o={}}Cs(tu,Wa),(as=tu.prototype).enabled=!1,as.B=null,as.setInterval=function(t){this.Na=t,this.B&&this.enabled?(this.stop(),this.start()):this.B&&this.stop()},as.Rg=function(){if(this.enabled){var t=Is()-this.ie;0<t&&t<.8*this.Na?this.B=this.wb.setTimeout(this.nd,this.Na-t):(this.B&&(this.wb.clearTimeout(this.B),this.B=null),this.ff(),this.enabled&&(this.stop(),this.start()))}},as.ff=function(){this.dispatchEvent("tick")},as.start=function(){this.enabled=!0,this.B||(this.B=this.wb.setTimeout(this.nd,this.Na),this.ie=Is())},as.stop=function(){this.enabled=!1,this.B&&(this.wb.clearTimeout(this.B),this.B=null)},as.F=function(){tu.L.F.call(this),this.stop(),delete this.wb},Cs(nu,As),(as=nu.prototype).Ta=!1,as.ob=0,as.B=null,as.mf=function(t){this.qc=arguments,this.B||this.ob?this.Ta=!0:this.Cc()},as.stop=function(){this.B&&(hs.clearTimeout(this.B),this.B=null,this.Ta=!1,this.qc=[])},as.pause=function(){this.ob++},as.resume=function(){this.ob--,this.ob||!this.Ta||this.B||(this.Ta=!1,this.Cc())},as.F=function(){nu.L.F.call(this),this.stop()},as.fg=function(){this.B=null,this.Ta&&!this.ob&&(this.Ta=!1,this.Cc())},as.Cc=function(){this.B=eu(this.Xe,this.Na),this.Uf.apply(null,this.qc)},Cs(ru,As);var iu=[];function ou(t,e,n){this.reset(t,e,n,void 0,void 0)}function su(t){this.pe=t,this.Zd=this.uc=this.mb=this.$b=null}function au(t,e){this.name=t,this.value=e}(as=ru.prototype).nb=function(t,e,n,r){return this.Tf(t,e,n,r)},as.Tf=function(t,e,n,r){ys(e)||(e&&(iu[0]=e.toString()),e=iu);for(var i=0;i<e.length;i++){var o=Ra(t,e[i],n||this.handleEvent,r||!1,this.i||this);if(!o)break;this.o[o.key]=o}return this},as.Oc=function(t,e,n,r){return this.je(t,e,n,r)},as.je=function(t,e,n,r,i){if(ys(e))for(var o=0;o<e.length;o++)this.je(t,e[o],n,r,i);else{if(!(t=Pa(t,e,n||this.handleEvent,r,i||this.i||this)))return this;this.o[t.key]=t}return this},as.ed=function(t,e,n,r,i){if(ys(e))for(var o=0;o<e.length;o++)this.ed(t,e[o],n,r,i);else n=n||this.handleEvent,r=vs(r)?!!r.capture:!!r,i=i||this.i||this,n=Va(n),r=!!r,(e=Sa(t)?t.jb(e,n,r,i):t&&(t=qa(t))?t.jb(e,n,r,i):null)&&(La(e),delete this.o[e.key])},as.pb=function(){Gs(this.o,function(t,e){this.o.hasOwnProperty(e)&&La(t)},this),this.o={}},as.F=function(){ru.L.F.call(this),this.pb()},as.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ou.prototype.Md=null,ou.prototype.reset=function(t,e,n,r,i){this.mb=t,delete this.Md},ou.prototype.Bg=function(t){this.Md=t},ou.prototype.Ge=function(t){this.mb=t},au.prototype.toString=function(){return this.name};var uu=new au("SEVERE",1e3),cu=new au("WARNING",900),hu=new au("INFO",800),lu=new au("CONFIG",700),fu=new au("FINE",500);(as=su.prototype).getName=function(){return this.pe},as.getParent=function(){return this.$b},as.pf=function(){return this.uc||(this.uc={}),this.uc},as.Ge=function(t){this.mb=t},as.Qd=function(){return this.mb?this.mb:this.$b?this.$b.Qd():(function(t,e){throw new Ds("Failure: "+t,Array.prototype.slice.call(arguments,1))}("Root logger has no level set."),null)},as.Pf=function(t){return t.value>=this.Qd().value},as.log=function(t,e,n){this.Pf(t)&&(gs(e)&&(e=e()),this.gf(this.uf(t,e,n)))},as.uf=function(t,e,n){return t=new ou(t,String(e),this.pe),n&&t.Bg(n),t},as.ca=function(t,e){this.log(uu,t,e)},as.T=function(t,e){this.log(cu,t,e)},as.info=function(t,e){this.log(hu,t,e)},as.lf=function(t){this.log(fu,t,void 0)},as.gf=function(t){for(var e=this;e;)e.We(t),e=e.getParent()},as.We=function(t){if(this.Zd)for(var e,n=0;e=this.Zd[n];n++)e(t)},as.Fg=function(t){this.$b=t},as.Qe=function(t,e){this.pf()[t]=e};var pu={},du=null;function yu(t){var e;if(du||(du=new su(""),pu[""]=du,du.Ge(lu)),!(e=pu[t])){e=new su(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=yu(t.substr(0,n))).Qe(r,e),e.Fg(n),pu[t]=e}return e}function mu(t,e){t&&t.info(e,void 0)}function gu(t,e){t&&t.lf(e)}function vu(){this.s=yu("goog.labs.net.webChannel.WebChannelDebug"),this.Wc=!0}(as=vu.prototype).Id=function(){this.Wc=!1},as.Tg=function(t,e,n,r,i){var o=this;this.info(function(){return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+t+"\n"+e+"\n"+o.Xf(i)})},as.Ug=function(t,e,n,r,i,o){this.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+t+"\n"+e+"\n"+i+" "+o})},as.Wa=function(t,e,n){var r=this;this.info(function(){return"XMLHTTP TEXT ("+t+"): "+r.ng(e)+(n?" "+n:"")})},as.Sg=function(t){this.info(function(){return"TIMEOUT: "+t})},as.debug=function(t){gu(this.s,t)},as.cb=function(t,e){var n=this.s;n&&n.ca(e||"Exception",t)},as.info=function(t){mu(this.s,t)},as.T=function(t){var e=this.s;e&&e.T(t,void 0)},as.ca=function(t){var e=this.s;e&&e.ca(t,void 0)},as.ng=function(t){if(!this.Wc)return t;if(!t)return null;try{var e=JSON.parse(t);if(e)for(var n=0;n<e.length;n++)ys(e[n])&&this.Wf(e[n]);return ja(e)}catch(e){return this.debug("Exception parsing expected JS array - probably was not JS"),t}},as.Wf=function(t){if(!(2>t.length||(t=t[1],!ys(t)||1>t.length))){var e=t[0];if("noop"!=e&&"stop"!=e&&"close"!=e)for(e=1;e<t.length;e++)t[e]=""}},as.Xf=function(t){if(!this.Wc)return t;if(!t)return null;var e="";t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].split("=");if(1<r.length){var i=r[0];r=r[1];var o=i.split("_");e=2<=o.length&&"type"==o[1]?e+(i+"=")+r+"&":e+(i+"=redacted&")}}return e};var bu=new Wa;function _u(t){_a.call(this,"serverreachability",t)}function wu(t){bu.dispatchEvent(new _u(bu,t))}function Eu(t,e){_a.call(this,"statevent",t),this.stat=e}function Tu(t){bu.dispatchEvent(new Eu(bu,t))}function Su(t,e,n){_a.call(this,"timingevent",t),this.size=e,this.rtt=n}function Iu(t,e){if(!gs(t))throw Error("Fn must not be null and must be a function");return hs.setTimeout(function(){t()},e)}Cs(_u,_a),Cs(Eu,_a),Cs(Su,_a);var Cu={NO_ERROR:0,Vg:1,bh:2,ah:3,Yg:4,$g:5,dh:6,Ne:7,TIMEOUT:8,gh:9},Nu={Xg:"complete",kh:"success",Oe:"error",Ne:"abort",ih:"ready",jh:"readystatechange",TIMEOUT:"timeout",eh:"incrementaldata",hh:"progress",Zg:"downloadprogress",lh:"uploadprogress"};function Du(){}function Au(){}Du.prototype.pd=null,Du.prototype.Vd=function(){return this.pd||(this.pd=this.Mf())};var ku,Ru={OPEN:"a",Wg:"b",Oe:"c",fh:"d"};function Ou(){_a.call(this,"d")}function Pu(){_a.call(this,"c")}function Lu(){}function Mu(t,e,n,r,i){this.b=t,this.a=e,this.ra=n,this.R=r,this.Xc=i||1,this.Fc=new ru(this),this.Ua=xu,t=oa?125:void 0,this.Vc=new tu(t),this.A=null,this.S=!1,this.Da=this.pa=this.ua=this.ic=this.qb=this.hd=this.Ga=null,this.ba=[],this.h=null,this.Bb=0,this.I=this.Fa=null,this.w=-1,this.Za=!1,this.Ra=0,this.ac=null,this.lb=this.Ed=this.yc=!1}Cs(Ou,_a),Cs(Pu,_a),Cs(Lu,Du),Lu.prototype.Dd=function(){var t=this.Wd();return t?new ActiveXObject(t):new XMLHttpRequest},Lu.prototype.Mf=function(){var t={};return this.Wd()&&(t[0]=!0,t[1]=!0),t},Lu.prototype.Wd=function(){if(!this.be&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var t=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],e=0;e<t.length;e++){var n=t[e];try{return new ActiveXObject(n),this.be=n}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return this.be},ku=new Lu;var xu=45e3,Fu={},Uu={};function qu(t){if(t.H&&"function"==typeof t.H)return t.H();if(ls(t))return t.split("");if(ms(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}return zs(t)}function Bu(t,e,n){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,n);else if(ms(t)||ls(t))Ls(t,e,n);else{if(t.W&&"function"==typeof t.W)var r=t.W();else if(t.H&&"function"==typeof t.H)r=void 0;else if(ms(t)||ls(t)){r=[];for(var i=t.length,o=0;o<i;o++)r.push(o)}else r=Ys(t);o=(i=qu(t)).length;for(var s=0;s<o;s++)e.call(n,i[s],r&&r[s],t)}}function Vu(t,e){this.D={},this.o=[],this.j=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else t&&this.addAll(t)}function Wu(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(as=Mu.prototype).ga=function(t){this.A=t},as.setTimeout=function(t){this.Ua=t},as.He=function(t){this.Ra=t},as.Gg=function(t){this.ba=t},as.la=function(){return this.ba},as.kd=function(t,e){this.ic=1,this.ua=t.clone().Ub(),this.Da=e,this.yc=!0,this.Ce(null)},as.jd=function(t,e,n){this.ic=1,this.ua=t.clone().Ub(),this.Da=null,this.yc=e,this.Ce(n)},as.Ce=function(t){this.qb=Is(),this.eb(),this.pa=this.ua.clone(),this.pa.dc("t",this.Xc),this.Bb=0,this.h=this.b.Jb(this.b.fc()?t:null),0<this.Ra&&(this.ac=new nu(Ts(this.Me,this,this.h),this.Ra)),this.Fc.nb(this.h,"readystatechange",this.mg),t=this.A?Xs(this.A):{},this.Da?(this.Fa||(this.Fa="POST"),t["Content-Type"]="application/x-www-form-urlencoded",this.h.send(this.pa,this.Fa,this.Da,t)):(this.Fa="GET",this.h.send(this.pa,this.Fa,null,t)),wu(1),this.a.Tg(this.Fa,this.pa,this.R,this.Xc,this.Da)},as.mg=function(t){t=t.target;var e=this.ac;e&&3==t.ma()?(this.a.debug("Throttling readystatechange."),e.mf()):this.Me(t)},as.Me=function(t){try{t==this.h?this.hg():this.a.T("Called back with an unexpected xmlhttp")}catch(t){if(this.a.debug("Failed call to OnXmlHttpReadyStateChanged_"),this.h&&this.h.ya()){var e=this;this.a.cb(t,function(){return"ResponseText: "+e.h.ya()})}else this.a.cb(t,"No response text")}},as.hg=function(){var t=this.h.ma(),e=this.h.Ud(),n=this.h.za();if(!(3>t||3==t&&!oa&&!this.h.ya())){this.Za||4!=t||7==e||wu(8==e||0>=n?3:2),this.Fb();var r=this.h.za();if(this.w=r,!(e=this.h.ya())){var i=this;this.a.debug(function(){return"No response text for uri "+i.pa+" status "+r})}if(this.S=200==r,this.a.Ug(this.Fa,this.pa,this.R,this.Xc,t,r),this.S){if(this.Ig()){if(!(n=this.sf()))return this.S=!1,this.I=3,Tu(12),this.a.T("XMLHTTP Missing X_HTTP_INITIAL_RESPONSE ("+this.R+")"),this.Ia(),void this.Kb();this.a.Wa(this.R,n,"Initial handshake response via X-HTTP-Initial-Response"),this.lb=!0,this.Yc(n)}this.yc?(this.Fd(t,e),oa&&this.S&&3==t&&this.Ng()):(this.a.Wa(this.R,e,null),this.Yc(e)),4==t&&this.Ia(),this.S&&!this.Za&&(4==t?this.b.Tc(this):(this.S=!1,this.eb()))}else 400==r&&0<e.indexOf("Unknown SID")?(this.I=3,Tu(12),this.a.T("XMLHTTP Unknown SID ("+this.R+")")):(this.I=0,Tu(13),this.a.T("XMLHTTP Bad status "+r+" ("+this.R+")")),this.Ia(),this.Kb()}},as.Ig=function(){return this.Ed&&!this.lb},as.sf=function(){if(this.h){var t=this.h.kb("X-HTTP-Initial-Response");if(t&&!Bs(t))return t}return null},as.Ag=function(){this.Ed=!0},as.Fd=function(t,e){for(var n=!0;!this.Za&&this.Bb<e.length;){var r=this.vf(e);if(r==Uu){4==t&&(this.I=4,Tu(14),n=!1),this.a.Wa(this.R,null,"[Incomplete Response]");break}if(r==Fu){this.I=4,Tu(15),this.a.Wa(this.R,e,"[Invalid Chunk]"),n=!1;break}this.a.Wa(this.R,r,null),this.Yc(r)}4==t&&0==e.length&&(this.I=1,Tu(16),n=!1),this.S=this.S&&n,n||(this.a.Wa(this.R,e,"[Invalid Chunked Response]"),this.Ia(),this.Kb())},as.kg=function(){if(this.h){var t=this.h.ma(),e=this.h.ya();this.Bb<e.length&&(this.Fb(),this.Fd(t,e),this.S&&4!=t&&this.eb())}},as.Ng=function(){this.Fc.nb(this.Vc,"tick",this.kg),this.Vc.start()},as.vf=function(t){var e=this.Bb,n=t.indexOf("\n",e);return-1==n?Uu:(e=Number(t.substring(e,n)),isNaN(e)?Fu:(n+=1)+e>t.length?Uu:(t=t.substr(n,e),this.Bb=n+e,t))},as.yg=function(t){this.ic=2,this.ua=t.clone().Ub(),t=!1,hs.navigator&&hs.navigator.sendBeacon&&(t=hs.navigator.sendBeacon(this.ua.toString(),"")),!t&&hs.Image&&((new Image).src=this.ua,t=!0),t||(this.h=this.b.Jb(null),this.h.send(this.ua)),this.qb=Is(),this.eb()},as.cancel=function(){this.Za=!0,this.Ia()},as.tg=function(t){t&&this.setTimeout(t),this.Ga&&(this.Fb(),this.eb())},as.eb=function(){this.hd=Is()+this.Ua,this.Ke(this.Ua)},as.Ke=function(t){if(null!=this.Ga)throw Error("WatchDog timer not null");this.Ga=Iu(Ts(this.gg,this),t)},as.Fb=function(){this.Ga&&(hs.clearTimeout(this.Ga),this.Ga=null)},as.gg=function(){this.Ga=null;var t=Is();0<=t-this.hd?this.Df():(this.a.T("WatchDog timer called too early"),this.Ke(this.hd-t))},as.Df=function(){this.S&&this.a.ca("Received watchdog timeout even though request loaded successfully"),this.a.Sg(this.pa),2!=this.ic&&(wu(3),Tu(17)),this.Ia(),this.I=2,this.Kb()},as.Kb=function(){this.b.de()||this.Za||this.b.Tc(this)},as.Ia=function(){this.Fb();var t=this.ac;t&&"function"==typeof t.bb&&t.bb(),this.ac=null,this.Vc.stop(),this.Fc.pb(),this.h&&(t=this.h,this.h=null,t.abort(),t.bb())},as.Hc=function(){return this.I},as.Yc=function(t){try{this.b.ue(this,t),wu(4)}catch(t){this.a.cb(t,"Error in httprequest callback")}},(as=Vu.prototype).C=function(){return this.j},as.H=function(){this.wc();for(var t=[],e=0;e<this.o.length;e++)t.push(this.D[this.o[e]]);return t},as.W=function(){return this.wc(),this.o.concat()},as.va=function(t){return Wu(this.D,t)},as.X=function(){return 0==this.j},as.clear=function(){this.D={},this.j=this.o.length=0},as.remove=function(t){return!!Wu(this.D,t)&&(delete this.D[t],this.j--,this.o.length>2*this.j&&this.wc(),!0)},as.wc=function(){if(this.j!=this.o.length){for(var t=0,e=0;t<this.o.length;){var n=this.o[t];Wu(this.D,n)&&(this.o[e++]=n),t++}this.o.length=e}if(this.j!=this.o.length){var r={};for(e=t=0;t<this.o.length;)Wu(r,n=this.o[t])||(this.o[e++]=n,r[n]=1),t++;this.o.length=e}},as.get=function(t,e){return Wu(this.D,t)?this.D[t]:e},as.set=function(t,e){Wu(this.D,t)||(this.j++,this.o.push(t)),this.D[t]=e},as.addAll=function(t){if(t instanceof Vu)for(var e=t.W(),n=0;n<e.length;n++)this.set(e[n],t.get(e[n]));else for(e in t)this.set(e,t[e])},as.forEach=function(t,e){for(var n=this.W(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}},as.clone=function(){return new Vu(this)};var ju=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ku(t,e){var n;this.xa=this.zb=this.qa="",this.Ca=null,this.ib=this.K="",this.O=this.Qf=!1,t instanceof Ku?(this.O=void 0!==e?e:t.O,this.tb(t.qa),this.cd(t.zb),this.rb(t.xa),this.sb(t.Ca),this.ec(t.K),this.bd(t.P.clone()),this.$c(t.ib)):t&&(n=String(t).match(ju))?(this.O=!!e,this.tb(n[1]||"",!0),this.cd(n[2]||"",!0),this.rb(n[3]||"",!0),this.sb(n[4]),this.ec(n[5]||"",!0),this.bd(n[6]||"",!0),this.$c(n[7]||"",!0)):(this.O=!!e,this.P=new Zu(null,this.O))}function Qu(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Hu(t,e,n){return ls(t)?(t=encodeURI(t).replace(e,Gu),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Gu(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}(as=Ku.prototype).toString=function(){var t=[],e=this.qa;e&&t.push(Hu(e,zu,!0),":");var n=this.xa;return(n||"file"==e)&&(t.push("//"),(e=this.zb)&&t.push(Hu(e,zu,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.Ca)&&t.push(":",String(n))),(n=this.K)&&(this.Ic()&&"/"!=n.charAt(0)&&t.push("/"),t.push(Hu(n,"/"==n.charAt(0)?Xu:Yu,!0))),(n=this.Rd())&&t.push("?",n),(n=this.ib)&&t.push("#",Hu(n,$u)),t.join("")},as.resolve=function(t){var e=this.clone(),n=t.Hf();n?e.tb(t.qa):n=t.If(),n?e.cd(t.zb):n=t.Ic(),n?e.rb(t.xa):n=t.Ff();var r=t.K;if(n)e.sb(t.Ca);else if(n=t.ae()){if("/"!=r.charAt(0))if(this.Ic()&&!this.ae())r="/"+r;else{var i=e.K.lastIndexOf("/");-1!=i&&(r=e.K.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.ec(r):n=t.Gf(),n?e.bd(t.P.clone()):n=t.Ef(),n&&e.$c(t.ib),e},as.clone=function(){return new Ku(this)},as.tb=function(t,e){this.U(),(this.qa=e?Qu(t,!0):t)&&(this.qa=this.qa.replace(/:$/,""))},as.Hf=function(){return!!this.qa},as.cd=function(t,e){this.U(),this.zb=e?Qu(t):t},as.If=function(){return!!this.zb},as.rb=function(t,e){this.U(),this.xa=e?Qu(t,!0):t},as.Ic=function(){return!!this.xa},as.sb=function(t){if(this.U(),t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);this.Ca=t}else this.Ca=null},as.Ff=function(){return null!=this.Ca},as.ec=function(t,e){this.U(),this.K=e?Qu(t,!0):t},as.ae=function(){return!!this.K},as.Gf=function(){return""!==this.P.toString()},as.bd=function(t,e){this.U(),t instanceof Zu?(this.P=t,this.P.ad(this.O)):(e||(t=Hu(t,Ju)),this.P=new Zu(t,this.O))},as.Rd=function(){return this.P.toString()},as.getQuery=function(){return this.Rd()},as.l=function(t,e){this.U(),this.P.set(t,e)},as.dc=function(t,e){this.U(),ys(e)||(e=[String(e)]),this.P.Ie(t,e)},as.$c=function(t,e){this.U(),this.ib=e?Qu(t):t},as.Ef=function(){return!!this.ib},as.Ub=function(){return this.U(),this.l("zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Is()).toString(36)),this},as.removeParameter=function(t){return this.U(),this.P.remove(t),this},as.U=function(){if(this.Qf)throw Error("Tried to modify a read-only Uri")},as.ad=function(t){this.O=t,this.P&&this.P.ad(t)};var zu=/[#\/\?@]/g,Yu=/[#\?:]/g,Xu=/[#\?]/g,Ju=/[#\?@]/g,$u=/#/g;function Zu(t,e){this.j=this.m=null,this.ja=t||null,this.O=!!e}function tc(t,e){this.b=t,this.a=e,this.f=this.A=null,this.bc=!1,this.K=null,this.w=-1,this.Ad=this.na=null}function ec(t){this.D=new Vu,t&&this.addAll(t)}function nc(t){var e=c(t);return"object"==e&&t||"function"==e?"o"+(t[bs]||(t[bs]=++_s)):e.substr(0,1)+t}function rc(t){this.me=t||ic,t=hs.PerformanceNavigationTiming?0<(t=hs.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(hs.vc&&hs.vc.ke&&hs.vc.ke()&&hs.vc.ke().nh),this.Xb=t?this.me:1,this.v=null,1<this.Xb&&(this.v=new ec),this.f=null,this.ba=[]}(as=Zu.prototype).$=function(){if(!this.m&&(this.m=new Vu,this.j=0,this.ja)){var t=this;!function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(this.ja,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})}},as.C=function(){return this.$(),this.j},as.add=function(t,e){this.$(),this.Oa(),t=this.Ma(t);var n=this.m.get(t);return n||this.m.set(t,n=[]),n.push(e),this.j+=1,this},as.remove=function(t){return this.$(),t=this.Ma(t),!!this.m.va(t)&&(this.Oa(),this.j-=this.m.get(t).length,this.m.remove(t))},as.clear=function(){this.Oa(),this.m=null,this.j=0},as.X=function(){return this.$(),0==this.j},as.va=function(t){return this.$(),t=this.Ma(t),this.m.va(t)},as.forEach=function(t,e){this.$(),this.m.forEach(function(n,r){Ls(n,function(n){t.call(e,n,r,this)},this)},this)},as.W=function(){this.$();for(var t=this.m.H(),e=this.m.W(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},as.H=function(t){this.$();var e=[];if(ls(t))this.va(t)&&(e=Us(e,this.m.get(this.Ma(t))));else{t=this.m.H();for(var n=0;n<t.length;n++)e=Us(e,t[n])}return e},as.set=function(t,e){return this.$(),this.Oa(),t=this.Ma(t),this.va(t)&&(this.j-=this.m.get(t).length),this.m.set(t,[e]),this.j+=1,this},as.get=function(t,e){return t&&0<(t=this.H(t)).length?String(t[0]):e},as.Ie=function(t,e){this.remove(t),0<e.length&&(this.Oa(),this.m.set(this.Ma(t),qs(e)),this.j+=e.length)},as.toString=function(){if(this.ja)return this.ja;if(!this.m)return"";for(var t=[],e=this.m.W(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.H(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.ja=t.join("&")},as.Oa=function(){this.ja=null},as.clone=function(){var t=new Zu;return t.ja=this.ja,this.m&&(t.m=this.m.clone(),t.j=this.j),t},as.Ma=function(t){return t=String(t),this.O&&(t=t.toLowerCase()),t},as.ad=function(t){t&&!this.O&&(this.$(),this.Oa(),this.m.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(this.remove(e),this.Ie(n,t))},this)),this.O=t},as.extend=function(t){for(var e=0;e<arguments.length;e++)Bu(arguments[e],function(t,e){this.add(e,t)},this)},Cs(function(){},function(){}),(as=tc.prototype).g=null,as.ga=function(t){this.A=t},as.connect=function(t){this.K=t,t=this.b.Sd(this.K),Tu(3);var e=this.b.Ib.$d;null!=e?(this.na=this.b.$a(e[0]),this.g=1,this.xd()):(t.dc("MODE","init"),!this.b.ta&&this.b.aa&&t.dc("X-HTTP-Session-Id",this.b.aa),this.f=new Mu(this,this.a,void 0,void 0,void 0),this.f.ga(this.A),this.f.jd(t,!1,null),this.g=0)},as.xd=function(){this.a.debug("TestConnection: starting stage 2");var t=this.b.Ib.od;if(null!=t)this.a.debug(function(){return"Buffered"}),Tu(4),t?(Tu(10),this.b.ub(this,!1)):(Tu(11),this.b.ub(this,!0));else{this.f=new Mu(this,this.a,void 0,void 0,void 0),this.f.ga(this.A);var e=this.b.Pd(this.na,this.K);Tu(4),e.dc("TYPE","xmlhttp");var n=this.b.aa,r=this.b.Kc;n&&r&&e.l(n,r),this.f.jd(e,!1,this.na)}},as.Jb=function(t){return this.b.Jb(t)},as.abort=function(){this.f&&(this.f.cancel(),this.f=null),this.w=-1},as.de=function(){return!1},as.ue=function(t,e){if(this.w=t.w,0==this.g)if(this.a.debug("TestConnection: Got data for stage 1"),this.pc(t),e){try{var n=this.b.kc.zc(e)}catch(t){return this.a.cb(t),void this.b.dd(this)}this.na=this.b.$a(n[0])}else this.a.debug("TestConnection: Null responseText"),this.b.dd(this);else 1==this.g&&(this.bc?Tu(6):"11111"==e?(Tu(5),this.bc=!0,this.Ze()&&(this.w=200,this.f.cancel(),this.a.debug("Test connection succeeded; using streaming connection"),Tu(11),this.b.ub(this,!0))):(Tu(7),this.bc=!1))},as.Tc=function(){this.w=this.f.w,this.f.S?0==this.g?(this.g=1,this.a.debug("TestConnection: request complete for initial check"),this.xd()):1==this.g&&(this.a.debug("TestConnection: request complete for stage 2"),this.bc?(this.a.debug("Test connection succeeded; using streaming connection"),Tu(11),this.b.ub(this,!0)):(this.a.debug("Test connection failed; not using streaming"),Tu(10),this.b.ub(this,!1))):(this.a.debug("TestConnection: request failed, in state "+this.g),0==this.g?Tu(8):1==this.g&&Tu(9),this.b.dd(this))},as.pc=function(t){if(!this.b.ta&&(t=t.h)){var e=t.kb("X-Client-Wire-Protocol");this.Ad=e||null,this.b.aa&&((t=t.kb("X-HTTP-Session-Id"))?this.b.Fe(t):this.a.T("Missing X_HTTP_SESSION_ID in the handshake response"))}},as.fc=function(){return this.b.fc()},as.Ba=function(){return this.b.Ba()},as.Ze=function(){return!ra||10<=Number(fa)},(as=ec.prototype).C=function(){return this.D.C()},as.add=function(t){this.D.set(nc(t),t)},as.addAll=function(t){for(var e=(t=qu(t)).length,n=0;n<e;n++)this.add(t[n])},as.pb=function(t){for(var e=(t=qu(t)).length,n=0;n<e;n++)this.remove(t[n])},as.remove=function(t){return this.D.remove(nc(t))},as.clear=function(){this.D.clear()},as.X=function(){return this.D.X()},as.contains=function(t){return this.D.va(nc(t))},as.H=function(){return this.D.H()},as.clone=function(){return new ec(this)};var ic=10;function oc(){this.xg=this.rg=void 0}function sc(){this.jg=new oc}function ac(t,e,n,r,i){try{t.debug(n),e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(e){t.cb(e)}}(as=rc.prototype).ld=function(t){this.v||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(this.Xb=this.me,this.v=new ec,this.f&&(this.oc(this.f),this.f=null))},as.ee=function(){return!!this.f||!!this.v&&this.v.C()>=this.Xb},as.xf=function(){return this.f?1:this.v?this.v.C():0},as.Jc=function(t){return this.f?this.f==t:!!this.v&&this.v.contains(t)},as.oc=function(t){this.v?this.v.add(t):this.f=t},as.ze=function(t){this.f&&this.f==t?this.f=null:this.v&&this.v.contains(t)&&this.v.remove(t)},as.cancel=function(){this.ba=this.la(),this.f?(this.f.cancel(),this.f=null):this.v&&!this.v.X()&&(Ls(this.v.H(),function(t){t.cancel()}),this.v.clear())},as.la=function(){if(null!=this.f)return this.ba.concat(this.f.la());if(null!=this.v&&!this.v.X()){var t=this.ba;return Ls(this.v.H(),function(e){t=t.concat(e.la())}),t}return qs(this.ba)},as.Re=function(t){this.ba=this.ba.concat(t)},as.$e=function(){this.ba.length=0},oc.prototype.stringify=function(t){return hs.JSON.stringify(t,this.rg)},oc.prototype.parse=function(t){return hs.JSON.parse(t,this.xg)},sc.prototype.hf=function(t,e,n){var r=n||"";try{Bu(t,function(t,n){var i=t;vs(t)&&(i=ja(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}},sc.prototype.jf=function(t,e,n){for(var r=-1;;){var i=["count="+e];-1==r?0<e?(r=t[0].Pc,i.push("ofs="+r)):r=0:i.push("ofs="+r);for(var o=!0,s=0;s<e;s++){var a=t[s].Pc,u=t[s].map;if(0>(a-=r))r=Math.max(0,t[s].Pc-100),o=!1;else try{this.hf(u,i,"req"+a+"_")}catch(t){n&&n(u)}}if(o)return i.join("&")}},sc.prototype.zc=function(t){return this.jg.parse(t)};var uc=hs.JSON.parse;function cc(t){Wa.call(this),this.headers=new Vu,this.Xa=t||null,this.ha=!1,this.mc=this.c=null,this.ge=this.Tb="",this.Pa=0,this.I="",this.Aa=this.Lc=this.Qb=this.Ec=!1,this.vb=0,this.hc=null,this.Ae=hc,this.jc=this.lg=this.Ab=!1}Cs(cc,Wa);var hc="";cc.prototype.s=yu("goog.net.XhrIo");var lc=/^https?$/i,fc=["POST","PUT"];function pc(t){return"content-type"==t.toLowerCase()}function dc(t,e){return{type:e,lengthComputable:t.lengthComputable,loaded:t.loaded,total:t.total}}function yc(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return Gs(n,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(),ls(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return t.l(e,n),t}function mc(t){this.Bd=22,this.De=0,this.M=[],this.a=new vu,this.Ib=new function(){this.od=this.$d=null},this.na=this.md=this.hb=this.K=this.u=this.Kc=this.aa=this.gb=this.N=this.Rb=this.A=null,this.Te=!0,this.ag=this.Yb=0,this.kf=!!fs("internalChannelParams.failFast",t),this.fd=this.Ja=this.wa=this.ia=this.ea=this.i=null,this.Se=!0,this.w=this.he=this.Sb=-1,this.rc=this.Ha=this.La=0,this.Ve=fs("internalChannelParams.baseRetryDelayMs",t)||5e3,this.vg=fs("internalChannelParams.retryDelaySeedMs",t)||1e4,this.nf=fs("internalChannelParams.forwardChannelMaxRetries",t)||2,this.Od=fs("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Xa=t&&t.oh||void 0,this.Db=void 0,this.Ra=0,this.gc=t&&t.supportsCrossDomainXhr||!1,this.ra="",this.G=new rc(t&&t.concurrentRequestLimit),this.kc=new sc,this.ta=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.Nd=t&&t.fastHandshake||!1)&&!this.ta&&(this.a.T("Force backgroundChannelTest when fastHandshake is enabled."),this.ta=!0),t&&t.Id&&this.a.Id()}function gc(){}function vc(){if(ra&&!(10<=Number(fa)))throw Error("Environmental error: no available transport.")}function bc(t,e){Wa.call(this),this.b=new mc(e),this.yb=t,this.Qg=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e=r?e+i:e+"/"+i)}return e}(this.yb,"test"),this.s=yu("goog.labs.net.webChannel.WebChannelBaseTransport"),this.Rc=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.b.ga(t),t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.zd&&(t?t["X-WebChannel-Client-Profile"]=e.zd:t={"X-WebChannel-Client-Profile":e.zd}),this.b.Eg(t),(t=e&&e.httpHeadersOverwriteParam)&&!Bs(t)&&this.b.Cg(t),this.Og=e&&e.supportsCrossDomainXhr||!1,this.zg=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Bs(e)&&(this.b.Dg(e),null!==(t=this.Rc)&&e in t&&(e in(t=this.Rc)&&delete t[e],(t=this.s)&&t.T("Ignore httpSessionIdParam also specified with messageUrlParams: "+e,void 0))),this.vd=new Ec(this)}function _c(t){Ou.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.ne=t)&&(t=this.ne,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function wc(t){Pu.call(this),this.status=1,this.errorCode=t}function Ec(t){this.b=t}(as=cc.prototype).Je=function(t){this.Ab=t},as.send=function(t,e,n,r){if(this.c)throw Error("[goog.net.XhrIo] Object is active with another request="+this.Tb+"; newUri="+t);e=e?e.toUpperCase():"GET",this.Tb=t,this.I="",this.Pa=0,this.ge=e,this.Ec=!1,this.ha=!0,this.c=this.df(),this.mc=this.Xa?this.Xa.Vd():ku.Vd(),this.c.onreadystatechange=Ts(this.te,this),this.lg&&"onprogress"in this.c&&(this.c.onprogress=Ts(function(t){this.re(t,!0)},this),this.c.upload&&(this.c.upload.onprogress=Ts(this.re,this)));try{gu(this.s,this.da("Opening Xhr")),this.Lc=!0,this.c.open(e,String(t),!0),this.Lc=!1}catch(t){return gu(this.s,this.da("Error opening Xhr: "+t.message)),void this.Ld(t)}t=n||"";var i=this.headers.clone();r&&Bu(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=pc,n=t.length,r=ls(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:ls(t)?t.charAt(e):t[e]}(i.W()),n=hs.FormData&&t instanceof hs.FormData,!(0<=Os(fc,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.c.setRequestHeader(e,t)},this),this.Ae&&(this.c.responseType=this.Ae),"withCredentials"in this.c&&this.c.withCredentials!==this.Ab&&(this.c.withCredentials=this.Ab);try{this.yd(),0<this.vb&&(this.jc=function(t){return ra&&da(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.c),gu(this.s,this.da("Will abort after "+this.vb+"ms if incomplete, xhr2 "+this.jc)),this.jc?(this.c.timeout=this.vb,this.c.ontimeout=Ts(this.Ua,this)):this.hc=eu(this.Ua,this.vb,this)),gu(this.s,this.da("Sending request")),this.Qb=!0,this.c.send(t),this.Qb=!1}catch(t){gu(this.s,this.da("Send error: "+t.message)),this.Ld(t)}},as.df=function(){return this.Xa?this.Xa.Dd():ku.Dd()},as.Ua=function(){void 0!==cs&&this.c&&(this.I="Timed out after "+this.vb+"ms, aborting",this.Pa=8,gu(this.s,this.da(this.I)),this.dispatchEvent("timeout"),this.abort(8))},as.Ld=function(t){this.ha=!1,this.c&&(this.Aa=!0,this.c.abort(),this.Aa=!1),this.I=t,this.Pa=5,this.Jd(),this.Gb()},as.Jd=function(){this.Ec||(this.Ec=!0,this.dispatchEvent("complete"),this.dispatchEvent("error"))},as.abort=function(t){this.c&&this.ha&&(gu(this.s,this.da("Aborting")),this.ha=!1,this.Aa=!0,this.c.abort(),this.Aa=!1,this.Pa=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),this.Gb())},as.F=function(){this.c&&(this.ha&&(this.ha=!1,this.Aa=!0,this.c.abort(),this.Aa=!1),this.Gb(!0)),cc.L.F.call(this)},as.te=function(){this.Ka||(this.Lc||this.Qb||this.Aa?this.se():this.eg())},as.eg=function(){this.se()},as.se=function(){if(this.ha&&void 0!==cs)if(this.mc[1]&&4==this.ma()&&2==this.za())gu(this.s,this.da("Local request error detected and ignored"));else if(this.Qb&&4==this.ma())eu(this.te,0,this);else if(this.dispatchEvent("readystatechange"),this.Mc()){gu(this.s,this.da("Request complete")),this.ha=!1;try{this.Rf()?(this.dispatchEvent("complete"),this.dispatchEvent("success")):(this.Pa=6,this.I=this.Yd()+" ["+this.za()+"]",this.Jd())}finally{this.Gb()}}},as.re=function(t,e){this.dispatchEvent(dc(t,"progress")),this.dispatchEvent(dc(t,e?"downloadprogress":"uploadprogress"))},as.Gb=function(t){if(this.c){this.yd();var e=this.c,n=this.mc[0]?ps:null;this.mc=this.c=null,t||this.dispatchEvent("ready");try{e.onreadystatechange=n}catch(e){(t=this.s)&&t.ca("Problem encountered resetting onreadystatechange: "+e.message,void 0)}}},as.yd=function(){this.c&&this.jc&&(this.c.ontimeout=null),this.hc&&(hs.clearTimeout(this.hc),this.hc=null)},as.Ba=function(){return!!this.c},as.Mc=function(){return 4==this.ma()},as.Rf=function(){var t=this.za();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}return e||0===t&&!this.Of()},as.Of=function(){var t=String(this.Tb).match(ju)[1]||null;return!t&&hs.self&&hs.self.location&&(t=(t=hs.self.location.protocol).substr(0,t.length-1)),lc.test(t?t.toLowerCase():"")},as.ma=function(){return this.c?this.c.readyState:0},as.za=function(){try{return 2<this.ma()?this.c.status:-1}catch(t){return-1}},as.Yd=function(){try{return 2<this.ma()?this.c.statusText:""}catch(t){return gu(this.s,"Can not get status: "+t.message),""}},as.ya=function(){try{return this.c?this.c.responseText:""}catch(t){return gu(this.s,"Can not get responseText: "+t.message),""}},as.yf=function(t){if(this.c){var e=this.c.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),uc(e)}},as.getResponseHeader=function(t){if(this.c&&this.Mc())return null===(t=this.c.getResponseHeader(t))?void 0:t},as.getAllResponseHeaders=function(){return this.c&&this.Mc()&&this.c.getAllResponseHeaders()||""},as.kb=function(t){return this.c?this.c.getResponseHeader(t):null},as.Ud=function(){return this.Pa},as.Hc=function(){return ls(this.I)?this.I:String(this.I)},as.da=function(t){return t+" ["+this.ge+" "+this.Tb+" "+this.za()+"]"},(as=mc.prototype).tc=8,as.g=1,as.connect=function(t,e,n,r,i){this.a.debug("connect()"),Tu(0),this.K=e,this.gb=n||{},r&&void 0!==i&&(this.gb.OSID=r,this.gb.OAID=i),this.ta&&(this.a.debug("connect() bypassed channel-test."),this.Ib.$d=[],this.Ib.od=!1),this.bf(t)},as.disconnect=function(){if(this.a.debug("disconnect()"),this.qd(),3==this.g){var t=this.Yb++,e=this.hb.clone();e.l("SID",this.ra),e.l("RID",t),e.l("TYPE","terminate"),this.Ya(e),new Mu(this,this.a,this.ra,t,void 0).yg(e)}this.qe()},as.bf=function(t){this.a.debug("connectTest_()"),this.Ja=new tc(this,this.a),null===this.N&&this.Ja.ga(this.A);var e=t;this.N&&this.A&&(e=yc(t,this.N,this.A)),this.Ja.connect(e)},as.af=function(){this.a.debug("connectChannel_()"),this.hb=this.Sd(this.K),this.Dc()},as.qd=function(){this.Ja&&(this.Ja.abort(),this.Ja=null),this.u&&(this.u.cancel(),this.u=null),this.ia&&(hs.clearTimeout(this.ia),this.ia=null),this.Hb(),this.G.cancel(),this.ea&&(hs.clearTimeout(this.ea),this.ea=null)},as.ga=function(t){this.A=t},as.Eg=function(t){this.Rb=t},as.Cg=function(t){this.N=t},as.Dg=function(t){this.aa=t},as.Fe=function(t){this.Kc=t},as.He=function(t){this.Ra=t},as.Hg=function(){this.gc=!0},as.Ee=function(t){this.i=t},as.Nf=function(){return!this.fd},as.Zc=function(t){1e3==this.M.length&&this.a.ca(function(){return"Already have 1000 queued maps upon queueing "+ja(t)}),this.M.push(new function(t,e){this.Pc=t,this.map=e,this.context=null}(this.ag++,t)),3==this.g&&this.Dc()},as.qf=function(){return this.kf?0:this.nf},as.de=function(){return 0==this.g},as.getState=function(){return this.g},as.Dc=function(){this.G.ee()||this.ea||(this.ea=Iu(Ts(this.we,this),0),this.La=0)},as.Yf=function(t){return this.G.xf()>=this.G.Xb-(this.ea?1:0)?(this.a.ca("Unexpected retry request is scheduled."),!1):this.ea?(this.a.debug("Use the retry request that is already scheduled."),this.M=t.la().concat(this.M),!0):!(1==this.g||2==this.g||this.La>=this.qf()||(this.a.debug("Going to retry POST"),this.ea=Iu(Ts(this.we,this,t),this.Xd(this.La)),this.La++,0))},as.we=function(t){this.ea=null,this.Mg(t)},as.Mg=function(t){this.a.debug("startForwardChannel_"),1==this.g?t?this.a.ca("Not supposed to retry the open"):(this.ig(),this.g=2):3==this.g&&(t?this.le(t):0==this.M.length?this.a.debug("startForwardChannel_ returned: nothing to send"):this.G.ee()?this.a.ca("startForwardChannel_ returned: connection already in progress"):(this.le(),this.a.debug("startForwardChannel_ finished, sent request")))},as.ig=function(){this.a.debug("open_()"),this.Yb=Math.floor(1e5*Math.random());var t=this.Yb++,e=new Mu(this,this.a,"",t,void 0),n=this.A;this.Rb&&(n?$s(n=Xs(n),this.Rb):n=this.Rb),null===this.N&&e.ga(n);var r=this.Hd(e),i=this.hb.clone();i.l("RID",t),0<this.Bd&&i.l("CVER",this.Bd),this.ta&&this.aa&&i.l("X-HTTP-Session-Id",this.aa),this.Ya(i),this.N&&n&&yc(i,this.N,n),this.G.oc(e),this.Nd?(i.l("$req",r),i.l("SID","null"),e.Ag(),e.kd(i,null)):e.kd(i,r)},as.le=function(t){var e=t?t.R:this.Yb++,n=this.hb.clone();n.l("SID",this.ra),n.l("RID",e),n.l("AID",this.Sb),this.Ya(n),this.N&&this.A&&yc(n,this.N,this.A),e=new Mu(this,this.a,this.ra,e,this.La+1),null===this.N&&e.ga(this.A),t&&this.sg(t),t=this.Hd(e),e.setTimeout(Math.round(.5*this.Od)+Math.round(.5*this.Od*Math.random())),this.G.oc(e),e.kd(n,t)},as.Ya=function(t){this.i&&Bu({},function(e,n){t.l(n,e)})},as.Hd=function(t){var e=Math.min(this.M.length,1e3),n=this.i?Ts(this.i.Ue,this.i,this):null;return n=this.kc.jf(this.M,e,n),t.Gg(this.M.splice(0,e)),n},as.sg=function(t){this.M=t.la().concat(this.M)},as.Kd=function(){if(!this.u&&!this.ia){this.rc=1;var t=this.ve;Ga||function(){if(hs.Promise&&hs.Promise.resolve){var t=hs.Promise.resolve(void 0);Ga=function(){t.then(Za)}}else Ga=function(){var t=Za;!gs(hs.setImmediate)||hs.Window&&hs.Window.prototype&&!Hs("Edge")&&hs.Window.prototype.setImmediate==hs.setImmediate?(Ha||(Ha=function(){var t=hs.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Hs("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=Ts(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0!==t&&!Hs("Trident")&&!Hs("MSIE")){var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).rd;n.rd=null,t()}},function(t){r.next={rd:t},r=r.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){hs.setTimeout(t,0)}}()),Ha(t)):hs.setImmediate(t)}}(),Ja||(Ga(),Ja=!0),$a.add(t,this),this.Ha=0}},as.Qc=function(){return this.u||this.ia?(this.a.ca("Request already in progress"),!1):!(3<=this.Ha||(this.a.debug("Going to retry GET"),this.rc++,this.ia=Iu(Ts(this.ve,this),this.Xd(this.Ha)),this.Ha++,0))},as.ve=function(){this.ia=null,this.Kg()},as.Kg=function(){this.a.debug("Creating new HttpRequest"),this.u=new Mu(this,this.a,this.ra,"rpc",this.rc),null===this.N&&this.u.ga(this.A),this.u.He(this.Ra);var t=this.md.clone();t.l("RID","rpc"),t.l("SID",this.ra),t.l("CI",this.fd?"0":"1"),t.l("AID",this.Sb),this.Ya(t),t.l("TYPE","xmlhttp"),this.N&&this.A&&yc(t,this.N,this.A),this.Db&&this.u.setTimeout(this.Db),this.u.jd(t,!0,this.na),this.a.debug("New Request created")},as.ub=function(t,e){this.a.debug("Test Connection Finished");var n=t.Ad;n&&this.G.ld(n),this.fd=this.Se&&e,this.w=t.w,this.af()},as.dd=function(t){this.a.debug("Test Connection Failed"),this.w=t.w,this.sa(2)},as.ue=function(t,e){if(0!=this.g&&(this.u==t||this.G.Jc(t)))if(this.w=t.w,!t.lb&&this.G.Jc(t)&&3==this.g){try{var n=this.kc.zc(e)}catch(t){n=null}ys(n)&&3==n.length?this.Cf(n,t):(this.a.debug("Bad POST response data returned"),this.sa(11))}else(t.lb||this.u==t)&&this.Hb(),Bs(e)||(n=this.kc.zc(e),this.dg(n,t))},as.Cf=function(t,e){0==t[0]?this.Bf(e):(this.he=t[1],0<(e=this.he-this.Sb)&&(t=t[2],this.a.debug(t+" bytes (in "+e+" arrays) are outstanding on the BackChannel"),this.Jg(t)&&!this.wa&&(this.wa=Iu(Ts(this.bg,this),6e3))))},as.Bf=function(t){if(this.a.debug("Server claims our backchannel is missing."),this.ia)this.a.debug("But we are currently starting the request.");else{if(this.u){if(!(this.u.qb+3e3<t.qb))return;this.Hb(),this.u.cancel(),this.u=null}else this.a.T("We do not have a BackChannel established");this.Qc(),Tu(18)}},as.Jg=function(t){return 37500>t&&!this.Nf()&&0==this.Ha},as.$a=function(t){return this.Te?this.i?this.i.$a(t):t:null},as.bg=function(){null!=this.wa&&(this.wa=null,this.u.cancel(),this.u=null,this.Qc(),Tu(19))},as.Hb=function(){null!=this.wa&&(hs.clearTimeout(this.wa),this.wa=null)},as.Tc=function(t){this.a.debug("Request complete");var e=null;if(this.u==t){this.Hb(),this.u=null;var n=2}else{if(!this.G.Jc(t))return;e=t.la(),this.G.ze(t),n=1}if(this.w=t.w,0!=this.g)if(t.S)1==n?(function(t,e,n){bu.dispatchEvent(new Su(bu,t,e,n))}(t.Da?t.Da.length:0,Is()-t.qb,this.La),this.Dc()):this.Kd();else{var r=t.Hc();if(3==r||0==r&&0<this.w)this.a.debug("Not retrying due to error type");else{var i=this;if(this.a.debug(function(){return"Maybe retrying, last error: "+function(t,e){switch(t){case 0:return"Non-200 return code ("+e+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}(r,i.w)}),1==n&&this.Yf(t)||2==n&&this.Qc())return;this.a.debug("Exceeded max number of retries")}switch(e&&0<e.length&&this.G.Re(e),this.a.debug("Error: HTTP request failed"),r){case 1:this.sa(5);break;case 4:this.sa(10);break;case 3:this.sa(6);break;default:this.sa(2)}}},as.Xd=function(t){var e=this.Ve+Math.floor(Math.random()*this.vg);return this.Ba()||(this.a.debug("Inactive channel"),e*=2),e*t},as.pc=function(t){if(this.ta&&(t=t.h)){var e=t.kb("X-Client-Wire-Protocol");e&&this.G.ld(e),this.aa&&((t=t.kb("X-HTTP-Session-Id"))?(this.Fe(t),this.hb.l(this.aa,t)):this.a.T("Missing X_HTTP_SESSION_ID in the handshake response"))}},as.dg=function(t,e){for(var n=this.i&&this.i.sc?[]:null,r=0;r<t.length;r++){var i=t[r];if(this.Sb=i[0],i=i[1],2==this.g)if("c"==i[0]){this.ra=i[1],this.na=this.$a(i[2]);var o=i[3];null!=o&&(this.tc=o,this.a.info("VER="+this.tc)),null!=(o=i[4])&&(this.De=o,this.a.info("SVER="+this.De)),null!=(i=i[5])&&"number"==typeof i&&0<i&&(this.Db=i*=1.5,this.a.info("backChannelRequestTimeoutMs_="+i)),this.pc(e),this.g=3,this.i&&this.i.wd(),this.Lg(e)}else"stop"!=i[0]&&"close"!=i[0]||this.sa(7);else 3==this.g&&("stop"==i[0]||"close"==i[0]?(n&&0!=n.length&&(this.i.sc(this,n),n.length=0),"stop"==i[0]?this.sa(7):this.disconnect()):"noop"!=i[0]&&(n?n.push(i):this.i&&this.i.ud(i)),this.Ha=0)}n&&0!=n.length&&this.i.sc(this,n)},as.Lg=function(t){this.md=this.Pd(this.na,this.K),t.lb?(this.a.debug("Upgrade the handshake request to a backchannel."),this.G.ze(t),t.tg(this.Db),this.u=t):this.Kd()},as.sa=function(t){if(this.a.info("Error code "+t),2==t){var e=null;this.i&&(e=null);var n=Ts(this.Pg,this);e||(e=new Ku("//www.google.com/images/cleardot.gif"),hs.location&&"http"==hs.location.protocol||e.tb("https"),e.Ub()),function(t,e){var n=new vu;n.debug("TestLoadImage: loading "+t);var r=new Image;r.onload=Ss(ac,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Ss(ac,n,r,"TestLoadImage: error",!1,e),r.onabort=Ss(ac,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ss(ac,n,r,"TestLoadImage: timeout",!1,e),hs.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}(e.toString(),n)}else Tu(2);this.cg(t)},as.Pg=function(t){t?(this.a.info("Successfully pinged google.com"),Tu(2)):(this.a.info("Failed to ping google.com"),Tu(1))},as.cg=function(t){this.a.debug("HttpChannel: error - "+t),this.g=0,this.i&&this.i.td(t),this.qe(),this.qd()},as.qe=function(){if(this.g=0,this.w=-1,this.i){var t=this.G.la();if(0!=t.length||0!=this.M.length){var e=this;this.a.debug(function(){return"Number of undelivered maps, pending: "+t.length+", outgoing: "+e.M.length}),this.G.$e(),qs(this.M),this.M.length=0}this.i.sd()}},as.Sd=function(t){return t=this.Cd(null,t),this.a.debug("GetForwardChannelUri: "+t),t},as.Pd=function(t,e){return t=this.Cd(this.fc()?t:null,e),this.a.debug("GetBackChannelUri: "+t),t},as.Cd=function(t,e){var n=function(t){return t instanceof Ku?t.clone():new Ku(t,void 0)}(e);if(""!=n.xa)t&&n.rb(t+"."+n.xa),n.sb(n.Ca);else{var r=hs.location;n=function(t,e,n,r){var i=new Ku(null,void 0);return t&&i.tb(t),e&&i.rb(e),n&&i.sb(n),r&&i.ec(r),i}(r.protocol,t?t+"."+r.hostname:r.hostname,+r.port,e)}return this.gb&&Gs(this.gb,function(t,e){n.l(e,t)}),t=this.aa,e=this.Kc,t&&e&&n.l(t,e),n.l("VER",this.tc),this.Ya(n),n},as.Jb=function(t){if(t&&!this.gc)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new cc(this.Xa)).Je(this.gc),t},as.Ba=function(){return!!this.i&&this.i.Ba()},as.fc=function(){return this.gc},(as=gc.prototype).sc=null,as.wd=function(){},as.ud=function(){},as.td=function(){},as.sd=function(){},as.Ba=function(){return!0},as.Ue=function(){},as.$a=function(t){return t},vc.prototype.cf=function(t,e){return new bc(t,e)},Cs(bc,Wa),(as=bc.prototype).addEventListener=function(t,e,n,r){bc.L.addEventListener.call(this,t,e,n,r)},as.removeEventListener=function(t,e,n,r){bc.L.removeEventListener.call(this,t,e,n,r)},as.open=function(){this.b.Ee(this.vd),this.Og&&this.b.Hg(),this.b.connect(this.Qg,this.yb,this.Rc||void 0)},as.close=function(){this.b.disconnect()},as.send=function(t){if(ls(t)){var e={};e.__data__=t,this.b.Zc(e)}else this.zg?((e={}).__data__=ja(t),this.b.Zc(e)):this.b.Zc(t)},as.F=function(){this.b.Ee(null),delete this.vd,this.b.disconnect(),delete this.b,bc.L.F.call(this)},Cs(_c,Ou),Cs(wc,Pu),Cs(Ec,gc),Ec.prototype.wd=function(){mu(this.b.s,"WebChannel opened on "+this.b.yb),this.b.dispatchEvent("a")},Ec.prototype.ud=function(t){this.b.dispatchEvent(new _c(t))},Ec.prototype.td=function(t){mu(this.b.s,"WebChannel aborted on "+this.b.yb+" due to channel error: "+t),this.b.dispatchEvent(new wc(t))},Ec.prototype.sd=function(){mu(this.b.s,"WebChannel closed on "+this.b.yb),this.b.dispatchEvent("b")};var Tc=Ss(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},vc);function Sc(){this.V=[],this.Z=[]}function Ic(t,e){if(As.call(this),this.oe=t||0,this.Wb=e||10,this.oe>this.Wb)throw Error(Cc);this.fa=new Sc,this.oa=new ec,this.Ac=0,this.Nc=null,this.Cb()}(as=Sc.prototype).Vf=function(){0==this.V.length&&(this.V=this.Z,this.V.reverse(),this.Z=[])},as.enqueue=function(t){this.Z.push(t)},as.ab=function(){return this.Vf(),this.V.pop()},as.C=function(){return this.V.length+this.Z.length},as.X=function(){return 0==this.V.length&&0==this.Z.length},as.clear=function(){this.V=[],this.Z=[]},as.contains=function(t){return 0<=Os(this.V,t)||0<=Os(this.Z,t)},as.remove=function(t){var e=this.V,n=Ps(e,t);return 0<=n?(Array.prototype.splice.call(e,n,1),e=!0):e=!1,e||Fs(this.Z,t)},as.H=function(){for(var t=[],e=this.V.length-1;0<=e;--e)t.push(this.V[e]);var n=this.Z.length;for(e=0;e<n;++e)t.push(this.Z[e]);return t},Cs(Ic,As);var Cc="[goog.structs.Pool] Min can not be greater than max";function Nc(t,e){this.fe=t,this.gd=e}function Dc(t){this.Y=[],t&&this.Lf(t)}function Ac(){Dc.call(this)}function kc(t,e){this.Gd=void 0,this.cc=new Ac,Ic.call(this,t,e)}function Rc(t,e,n,r){this.Jf=t,this.Ab=!!r,kc.call(this,e,n)}(as=Ic.prototype).Mb=function(){var t=Is();if(!(null!=this.Nc&&t-this.Nc<this.Ac)){var e=this.qg();return e&&(this.Nc=t,this.oa.add(e)),e}},as.og=function(t){return!!this.oa.remove(t)&&(this.nc(t),!0)},as.qg=function(){for(var t;0<this.Td()&&(t=this.fa.ab(),!this.Sc(t));)this.Cb();return!t&&this.C()<this.Wb&&(t=this.xc()),t},as.nc=function(t){this.oa.remove(t),this.Sc(t)&&this.C()<this.Wb?this.fa.enqueue(t):this.Bc(t)},as.Cb=function(){for(var t=this.fa;this.C()<this.oe;)t.enqueue(this.xc());for(;this.C()>this.Wb&&0<this.Td();)this.Bc(t.ab())},as.xc=function(){return{}},as.Bc=function(t){if("function"==typeof t.bb)t.bb();else for(var e in t)t[e]=null},as.Sc=function(t){return"function"!=typeof t.Ye||t.Ye()},as.contains=function(t){return this.fa.contains(t)||this.oa.contains(t)},as.C=function(){return this.fa.C()+this.oa.C()},as.rf=function(){return this.oa.C()},as.Td=function(){return this.fa.C()},as.X=function(){return this.fa.X()&&this.oa.X()},as.F=function(){if(Ic.L.F.call(this),0<this.rf())throw Error("[goog.structs.Pool] Objects not released");delete this.oa;for(var t=this.fa;!t.X();)this.Bc(t.ab());delete this.fa},Nc.prototype.getKey=function(){return this.fe},Nc.prototype.clone=function(){return new Nc(this.fe,this.gd)},(as=Dc.prototype).ce=function(t,e){var n=this.Y;n.push(new Nc(t,e)),this.$f(n.length-1)},as.Lf=function(t){if(t instanceof Dc){var e=t.W();if(t=t.H(),0>=this.C()){for(var n=this.Y,r=0;r<e.length;r++)n.push(new Nc(e[r],t[r]));return}}else e=Ys(t),t=zs(t);for(r=0;r<e.length;r++)this.ce(e[r],t[r])},as.remove=function(){var t=this.Y,e=t.length,n=t[0];if(!(0>=e))return 1==e?xs(t):(t[0]=t.pop(),this.Zf()),n.gd},as.Zf=function(){for(var t=0,e=this.Y,n=e.length,r=e[t];t<n>>1;){var i=this.tf(t),o=this.zf(t);if(e[i=o<n&&e[o].getKey()<e[i].getKey()?o:i].getKey()>r.getKey())break;e[t]=e[i],t=i}e[t]=r},as.$f=function(t){for(var e=this.Y,n=e[t];0<t;){var r=this.wf(t);if(!(e[r].getKey()>n.getKey()))break;e[t]=e[r],t=r}e[t]=n},as.tf=function(t){return 2*t+1},as.zf=function(t){return 2*t+2},as.wf=function(t){return t-1>>1},as.H=function(){for(var t=this.Y,e=[],n=t.length,r=0;r<n;r++)e.push(t[r].gd);return e},as.W=function(){for(var t=this.Y,e=[],n=t.length,r=0;r<n;r++)e.push(t[r].getKey());return e},as.va=function(t){return Ms(this.Y,function(e){return e.getKey()==t})},as.clone=function(){return new Dc(this)},as.C=function(){return this.Y.length},as.X=function(){return 0==this.Y.length},as.clear=function(){xs(this.Y)},Cs(Ac,Dc),Ac.prototype.enqueue=function(t,e){this.ce(t,e)},Ac.prototype.ab=function(){return this.remove()},Cs(kc,Ic),(as=kc.prototype).Mb=function(t,e){if(!t)return(t=kc.L.Mb.call(this))&&this.Ac&&(this.Gd=hs.setTimeout(Ts(this.Nb,this),this.Ac)),t;this.cc.enqueue(void 0!==e?e:100,t),this.Nb()},as.Nb=function(){for(var t=this.cc;0<t.C();){var e=this.Mb();if(!e)break;t.ab().apply(this,[e])}},as.nc=function(t){kc.L.nc.call(this,t),this.Nb()},as.Cb=function(){kc.L.Cb.call(this),this.Nb()},as.F=function(){kc.L.F.call(this),hs.clearTimeout(this.Gd),this.cc.clear(),this.cc=null},Cs(Rc,kc),Rc.prototype.xc=function(){var t=new cc,e=this.Jf;return e&&e.forEach(function(e,n){t.headers.set(n,e)}),this.Ab&&t.Je(!0),t},Rc.prototype.Sc=function(t){return!t.Ka&&!t.Ba()},vc.prototype.createWebChannel=vc.prototype.cf,bc.prototype.send=bc.prototype.send,bc.prototype.open=bc.prototype.open,bc.prototype.close=bc.prototype.close,Cu.NO_ERROR=0,Cu.TIMEOUT=8,Cu.HTTP_ERROR=6,Nu.COMPLETE="complete",Au.EventType=Ru,Ru.OPEN="a",Ru.CLOSE="b",Ru.ERROR="c",Ru.MESSAGE="d",Wa.prototype.listen=Wa.prototype.nb,Rc.prototype.getObject=Rc.prototype.Mb,Rc.prototype.releaseObject=Rc.prototype.og,cc.prototype.listenOnce=cc.prototype.Oc,cc.prototype.getLastError=cc.prototype.Hc,cc.prototype.getLastErrorCode=cc.prototype.Ud,cc.prototype.getStatus=cc.prototype.za,cc.prototype.getStatusText=cc.prototype.Yd,cc.prototype.getResponseJson=cc.prototype.yf,cc.prototype.getResponseText=cc.prototype.ya,cc.prototype.getResponseText=cc.prototype.ya,cc.prototype.send=cc.prototype.send;var Oc,Pc,Lc={createWebChannelTransport:Tc,ErrorCode:Cu,EventType:Nu,WebChannel:Au,XhrIoPool:Rc},Mc=Lc.createWebChannelTransport,xc=Lc.ErrorCode,Fc=Lc.EventType,Uc=Lc.WebChannel,qc=Lc.XhrIoPool,Bc=Qn.SDK_VERSION,Vc=new ir("@firebase/firestore");function Wc(){return Vc.logLevel===jn.DEBUG?Oc.DEBUG:Vc.logLevel===jn.SILENT?Oc.SILENT:Oc.ERROR}function jc(t){switch(t){case Oc.DEBUG:Vc.logLevel=jn.DEBUG;break;case Oc.ERROR:Vc.logLevel=jn.ERROR;break;case Oc.SILENT:Vc.logLevel=jn.SILENT;break;default:Vc.error("Firestore ("+Bc+"): Invalid value passed to `setLogLevel`")}}function Kc(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Vc.logLevel<=jn.DEBUG){var i=n.map(Hc);Vc.debug.apply(Vc,["Firestore ("+Bc+") ["+t+"]: "+e].concat(i))}}function Qc(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Vc.logLevel<=jn.ERROR){var r=e.map(Hc);Vc.error.apply(Vc,["Firestore ("+Bc+"): "+t].concat(r))}}function Hc(t){if("string"==typeof t)return t;var e=Yc.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function Gc(t){var e="FIRESTORE ("+Bc+") INTERNAL ASSERTION FAILED: "+t;throw Qc(e),new Error(e)}function zc(t,e){t||Gc(e)}(Pc=Oc||(Oc={}))[Pc.DEBUG=0]="DEBUG",Pc[Pc.ERROR=1]="ERROR",Pc[Pc.SILENT=2]="SILENT";var Yc=function(){function t(){}return t.setPlatform=function(e){t.platform&&Gc("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||Gc("Platform not set"),t.platform},t}();function Xc(){return Yc.getPlatform().emptyByteString}var Jc={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},$c=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Je(e,t),e}(Error);function Zc(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new $c(Jc.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function th(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function eh(t,e){return void 0!==t?t:e}function nh(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function rh(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ih(t){for(var e in zc(null!=t&&"object"==c(t),"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function oh(t,e,n){if(e.length!==n)throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() requires "+_h(n,"argument")+", but was called with "+_h(e.length,"argument")+".")}function sh(t,e,n){if(e.length<n)throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() requires at least "+_h(n,"argument")+", but was called with "+_h(e.length,"argument")+".")}function ah(t,e,n,r){if(e.length<n||e.length>r)throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+_h(e.length,"argument")+".")}function uh(t,e,n,r){ph(t,e,bh(n)+" argument",r)}function ch(t,e,n,r){void 0!==r&&uh(t,e,n,r)}function hh(t,e,n,r){ph(t,e,n+" option",r)}function lh(t,e,n,r){void 0!==r&&hh(t,e,n,r)}function fh(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,a=i;s<a.length;s++){var u=a[s];if(u===r)return;o.push(yh(u))}var c=yh(r);throw new $c(Jc.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function ph(t,e,n,r){if(!("object"===e?dh(r):"non-empty string"===e?"string"==typeof r&&""!==r:c(r)===e)){var i=yh(r);throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function dh(t){return"object"==c(t)&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function yh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==c(t)){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Gc("Unknown wrong type: "+c(t))}function mh(t,e,n){if(void 0===n)throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+bh(e)+" argument, but it was undefined.")}function gh(t,e,n){rh(e,function(e,r){if(n.indexOf(e)<0)throw new $c(Jc.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function vh(t,e,n,r){var i=yh(r);return new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() requires its "+bh(n)+" argument to be a "+e+", but it was: "+i)}function bh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function _h(t,e){return t+" "+e+(1===t?"":"s")}var wh=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return zc(20===e.length,"Invalid auto ID: "+e),e},t}();function Eh(t,e){return t<e?-1:t>e?1:0}function Th(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Sh(){if("undefined"==typeof Uint8Array)throw new $c(Jc.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ih(){if(!Yc.getPlatform().base64Available)throw new $c(Jc.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ch,Nh,Dh=function(){function t(t){Ih(),this._binaryString=t}return t.fromBase64String=function(e){oh("Blob.fromBase64String",arguments,1),uh("Blob.fromBase64String","string",1,e),Ih();try{return new t(Yc.getPlatform().atob(e))}catch(t){throw new $c(Jc.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(oh("Blob.fromUint8Array",arguments,1),Sh(),!(e instanceof Uint8Array))throw vh("Blob.fromUint8Array","Uint8Array",1,e);return new t(Array.prototype.map.call(e,function(t){return String.fromCharCode(t)}).join(""))},t.prototype.toBase64=function(){return oh("Blob.toBase64",arguments,0),Ih(),Yc.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){oh("Blob.toUint8Array",arguments,0),Sh();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return Eh(this._binaryString,t._binaryString)},t}(),Ah=Zc(Dh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),kh=function(){function t(t,e){if(oh("GeoPoint",arguments,2),uh("GeoPoint","number",1,t),uh("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new $c(Jc.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new $c(Jc.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return Eh(this._lat,t._lat)||Eh(this._long,t._long)},t}(),Rh=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new $c(Jc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new $c(Jc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new $c(Jc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new $c(Jc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Eh(this.nanoseconds,t.nanoseconds):Eh(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),Oh=function(t,e,n,r){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r},Ph="(default)",Lh=function(){function t(t,e){this.projectId=t,this.database=e||Ph}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===Ph},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return Eh(this.projectId,t.projectId)||Eh(this.database,t.database)},t}(),Mh=function(){function t(t,e,n){this.init(t,e,n)}return t.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&Gc("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Gc("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},t.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):"string"==typeof e?n.push(e):Gc("Unknown parameter type for Path.child(): "+e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,zc(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return zc(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return zc(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return zc(!this.isEmpty(),"Can't call lastSegment() on empty path"),this.segments[this.limit()-1]},t.prototype.get=function(t){return zc(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),xh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(t.indexOf("//")>=0)throw new $c(Jc.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return t.length>0}))},e.EMPTY_PATH=new e([]),e}(Mh),Fh=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Uh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),e.isValidIdentifier=function(t){return Fh.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new $c(Jc.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new $c(Jc.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new $c(Jc.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new $c(Jc.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(Mh),qh=function(){function t(e){this.path=e,zc(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.isEqual=function(t){return null!==t&&0===xh.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return xh.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new xh(e.slice()))},t.fromPathString=function(e){return new t(xh.fromString(e))},t.EMPTY=new t(new xh([])),t}(),Bh=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return qh.comparator(t.key,e.key)},t}(),Vh=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.data=r,o.hasLocalMutations=!!i.hasLocalMutations,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return Je(e,t),e.prototype.field=function(t){return this.data.field(t)},e.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},e.prototype.value=function(){return this.data.value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return void 0!==r&&void 0!==i?r.compareTo(i):Gc("Trying to compare documents on fields that don't exist")},e}(Bh),Wh=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Je(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Bh),jh=function(t){function e(e,n){return t.call(this,e,n)||this}return Je(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Bh),Kh=function(){function t(t,e){this.comparator=t,this.root=e||Hh.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Hh.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Hh.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Qh(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Qh(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Qh(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Qh(this.root,t,this.comparator,!0)},t}(),Qh=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){zc(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Hh=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Gc("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Gc("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Gc("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),Gh=function(){function t(){this.size=0}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Hh(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();Hh.EMPTY=new Gh,function(t){t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue"}(Ch||(Ch={})),function(t){t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous"}(Nh||(Nh={}));var zh=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(Nh.Estimate,n);case"previous":return new t(Nh.Previous,n);case"none":case void 0:return new t(Nh.Default,n);default:return Gc("fromSnapshotOptions() called with invalid options.")}},t}(),Yh=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return zc(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),Eh(this.typeOrder,t.typeOrder)},t}(),Xh=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=Ch.NullValue,e.internalValue=null,e}return Je(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(Yh),Jh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ch.BooleanValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Eh(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(Yh),$h=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ch.NumberValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue)<(r=t.internalValue)?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1:this.defaultCompareTo(t);var n,r},e}(Yh);function Zh(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var tl=function(t){function e(e){return t.call(this,e)||this}return Je(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Zh(this.internalValue,t.internalValue)},e}($h),el=function(t){function e(e){var n=t.call(this,e)||this;return n.internalValue=e,n}return Je(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Zh(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}($h),nl=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ch.StringValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Eh(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(Yh),rl=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ch.TimestampValue,n}return Je(e,t),e.prototype.value=function(t){return t&&t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof il?-1:this.defaultCompareTo(t)},e}(Yh),il=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=Ch.TimestampValue,r}return Je(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===Nh.Estimate?new rl(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Nh.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof rl?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(Yh),ol=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ch.BlobValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Yh),sl=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=Ch.RefValue,r}return Je(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:qh.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(Yh),al=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ch.GeoPointValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Yh),ul=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ch.ObjectValue,n}return Je(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),s=Eh(i.key,o.key)||i.value.compareTo(o.value);if(s)return s}return Eh(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(zc(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(zc(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return void 0!==this.field(t)},e.prototype.field=function(t){zc(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach(function(t){n=n instanceof e&&n.internalValue.get(t)||void 0}),n},e.prototype.toString=function(){return JSON.stringify(this.value())},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new Kh(Eh)),e}(Yh),cl=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ch.ArrayValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return Eh(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return JSON.stringify(this.value())},e}(Yh),hl=Number,ll=hl.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),fl=hl.MAX_SAFE_INTEGER||Math.pow(2,53)-1,pl=hl.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function dl(t){return null==t}function yl(t){return pl(t)&&t<=fl&&t>=ll}var ml,gl=function(){function t(t,e,n,r,i,o){void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),this.path=t,this.explicitOrderBy=e,this.filters=n,this.limit=r,this.startAt=i,this.endAt=o,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[Cl]:this.memoizedOrderBy=[new Il(t),Cl];else{zc(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var s=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Tl.ASCENDING;this.memoizedOrderBy.push(s===Tl.ASCENDING?Cl:Nl)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){zc(null==this.getInequalityFilterField()||!(e instanceof _l)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),zc(!qh.isDocumentKey(this.path),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.explicitOrderBy.slice(),n,this.limit,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){zc(!qh.isDocumentKey(this.path),"No ordering allowed for document query"),zc(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,n,this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.withLimit=function(e){return new t(this.path,this.explicitOrderBy.slice(),this.filters.slice(),e,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,e)},t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";dl(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),dl(this.limit)||(t+=", limit: "+this.limit),this.explicitOrderBy.length>0&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return zc(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesAncestor(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimit=function(){return!dl(this.limit)},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof _l&&n.isInequality())return n.field}return null},t.prototype.hasArrayContainsFilter=function(){return void 0!==this.filters.find(function(t){return t instanceof _l&&t.op===bl.ARRAY_CONTAINS})},t.prototype.isDocumentQuery=function(){return qh.isDocumentKey(this.path)&&0===this.filters.length},t.prototype.matchesAncestor=function(t){var e=t.key.path;return qh.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isPrefixOf(e)&&this.path.length===e.length-1},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&void 0===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){zc(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),vl=function(){function t(){}return t.create=function(t,e,n){if(n.isEqual(Xh.INSTANCE)){if(e!==bl.EQUAL)throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on null.");return new wl(t)}if(n.isEqual(el.NAN)){if(e!==bl.EQUAL)throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on NaN.");return new El(t)}return new _l(t,e,n)},t}(),bl=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;default:return Gc("Unknown relation: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t}(),_l=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return Je(e,t),e.prototype.matches=function(t){if(this.field.isKeyField()){zc(this.value instanceof sl,"Comparing on key, but filter value not a RefValue"),zc(this.op!==bl.ARRAY_CONTAINS,"array-contains queries don't make sense on document keys.");var e=this.value,n=qh.comparator(t.key,e.key);return this.matchesComparison(n)}var r=t.field(this.field);return void 0!==r&&this.matchesValue(r)},e.prototype.matchesValue=function(t){var e=this;return this.op===bl.ARRAY_CONTAINS?t instanceof cl&&void 0!==t.internalValue.find(function(t){return t.isEqual(e.value)}):this.value.typeOrder===t.typeOrder&&this.matchesComparison(t.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case bl.LESS_THAN:return t<0;case bl.LESS_THAN_OR_EQUAL:return t<=0;case bl.EQUAL:return 0===t;case bl.GREATER_THAN:return t>0;case bl.GREATER_THAN_OR_EQUAL:return t>=0;default:return Gc("Unknown relation op"+this.op)}},e.prototype.isInequality=function(){return this.op!==bl.EQUAL&&this.op!==bl.ARRAY_CONTAINS},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(vl),wl=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return Je(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return void 0!==e&&null===e.value()},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS null"},e.prototype.toString=function(){return this.field.canonicalString()+" IS null"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(vl),El=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return Je(e,t),e.prototype.matches=function(t){var e=t.field(this.field),n=e&&e.value();return"number"==typeof n&&isNaN(n)},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.toString=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(vl),Tl=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),Sl=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},t.prototype.sortsBeforeDocument=function(t,e){zc(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())zc(o instanceof sl,"Bound has a non-key value where the key path is being used."),n=qh.comparator(o.key,e.key);else{var s=e.field(i.field);zc(void 0!==s,"Field should exist since document matched the orderBy already."),n=o.compareTo(s)}if(i.dir===Tl.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];return n.isEqual(r)}return!0},t}(),Il=function(){function t(t,e){this.field=t,void 0===e&&(e=Tl.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Vh.compareByKey(t,e):Vh.compareByField(this.field,t,e);switch(this.dir){case Tl.ASCENDING:return n;case Tl.DESCENDING:return-1*n;default:return Gc("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),Cl=new Il(Uh.keyField(),Tl.ASCENDING),Nl=new Il(Uh.keyField(),Tl.DESCENDING),Dl=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new Rh(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new Rh(0,0)),t}();!function(t){t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution"}(ml||(ml={}));var Al,kl=function(){function t(t,e,n,r,i,o){void 0===i&&(i=Dl.MIN),void 0===o&&(o=Xc()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return t.prototype.copy=function(e){return new t(this.query,this.targetId,this.purpose,void 0===e.sequenceNumber?this.sequenceNumber:e.sequenceNumber,void 0===e.snapshotVersion?this.snapshotVersion:e.snapshotVersion,void 0===e.resumeToken?this.resumeToken:e.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},t}(),Rl=function(){function t(t){this.fields=t}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Th(this.fields,t.fields)},t}(),Ol=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),Pl=function(t,e){this.version=t,this.transformResults=e};!function(t){t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete"}(Al||(Al={}));var Ll=function(){function t(t,e){this.updateTime=t,this.exists=e,zc(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Vh&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Vh:(zc(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),Ml=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&zc(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof Vh?t.version:Dl.MIN},t}(),xl=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=Al.Set,i}return Je(e,t),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),zc(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Vh(this.key,n,this.value,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Ml.getPostMutationVersion(t);return new Vh(this.key,r,this.value,{hasLocalMutations:!0})},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(Ml),Fl=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=Al.Patch,o}return Je(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),zc(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new jh(this.key,e.version);var n=this.patchDocument(t);return new Vh(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Ml.getPostMutationVersion(t),i=this.patchDocument(t);return new Vh(this.key,r,i,{hasLocalMutations:!0})},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof Vh?t.data:ul.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(t){for(var e=0,n=this.fieldMask.fields;e<n.length;e++){var r=n[e];if(!r.isEmpty()){var i=this.data.field(r);t=void 0!==i?t.set(r,i):t.delete(r)}}return t},e}(Ml),Ul=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=Al.Transform,r.precondition=Ll.exists(!0),r}return Je(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),zc(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new jh(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new Vh(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,e),o=this.transformObject(r.data,i);return new Vh(this.key,r.version,o,{hasLocalMutations:!0})},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&Th(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){zc(t instanceof Vh,"Unknown MaybeDocument type "+t);var e=t;return zc(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];zc(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Vh&&(s=t.field(i.field)||null),n.push(o.applyToRemoteDocument(s,e[r]))}return n},e.prototype.localTransformResults=function(t,e){for(var n=[],r=0,i=this.fieldTransforms;r<i.length;r++){var o=i[r],s=o.transform,a=null;e instanceof Vh&&(a=e.field(o.field)||null),n.push(s.applyToLocalView(a,t))}return n},e.prototype.transformObject=function(t,e){zc(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(Ml),ql=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=Al.Delete,r}return Je(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),zc(null==e.transformResults,"Transform results received by DeleteMutation."),new Wh(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&zc(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Wh(this.key,Dl.forDeletedDoc())):t},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},e}(Ml),Bl=function(){function t(){}return t.prototype.applyToLocalView=function(t,e){return new il(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),Vl=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=jl(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new cl(e)},t.prototype.isEqual=function(e){return e instanceof t&&Th(e.elements,this.elements)},t}(),Wl=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=jl(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new cl(e)},t.prototype.isEqual=function(e){return e instanceof t&&Th(e.elements,this.elements)},t}();function jl(t){return t instanceof cl?t.internalValue.slice():[]}var Kl,Ql=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}();function Hl(t){switch(t){case Jc.OK:return Gc("Treated status OK as error");case Jc.CANCELLED:case Jc.UNKNOWN:case Jc.DEADLINE_EXCEEDED:case Jc.RESOURCE_EXHAUSTED:case Jc.INTERNAL:case Jc.UNAVAILABLE:case Jc.UNAUTHENTICATED:return!1;case Jc.INVALID_ARGUMENT:case Jc.NOT_FOUND:case Jc.ALREADY_EXISTS:case Jc.PERMISSION_DENIED:case Jc.FAILED_PRECONDITION:case Jc.ABORTED:case Jc.OUT_OF_RANGE:case Jc.UNIMPLEMENTED:case Jc.DATA_LOSS:return!0;default:return Gc("Unknown status code: "+t)}}function Gl(t){if(void 0===t)return Qc("GRPC error has no .code"),Jc.UNKNOWN;switch(t){case Kl.OK:return Jc.OK;case Kl.CANCELLED:return Jc.CANCELLED;case Kl.UNKNOWN:return Jc.UNKNOWN;case Kl.DEADLINE_EXCEEDED:return Jc.DEADLINE_EXCEEDED;case Kl.RESOURCE_EXHAUSTED:return Jc.RESOURCE_EXHAUSTED;case Kl.INTERNAL:return Jc.INTERNAL;case Kl.UNAVAILABLE:return Jc.UNAVAILABLE;case Kl.UNAUTHENTICATED:return Jc.UNAUTHENTICATED;case Kl.INVALID_ARGUMENT:return Jc.INVALID_ARGUMENT;case Kl.NOT_FOUND:return Jc.NOT_FOUND;case Kl.ALREADY_EXISTS:return Jc.ALREADY_EXISTS;case Kl.PERMISSION_DENIED:return Jc.PERMISSION_DENIED;case Kl.FAILED_PRECONDITION:return Jc.FAILED_PRECONDITION;case Kl.ABORTED:return Jc.ABORTED;case Kl.OUT_OF_RANGE:return Jc.OUT_OF_RANGE;case Kl.UNIMPLEMENTED:return Jc.UNIMPLEMENTED;case Kl.DATA_LOSS:return Jc.DATA_LOSS;default:return Gc("Unknown status code: "+t)}}!function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS"}(Kl||(Kl={}));var zl=function(){function t(t){this.comparator=t,this.data=new Kh(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach(function(t){n=n.add(t)}),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Yl=new Kh(qh.comparator);function Xl(){return Yl}var Jl=new Kh(qh.comparator);function $l(){return Jl}var Zl=new Kh(qh.comparator);function tf(){return Zl}var ef=new zl(qh.comparator);function nf(){return ef}var rf=new zl(Eh);function of(){return rf}var sf,af,uf=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||qh.comparator(e.key,n.key)}:function(t,e){return qh.comparator(t.key,e.key)},this.keyedMap=$l(),this.sortedSet=new Kh(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}();!function(t){t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata"}(sf||(sf={})),function(t){t[t.Local=0]="Local",t[t.Synced=1]="Synced"}(af||(af={}));var cf,hf=function(){function t(){this.changeMap=new Kh(qh.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==sf.Added&&n.type===sf.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===sf.Metadata&&n.type!==sf.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===sf.Modified&&n.type===sf.Modified?this.changeMap=this.changeMap.insert(e,{type:sf.Modified,doc:t.doc}):t.type===sf.Modified&&n.type===sf.Added?this.changeMap=this.changeMap.insert(e,{type:sf.Added,doc:t.doc}):t.type===sf.Removed&&n.type===sf.Added?this.changeMap=this.changeMap.remove(e):t.type===sf.Removed&&n.type===sf.Modified?this.changeMap=this.changeMap.insert(e,{type:sf.Removed,doc:n.doc}):t.type===sf.Added&&n.type===sf.Removed?this.changeMap=this.changeMap.insert(e,{type:sf.Modified,doc:t.doc}):Gc("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},t}(),lf=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:sf.Added,doc:t})}),new t(e,n,uf.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),ff=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=pf.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(Dl.MIN,i,of(),Xl(),nf())},t}(),pf=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Xc(),n,nf(),nf(),nf())},t}(),df=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},yf=function(t,e){this.targetId=t,this.existenceFilter=e};!function(t){t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset"}(cf||(cf={}));var mf=function(t,e,n,r){void 0===n&&(n=Xc()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},gf=function(){function t(){this.pendingResponses=0,this.documentChanges=_f(),this._resumeToken=Xc(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=nf(),e=nf(),n=nf();return this.documentChanges.forEach(function(r,i){switch(i){case sf.Added:t=t.add(r);break;case sf.Modified:e=e.add(r);break;case sf.Removed:n=n.add(r);break;default:Gc("Encountered invalid change type: "+i)}}),new pf(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=_f()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),vf=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Xl(),this.pendingDocumentTargetMapping=bf(),this.pendingTargetResets=new zl(Eh)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Vh?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Wh&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case cf.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case cf.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case cf.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),zc(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case cf.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case cf.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:Gc("Unknown target watch change state: "+t.state)}})},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):nh(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new qh(i.path);this.removeDocumentFromTarget(e,o,new Wh(o,Dl.forDeletedDoc()))}else zc(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};nh(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var s=new qh(o.query.path);null!==e.pendingDocumentUpdates.get(s)||e.targetContainsDocument(r,s)||e.removeDocumentFromTarget(r,s,new Wh(s,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=nf();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===ml.LimboResolution||(i=!1,!1)}),i&&(r=r.add(t))});var i=new ff(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Xl(),this.pendingDocumentTargetMapping=bf(),this.pendingTargetResets=new zl(Eh),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?sf.Modified:sf.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,sf.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new gf),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new zl(Eh),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){return null!==this.queryDataForActiveTarget(t)},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;zc(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new gf,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function bf(){return new Kh(qh.comparator)}function _f(){return new Kh(qh.comparator)}var wf,Ef,Tf=((wf={})[Tl.ASCENDING.name]="ASCENDING",wf[Tl.DESCENDING.name]="DESCENDING",wf),Sf=((Ef={})[bl.LESS_THAN.name]="LESS_THAN",Ef[bl.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Ef[bl.GREATER_THAN.name]="GREATER_THAN",Ef[bl.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Ef[bl.EQUAL.name]="EQUAL",Ef[bl.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Ef),If=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Cf(t,e){zc(!dl(t),e+" is missing")}function Nf(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Gc("can't parse "+t)}var Df=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Jc.UNKNOWN:Gl(t.code);return new $c(e,t.message||"")},t.prototype.toInt32Value=function(t){return dl(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return dl(e="object"==c(t)?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);zc(!!t,"Cannot deserialize null or undefined timestamp.");var e=Nf(t.seconds||"0"),n=t.nanos||0;return new Rh(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=If.exec(t);if(zc(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Rh(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(zc(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Dh.fromBase64String(t)):(zc(!this.options.useProto3Json,"Expected bytes to be passed in as string, but got something else instead."),Dh.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return zc(!!t,"Trying to deserialize version that isn't set"),Dl.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=xh.fromString(t);return zc(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return zc(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),zc(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new qh(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return 0===t.length?this.encodedDatabaseId:this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?xh.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new xh(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new xh(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return zc(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof Xh)return{nullValue:"NULL_VALUE"};if(t instanceof Jh)return{booleanValue:t.value()};if(t instanceof tl)return{integerValue:""+t.value()};if(t instanceof el){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof nl?{stringValue:t.value()}:t instanceof ul?{mapValue:this.toMapValue(t)}:t instanceof cl?{arrayValue:this.toArrayValue(t)}:t instanceof rl?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof al?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof ol?{bytesValue:this.toBytes(t.value())}:t instanceof sl?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Gc("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this,n=t.value_type;if(Af(t,n,"nullValue"))return Xh.INSTANCE;if(Af(t,n,"booleanValue"))return Jh.of(t.booleanValue);if(Af(t,n,"integerValue"))return new tl(Nf(t.integerValue));if(Af(t,n,"doubleValue")){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return el.NAN;if("Infinity"===t.doubleValue)return el.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return el.NEGATIVE_INFINITY}return new el(t.doubleValue)}if(Af(t,n,"stringValue"))return new nl(t.stringValue);if(Af(t,n,"mapValue"))return this.fromFields(t.mapValue.fields||{});if(Af(t,n,"arrayValue")){Cf(t.arrayValue,"arrayValue");var r=t.arrayValue.values||[];return new cl(r.map(function(t){return e.fromValue(t)}))}if(Af(t,n,"timestampValue"))return Cf(t.timestampValue,"timestampValue"),new rl(this.fromTimestamp(t.timestampValue));if(Af(t,n,"geoPointValue")){Cf(t.geoPointValue,"geoPointValue");var i=t.geoPointValue.latitude||0,o=t.geoPointValue.longitude||0;return new al(new kh(i,o))}if(Af(t,n,"bytesValue")){Cf(t.bytesValue,"bytesValue");var s=this.fromBlob(t.bytesValue);return new ol(s)}if(Af(t,n,"referenceValue")){Cf(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),u=new Lh(a.get(1),a.get(3)),c=new qh(this.extractLocalPathFromResourceName(a));return new sl(u,c)}return Gc("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return zc(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new Vh(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},t.prototype.fromFields=function(t){var e=this,n=t,r=ul.EMPTY;return rh(n,function(t,n){r=r.set(new Uh([t]),e.fromValue(n))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){zc(!!t.found,"Tried to deserialize a found document from a missing document."),Cf(t.found.name,"doc.found.name"),Cf(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new Vh(e,n,r,{})},t.prototype.fromMissing=function(t){zc(!!t.missing,"Tried to deserialize a missing document from a found document."),zc(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Wh(e,n)},t.prototype.fromMaybeDocument=function(t){var e=t.result;return Af(t,e,"found")?this.fromFound(t):Af(t,e,"missing")?this.fromMissing(t):Gc("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case cf.Added:return"ADD";case cf.Current:return"CURRENT";case cf.NoChange:return"NO_CHANGE";case cf.Removed:return"REMOVE";case cf.Reset:return"RESET";default:return Gc("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof yf)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof df){if(t.newDoc instanceof Vh){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Wh)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof mf){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Kl.OK;switch(t){case Jc.OK:return Kl.OK;case Jc.CANCELLED:return Kl.CANCELLED;case Jc.UNKNOWN:return Kl.UNKNOWN;case Jc.DEADLINE_EXCEEDED:return Kl.DEADLINE_EXCEEDED;case Jc.RESOURCE_EXHAUSTED:return Kl.RESOURCE_EXHAUSTED;case Jc.INTERNAL:return Kl.INTERNAL;case Jc.UNAVAILABLE:return Kl.UNAVAILABLE;case Jc.UNAUTHENTICATED:return Kl.UNAUTHENTICATED;case Jc.INVALID_ARGUMENT:return Kl.INVALID_ARGUMENT;case Jc.NOT_FOUND:return Kl.NOT_FOUND;case Jc.ALREADY_EXISTS:return Kl.ALREADY_EXISTS;case Jc.PERMISSION_DENIED:return Kl.PERMISSION_DENIED;case Jc.FAILED_PRECONDITION:return Kl.FAILED_PRECONDITION;case Jc.ABORTED:return Kl.ABORTED;case Jc.OUT_OF_RANGE:return Kl.OUT_OF_RANGE;case Jc.UNIMPLEMENTED:return Kl.UNIMPLEMENTED;case Jc.DATA_LOSS:return Kl.DATA_LOSS;default:return Gc("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Gc("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=t.response_type;if(Af(t,n,"targetChange")){Cf(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),s=t.targetChange.cause,a=s&&this.fromRpcStatus(s);e=new mf(r,i,o,a||null)}else if(Af(t,n,"documentChange")){Cf(t.documentChange,"documentChange"),Cf(t.documentChange.document,"documentChange.name"),Cf(t.documentChange.document.name,"documentChange.document.name"),Cf(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=this.fromFields(u.document.fields||{}),f=new Vh(c,h,l,{}),p=u.targetIds||[],d=u.removedTargetIds||[];e=new df(p,d,f.key,f)}else if(Af(t,n,"documentDelete")){Cf(t.documentDelete,"documentDelete"),Cf(t.documentDelete.document,"documentDelete.document");var y=t.documentDelete;c=this.fromName(y.document),h=y.readTime?this.fromVersion(y.readTime):Dl.forDeletedDoc(),f=new Wh(c,h),d=y.removedTargetIds||[],e=new df([],d,f.key,f)}else if(Af(t,n,"documentRemove")){Cf(t.documentRemove,"documentRemove"),Cf(t.documentRemove.document,"documentRemove");var m=t.documentRemove;c=this.fromName(m.document),d=m.removedTargetIds||[],e=new df([],d,c,null)}else{if(!Af(t,n,"filter"))return Gc("Unknown change type "+JSON.stringify(t));Cf(t.filter,"filter"),Cf(t.filter.targetId,"filter.targetId");var g=t.filter,v=g.count||0,b=new Ql(v),_=g.targetId;e=new yf(_,b)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?cf.NoChange:"ADD"===t?cf.Added:"REMOVE"===t?cf.Removed:"CURRENT"===t?cf.Current:"RESET"===t?cf.Reset:Gc("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!Af(t,t.response_type,"targetChange"))return Dl.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Dl.MIN:e.readTime?this.fromVersion(e.readTime):Dl.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof xl)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof ql)e={delete:this.toName(t.key)};else if(t instanceof Fl)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Ul))return Gc("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Ll.NONE;if(t.update){Cf(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Fl(r,i,o,n)}return new xl(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new ql(r,n);if(t.transform){r=this.fromName(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return zc(!0===n.exists,'Transforms only support precondition "exists == true"'),new Ul(r,s)}return Gc("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return zc(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Gc("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Ll.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Ll.exists(t.exists):Ll.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new Pl(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(zc(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof Bl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Vl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Wl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};throw Gc("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=t.transform_type,r=null;if(Af(t,n,"setToServerValue"))zc("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),r=Bl.instance;else if(Af(t,n,"appendMissingElements")){var i=t.appendMissingElements.values||[];r=new Vl(i.map(function(t){return e.fromValue(t)}))}else Af(t,n,"removeAllFromArray")?(i=t.removeAllFromArray.values||[],r=new Wl(i.map(function(t){return e.fromValue(t)}))):Gc("Unknown transform proto: "+JSON.stringify(t));var o=Uh.fromServerFormat(t.fieldPath);return new Ol(o,r)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;zc(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return gl.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}};if(t.path.isEmpty())e.parent=this.toQueryPath(xh.EMPTY_PATH);else{var n=t.path;zc(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]}var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0;if(r>0){zc(1===r,"StructuredQuery.from with more than one collection is not supported.");var i=n.from[0];e=e.child(i.collectionId)}var o=[];n.where&&(o=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var a=null;n.limit&&(a=this.fromInt32Value(n.limit));var u=null;n.startAt&&(u=this.fromCursor(n.startAt));var c=null;return n.endAt&&(c=this.fromCursor(n.endAt)),new gl(e,s,o,a,u,c)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case ml.Listen:return null;case ml.ExistenceFilterMismatch:return"existence-filter-mismatch";case ml.LimboResolution:return"limbo-document";default:return Gc("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof _l?e.toRelationFilter(t):e.toUnaryFilter(t)});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromRelationFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Gc("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new Sl(r,n)},t.prototype.toDirection=function(t){return Tf[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return Tl.ASCENDING;case"DESCENDING":return Tl.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return Sf[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return bl.EQUAL;case"GREATER_THAN":return bl.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return bl.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return bl.LESS_THAN;case"LESS_THAN_OR_EQUAL":return bl.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return bl.ARRAY_CONTAINS;case"OPERATOR_UNSPECIFIED":return Gc("Unspecified relation");default:return Gc("Unknown relation")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return Uh.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new Il(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.toRelationFilter=function(t){return t instanceof _l?{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}:Gc("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromRelationFilter=function(t){return new _l(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryFilter=function(t){return t instanceof El?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}}:t instanceof wl?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}:Gc("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return new El(e);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return new wl(n);case"OPERATOR_UNSPECIFIED":return Gc("Unspecified filter");default:return Gc("Unknown filter")}},t.prototype.toDocumentMask=function(t){return{fieldPaths:t.fields.map(function(t){return t.canonicalString()})}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Uh.fromServerFormat(t)});return new Rl(e)},t}();function Af(t,e,n){return e===n||!e&&n in t}var kf="FirebaseError",Rf=Error.captureStackTrace,Of=function(t,e){if(this.code=t,this.message=e,Rf)Rf(this,Pf.prototype.create);else try{throw Error.apply(this,arguments)}catch(t){this.name=kf,Object.defineProperty(this,"stack",{get:function(){return t.stack}})}};Of.prototype=Object.create(Error.prototype),Of.prototype.constructor=Of,Of.prototype.name=kf;var Pf=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return t.prototype.create=function(t,e){void 0===e&&(e={});var n,r=this.errors[t],i=this.service+"/"+t;n=void 0===r?"Error":r.replace(this.pattern,function(t,n){var r=e[n];return void 0!==r?r.toString():"<"+n+"?>"}),n=this.serviceName+": "+n+" ("+i+").";var o=new Of(i,n);for(var s in e)e.hasOwnProperty(s)&&"_"!==s.slice(-1)&&(o[s]=e[s]);return o},t}(),Lf=(function(t){function e(){var e=t.call(this)||this;e.chain_=[],e.buf_=[],e.W_=[],e.pad_=[],e.inbuf_=0,e.total_=0,e.blockSize=64,e.pad_[0]=128;for(var n=1;n<e.blockSize;++n)e.pad_[n]=0;return e.reset(),e}Je(e,t),e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)r<40?r<20?(o=h^u&(c^h),s=1518500249):(o=u^c^h,s=1859775393):r<60?(o=u&c|h&(u|c),s=2400959708):(o=u^c^h,s=3395469782),i=(a<<5|a>>>27)+o+l+s+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},e.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0==o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},e.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t}}(function(){this.blockSize=-1}),function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){zc(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){zc(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){zc(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){zc(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){zc(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){zc(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}()),Mf="Connection",xf={BatchGetDocuments:"batchGet",Commit:"commit"},Ff="gl-js/ fire/"+Bc,Uf=function(){function t(t){this.databaseId=t.databaseId,this.pool=new qc;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=Ff},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,s){r.pool.getObject(function(a){a.listenOnce(Fc.COMPLETE,function(){try{switch(a.getLastErrorCode()){case xc.NO_ERROR:var e=a.getResponseJson();Kc(Mf,"XHR received:",JSON.stringify(e)),o(e);break;case xc.TIMEOUT:Kc(Mf,'RPC "'+t+'" timed out'),s(new $c(Jc.DEADLINE_EXCEEDED,"Request time out"));break;case xc.HTTP_ERROR:var n=a.getStatus();Kc(Mf,'RPC "'+t+'" failed with status:',n,"response text:",a.getResponseText()),n>0?s(new $c(function(t){switch(t){case 200:return Jc.OK;case 400:return Jc.INVALID_ARGUMENT;case 401:return Jc.UNAUTHENTICATED;case 403:return Jc.PERMISSION_DENIED;case 404:return Jc.NOT_FOUND;case 409:return Jc.ABORTED;case 416:return Jc.OUT_OF_RANGE;case 429:return Jc.RESOURCE_EXHAUSTED;case 499:return Jc.CANCELLED;case 500:return Jc.UNKNOWN;case 501:return Jc.UNIMPLEMENTED;case 503:return Jc.UNAVAILABLE;case 504:return Jc.DEADLINE_EXCEEDED;default:return t>=200&&t<300?Jc.OK:t>=400&&t<500?Jc.FAILED_PRECONDITION:t>=500&&t<600?Jc.INTERNAL:Jc.UNKNOWN}}(n),"Server responded with status "+a.getStatusText())):(Kc(Mf,'RPC "'+t+'" failed'),s(new $c(Jc.UNAVAILABLE,"Connection failed.")));break;default:Gc('RPC "'+t+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Kc(Mf,'RPC "'+t+'" completed.'),r.pool.releaseObject(a)}});var u=JSON.stringify(e);Kc(Mf,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),a.send(i,"POST",u,c,15)})})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1beta1.Firestore","/",t,"/channel"],r=Mc(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0};this.modifyHeadersForRequest(i.initMessageHeaders,e),"object"==("undefined"==typeof navigator?"undefined":c(navigator))&&"ReactNative"===navigator.product||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");Kc(Mf,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),a=!1,u=!1,h=new Lf({sendFn:function(t){u?Kc(Mf,"Not sending because WebChannel is closed:",t):(a||(Kc(Mf,"Opening WebChannel transport."),s.open(),a=!0),Kc(Mf,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}}),l=function(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(Uc.EventType.OPEN,function(){u||Kc(Mf,"WebChannel transport opened.")}),l(Uc.EventType.CLOSE,function(){u||(u=!0,Kc(Mf,"WebChannel transport closed"),h.callOnClose())}),l(Uc.EventType.ERROR,function(t){u||(u=!0,Kc(Mf,"WebChannel transport errored:",t),h.callOnClose(new $c(Jc.UNAVAILABLE,"The operation could not be completed")))}),l(Uc.EventType.MESSAGE,function(t){if(!u){var e=t.data[0];zc(!!e,"Got a webchannel message without data.");var n=e.error||e[0]&&e[0].error;if(n){Kc(Mf,"WebChannel received error:",n);var r=n.status,i=function(t){var e=Kl[r];if(void 0!==e)return Gl(e)}(),o=n.message;void 0===i&&(i=Jc.INTERNAL,o="Unknown error status: "+r+" with message "+n.message),u=!0,h.callOnClose(new $c(i,o)),s.close()}else Kc(Mf,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},t.prototype.makeUrl=function(t){var e=xf[t];zc(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1beta1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),qf=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new Uf(t))},t.prototype.newSerializer=function(t){return new Df(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();Yc.setPlatform(new qf);var Bf,Vf=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),Wf=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})};!function(t){t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh"}(Bf||(Bf={}));var jf=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Wf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new $c(Jc.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),Kf=function(){function t(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueue=function(t){var e=this;this.verifyNotFailed();var n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw Qc("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),zc(e>=0,"Attempted to schedule an operation with a negative delay of "+e),zc(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=jf.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&Gc("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){zc(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){zc(t===Bf.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==Bf.All&&i.timerId===t)break}return e.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);zc(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),Qf="",Hf="",Gf="",zf="";function Yf(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Jf(e)),e=Xf(t.get(n),e);return Jf(e)}function Xf(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Qf+Gf;break;case Qf:n+=Qf+zf;break;default:n+=o}}return n}function Jf(t){return t+Qf+Hf}function $f(t){var e=t.length;if(zc(e>=2,"Invalid path "+t),2===e)return zc(t.charAt(0)===Qf&&t.charAt(1)===Hf,"Non-empty path "+t+" had length 2"),xh.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf(Qf,o);switch((s<0||s>n)&&Gc('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case Hf:var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case Gf:i+=t.substring(o,s),i+="\0";break;case zf:i+=t.substring(o,s+1);break;default:Gc('Invalid encoded resource path: "'+t+'"')}o=s+2}return new xh(r)}var Zf,tp=-1,ep=function(){function t(t,e,n){this.batchId=t,this.localWriteTime=e,this.mutations=n,zc(n.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&zc(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;zc(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.applyToRemoteDocument(e,s)}}return e},t.prototype.applyToLocalView=function(t,e){e&&zc(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=e,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t)&&(e=i.applyToLocalView(e,n,this.localWriteTime))}return e},t.prototype.keys=function(){for(var t=nf(),e=0,n=this.mutations;e<n.length;e++){var r=n[e];t=t.add(r.key)}return t},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Th(this.mutations,t.mutations)},t}(),np=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){zc(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=tf(),s=e.mutations,a=0;a<s.length;a++)o=o.insert(s[a].key,r[a].version);return new t(e,n,r,i,o)},t}(),rp=1;!function(t){t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine"}(Zf||(Zf={}));var ip=function(){function t(t,e){this.generatorId=t,zc((t&rp)===t,"Generator ID "+t+" contains more than "+rp+" reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=1<<rp,t},t.prototype.after=function(t){return this.seek(t+(1<<rp)),this.next()},t.prototype.seek=function(t){zc((t&rp)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(Zf.QueryCache,2)},t.forSyncEngine=function(){return new t(Zf.SyncEngine)},t}(),op=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Gc("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),sp=function(){function t(t){this.db=t}return t.openOrCreate=function(e,n,r){return zc(t.isAvailable(),"IndexedDB not supported in current environment."),Kc("SimpleDb","Opening database:",e),new op(function(i,o){var s=window.indexedDB.open(e,n);s.onsuccess=function(e){var n=e.target.result;i(new t(n))},s.onblocked=function(){o(new $c(Jc.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=function(t){o(t.target.error)},s.onupgradeneeded=function(t){Kc("SimpleDb",'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result,i=new up(s.transaction);r.createOrUpgrade(n,i,t.oldVersion,Cp).next(function(){Kc("SimpleDb","Database upgrade to version "+Cp+" complete")})}}).toPromise()},t.delete=function(t){return Kc("SimpleDb","Removing database:",t),hp(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===o.env.USE_MOCK_PERSISTENCE;var t=window.navigator.userAgent;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0)},t.getStore=function(t,e){return t.store(e)},t.prototype.runTransaction=function(t,e,n){var r=up.open(this.db,t,e),i=n(r).catch(function(t){r.abort(t)}).toPromise();return r.completionPromise.then(function(){return i})},t.prototype.close=function(){this.db.close()},t}(),ap=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return hp(this.dbCursor.delete())},t}(),up=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Wf,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){e.completionDeferred.reject(t.target.error)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Kc("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return zc(!!e,"Object store not part of transaction: "+t),new cp(e)},t}(),cp=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Kc("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Kc("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),hp(n)},t.prototype.add=function(t){return Kc("SimpleDb","ADD",this.store.name,t,t),hp(this.store.add(t))},t.prototype.get=function(t){var e=this;return hp(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Kc("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Kc("SimpleDb","DELETE",this.store.name,t),hp(this.store.delete(t))},t.prototype.count=function(){return Kc("SimpleDb","COUNT",this.store.name),hp(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){Kc("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new op(function(n,r){e.onerror=function(t){r(t.target.error)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,e){var n=[];return new op(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new ap(i),s=e(i.primaryKey,i.value,o);if(s instanceof op){var a=s.catch(function(t){return o.done(),op.reject(t)});n.push(a)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return op.waitFor(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(zc(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function hp(t){return new op(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){n(t.target.error)}})}var lp=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=ip.forQueryCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Dl.fromTimestamp(new Rh(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return dp(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},t.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return fp(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return zc(e.targetCount>0,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return fp(t).iterate(function(s,a){var u=r.serializer.fromDbTarget(a);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return op.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){var n=this;return fp(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},t.prototype.retrieveMetadata=function(t){return pp(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,sd.getStore(n,qp.store)).put(qp.key,e);var n},t.prototype.saveQueryData=function(t,e){return fp(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return fp(t).iterate({range:i,index:Fp.queryTargetsIndexName},function(t,r,i){var s=n.serializer.fromDbTarget(r);e.isEqual(s.query)&&(o=s,i.done())}).next(function(){return o})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=yp(t);return e.forEach(function(e){var s=Yf(e.path);i.push(o.put(new Up(n,s))),i.push(r.referenceDelegate.addReference(t,e))}),op.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=yp(t);return op.forEach(e,function(e){var o=Yf(e.path);return op.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=yp(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=yp(t),i=nf();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=$f(t[1]),o=new qh(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n,r=Yf(e.path),i=IDBKeyRange.bound([r],[(n=r,n+"\0")],!1,!0),o=0;return yp(t).iterate({index:Up.documentTargetsIndex,keysOnly:!0,range:i},function(t,e,n){var r=t[0];t[1],0!==r&&(o++,n.done())}).next(function(){return o>0})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return fp(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function fp(t){return sd.getStore(t,Fp.store)}function pp(t){return sp.getStore(t,qp.store).get(qp.key).next(function(t){return zc(null!==t,"Missing metadata row."),t})}function dp(t){return pp(t).next(function(t){return t.highestListenSequenceNumber})}function yp(t){return sd.getStore(t,Up.store)}var mp=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(s.isEqual(t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){rh(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}})},t.prototype.isEmpty=function(){return ih(this.inner)},t}(),gp=function(){function t(){this.changes=Xl(),this.documentSizes=new mp(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?op.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return zc(null!==this.changes,"Changes have already been applied."),this.changes},t}(),vp="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",bp=function(){function t(t,e){this.serializer=t,this.keepDocumentChangeLog=e,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=sp.getStore(t,Vp.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r=[];if(e.length>0){for(var i=Ep(t),o=nf(),s=0,a=e;s<a.length;s++){var u=a[s],c=u.key,h=u.doc;r.push(i.put(Sp(c),h)),o=o.add(c)}this.keepDocumentChangeLog&&r.push(Tp(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return op.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=Ep(t),r=Sp(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return Ip(t)}):op.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return Ep(t).get(Sp(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return Ep(t).get(Sp(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Ip(t)}:null})},t.prototype.getDocumentsMatchingQuery=function(t,e){var n=this,r=$l(),i=e.path.toArray(),o=IDBKeyRange.lowerBound(i);return Ep(t).iterate({range:o},function(t,i,o){var s=n.serializer.fromDbRemoteDocument(i);e.path.isPrefixOf(s.key.path)?s instanceof Vh&&e.matches(s)&&(r=r.insert(s.key,s)):o.done()}).next(function(){return r})},t.prototype.getNewDocumentChanges=function(t){var e=this;zc(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=nf(),r=Xl(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,s=Tp(t);return s.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(s).next(function(){return op.reject(new $c(Jc.DATA_LOSS,vp))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new Wh(n,Dl.forDeletedDoc());r=r.insert(n,e)}))}),op.waitFor(i)}).next(function(){return r})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Tp(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},t.prototype.newChangeBuffer=function(){return new wp(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return _p(t).get(xp.key).next(function(t){return zc(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return _p(t).put(xp.key,e)},t.prototype.updateSize=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.setMetadata(t,r)})},t}();function _p(t){return sd.getStore(t,xp.store)}var wp=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return Je(e,t),e.prototype.applyChanges=function(t){var e=this,n=0,r=[];return this.assertChanges().forEach(function(t,i){var o=e.documentCache.serializer.toDbRemoteDocument(i),s=e.documentSizes.get(t);zc(void 0!==s,"Attempting to change document "+t.toString()+" without having read it first");var a=Ip(o);n+=a-s,r.push({key:t,doc:o})}),this.documentCache.addEntries(t,r,n)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e}(gp);function Ep(t){return sd.getStore(t,Mp.store)}function Tp(t){return sd.getStore(t,Vp.store)}function Sp(t){return t.path.toArray()}function Ip(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Gc("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Cp=7,Np=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;zc(n<r&&n>=0&&r<=Cp,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&r>=1&&(function(t){t.createObjectStore(Ap.store)}(t),function(t){t.createObjectStore(kp.store,{keyPath:kp.keyPath}),t.createObjectStore(Rp.store,{keyPath:Rp.keyPath,autoIncrement:!0}).createIndex(Rp.userMutationsIndex,Rp.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Op.store)}(t),Bp(t),function(t){t.createObjectStore(Mp.store)}(t));var o=op.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Up.store),t.deleteObjectStore(Fp.store),t.deleteObjectStore(qp.store)}(t),Bp(t)),o=o.next(function(){return function(t){var e=t.store(qp.store),n=new qp(0,0,Dl.MIN.toTimestamp(),0);return e.put(qp.key,n)}(e)})),n<4&&r>=4&&(0!==n&&(o=o.next(function(){return function(t,e){return e.store(Rp.store).loadAll().next(function(n){t.deleteObjectStore(Rp.store),t.createObjectStore(Rp.store,{keyPath:Rp.keyPath,autoIncrement:!0}).createIndex(Rp.userMutationsIndex,Rp.userMutationsKeyPath,{unique:!0});var r=e.store(Rp.store),i=n.map(function(t){return r.put(t)});return op.waitFor(i)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(Wp.store,{keyPath:Wp.keyPath})}(t),function(t){t.createObjectStore(Vp.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&r>=5&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&r>=6&&(o=o.next(function(){return function(t){t.createObjectStore(xp.store)}(t),i.addDocumentGlobal(e)})),n<7&&r>=7&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),o},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Mp.store).iterate(function(t,n){e+=Ip(n)}).next(function(){var n=new xp(e);return t.store(xp.store).put(xp.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(kp.store),r=t.store(Rp.store);return n.loadAll().next(function(n){return op.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,tp],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(Rp.userMutationsIndex,i).next(function(r){return op.forEach(r,function(r){zc(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return Hp(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Up.store),n=t.store(Mp.store);return dp(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new xh(n),s=[0,Yf(o)];r.push(e.get(s).next(function(n){return n?op.resolve():function(n){return e.put(new Up(0,Yf(n),t))}(o)}))}).next(function(){return op.waitFor(r)})})},t}(),Dp=function(t,e){this.seconds=t,this.nanoseconds=e},Ap=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}(),kp=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),Rp=function(){function t(t,e,n,r){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.mutations=r}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}(),Op=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Yf(e)]},t.key=function(t,e,n){return[t,Yf(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}(),Pp=function(t,e){this.path=t,this.readTime=e},Lp=function(t,e){this.path=t,this.version=e},Mp=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),xp=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}(),Fp=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),Up=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,zc(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),qp=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}();function Bp(t){t.createObjectStore(Up.store,{keyPath:Up.keyPath}).createIndex(Up.documentTargetsIndex,Up.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Fp.store,{keyPath:Fp.keyPath}).createIndex(Fp.queryTargetsIndexName,Fp.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(qp.store)}var Vp=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}(),Wp=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}(),jp=[kp.store,Rp.store,Op.store,Mp.store,Fp.store,Ap.store,qp.store,Up.store].concat([Wp.store,Vp.store]).concat([xp.store]),Kp=function(){function t(t,e,n){this.userId=t,this.serializer=e,this.referenceDelegate=n,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r){return zc(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zp(t).iterate({index:Rp.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(r){var i=e.batchId;return zc(i>r.lastAcknowledgedBatchId,"Mutation batchIDs must be acknowledged in order"),r.lastAcknowledgedBatchId=i,r.lastStreamToken=Gp(n),Xp(t).put(r)})},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=Gp(e),Xp(t).put(n)})},t.prototype.addMutationBatch=function(t,e,n){var r=this,i=Yp(t),o=zp(t);return o.add({}).next(function(t){zc("number"==typeof t,"Auto-generated key is not a number");var s=new ep(t,e,n),a=r.serializer.toDbMutationBatch(r.userId,s);r.documentKeysByBatchId[t]=s.keys();for(var u=[],c=0,h=n;c<h.length;c++){var l=h[c],f=Op.key(r.userId,l.key.path,t);u.push(o.put(a)),u.push(i.put(f,Op.PLACEHOLDER))}return op.waitFor(u).next(function(){return s})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return zp(t).get(e).next(function(t){return t?(zc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?op.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this;return this.getMutationQueueMetadata(t).next(function(r){var i=Math.max(e,r.lastAcknowledgedBatchId)+1,o=IDBKeyRange.lowerBound([n.userId,i]),s=null;return zp(t).iterate({index:Rp.userMutationsIndex,range:o},function(t,e,r){e.userId===n.userId&&(zc(e.batchId>=i,"Should have found mutation after "+i),s=n.serializer.fromDbMutationBatch(e)),r.done()}).next(function(){return s})})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,tp],[this.userId,Number.POSITIVE_INFINITY]);return zp(t).loadAll(Rp.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Op.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Yp(t).iterate({range:i},function(r,i,s){var a=r[0],u=r[1],c=r[2],h=$f(u);if(a===n.userId&&e.path.isEqual(h))return zp(t).get(c).next(function(t){if(!t)throw Gc("Dangling document-mutation reference found: "+r+" which points to "+c);zc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new zl(Eh),i=[];return e.forEach(function(e){var o=Op.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Yp(t).iterate({range:s},function(t,i,o){var s=t[0],a=t[1],u=t[2],c=$f(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(a)}),op.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;zc(!e.isDocumentQuery(),"Document queries shouldn't go down this path");var r=e.path,i=r.length+1,o=Op.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new zl(Eh);return Yp(t).iterate({range:s},function(t,e,o){var s=t[0],u=t[1],c=t[2],h=$f(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,a)})},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(zp(t).get(e).next(function(t){if(null===t)throw Gc("Dangling document-mutation reference found, which points to "+e);zc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),op.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Hp(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),op.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return op.resolve();var r=IDBKeyRange.lowerBound(Op.prefixForUser(e.userId)),i=[];return Yp(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=$f(t[1]);i.push(o)}else r.done()}).next(function(){zc(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},t.prototype.containsKey=function(t,e){return Qp(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return Xp(t).get(this.userId).next(function(t){return t||new kp(e.userId,tp,"")})},t}();function Qp(t,e,n){var r=Op.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Yp(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()}).next(function(){return s})}function Hp(t,e,n){var r=t.store(Rp.store),i=t.store(Op.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.iterate({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){zc(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Op.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return op.waitFor(o).next(function(){return c})}function Gp(t){return t instanceof Uint8Array?(zc("YES"===o.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function zp(t){return sd.getStore(t,Rp.store)}function Yp(t){return sd.getStore(t,Op.store)}function Xp(t){return sd.getStore(t,kp.store)}var Jp=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=qh.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Wh(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=qh.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new jh(e,n)):Gc("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof Vh){var e=this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Mp(null,null,e,n)}if(t instanceof Wh){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return n=t.hasCommittedMutations,new Mp(null,new Pp(r,i),null,n)}return t instanceof jh?(r=t.key.path.toArray(),i=this.toDbTimestamp(t.version),new Mp(new Lp(r,i),null,null,!0)):Gc("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Dp(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new Rh(t.seconds,t.nanoseconds);return Dl.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Rp(t,e.batchId,e.localWriteTime.toMillis(),r)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),r=Rh.fromMillis(t.localWriteTimeMs);return new ep(t.batchId,r,n)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Yf(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=nf(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new qh($f(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new kl(e,t.targetId,ml.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){zc(ml.Listen===t.purpose,"Only queries with purpose "+ml.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),t.resumeToken instanceof Uint8Array?(zc("YES"===o.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new Fp(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function $p(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Eh(n,i);return 0===s?Eh(r,o):s}var Zp=function(){function t(t){this.maxElements=t,this.buffer=new zl($p),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();$p(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),td=function(){function t(t){this.delegate=t}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return op.resolve(Vf.INVALID);var r=new Zp(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t}(),ed="IndexedDbPersistence",nd="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",rd="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `experimentalTabSynchronization:true` in all tabs.",id="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",od=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return Je(e,t),e}(function(){}),sd=function(){function t(e,n,r,i,o,s){if(this.persistenceKey=e,this.clientId=n,this.queue=i,this.multiClientParams=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!t.isAvailable())throw new $c(Jc.UNIMPLEMENTED,id);if(this.referenceDelegate=new hd(this),this.dbName=e+t.MAIN_DATABASE,this.serializer=new Jp(o),this.document=r.document,this.allowTabSynchronization=void 0!==s,this.queryCache=new lp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new bp(this.serializer,this.allowTabSynchronization),!r.window||!r.window.localStorage)throw new $c(Jc.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof od)return sp.getStore(t.simpleDbTransaction,e);throw Gc("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e,n,r,i,o){return Ze(this,void 0,void 0,function(){var s;return tn(this,function(a){switch(a.label){case 0:return[4,(s=new t(e,n,r,i,o)).start()];case 1:return a.sent(),[2,s]}})})},t.createMultiClientIndexedDbPersistence=function(e,n,r,i,o,s){return Ze(this,void 0,void 0,function(){var a;return tn(this,function(u){switch(u.label){case 0:return[4,(a=new t(e,n,r,i,o,s)).start()];case 1:return u.sent(),[2,a]}})})},t.prototype.start=function(){var t=this;return zc(!this.started,"IndexedDbPersistence double-started!"),zc(null!==this.window,"Expected 'window' to be defined"),sp.openOrCreate(this.dbName,Cp,new Np(this.serializer)).then(function(e){t.simpleDb=e}).then(function(){return t.startRemoteDocumentCache()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})}).then(function(){return t.simpleDb.runTransaction("readonly",[qp.store],function(e){return dp(e).next(function(e){var n=t.multiClientParams?t.multiClientParams.sequenceNumberSyncer:void 0;t.listenSequence=new Vf(e,n)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},t.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",jp,function(e){return t.remoteDocumentCache.start(e)})},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return Ze(e,void 0,void 0,function(){return tn(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return Ze(e,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",jp,function(e){return cd(e).put(new Wp(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},t.prototype.verifyPrimaryLease=function(t){var e=this;return ud(t).get(Ap.key).next(function(t){return op.resolve(e.isLocalClient(t))})},t.prototype.removeClientMetadata=function(t){return cd(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return Ze(this,void 0,void 0,function(){var e,n,r=this;return tn(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),n=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(i){var o=t.getStore(i,Wp.store);return o.loadAll().next(function(t){e=r.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)})}).next(function(){return op.forEach(n,function(t){return o.delete(t.clientId)})}).next(function(){if((e=e.filter(function(t){return t.clientId!==r.clientId})).length>0){var t=e.map(function(t){return t.lastProcessedDocumentChangeId||0}),n=Math.min.apply(Math,t);return r.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,n)}})})]);case 1:i.sent(),n.forEach(function(t){r.window.localStorage.removeItem(r.zombiedClientLocalStorageKey(t.clientId))}),i.label=2;case 2:return[2]}})})},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Bf.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return ud(t).get(Ap.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new $c(Jc.FAILED_PRECONDITION,rd);return!1}}return!(!e.networkEnabled||!e.inForeground)||cd(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&Kc(ed,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(t){return Ze(this,void 0,void 0,function(){var e=this;return tn(this,function(n){switch(n.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[Ap.store,Wp.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return n.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),t?[4,sp.delete(this.dbName)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[Wp.store],function(e){return cd(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return zc(this.started,"Cannot initialize MutationQueue before persistence is started."),Kp.forUser(t,this.serializer,this.referenceDelegate)},t.prototype.getQueryCache=function(){return zc(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},t.prototype.getRemoteDocumentCache=function(){return zc(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;return Kc(ed,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",jp,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw Qc("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new $c(Jc.FAILED_PRECONDITION,nd);return n(new od(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new od(i,r.listenSequence.next()))})})},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return ud(t).get(Ap.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new $c(Jc.FAILED_PRECONDITION,rd)})},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Ap(this.clientId,this.allowTabSynchronization,Date.now());return ud(t).put(Ap.key,e)},t.isAvailable=function(){return sp.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=ud(t);return n.get(Ap.key).next(function(t){return e.isLocalClient(t)?(Kc(ed,"Releasing primary lease."),n.delete(Ap.key)):op.resolve()})},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Qc("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(zc(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(zc("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Kc(ed,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Qc(ed,"Failed to get zombied client id.",t),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Qc("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function ad(t){return t.code===Jc.FAILED_PRECONDITION&&t.message===nd}function ud(t){return t.store(Ap.store)}function cd(t){return t.store(Wp.store)}var hd=function(){function t(t){this.db=t,this.garbageCollector=new td(this)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return ld(t,e)},t.prototype.removeReference=function(t,e){return ld(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return ld(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?op.resolve(!0):function(t,e){var n=!1;return Xp(t).iterateSerial(function(r){return Qp(t,r,e).next(function(t){return t&&(n=!0),op.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=0,o=[];return this.forEachOrphanedDocument(t,function(s,a){if(a<=e){var u=n.isPinned(t,s).next(function(e){if(!e)return r++,n.removeOrphanedDocument(t,s).next(function(t){i+=t})});o.push(u)}}).next(function(){return op.waitFor(o)}).next(function(){return n.db.getRemoteDocumentCache().updateSize(t,-i)}).next(function(){return r})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return op.waitFor([yp(t).delete((n=e,[0,Yf(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return ld(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=yp(t),i=Vf.INVALID;return r.iterate({index:Up.documentTargetsIndex},function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==Vf.INVALID&&e(new qh($f(n)),i),i=a,n=s):i=Vf.INVALID}).next(function(){i!==Vf.INVALID&&e(new qh($f(n)),i)})},t}();function ld(t,e){return yp(t).put(function(t,e){return new Up(0,Yf(t.path),e)}(e,t.currentSequenceNumber))}var fd,pd=function(){function t(t,e){this.remoteDocumentCache=t,this.mutationQueue=e}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t})},t.prototype.getDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=[],o=Xl();return e.forEach(function(e){i.push(n.getDocumentInternal(t,e,r).next(function(t){t||(t=new Wh(e,Dl.forDeletedDoc())),o=o.insert(e,t)}))}),op.waitFor(i).next(function(){return o})})},t.prototype.getDocumentsMatchingQuery=function(t,e){return qh.isDocumentKey(e.path)?this.getDocumentsMatchingDocumentQuery(t,e.path):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new qh(e)).next(function(t){var e=$l();return t instanceof Vh&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(i){return n=i,r.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(t){for(var r=0,i=t;r<i.length;r++)for(var o=i[r],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key;if(e.path.isImmediateParentOf(c.path)){var h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof Vh?n.insert(c,l):n.remove(c)}}}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},t}(),dd=function(){function t(){this.refsByKey=new zl(yd.compareByKey),this.refsByTarget=new zl(yd.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new yd(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new yd(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=qh.EMPTY,r=new yd(n,t),i=new yd(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=qh.EMPTY,n=new yd(e,t),r=new yd(e,t+1),i=nf();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new yd(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),yd=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return qh.comparator(t.key,e.key)||Eh(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return Eh(t.targetOrBatchId,e.targetOrBatchId)||qh.comparator(t.key,e.key)},t}(),md=function(){function t(t,e){this.persistence=t,this.localViewReferences=new dd,this.queryDataByTarget={},zc(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new pd(this.remoteDocuments,this.mutationQueue)}return t.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new pd(e.remoteDocuments,e.mutationQueue),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],s=nf(),a=0,u=r;a<u.length;a++){var c=u[a];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p],o.push(c.batchId);for(var y=0,m=c.mutations;y<m.length;y++)f=m[y],s=s.add(f.key)}return e.localDocuments.getDocuments(n,s).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},t.prototype.localWrite=function(t){var e=this;return this.persistence.runTransaction("Locally write mutations","readwrite",function(n){var r,i=Rh.now();return e.mutationQueue.addMutationBatch(n,i,t).next(function(t){var i=(r=t).keys();return e.localDocuments.getDocuments(n,i)}).next(function(t){return{batchId:r.batchId,changes:t}})})},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):op.resolve(null)})})},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return zc(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},t.prototype.applyRemoteEvent=function(e){var n=this,r=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var o=[],s=nf();nh(e.targetChanges,function(r,a){var u=n.queryDataByTarget[r];if(u){a.addedDocuments.forEach(function(t){s=s.add(t)}),a.modifiedDocuments.forEach(function(t){s=s.add(t)}),o.push(n.queryCache.removeMatchingKeys(i,a.removedDocuments,r).next(function(){return n.queryCache.addMatchingKeys(i,a.addedDocuments,r)}));var c=a.resumeToken;if(c.length>0){var h=u;u=u.copy({resumeToken:c,snapshotVersion:e.snapshotVersion}),n.queryDataByTarget[r]=u,t.shouldPersistQueryData(h,u,a)&&o.push(n.queryCache.updateQueryData(i,u))}}});var a=nf();e.documentUpdates.forEach(function(t,u){a=a.add(t),o.push(r.getEntry(i,t).next(function(e){null==e||u.version.isEqual(Dl.MIN)||s.has(u.key)&&!e.hasPendingWrites||u.version.compareTo(e.version)>=0?r.addEntry(u):Kc("LocalStore","Ignoring outdated watch update for ",t,". Current version:",e.version," Watch version:",u.version)})),e.resolvedLimboDocuments.has(t)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(i,t))});var u=e.snapshotVersion;if(!u.isEqual(Dl.MIN)){var c=n.queryCache.getLastRemoteSnapshotVersion(i).next(function(t){return zc(u.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+u+" < "+t),n.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,u)});o.push(c)}return op.waitFor(o).next(function(){return r.apply(i)}).next(function(){return n.localDocuments.getDocuments(i,a)})})},t.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)},t.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return op.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),op.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=tp),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},t.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,op.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new kl(t,i,ml.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return zc(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r,r})})},t.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,t).next(function(i){zc(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,s=n.queryDataByTarget[o],a=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?op.resolve():op.forEach(a,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,s)})})})},t.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=op.resolve();return o.forEach(function(r){s=s.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,s=e.docVersions.get(r);zc(null!==s,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(s)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):zc(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),s.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},t.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),gd=function(){function t(t){this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.highestAcknowledgedBatchId=tp,this.lastStreamToken=Xc(),this.batchesByDocumentKey=new zl(yd.compareByKey)}return t.prototype.checkEmpty=function(t){return op.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId;zc(r>this.highestAcknowledgedBatchId,"Mutation batchIDs must be acknowledged in order");var i=this.indexOfExistingBatchId(r,"acknowledged");zc(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return zc(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.highestAcknowledgedBatchId=r,this.lastStreamToken=n,op.resolve()},t.prototype.getLastStreamToken=function(t){return op.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,op.resolve()},t.prototype.addMutationBatch=function(t,e,n){zc(0!==n.length,"Mutation batches should not be empty");var r=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&zc(this.mutationQueue[this.mutationQueue.length-1].batchId<r,"Mutation batchIDs must be monotonically increasing order");var i=new ep(r,e,n);this.mutationQueue.push(i);for(var o=0,s=n;o<s.length;o++){var a=s[o];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new yd(a.key,r))}return op.resolve(i)},t.prototype.lookupMutationBatch=function(t,e){return op.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return zc(null!=n,"Failed to find local mutation batch."),op.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=Math.max(e,this.highestAcknowledgedBatchId)+1,r=this.indexOfBatchId(n),i=r<0?0:r;return op.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getAllMutationBatches=function(t){return op.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new yd(e,0),i=new yd(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){zc(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);zc(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),op.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new zl(Eh);return e.forEach(function(t){var e=new yd(t,0),i=new yd(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){zc(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),op.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;qh.isDocumentKey(i)||(i=i.child(""));var o=new yd(new qh(i),0),s=new zl(Eh);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.targetOrBatchId)),!0)},o),op.resolve(this.findMutationBatches(s))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;zc(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return op.forEach(e.mutations,function(i){var o=new yd(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new yd(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return op.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&zc(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),op.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return zc(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return zc(n.batchId===t,"If found batch must match"),n},t}(),vd=function(){function t(t){this.persistence=t,this.queries=new mp(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Dl.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new dd,this.targetCount=0,this.targetIdGenerator=ip.forQueryCache()}return t.prototype.getTargetCount=function(t){return op.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),op.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return op.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return op.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,op.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),op.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return zc(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,op.resolve()},t.prototype.updateQueryData=function(t,e){return zc(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),op.resolve()},t.prototype.removeQueryData=function(t,e){return zc(this.targetCount>0,"Removing a target from an empty cache"),zc(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,op.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(s,a){a.sequenceNumber<=e&&!n[a.targetId]&&(r.queries.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),op.waitFor(o).next(function(){return i})},t.prototype.getQueryCount=function(t){return op.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return op.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return Gc("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),op.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),op.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),op.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return op.resolve(n)},t.prototype.containsKey=function(t,e){return op.resolve(this.references.containsKey(e))},t}(),bd=function(){function t(t){this.sizer=t,this.docs=new Kh(qh.comparator),this.newDocumentChanges=nf(),this.size=0}return t.prototype.addEntries=function(t,e,n){for(var r=0,i=e;r<i.length;r++){var o=i[r],s=o.maybeDocument.key;this.docs=this.docs.insert(s,o),this.newDocumentChanges=this.newDocumentChanges.add(s)}return this.size+=n,op.resolve()},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,op.resolve(n.size)):op.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return op.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return op.resolve(this.docs.get(e))},t.prototype.getDocumentsMatchingQuery=function(t,e){for(var n=$l(),r=new qh(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),s=o.key,a=o.value.maybeDocument;if(!e.path.isPrefixOf(s.path))break;a instanceof Vh&&e.matches(a)&&(n=n.insert(a.key,a))}return op.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return op.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var e=this,n=Xl();return this.newDocumentChanges.forEach(function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new Wh(t,Dl.forDeletedDoc());n=n.insert(t,i)}),this.newDocumentChanges=nf(),op.resolve(n)},t.prototype.newChangeBuffer=function(){return new _d(this.sizer,this)},t.prototype.getSize=function(t){return op.resolve(this.size)},t}(),_d=function(t){function e(e,n){var r=t.call(this)||this;return r.sizer=e,r.documentCache=n,r}return Je(e,t),e.prototype.applyChanges=function(t){var e=this,n=0,r=[];return this.assertChanges().forEach(function(t,i){var o=e.documentSizes.get(t);zc(void 0!==o,"Attempting to change document "+t.toString()+" without having read it first");var s=e.sizer(i);n+=s-o,r.push({maybeDocument:i,size:s})}),this.documentCache.addEntries(t,r,n)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e}(gp),wd=function(){function t(t,e,n){var r=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Vf(0),this._started=!1,this._started=!0,this.referenceDelegate=e?new Td(this):new Sd(this,new Jp(n)),this.queryCache=new vd(this),this.remoteDocumentCache=new bd(function(t){return r.referenceDelegate.documentSize(t)})}return t.createLruPersistence=function(e,n){return new t(e,!1,n)},t.createEagerPersistence=function(e,n){return new t(e,!0,n)},t.prototype.shutdown=function(t){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return[2,[this.clientId]]})})},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setNetworkEnabled=function(t){},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new gd(this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getQueryCache=function(){return this.queryCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;Kc("MemoryPersistence","Starting transaction:",t);var i=new Ed(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},t.prototype.mutationQueuesContainKey=function(t,e){return op.or((n=this.mutationQueues,r=[],rh(n,function(t,e){return r.push(e)}),r).map(function(n){return function(){return n.containsKey(t,e)}}));var n,r},t}(),Ed=function(t){this.currentSequenceNumber=t},Td=function(){function t(t){this.persistence=t}return t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),op.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),op.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),op.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache();return op.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(e){return e?op.resolve():n.removeEntry(t,r).next(function(){})})})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return op.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return op.resolve(n.inMemoryPins.containsKey(e))}])},t}(),Sd=function(){function t(t,e){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new mp(function(t){return Yf(t.path)}),this.garbageCollector=new td(this)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return op.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return op.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?op.resolve():e(i)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache();return i.forEachDocumentKey(t,function(o){return n.isPinned(t,o,e).next(function(e){return e?op.resolve():(r++,i.removeEntry(t,o).next())})}).next(function(){return r})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),op.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),op.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),op.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),op.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Gc("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return op.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return op.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return op.resolve(void 0!==t&&t>n)}])},t}(),Id=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&Kc("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}();!function(t){t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff"}(fd||(fd={}));var Cd,Nd,Dd=1e3,Ad=6e4,kd=1.5,Rd=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=fd.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Id(t,e,Dd,kd,Ad)}return t.prototype.isStarted=function(){return this.state===fd.Starting||this.state===fd.Open||this.state===fd.Backoff},t.prototype.isOpen=function(){return this.state===fd.Open},t.prototype.start=function(){this.state!==fd.Error?(zc(this.state===fd.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(fd.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){zc(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=fd.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.isOpen()?[2,this.close(fd.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return Ze(this,void 0,void 0,function(){return tn(this,function(n){switch(n.label){case 0:return zc(this.isStarted(),"Only started streams should be closed."),zc(t===fd.Error||dl(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==fd.Error?this.backoff.reset():e&&e.code===Jc.RESOURCE_EXHAUSTED?(Qc(e.toString()),Qc("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Jc.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;zc(this.state===fd.Initial,"Must be in initial state to auth"),this.state=fd.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new $c(Jc.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},t.prototype.startStream=function(t){var e=this;zc(this.state===fd.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return zc(e.state===fd.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=fd.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;zc(this.state===fd.Error,"Should only perform backoff when in Error state"),this.state=fd.Backoff,this.backoff.backoffAndRun(function(){return Ze(t,void 0,void 0,function(){return tn(this,function(t){return zc(this.state===fd.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=fd.Initial,this.start(),zc(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return zc(this.isStarted(),"Can't handle server close on non-started stream"),Kc("PersistentStream","close with error: "+t),this.stream=null,this.close(fd.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(Kc("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Od=function(t){function e(e,n,r,i,o){var s=t.call(this,e,Bf.ListenStreamConnectionBackoff,Bf.ListenStreamIdle,n,r,o)||this;return s.serializer=i,s}return Je(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(Rd),Pd=function(t){function e(e,n,r,i,o){var s=t.call(this,e,Bf.WriteStreamConnectionBackoff,Bf.WriteStreamIdle,n,r,o)||this;return s.serializer=i,s.handshakeComplete_=!1,s}return Je(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(zc(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return zc(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){zc(this.isOpen(),"Writing handshake requires an opened stream"),zc(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;zc(this.isOpen(),"Writing mutations requires an opened stream"),zc(this.handshakeComplete_,"Handshake must be complete before writing mutations"),zc(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},e}(Rd),Ld=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Pd(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Od(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=Xl();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);zc(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===Jc.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===Jc.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t}(),Md=function(){function t(t){this.datastore=t,this.readVersions=tf(),this.mutations=[],this.committed=!1}return t.prototype.recordVersion=function(t){var e;if(t instanceof Vh)e=t.version;else{if(!(t instanceof Wh))throw Gc("Document in a transaction was a "+t.constructor.name);e=Dl.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new $c(Jc.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.lookup=function(t){var e=this;return this.committed?Promise.reject("Transaction has already completed."):this.mutations.length>0?Promise.reject("Transactions lookups are invalid after writes."):this.datastore.lookup(t).then(function(t){return t.forEach(function(t){t instanceof Wh||t instanceof Vh?e.recordVersion(t):Gc("Document in a transaction was a "+t.constructor.name)}),t})},t.prototype.write=function(t){if(this.committed)throw new $c(Jc.FAILED_PRECONDITION,"Transaction has already completed.");this.mutations=this.mutations.concat(t)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return e?Ll.updateTime(e):Ll.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(e&&e.isEqual(Dl.forDeletedDoc()))throw new $c(Jc.FAILED_PRECONDITION,"Can't update a document that doesn't exist.");return e?Ll.updateTime(e):Ll.exists(!0)},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t)))},t.prototype.update=function(t,e){this.write(e.toMutations(t,this.preconditionForUpdate(t)))},t.prototype.delete=function(t){this.write([new ql(t,this.precondition(t))]),this.readVersions=this.readVersions.insert(t,Dl.forDeletedDoc())},t.prototype.commit=function(){var t=this,e=this.readVersions;return this.mutations.forEach(function(t){e=e.remove(t.key)}),e.isEmpty()?this.datastore.commit(this.mutations).then(function(){t.committed=!0}):Promise.reject(Error("Every document read in a transaction must also be written."))},t}();!function(t){t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline"}(Cd||(Cd={})),function(t){t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState"}(Nd||(Nd={}));var xd=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Cd.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Cd.Unknown),zc(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Bf.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,zc(t.state===Cd.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Cd.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===Cd.Online?(this.setAndBroadcast(Cd.Unknown),zc(0===this.watchStreamFailures,"watchStreamFailures must be 0"),zc(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Cd.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Cd.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Qc(e),this.shouldWarnClientIsOffline=!1):Kc("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}(),Fd=function(){function t(t,e,n,r){this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.onlineStateTracker=new xd(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return Ze(this,void 0,void 0,function(){var t;return tn(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Cd.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Cd.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(Kc("RemoteStore","Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return Kc("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Cd.Unknown),[2]}})})},t.prototype.listen=function(t){zc(!th(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){zc(th(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),ih(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Cd.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){zc(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new vf(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!ih(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return Ze(this,void 0,void 0,function(){var t=this;return tn(this,function(e){return nh(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},t.prototype.onWatchStreamClose=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){return void 0===t&&zc(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(Cd.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(t,e){return Ze(this,void 0,void 0,function(){var n;return tn(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(Cd.Online),t instanceof mf&&t.state===cf.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof df?this.watchChangeAggregator.handleDocumentChange(t):t instanceof yf?this.watchChangeAggregator.handleExistenceFilter(t):(zc(t instanceof mf,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(Dl.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(t){var e=this;zc(!t.isEqual(Dl.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return nh(n.targetChanges,function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:t}))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.copy({resumeToken:Xc()}),e.sendUnwatchRequest(t);var r=new kl(n.query,t,ml.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;zc(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return Ze(e,void 0,void 0,function(){return tn(this,function(e){return th(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},t.prototype.fillWritePipeline=function(){return Ze(this,void 0,void 0,function(){var t,e;return tn(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:tp,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){zc(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){zc(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(function(e){return t.ignoreIfPrimaryLeaseLoss(e)})},t.prototype.ignoreIfPrimaryLeaseLoss=function(t){if(!ad(t))throw t;Kc("RemoteStore","Unexpectedly lost primary lease")},t.prototype.onMutationResult=function(t,e){var n=this;zc(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=np.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(t){return Ze(this,void 0,void 0,function(){var e=this;return tn(this,function(n){return void 0===t&&zc(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},t.prototype.handleHandshakeError=function(t){return Ze(this,void 0,void 0,function(){var e=this;return tn(this,function(n){return Hl(t.code)||t.code===Jc.ABORTED?(Kc("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Xc(),[2,this.localStore.setLastStreamToken(Xc()).catch(function(t){return e.ignoreIfPrimaryLeaseLoss(t)})]):[2]})})},t.prototype.handleWriteError=function(t){return Ze(this,void 0,void 0,function(){var e,n=this;return tn(this,function(r){return Hl(t.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2]})})},t.prototype.createTransaction=function(){return new Md(this.datastore)},t.prototype.handleCredentialChange=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Kc("RemoteStore","RemoteStore restarting streams for new credential"),this.networkEnabled=!1,[4,this.disableNetworkInternal()]):[3,3];case 1:return t.sent(),this.onlineStateTracker.set(Cd.Unknown),[4,this.enableNetwork()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.applyPrimaryState=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(Cd.Unknown),e.label=4;case 4:return[2]}})})},t}(),Ud=function(){this.listeners=[]},qd=function(){function t(t){this.syncEngine=t,this.queries=new mp(function(t){return t.canonicalId()}),this.onlineState=Cd.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new Ud,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t,t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i;return tn(this,function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&(i=r.listeners.indexOf(t))>=0&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var s=0,a=o.listeners;s<a.length;s++)a[s].onViewSnapshot(r);o.viewSnap=r}}},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t,this.queries.forEach(function(e,n){for(var r=0,i=n.listeners;r<i.length;r++)i[r].applyOnlineStateChange(t)})},t}(),Bd=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=Cd.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(zc(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==sf.Metadata&&e.push(i)}t=new lf(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){if(zc(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Cd.Offline;return this.options.waitForSyncWhenOnline&&n?(zc(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Cd.Offline},t.prototype.shouldRaiseEvent=function(t){if(t.docChanges.length>0)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){zc(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=lf.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),Vd=function(){function t(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return t.fromSnapshot=function(e,n){for(var r=nf(),i=nf(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case sf.Added:r=r.add(a.doc.key);break;case sf.Removed:i=i.add(a.doc.key)}}return new t(e,r,i)},t}(),Wd=function(t){this.key=t},jd=function(t){this.key=t},Kd=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=nf(),this.mutatedKeys=nf(),this.documentSet=new uf(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new hf,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof Vh?e:null;h&&(zc(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data.isEqual(h.data)?l!==f&&(r.track({type:sf.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:sf.Modified,doc:h}),p=!0,u&&n.query.docComparator(h,u)>0&&(a=!0)):!c&&h?(r.track({type:sf.Added,doc:h}),p=!0):c&&!h&&(r.track({type:sf.Removed,doc:c}),p=!0,u&&(a=!0)),p&&(h?(s=s.add(h),o=f?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),this.query.hasLimit())for(;s.size>this.query.limit;){var c=s.last();s=s.delete(c.key),o=o.delete(c.key),r.track({type:sf.Removed,doc:c})}return zc(!a||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;zc(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case sf.Added:return 1;case sf.Modified:case sf.Metadata:return 2;case sf.Removed:return 0;default:return Gc("Unknown ChangeType: "+t)}};return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var s=e?this.updateLimboDocuments():[],a=0===this.limboDocuments.size&&this.current?af.Synced:af.Local,u=a!==this.syncState;return this.syncState=a,0!==o.length||u?{snapshot:new lf(this.query,t.documentSet,i,o,t.mutatedKeys,a===af.Local,u,!1),limboChanges:s}:{limboChanges:s}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===Cd.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new hf,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return zc(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=nf(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new jd(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new Wd(t))}),n},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=nf();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return lf.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===af.Local)},t}(),Qd=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Hd=function(t){this.key=t},Gd=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new mp(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new Kh(qh.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new dd,this.mutationUserCallbacks={},this.limboTargetIdGenerator=ip.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Cd.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){zc(null!==t,"SyncEngine listener cannot be null"),zc(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i,o;return tn(this,function(s){switch(s.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=s.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=s.sent(),this.isPrimary&&this.remoteStore.listen(i),s.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(t,e){var n=this,r=t.query;return this.localStore.executeQuery(r).then(function(i){return n.localStore.remoteDocumentKeys(t.targetId).then(function(o){var s=new Kd(r,o),a=s.computeDocChanges(i),u=pf.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&n.onlineState!==Cd.Offline),c=s.applyChanges(a,!0===n.isPrimary,u);zc(0===c.limboChanges.length,"View returned limbo docs before target ack from the server."),zc(!!c.snapshot,"applyChanges for new view should always return a snapshot");var h=new Qd(r,t.targetId,s);return n.queryViewsByQuery.set(r,h),n.queryViewsByTarget[t.targetId]=h,c.snapshot})})},t.prototype.synchronizeViewAndComputeSnapshot=function(t){var e=this;return this.localStore.executeQuery(t.query).then(function(n){return e.localStore.remoteDocumentKeys(t.targetId).then(function(r){return Ze(e,void 0,void 0,function(){var e;return tn(this,function(i){return e=t.view.synchronizeWithPersistedState(n,r),this.isPrimary&&this.updateTrackedLimbos(t.targetId,e.limboChanges),[2,e]})})})})},t.prototype.unlisten=function(t){return Ze(this,void 0,void 0,function(){var e,n=this;return tn(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),zc(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(function(t){return n.ignoreIfPrimaryLeaseLoss(t)})]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){var n=this;return this.assertSubscribed("write()"),this.localStore.localWrite(t).then(function(t){return n.sharedClientState.addPendingMutation(t.batchId),n.addMutationCallback(t.batchId,e),n.emitNewSnapsAndNotifyLocalStore(t.changes)}).then(function(){return n.remoteStore.fillWritePipeline()})},t.prototype.wrapUpdateFunctionError=function(t){return t},t.prototype.runTransaction=function(t,e){var n=this;void 0===e&&(e=5),zc(e>=0,"Got negative number of retries for transaction.");var r=this.remoteStore.createTransaction();return function(){try{var e=t(r);return!dl(e)&&e.catch&&e.then?e.catch(function(t){return Promise.reject(n.wrapUpdateFunctionError(t))}):Promise.reject(Error("Transaction callback must return a Promise"))}catch(t){return Promise.reject(n.wrapUpdateFunctionError(t))}}().then(function(i){return r.commit().then(function(){return i}).catch(function(r){return 0===e?Promise.reject(r):n.runTransaction(t,e-1)})})},t.prototype.applyRemoteEvent=function(t){var e=this;return this.assertSubscribed("applyRemoteEvent()"),this.localStore.applyRemoteEvent(t).then(function(n){return rh(t.targetChanges,function(t,n){var r=e.limboResolutionsByTarget[t];r&&(zc(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),n.addedDocuments.size>0?r.receivedDocument=!0:n.modifiedDocuments.size>0?zc(r.receivedDocument,"Received change for limbo target document without add."):n.removedDocuments.size>0&&(zc(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),e.emitNewSnapsAndNotifyLocalStore(n,t)}).catch(function(t){return e.ignoreIfPrimaryLeaseLoss(t)})},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===Nd.RemoteStore||!this.isPrimary&&e===Nd.SharedClientState){var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);zc(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return Ze(this,void 0,void 0,function(){var n,r,i,o,s,a,u=this;return tn(this,function(c){switch(c.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new Kh(qh.comparator)).insert(r,new Wh(r,Dl.forDeletedDoc())),o=nf().add(r),s=new ff(Dl.MIN,{},new zl(Eh),i,o),[2,this.applyRemoteEvent(s)]):[3,1];case 1:return zc(!!(a=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(a.query,!1).then(function(){return u.removeAndCleanupQuery(a)}).catch(function(t){return u.ignoreIfPrimaryLeaseLoss(t)})];case 2:c.sent(),this.syncEngineListener.onWatchError(a.query,e),c.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(t,e,n){return Ze(this,void 0,void 0,function(){var r;return tn(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(Kc("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):Gc("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){var e=this;this.assertSubscribed("applySuccessfulWrite()");var n=t.batch.batchId;return this.processUserCallback(n,null),this.localStore.acknowledgeBatch(t).then(function(t){return e.sharedClientState.updateMutationState(n,"acknowledged"),e.emitNewSnapsAndNotifyLocalStore(t)}).catch(function(t){return e.ignoreIfPrimaryLeaseLoss(t)})},t.prototype.rejectFailedWrite=function(t,e){var n=this;return this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.localStore.rejectBatch(t).then(function(r){return n.sharedClientState.updateMutationState(t,"rejected",e),n.emitNewSnapsAndNotifyLocalStore(r)}).catch(function(t){return n.ignoreIfPrimaryLeaseLoss(t)})},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new Kh(Eh)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(zc(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Wd?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof jd?(Kc("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Gc("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Kc("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=gl.atPath(e.path);this.limboResolutionsByTarget[n]=new Hd(e),this.remoteStore.listen(new kl(r,n,ml.LimboResolution,Vf.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return Ze(this,void 0,void 0,function(){var n,r,i,o=this;return tn(this,function(s){switch(s.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(s,a){i.push(Promise.resolve().then(function(){var e=a.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(a.query).then(function(t){return a.view.computeDocChanges(t,e)}):e}).then(function(t){var i=e&&e.targetChanges[a.targetId],s=a.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(a.targetId,s.limboChanges),s.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(a.targetId,s.snapshot.fromCache?"not-current":"current"),n.push(s.snapshot);var u=Vd.fromSnapshot(a.targetId,s.snapshot);r.push(u)}}))}),[4,Promise.all(i)];case 1:return s.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return s.sent(),[2]}})})},t.prototype.ignoreIfPrimaryLeaseLoss=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){if(!ad(t))throw t;return Kc("SyncEngine","Unexpectedly lost primary lease"),[2]})})},t.prototype.assertSubscribed=function(t){zc(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return Ze(this,void 0,void 0,function(){var e,n;return tn(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?[4,this.localStore.handleUserChange(t)]:[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},t.prototype.applyPrimaryState=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u=this;return tn(this,function(c){switch(c.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return c.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=c.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],a=Promise.resolve(),nh(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?s.push(t):a=a.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,a]);case 4:return c.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(s)];case 5:return c.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var t=this;nh(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Kh(qh.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){for(var e=this,n=Promise.resolve(),r=[],i=[],o=function(t){n=n.then(function(){return Ze(e,void 0,void 0,function(){var e,n,o,s;return tn(this,function(a){switch(a.label){case 0:return(n=this.queryViewsByTarget[t])?[4,this.localStore.releaseQuery(n.query,!0)]:[3,4];case 1:return a.sent(),[4,this.localStore.allocateQuery(n.query)];case 2:return e=a.sent(),[4,this.synchronizeViewAndComputeSnapshot(n)];case 3:return(o=a.sent()).snapshot&&i.push(o.snapshot),[3,8];case 4:return zc(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(t)];case 5:return zc(!!(s=a.sent()),"Query data for target "+t+" not found"),[4,this.localStore.allocateQuery(s)];case 6:return e=a.sent(),[4,this.initializeViewAndComputeSnapshot(e,!1)];case 7:a.sent(),a.label=8;case 8:return r.push(e),[2]}})})})},s=0,a=t;s<a.length;s++)o(a[s]);return n.then(function(){return e.syncEngineListener.onWatchChange(i),r})},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i=this;return tn(this,function(o){switch(o.label){case 0:if(this.isPrimary)return Kc("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,5];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,2]}return[3,4];case 1:return[2,this.localStore.getNewDocumentChanges().then(function(n){return Ze(i,void 0,void 0,function(){var r;return tn(this,function(i){switch(i.label){case 0:return r=ff.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(n,r)];case 1:return i.sent(),[2]}})})},function(t){return Ze(i,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:return function(t){return t.code===Jc.DATA_LOSS&&t.message===vp}(t)?(e=[],nh(this.queryViewsByTarget,function(t){return e.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e)]):[3,2];case 1:return n.sent(),[3,3];case 2:throw t;case 3:return[2]}})})})];case 2:return r=this.queryViewsByTarget[t],this.removeAndCleanupQuery(r),[4,this.localStore.releaseQuery(r.query,!0)];case 3:return o.sent(),this.syncEngineListener.onWatchError(r.query,n),[3,5];case 4:Gc("Unexpected target state: "+e),o.label=5;case 5:return[2]}})})},t.prototype.applyActiveTargetsChange=function(t,e){return Ze(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l=this;return tn(this,function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(h=r[n],zc(!this.queryViewsByTarget[h],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(h)]):[3,6];case 2:return zc(!!(i=f.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=f.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:f.sent(),this.remoteStore.listen(o),f.label=5;case 5:return n++,[3,1];case 6:s=function(t){var e;return tn(this,function(n){switch(n.label){case 0:return(e=a.queryViewsByTarget[t])?[4,a.localStore.releaseQuery(e.query,!1).then(function(){l.remoteStore.unlisten(t),l.removeAndCleanupQuery(e)}).catch(function(t){return l.ignoreIfPrimaryLeaseLoss(t)})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},a=this,u=0,c=e,f.label=7;case 7:return u<c.length?(h=c[u],[5,s(h)]):[3,10];case 8:f.sent(),f.label=9;case 9:return u++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?nf().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:nf()},t}(),zd=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),Yd="SharedClientState",Xd="firestore_clients",Jd="firestore_mutations",$d="firestore_targets",Zd="firestore_online_state",ty="firestore_sequence_number",ey=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,zc(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==c(i)&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==c(i.error)),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new $c(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(Qc(Yd,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),ny=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,zc(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==c(r)&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==c(r.error)),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new $c(r.error.code,r.error.message)),i?new t(e,r.state,o):(Qc(Yd,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),ry=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==c(r)&&r.activeTargetIds instanceof Array,o=of(),s=0;i&&s<r.activeTargetIds.length;++s)i=yl(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Qc(Yd,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),iy=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==c(n)&&void 0!==Cd[n.onlineState]&&"string"==typeof n.clientId?new t(n.clientId,Cd[n.onlineState]):(Qc(Yd,"Failed to parse online state: "+e),null)},t}(),oy=function(){function t(){this.activeTargetIds=of()}return t.prototype.addQueryTarget=function(t){zc(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),sy=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new $c(Jc.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey=ty+"_"+r,this.activeClients[this.localClientId]=new oy,this.clientStateKeyRe=new RegExp("^"+Xd+"_"+s+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Jd+"_"+s+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+$d+"_"+s+"_(\\d+)$"),this.onlineStateKey=Zd+"_"+r,this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return Ze(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h,l=this;return tn(this,function(f){switch(f.label){case 0:return zc(!this.started,"WebStorageSharedClientState already started"),zc(null!==this.syncEngine,"syncEngine property must be set before calling start()"),zc(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=ry.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(a=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(a),u=0,c=this.earlyEvents;u<c.length;u++)h=c[u],this.handleWebStorageEvent(h);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=of();return rh(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=ny.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Kc(Yd,"READ",t,e),e},t.prototype.setItem=function(t,e){Kc(Yd,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Kc(Yd,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(Kc(Yd,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void Qc("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return Ze(e,void 0,void 0,function(){var e,n,r,i,o,s;return tn(this,function(a){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(zc(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(s=function(t){var e=Vf.INVALID;if(null!=t)try{var n=JSON.parse(t);zc("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Qc(Yd,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==Vf.INVALID&&this.sequenceNumberHandler(s));return[2]})})})}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new ey(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:Cd[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},t.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new ny(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.toWebStorageClientStateKey=function(t){return zc(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),Xd+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageQueryTargetMetadataKey=function(t){return $d+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageMutationBatchKey=function(t){var e=Jd+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return zc(null!==n,"Cannot parse client state key '"+t+"'"),ry.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);zc(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ey.fromWebStorageEntry(new zd(i),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);zc(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return ny.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return iy.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){return t.user.uid!==this.currentUser.uid?(Kc(Yd,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],s=[];return i.forEach(function(t){return Ze(n,void 0,void 0,function(){return tn(this,function(e){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return Ze(n,void 0,void 0,function(){return tn(this,function(e){return i.has(t)||s.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,s)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}(),ay=function(){function t(){this.localState=new oy,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new oy,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),uy=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=wh.newId()}return t.prototype.start=function(t){var e=this,n=new Wf,r=new Wf,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(){return e.initializeRest(o)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t.enabled?this.startIndexedDbPersistence(n,t).then(e.resolve).catch(function(t){return e.reject(t),r.canFallback(t)?(console.warn("Error enabling offline storage. Falling back to storage disabled: "+t),r.startMemoryPersistence()):Promise.reject(t)}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof $c?t.code===Jc.FAILED_PRECONDITION||t.code===Jc.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code},t.prototype.startIndexedDbPersistence=function(t,e){var n=this;zc(e.enabled,"Should only start IndexedDb persitence with offline persistence enabled.");var r=sd.buildStoragePrefix(this.databaseInfo),i=new Df(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return Ze(n,void 0,void 0,function(){var n,o;return tn(this,function(s){switch(s.label){case 0:if(e.experimentalTabSynchronization&&!sy.isAvailable(this.platform))throw new $c(Jc.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e.experimentalTabSynchronization?(this.sharedClientState=new sy(this.asyncQueue,this.platform,r,this.clientId,t),n=this,[4,sd.createMultiClientIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return n.persistence=s.sent(),[3,4];case 2:return this.sharedClientState=new ay,o=this,[4,sd.createIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i)];case 3:o.persistence=s.sent(),s.label=4;case 4:return[2]}})})})},t.prototype.startMemoryPersistence=function(){var t=new Df(this.databaseInfo.databaseId,{useProto3Json:!0});return this.persistence=wd.createEagerPersistence(this.clientId,t),this.sharedClientState=new ay,Promise.resolve()},t.prototype.initializeRest=function(t){var e=this;return Kc("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(n){return Ze(e,void 0,void 0,function(){var e,r,i,o,s=this;return tn(this,function(a){switch(a.label){case 0:return this.localStore=new md(this.persistence,t),e=this.platform.newSerializer(this.databaseInfo.databaseId),r=new Ld(this.asyncQueue,n,this.credentials,e),i=function(t){return s.syncEngine.applyOnlineStateChange(t,Nd.RemoteStore)},o=function(t){return s.syncEngine.applyOnlineStateChange(t,Nd.SharedClientState)},this.remoteStore=new Fd(this.localStore,r,this.asyncQueue,i),this.syncEngine=new Gd(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=o,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new qd(this.syncEngine),[4,this.sharedClientState.start()];case 1:return a.sent(),[4,this.remoteStore.start()];case 2:return a.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return s.syncEngine.applyPrimaryState(t)})];case 3:return a.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Kc("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(t){var e=this;return this.asyncQueue.enqueue(function(){return Ze(e,void 0,void 0,function(){return tn(this,function(e){switch(e.label){case 0:return[4,this.remoteStore.shutdown()];case 1:return e.sent(),[4,this.sharedClientState.shutdown()];case 2:return e.sent(),[4,this.persistence.shutdown(t&&t.purgePersistenceWithDataLoss)];case 3:return e.sent(),this.credentials.removeChangeListener(),[2]}})})})},t.prototype.listen=function(t,e,n){var r=this,i=new Bd(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Vh)return t;if(t instanceof Wh)return null;throw new $c(Jc.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=nf(),r=new Kd(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},t.prototype.write=function(t){var e=this,n=new Wf;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.transaction=function(t){var e=this;return this.asyncQueue.enqueue(function(){return Ze(e,void 0,void 0,function(){return tn(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),cy=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),hy=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new $c(Jc.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+_h(1,"element")+".")}(0,t);for(var n=0;n<t.length;++n)if(uh("FieldPath","string",n,t[n]),0===t[n].length)throw new $c(Jc.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Uh(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw vh("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(Uh.keyField().canonicalString()),t}(),ly=new RegExp("[~\\*/\\[\\]]"),fy=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},py=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){zc(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(zd.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){zc(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),dy=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var t=this;zc(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new $c(Jc.ABORTED,"getToken aborted due to token change.");return n?(zc("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new fy(n.accessToken,t.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){zc(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){zc(null!=this.tokenListener,"removeChangeListener() called twice"),zc(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return zc(null===t||"string"==typeof t,"Received invalid UID: "+t),new zd(t)},t}(),yy=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=zd.FIRST_PARTY,zc(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){return{Authorization:this.gapi.auth.getAuthHeaderValueForFirstParty([]),"X-Goog-AuthUser":this.sessionIndex}},enumerable:!0,configurable:!0}),t}(),my=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,zc(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")}return t.prototype.getToken=function(){return Promise.resolve(new yy(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(zd.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function gy(t){return function(t,e){if("object"!=c(t)||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var vy,by=function(){function t(t){this._methodName=t}return t.delete=function(){return _y.instance},t.serverTimestamp=function(){return wy.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return sh("FieldValue.arrayUnion",arguments,1),new Ey(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return sh("FieldValue.arrayRemove",arguments,1),new Ty(t)},t.prototype.isEqual=function(t){return this===t},t}(),_y=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return Je(e,t),e.instance=new e,e}(by),wy=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return Je(e,t),e.instance=new e,e}(by),Ey=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return Je(e,t),e}(by),Ty=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return Je(e,t),e}(by),Sy=Zc(by,"Use FieldValue.<field>() instead."),Iy=/^__.*__$/,Cy=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Fl(t,this.data,this.fieldMask,e)):n.push(new xl(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Ul(t,this.fieldTransforms)),n},t}(),Ny=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new Fl(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new Ul(t,this.fieldTransforms)),n},t}();function Dy(t){switch(t){case vy.Set:case vy.MergeSet:case vy.Update:return!0;case vy.Argument:return!1;default:throw Gc("Unexpected case for UserDataSource: "+t)}}!function(t){t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument"}(vy||(vy={}));var Ay=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new $c(Jc.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(Dy(this.dataSource)&&Iy.test(t))throw this.createError("Document fields cannot begin and end with __")},t}(),ky=function(t,e){this.databaseId=t,this.key=e},Ry=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new Ay(vy.Set,t,Uh.EMPTY_PATH);Py("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new Cy(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new Ay(vy.MergeSet,t,Uh.EMPTY_PATH);Py("Data must be an object, but it was:",r,e);var i,o,s=this.parseData(e,r);if(n){for(var a=[],u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof hy)l=h._internalPath;else{if("string"!=typeof h)throw Gc("Expected stringOrFieldPath to be a string or a FieldPath");l=My(t,h)}if(!r.contains(l))throw new $c(Jc.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");a.push(l)}i=new Rl(a),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=new Rl(r.fieldMask),o=r.fieldTransforms;return new Cy(s,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new Ay(vy.Update,t,Uh.EMPTY_PATH);Py("Data must be an object, but it was:",r,e);var i=[],o=ul.EMPTY;rh(e,function(e,s){var a=My(t,e),u=r.childContextForFieldPath(a);if((s=n.runPreConverter(s,u))instanceof _y)i.push(a);else{var c=n.parseData(s,u);null!=c&&(i.push(a),o=o.set(a,c))}});var s=new Rl(i);return new Ny(o,s,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Ay(vy.Update,t,Uh.EMPTY_PATH),o=[Ly(t,e)],s=[n];if(r.length%2!=0)throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<r.length;a+=2)o.push(Ly(t,r[a])),s.push(r[a+1]);var u=[],c=ul.EMPTY;for(a=0;a<o.length;++a){var h=o[a],l=i.childContextForFieldPath(h),f=this.runPreConverter(s[a],l);if(f instanceof _y)u.push(h);else{var p=this.parseData(f,l);null!=p&&(u.push(h),c=c.set(h,p))}}var d=new Rl(u);return new Ny(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new Ay(vy.Argument,t,Uh.EMPTY_PATH),r=this.parseData(e,n);return zc(null!=r,"Parsed data should not be null."),zc(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=xy(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(Oy(t=this.runPreConverter(t,e)))return Py("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof by)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new Kh(Eh);return ih(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):rh(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new ul(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],a=this.parseData(s,e.childContextForArray(r));null==a&&(a=Xh.INSTANCE),n.push(a),r++}return new cl(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!Dy(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof _y){if(e.dataSource!==vy.MergeSet)throw e.dataSource===vy.Update?(zc(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof wy)e.fieldTransforms.push(new Ol(e.path,Bl.instance));else if(t instanceof Ey){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new Vl(n);e.fieldTransforms.push(new Ol(e.path,r))}else if(t instanceof Ty){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new Wl(n);e.fieldTransforms.push(new Ol(e.path,i))}else Gc("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return Xh.INSTANCE;if("number"==typeof t)return yl(t)?new tl(t):new el(t);if("boolean"==typeof t)return Jh.of(t);if("string"==typeof t)return new nl(t);if(t instanceof Date)return new rl(Rh.fromDate(t));if(t instanceof Rh)return new rl(new Rh(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof kh)return new al(t);if(t instanceof Dh)return new ol(t);if(t instanceof ky)return new sl(t.databaseId,t.key);throw e.createError("Unsupported field value: "+yh(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new Ay(vy.Argument,t,Uh.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},t}();function Oy(t){return!("object"!=c(t)||null===t||t instanceof Array||t instanceof Date||t instanceof Rh||t instanceof kh||t instanceof Dh||t instanceof ky||t instanceof by)}function Py(t,e,n){if(!Oy(n)||!dh(n)){var r=yh(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Ly(t,e){if(e instanceof hy)return e._internalPath;if("string"==typeof e)return My(t,e);throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function My(t,e){try{return function(t){if(t.search(ly)>=0)throw new $c(Jc.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(hy.bind.apply(hy,[void 0].concat(t.split("."))))}catch(e){throw new $c(Jc.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=xy(e);throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function xy(t){return t instanceof Error?t.message:t.toString()}var Fy="firestore.googleapis.com",Uy=!0,qy=!1,By=!1,Vy=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new $c(Jc.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Fy,this.ssl=Uy}else hh("settings","non-empty string","host",t.host),this.host=t.host,lh("settings","boolean","ssl",t.ssl),this.ssl=eh(t.ssl,Uy);gh("settings",t,["host","ssl","credentials","timestampsInSnapshots"]),lh("settings","object","credentials",t.credentials),this.credentials=t.credentials,lh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),this.timestampsInSnapshots=eh(t.timestampsInSnapshots,qy)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials},t}(),Wy=function(){},jy=function(){function t(t,e){this.enabled=t,zc(t||!e,"Can only provide PersistenceSettings with persistence enabled"),e=e||{},this.experimentalTabSynchronization=eh(e.experimentalTabSynchronization,By)}return t.prototype.isEqual=function(t){return this.enabled===t.enabled&&this.experimentalTabSynchronization===t.experimentalTabSynchronization},t}(),Ky=function(){function t(e){var n=this;this._queue=new Kf,this.INTERNAL={delete:function(t){return Ze(n,void 0,void 0,function(){return tn(this,function(e){return this._firestoreClient?[2,this._firestoreClient.shutdown(t)]:[2]})})}};var r=new Wy;if("object"==c(e.options)){var i=e;r.firebaseApp=i,r.databaseId=t.databaseIdFromApp(i),r.persistenceKey=r.firebaseApp.name,r.credentials=new dy(i)}else{var o=e;if(!o.projectId)throw new $c(Jc.INVALID_ARGUMENT,"Must provide projectId");r.databaseId=new Lh(o.projectId,o.database),r.persistenceKey="[DEFAULT]",r.credentials=new py}r.settings=new Vy({}),this._config=r,this._databaseId=r.databaseId}return t.prototype.settings=function(t){if(oh("Firestore.settings",arguments,1),uh("Firestore.settings","object",1,t),th(t,"persistence"))throw new $c(Jc.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Vy(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new $c(Jc.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._config.settings=e,void 0!==e.credentials&&(this._config.credentials=function(t){if(!t)return new py;switch(t.type){case"gapi":return new my(t.client,t.sessionIndex||"0");case"provider":return t.client;default:throw new $c(Jc.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new $c(Jc.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");return this.configureClient(new jy(!0,t))},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new jy(!1)),this._firestoreClient},t.prototype.configureClient=function(t){var e=this;zc(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),this._config.settings.timestampsInSnapshots||Qc("\nThe behavior for Date objects stored in Firestore is going to change\nAND YOUR APP MAY BREAK.\nTo hide this warning and ensure your app does not break, you need to add the\nfollowing code to your app before calling any other Cloud Firestore methods:\n\n  const firestore = firebase.firestore();\n  const settings = {/* your settings... */ timestampsInSnapshots: true};\n  firestore.settings(settings);\n\nWith this change, timestamps stored in Cloud Firestore will be read back as\nFirebase Timestamp objects instead of as system Date objects. So you will also\nneed to update code expecting a Date to instead expect a Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at');\n  const date = timestamp.toDate();\n\nPlease audit all existing usages of Date when you enable the new behavior. In a\nfuture release, the behavior will change to the new behavior, so if you do not\nfollow these steps, YOUR APP MAY BREAK."),zc(!this._firestoreClient,"configureClient() called multiple times");var n=new Oh(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl);return this._dataConverter=new Ry(function(t){if(t instanceof Gy){var n=e._config.databaseId,r=t.firestore._config.databaseId;if(!r.isEqual(n))throw new $c(Jc.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new ky(e._config.databaseId,t._key)}return t}),this._firestoreClient=new uy(Yc.getPlatform(),n,this._config.credentials,this._queue),this._firestoreClient.start(t)},t.databaseIdFromApp=function(t){var e=t.options;if(!th(e,"projectId"))throw new $c(Jc.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new $c(Jc.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Lh(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new $c(Jc.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(oh("Firestore.collection",arguments,1),uh("Firestore.collection","non-empty string",1,t),!t)throw new $c(Jc.INVALID_ARGUMENT,"Must provide a non-empty collection path to collection()");return this.ensureClientConfigured(),new Zy(xh.fromString(t),this)},t.prototype.doc=function(t){if(oh("Firestore.doc",arguments,1),uh("Firestore.doc","non-empty string",1,t),!t)throw new $c(Jc.INVALID_ARGUMENT,"Must provide a non-empty document path to doc()");return this.ensureClientConfigured(),Gy.forPath(xh.fromString(t),this)},t.prototype.runTransaction=function(t){var e=this;return oh("Firestore.runTransaction",arguments,1),uh("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new Qy(e,n))})},t.prototype.batch=function(){return this.ensureClientConfigured(),new Hy(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(Wc()){case Oc.DEBUG:return"debug";case Oc.ERROR:return"error";case Oc.SILENT:return"silent";default:return Gc("Unknown log level: "+Wc())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(oh("Firestore.setLogLevel",arguments,1),uh("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":jc(Oc.DEBUG);break;case"error":jc(Oc.ERROR);break;case"silent":jc(Oc.SILENT);break;default:throw new $c(Jc.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},t}(),Qy=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;oh("Transaction.get",arguments,1);var n=rm("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Gc("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof Wh)return new Yy(e._firestore,n._key,null,!1,!1);if(r instanceof Vh)return new Yy(e._firestore,n._key,r,!1,!1);throw Gc("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},t.prototype.set=function(t,e,n){ah("Transaction.set",arguments,2,3);var r=rm("Transaction.set",t,this._firestore),i=(n=tm("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof hy?(sh("Transaction.update",arguments,3),r=rm("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(oh("Transaction.update",arguments,2),r=rm("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){oh("Transaction.delete",arguments,1);var e=rm("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Hy=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){ah("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=rm("WriteBatch.set",t,this._firestore),i=(n=tm("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,Ll.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.verifyNotCommitted(),"string"==typeof e||e instanceof hy?(sh("WriteBatch.update",arguments,3),r=rm("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(oh("WriteBatch.update",arguments,2),r=rm("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Ll.exists(!0))),this},t.prototype.delete=function(t){oh("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=rm("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new ql(e._key,Ll.NONE)),this},t.prototype.commit=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new $c(Jc.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Gy=function(){function t(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n){if(e.length%2!=0)throw new $c(Jc.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new qh(e),n)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Zy(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(oh("DocumentReference.collection",arguments,1),uh("DocumentReference.collection","non-empty string",1,t),!t)throw new $c(Jc.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=xh.fromString(t);return new Zy(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw vh("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)},t.prototype.set=function(t,e){ah("DocumentReference.set",arguments,1,2);var n=(e=tm("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,Ll.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof hy?(sh("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(oh("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Ll.exists(!0)))},t.prototype.delete=function(){return oh("DocumentReference.delete",arguments,0),this._firestoreClient.write([new ql(this._key,Ll.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ah("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=c(t[i])||gy(t[i])||(gh("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),lh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return gy(t[i])?n=t[i]:(uh("DocumentReference.onSnapshot","function",i,t[i]),ch("DocumentReference.onSnapshot","function",i+1,t[i+1]),ch("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new cy({next:function(t){if(e.next){zc(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new Yy(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(gl.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return ah("DocumentReference.get",arguments,0,1),nm("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new Yy(e.firestore,e._key,t,!0,t instanceof Vh&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new $c(Jc.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new $c(Jc.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t}(),zy=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Yy=function(){function t(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return t.prototype.data=function(t){return ah("DocumentSnapshot.data",arguments,0,1),t=em("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,zh.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},t.prototype.get=function(t,e){if(ah("DocumentSnapshot.get",arguments,1,2),e=em("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(Ly("DocumentSnapshot.get",t));if(void 0!==n)return this.convertValue(n,zh.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Gy(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new zy(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw vh("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))},t.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertValue=function(t,e){if(t instanceof ul)return this.convertObject(t,e);if(t instanceof cl)return this.convertArray(t,e);if(t instanceof sl){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Qc("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Gy(n,this._firestore)}return t.value(e)},t.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},t}(),Xy=function(t){function e(e,n,r,i,o){return t.call(this,e,n,r,i,o)||this}return Je(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return zc("object"==c(n),"Document in a QueryDocumentSnapshot should exist"),n},e}(Yy),Jy=function(){function t(t,e){this._query=t,this.firestore=e}return t.prototype.where=function(e,n,r){var i;oh("Query.where",arguments,3),uh("Query.where","non-empty string",2,n),mh("Query.where",3,r);var o=Ly("Query.where",e),s=bl.fromString(n);if(o.isKeyField()){if(s===bl.ARRAY_CONTAINS)throw new $c(Jc.INVALID_ARGUMENT,"Invalid Query. You can't perform array-contains queries on FieldPath.documentId() since document IDs are not arrays.");if("string"==typeof r){if(-1!==r.indexOf("/"))throw new $c(Jc.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it contains a slash.");if(""===r)throw new $c(Jc.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it was an empty string.");var a=this._query.path.child(new xh([r]));zc(a.length%2==0,"Path should be a document key"),i=new sl(this.firestore._databaseId,new qh(a))}else{if(!(r instanceof Gy))throw new $c(Jc.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a string or a DocumentReference if the first parameter is FieldPath.documentId(), but it was: "+yh(r)+".");var u=r;i=new sl(this.firestore._databaseId,u._key)}}else i=this.firestore._dataConverter.parseQueryValue("Query.where",r);var c=vl.create(o,s,i);return this.validateNewFilter(c),new t(this._query.addFilter(c),this.firestore)},t.prototype.orderBy=function(e,n){var r;if(ah("Query.orderBy",arguments,1,2),ch("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=Tl.ASCENDING;else{if("desc"!==n)throw new $c(Jc.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=Tl.DESCENDING}if(null!==this._query.startAt)throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=Ly("Query.orderBy",e),o=new Il(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore)},t.prototype.limit=function(e){if(oh("Query.limit",arguments,1),uh("Query.limit","number",1,e),e<=0)throw new $c(Jc.INVALID_ARGUMENT,"Invalid Query. Query limit ("+e+") is invalid. Limit must be positive.");return new t(this._query.withLimit(e),this.firestore)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];sh("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];sh("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];sh("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];sh("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw vh("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(mh(t,1,e),e instanceof Yy){if(n.length>0)throw new $c(Jc.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new $c(Jc.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var s=o[i];if(s.field.isKeyField())r.push(new sl(this.firestore._databaseId,e.key));else{var a=e.field(s.field);if(void 0===a){var u=s.field.canonicalString();throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(a)}}return new Sl(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new $c(Jc.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.isKeyField()){if("string"!=typeof s)throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+c(s));if(-1!==s.indexOf("/"))throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. Document ID '"+s+"' contains a slash in "+t+"()");var a=new qh(this._query.path.child(s));i.push(new sl(this.firestore._databaseId,a))}else{var u=this.firestore._dataConverter.parseQueryValue(t,s);i.push(u)}}return new Sl(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ah("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=c(t[i])||gy(t[i])||(gh("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),lh("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),gy(t[i])?n=t[i]:(uh("Query.onSnapshot","function",i,t[i]),ch("Query.onSnapshot","function",i+1,t[i+1]),ch("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new cy({next:function(t){e.next&&e.next(new $y(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),s=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(s)}},t.prototype.get=function(t){var e=this;return ah("Query.get",arguments,0,1),nm("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new $y(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new $c(Jc.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.validateNewFilter=function(t){if(t instanceof _l)if(t.isInequality()){var e=this._query.getInequalityFilterField();if(null!==e&&!e.isEqual(t.field))throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+e.toString()+"' and '"+t.field.toString()+"'");var n=this._query.getFirstOrderByField();null!==n&&this.validateOrderByAndInequalityMatch(t.field,n)}else if(t.op===bl.ARRAY_CONTAINS&&this._query.hasArrayContainsFilter())throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. Queries only support a single array-contains filter.")},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new $c(Jc.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),$y=function(){function t(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new zy(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;ah("QuerySnapshot.forEach",arguments,1,2),uh("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(t.prototype,"query",{get:function(){return new Jy(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(gh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),lh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new $c(Jc.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new Xy(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return zc(e.type===sf.Added,"Invalid event type for first snapshot"),zc(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==sf.Metadata}).map(function(e){var r=new Xy(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,s=-1;return e.type!==sf.Added&&(zc((i=o.indexOf(e.doc.key))>=0,"Index for document not found"),o=o.delete(e.doc.key)),e.type!==sf.Removed&&(s=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case sf.Added:return"added";case sf.Modified:case sf.Metadata:return"modified";case sf.Removed:return"removed";default:return Gc("Unknown change type: "+t)}}(e.type),doc:r,oldIndex:i,newIndex:s}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw vh("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)},t.prototype.convertToDocumentImpl=function(t){return new Xy(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},t}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty($y.prototype.docChanges,t,{get:function(){return function(){throw new $c(Jc.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var Zy=function(t){function e(e,n){var r=t.call(this,gl.atPath(e),n)||this;if(e.length%2!=1)throw new $c(Jc.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return r}return Je(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new Gy(new qh(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(ah("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=wh.newId()),uh("CollectionReference.doc","non-empty string",1,t),""===t)throw new $c(Jc.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=xh.fromString(t);return Gy.forPath(this._query.path.child(e),this.firestore)},e.prototype.add=function(t){oh("CollectionReference.add",arguments,1),uh("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},e}(Jy);function tm(t,e){if(void 0===e)return{merge:!1};if(gh(t,e,["merge","mergeFields"]),lh(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+yh(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new $c(Jc.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+yh(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof hy}),void 0!==e.mergeFields&&void 0!==e.merge)throw new $c(Jc.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function em(t,e){return void 0===e?{}:(gh(t,e,["serverTimestamps"]),fh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function nm(t,e){ch(t,"object",1,e),e&&(gh(t,e,["source"]),fh(t,0,"source",e.source,["default","server","cache"]))}function rm(t,e,n){if(e instanceof Gy){if(e.firestore!==n)throw new $c(Jc.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw vh(t,"DocumentReference",1,e)}var im=Zc(Ky,"Use firebase.firestore() instead."),om=Zc(Qy,"Use firebase.firestore().runTransaction() instead."),sm=Zc(Hy,"Use firebase.firestore().batch() instead."),am=Zc(Gy,"Use firebase.firestore().doc() instead."),um=Zc(Yy),cm=Zc(Xy),hm=Zc(Jy),lm=Zc($y),fm=Zc(Zy,"Use firebase.firestore().collection() instead."),pm={Firestore:im,GeoPoint:kh,Timestamp:Rh,Blob:Ah,Transaction:om,WriteBatch:sm,DocumentReference:am,DocumentSnapshot:um,Query:hm,QueryDocumentSnapshot:cm,QuerySnapshot:lm,CollectionReference:fm,FieldPath:hy,FieldValue:Sy,setLogLevel:Ky.setLogLevel};!function(t){t.INTERNAL.registerService("firestore",function(t){return new Ky(t)},function(t){zc(t&&"object"==c(t),"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(pm))}(Qn);var dm={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ym=function(t){function e(n,r,i){var o=t.call(this,r)||this;return Object.setPrototypeOf(o,e.prototype),o.code=n,o.details=i,o}return Je(e,t),e}(Error),mm=function(){function t(t){this.app=t}return t.prototype.getAuthToken=function(){return Ze(this,void 0,void 0,function(){var t;return tn(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getInstanceIdToken=function(){return Ze(this,void 0,void 0,function(){var t;return tn(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(t=e.sent())?[2,t]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getContext=function(){return Ze(this,void 0,void 0,function(){var t,e;return tn(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}})})},t}();function gm(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var vm=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==c(t))return gm(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null===t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=parseFloat(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==c(t)?gm(t,function(t){return e.decode(t)}):t},t}(),bm=function(){function t(t,e){void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new vm,this.emulatorOrigin=null,this.contextProvider=new mm(t)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+n+"/"+t:"https://"+n+"-"+e+".cloudfunctions.net/"+t},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(t){var e=this;return function(n){return e.call(t,n)}},t.prototype.postJSON=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i;return tn(this,function(o){switch(o.label){case 0:n.append("Content-Type","application/json"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=o.sent(),[3,4];case 3:return o.sent(),[2,{status:0,json:null}];case 4:i=null,o.label=5;case 5:return o.trys.push([5,7,,8]),[4,r.json()];case 6:return i=o.sent(),[3,8];case 7:return o.sent(),[3,8];case 8:return[2,{status:r.status,json:i}]}})})},t.prototype.call=function(t,e){return Ze(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return tn(this,function(c){switch(c.label){case 0:return n=this._url(t),e=this.serializer.encode(e),r={data:e},i=new Headers,[4,this.contextProvider.getContext()];case 1:return(o=c.sent()).authToken&&i.append("Authorization","Bearer "+o.authToken),o.instanceIdToken&&i.append("Firebase-Instance-ID-Token",o.instanceIdToken),[4,this.postJSON(n,r,i)];case 2:if(s=c.sent(),a=function(t,e,n){var r=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var s=e.error;if(s){var a=s.status;if("string"==typeof a){if(!dm[a])return new ym("internal","internal");r=dm[a]}i=a;var u=s.message;"string"==typeof u&&(i=u),void 0!==(o=s.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new ym(r,i,o)}(s.status,s.json,this.serializer))throw a;if(!s.json)throw new ym("internal","Response is not valid JSON object.");if(void 0===(u=s.json.data)&&(u=s.json.result),void 0===u)throw new ym("internal","Response is missing data field.");return[2,{data:this.serializer.decode(u)}]}})})},t}();function _m(t,e,n){return new bm(t,n)}!function(t){var e={Functions:bm};Qn.INTERNAL.registerService("functions",_m,e,void 0,!0)}();var wm,Em,Tm,Sm={AVAILABLE_IN_WINDOW:"only-available-in-window",AVAILABLE_IN_SW:"only-available-in-sw",SHOULD_BE_INHERITED:"should-be-overriden",BAD_SENDER_ID:"bad-sender-id",INCORRECT_GCM_SENDER_ID:"incorrect-gcm-sender-id",PERMISSION_DEFAULT:"permission-default",PERMISSION_BLOCKED:"permission-blocked",UNSUPPORTED_BROWSER:"unsupported-browser",NOTIFICATIONS_BLOCKED:"notifications-blocked",FAILED_DEFAULT_REGISTRATION:"failed-serviceworker-registration",SW_REGISTRATION_EXPECTED:"sw-registration-expected",GET_SUBSCRIPTION_FAILED:"get-subscription-failed",INVALID_SAVED_TOKEN:"invalid-saved-token",SW_REG_REDUNDANT:"sw-reg-redundant",TOKEN_SUBSCRIBE_FAILED:"token-subscribe-failed",TOKEN_SUBSCRIBE_NO_TOKEN:"token-subscribe-no-token",TOKEN_SUBSCRIBE_NO_PUSH_SET:"token-subscribe-no-push-set",TOKEN_UNSUBSCRIBE_FAILED:"token-unsubscribe-failed",TOKEN_UPDATE_FAILED:"token-update-failed",TOKEN_UPDATE_NO_TOKEN:"token-update-no-token",USE_SW_BEFORE_GET_TOKEN:"use-sw-before-get-token",INVALID_DELETE_TOKEN:"invalid-delete-token",DELETE_TOKEN_NOT_FOUND:"delete-token-not-found",DELETE_SCOPE_NOT_FOUND:"delete-scope-not-found",BG_HANDLER_FUNCTION_EXPECTED:"bg-handler-function-expected",NO_WINDOW_CLIENT_TO_MSG:"no-window-client-to-msg",UNABLE_TO_RESUBSCRIBE:"unable-to-resubscribe",NO_FCM_TOKEN_FOR_RESUBSCRIBE:"no-fcm-token-for-resubscribe",FAILED_TO_DELETE_TOKEN:"failed-to-delete-token",NO_SW_IN_REG:"no-sw-in-reg",BAD_SCOPE:"bad-scope",BAD_VAPID_KEY:"bad-vapid-key",BAD_SUBSCRIPTION:"bad-subscription",BAD_TOKEN:"bad-token",BAD_PUSH_SET:"bad-push-set",FAILED_DELETE_VAPID_KEY:"failed-delete-vapid-key",INVALID_PUBLIC_VAPID_KEY:"invalid-public-vapid-key",USE_PUBLIC_KEY_BEFORE_GET_TOKEN:"use-public-key-before-get-token",PUBLIC_KEY_DECRYPTION_FAILED:"public-vapid-key-decryption-failed"},Im=((wm={})[Sm.AVAILABLE_IN_WINDOW]="This method is available in a Window context.",wm[Sm.AVAILABLE_IN_SW]="This method is available in a service worker context.",wm[Sm.SHOULD_BE_INHERITED]="This method should be overriden by extended classes.",wm[Sm.BAD_SENDER_ID]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",wm[Sm.PERMISSION_DEFAULT]="The required permissions were not granted and dismissed instead.",wm[Sm.PERMISSION_BLOCKED]="The required permissions were not granted and blocked instead.",wm[Sm.UNSUPPORTED_BROWSER]="This browser doesn't support the API's required to use the firebase SDK.",wm[Sm.NOTIFICATIONS_BLOCKED]="Notifications have been blocked.",wm[Sm.FAILED_DEFAULT_REGISTRATION]="We are unable to register the default service worker. {$browserErrorMessage}",wm[Sm.SW_REGISTRATION_EXPECTED]="A service worker registration was the expected input.",wm[Sm.GET_SUBSCRIPTION_FAILED]="There was an error when trying to get any existing Push Subscriptions.",wm[Sm.INVALID_SAVED_TOKEN]="Unable to access details of the saved token.",wm[Sm.SW_REG_REDUNDANT]="The service worker being used for push was made redundant.",wm[Sm.TOKEN_SUBSCRIBE_FAILED]="A problem occured while subscribing the user to FCM: {$message}",wm[Sm.TOKEN_SUBSCRIBE_NO_TOKEN]="FCM returned no token when subscribing the user to push.",wm[Sm.TOKEN_SUBSCRIBE_NO_PUSH_SET]="FCM returned an invalid response when getting an FCM token.",wm[Sm.TOKEN_UNSUBSCRIBE_FAILED]="A problem occured while unsubscribing the user from FCM: {$message}",wm[Sm.TOKEN_UPDATE_FAILED]="A problem occured while updating the user from FCM: {$message}",wm[Sm.TOKEN_UPDATE_NO_TOKEN]="FCM returned no token when updating the user to push.",wm[Sm.USE_SW_BEFORE_GET_TOKEN]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",wm[Sm.INVALID_DELETE_TOKEN]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",wm[Sm.DELETE_TOKEN_NOT_FOUND]="The deletion attempt for token could not be performed as the token was not found.",wm[Sm.DELETE_SCOPE_NOT_FOUND]="The deletion attempt for service worker scope could not be performed as the scope was not found.",wm[Sm.BG_HANDLER_FUNCTION_EXPECTED]="The input to setBackgroundMessageHandler() must be a function.",wm[Sm.NO_WINDOW_CLIENT_TO_MSG]="An attempt was made to message a non-existant window client.",wm[Sm.UNABLE_TO_RESUBSCRIBE]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",wm[Sm.NO_FCM_TOKEN_FOR_RESUBSCRIBE]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",wm[Sm.FAILED_TO_DELETE_TOKEN]="Unable to delete the currently saved token.",wm[Sm.NO_SW_IN_REG]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",wm[Sm.INCORRECT_GCM_SENDER_ID]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",wm[Sm.BAD_SCOPE]="The service worker scope must be a string with at least one character.",wm[Sm.BAD_VAPID_KEY]="The public VAPID key is not a Uint8Array with 65 bytes.",wm[Sm.BAD_SUBSCRIPTION]="The subscription must be a valid PushSubscription.",wm[Sm.BAD_TOKEN]="The FCM Token used for storage / lookup was not a valid token string.",wm[Sm.BAD_PUSH_SET]="The FCM push set used for storage / lookup was not not a valid push set string.",wm[Sm.FAILED_DELETE_VAPID_KEY]="The VAPID key could not be deleted.",wm[Sm.INVALID_PUBLIC_VAPID_KEY]="The public VAPID key must be a string.",wm[Sm.PUBLIC_KEY_DECRYPTION_FAILED]="The public VAPID key did not equal 65 bytes when decrypted.",wm),Cm=new mn("messaging","Messaging",Im),Nm=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),Dm="https://fcm.googleapis.com";function Am(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function km(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(null,e))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}!function(t){t.TYPE_OF_MSG="firebase-messaging-msg-type",t.DATA="firebase-messaging-msg-data"}(Em||(Em={})),function(t){t.PUSH_MSG_RECEIVED="push-msg-received",t.NOTIFICATION_CLICKED="notification-clicked"}(Tm||(Tm={}));var Rm=function(){function t(){}return t.prototype.getToken=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h;return tn(this,function(l){switch(l.label){case 0:r=km(e.getKey("p256dh")),i=km(e.getKey("auth")),o="authorized_entity="+t+"&endpoint="+e.endpoint+"&encryption_key="+r+"&encryption_auth="+i,Am(n.buffer,Nm.buffer)||(s=km(n),o+="&application_pub_key="+s),(a=new Headers).append("Content-Type","application/x-www-form-urlencoded"),u={method:"POST",headers:a,body:o},l.label=1;case 1:return l.trys.push([1,4,,5]),[4,fetch(Dm+"/fcm/connect/subscribe",u)];case 2:return[4,l.sent().json()];case 3:return c=l.sent(),[3,5];case 4:throw l.sent(),Cm.create(Sm.TOKEN_SUBSCRIBE_FAILED);case 5:if(c.error)throw h=c.error.message,Cm.create(Sm.TOKEN_SUBSCRIBE_FAILED,{message:h});if(!c.token)throw Cm.create(Sm.TOKEN_SUBSCRIBE_NO_TOKEN);if(!c.pushSet)throw Cm.create(Sm.TOKEN_SUBSCRIBE_NO_PUSH_SET);return[2,{token:c.token,pushSet:c.pushSet}]}})})},t.prototype.updateToken=function(t,e,n,r,i){return Ze(this,void 0,void 0,function(){var o,s,a,u,c,h,l,f;return tn(this,function(p){switch(p.label){case 0:o=km(r.getKey("p256dh")),s=km(r.getKey("auth")),a="push_set="+n+"&token="+e+"&authorized_entity="+t+"&endpoint="+r.endpoint+"&encryption_key="+o+"&encryption_auth="+s,Am(i.buffer,Nm.buffer)||(u=km(i),a+="&application_pub_key="+u),(c=new Headers).append("Content-Type","application/x-www-form-urlencoded"),h={method:"POST",headers:c,body:a},p.label=1;case 1:return p.trys.push([1,4,,5]),[4,fetch(Dm+"/fcm/connect/subscribe",h)];case 2:return[4,p.sent().json()];case 3:return l=p.sent(),[3,5];case 4:throw p.sent(),Cm.create(Sm.TOKEN_UPDATE_FAILED);case 5:if(l.error)throw f=l.error.message,Cm.create(Sm.TOKEN_UPDATE_FAILED,{message:f});if(!l.token)throw Cm.create(Sm.TOKEN_UPDATE_NO_TOKEN);return[2,l.token]}})})},t.prototype.deleteToken=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i,o,s,a;return tn(this,function(u){switch(u.label){case 0:r="authorized_entity="+t+"&token="+e+"&pushSet="+n,(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),o={method:"POST",headers:i,body:r},u.label=1;case 1:return u.trys.push([1,4,,5]),[4,fetch(Dm+"/fcm/connect/unsubscribe",o)];case 2:return[4,u.sent().json()];case 3:if((s=u.sent()).error)throw a=s.error.message,Cm.create(Sm.TOKEN_UNSUBSCRIBE_FAILED,{message:a});return[3,5];case 4:throw u.sent(),Cm.create(Sm.TOKEN_UNSUBSCRIBE_FAILED);case 5:return[2]}})})},t}();function Om(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var Pm="undefined",Lm="fcm_token_object_Store",Mm=function(){function t(){this.dbPromise=null}return t.prototype.get=function(t){return this.createTransaction(function(e){return e.get(t)})},t.prototype.getIndex=function(t,e){return this.createTransaction(function(n){return n.index(t).get(e)})},t.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},t.prototype.delete=function(t){return this.createTransaction(function(e){return e.delete(t)},"readwrite")},t.prototype.closeDatabase=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.createTransaction=function(t,e){return void 0===e&&(e="readonly"),Ze(this,void 0,void 0,function(){var n,r,i,o;return tn(this,function(s){switch(s.label){case 0:return[4,this.getDb()];case 1:return n=s.sent(),r=n.transaction(this.objectStoreName,e),i=r.objectStore(this.objectStoreName),[4,function(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}(t(i))];case 2:return o=s.sent(),[2,new Promise(function(t,e){r.oncomplete=function(){t(o)},r.onerror=function(){e(r.error)}})]}})})},t.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise(function(e,n){var r=indexedDB.open(t.dbName,t.dbVersion);r.onsuccess=function(){e(r.result)},r.onerror=function(){t.dbPromise=null,n(r.error)},r.onupgradeneeded=function(e){return t.onDbUpgrade(r,e)}})),this.dbPromise},t}(),xm=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dbName="fcm_token_details_db",e.dbVersion=3,e.objectStoreName="fcm_token_object_Store",e}return Je(e,t),e.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:!function(){var t=indexedDB.open(Pm);t.onerror=function(t){},t.onsuccess=function(e){!function(t){if(t.objectStoreNames.contains(Lm)){var e=t.transaction(Lm).objectStore(Lm),n=new Rm,r=e.openCursor();r.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},r.onsuccess=function(){var e=r.result;if(e){var i=e.value;n.deleteToken(i.fcmSenderId,i.fcmToken,i.fcmPushSet),e.continue()}else t.close(),indexedDB.deleteDatabase(Pm)}}}(t.result)}}();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=$e({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=Om(e.vapidKey)),"string"==typeof e.auth&&(n.auth=Om(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=Om(e.p256dh).buffer),t.update(n),t.continue()}}}},e.prototype.getTokenDetailsFromToken=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){if(!t)throw Cm.create(Sm.BAD_TOKEN);return Fm({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},e.prototype.getTokenDetailsFromSWScope=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){if(!t)throw Cm.create(Sm.BAD_SCOPE);return Fm({swScope:t}),[2,this.get(t)]})})},e.prototype.saveTokenDetails=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){if(!t.swScope)throw Cm.create(Sm.BAD_SCOPE);if(!t.vapidKey)throw Cm.create(Sm.BAD_VAPID_KEY);if(!t.endpoint||!t.auth||!t.p256dh)throw Cm.create(Sm.BAD_SUBSCRIPTION);if(!t.fcmSenderId)throw Cm.create(Sm.BAD_SENDER_ID);if(!t.fcmToken)throw Cm.create(Sm.BAD_TOKEN);if(!t.fcmPushSet)throw Cm.create(Sm.BAD_PUSH_SET);return Fm(t),[2,this.put(t)]})})},e.prototype.deleteToken=function(t){return Ze(this,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(Cm.create(Sm.INVALID_DELETE_TOKEN))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(e=n.sent()))throw Cm.create(Sm.DELETE_TOKEN_NOT_FOUND);return[4,this.delete(e.swScope)];case 2:return n.sent(),[2,e]}})})},e}(Mm);function Fm(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw Cm.create(Sm.BAD_TOKEN);if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw Cm.create(Sm.BAD_SCOPE);if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw Cm.create(Sm.BAD_VAPID_KEY);if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw Cm.create(Sm.BAD_SUBSCRIPTION);if(t.auth&&!(t.auth instanceof ArrayBuffer))throw Cm.create(Sm.BAD_SUBSCRIPTION);if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw Cm.create(Sm.BAD_SUBSCRIPTION);if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw Cm.create(Sm.BAD_SENDER_ID);if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw Cm.create(Sm.BAD_PUSH_SET)}var Um=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dbName="fcm_vapid_details_db",e.dbVersion=1,e.objectStoreName="fcm_vapid_object_Store",e}return Je(e,t),e.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},e.prototype.getVapidFromSWScope=function(t){return Ze(this,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:if("string"!=typeof t||0===t.length)throw Cm.create(Sm.BAD_SCOPE);return[4,this.get(t)];case 1:return[2,(e=n.sent())?e.vapidKey:void 0]}})})},e.prototype.saveVapidDetails=function(t,e){return Ze(this,void 0,void 0,function(){var n;return tn(this,function(r){if("string"!=typeof t||0===t.length)throw Cm.create(Sm.BAD_SCOPE);if(null===e||65!==e.length)throw Cm.create(Sm.BAD_VAPID_KEY);return n={swScope:t,vapidKey:e},[2,this.put(n)]})})},e.prototype.deleteVapidDetails=function(t){return Ze(this,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(e=n.sent()))throw Cm.create(Sm.DELETE_SCOPE_NOT_FOUND);return[4,this.delete(t)];case 2:return n.sent(),[2,e]}})})},e}(Mm),qm="messagingSenderId",Bm=function(){function t(t){var e=this;if(!t.options[qm]||"string"!=typeof t.options[qm])throw Cm.create(Sm.BAD_SENDER_ID);this.messagingSenderId=t.options[qm],this.tokenDetailsModel=new xm,this.vapidDetailsModel=new Um,this.iidModel=new Rm,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}return t.prototype.getToken=function(){return Ze(this,void 0,void 0,function(){var t,e,n,r,i;return tn(this,function(o){switch(o.label){case 0:if("denied"===(t=this.getNotificationPermission_()))throw Cm.create(Sm.NOTIFICATIONS_BLOCKED);return"granted"!==t?[2,null]:[4,this.getSWRegistration_()];case 1:return e=o.sent(),[4,this.getPublicVapidKey_()];case 2:return n=o.sent(),[4,this.getPushSubscription(e,n)];case 3:return r=o.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(e.scope)];case 4:return(i=o.sent())?[2,this.manageExistingToken(e,r,n,i)]:[2,this.getNewToken(e,r,n)]}})})},t.prototype.manageExistingToken=function(t,e,n,r){return Ze(this,void 0,void 0,function(){return tn(this,function(i){switch(i.label){case 0:return function(t,e,n){if(!n.vapidKey||!Am(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=Am(t.getKey("auth"),n.auth),o=Am(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(e,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,e,n,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return i.sent(),[2,this.getNewToken(t,e,n)]}})})},t.prototype.updateToken=function(t,e,n,r){return Ze(this,void 0,void 0,function(){var i,o,s;return tn(this,function(a){switch(a.label){case 0:return a.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,r.fcmToken,r.fcmPushSet,e,n)];case 1:return i=a.sent(),o={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:i,fcmPushSet:r.fcmPushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return a.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return a.sent(),[2,i];case 4:return s=a.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw a.sent(),s;case 6:return[2]}})})},t.prototype.getNewToken=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i;return tn(this,function(o){switch(o.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,e,n)];case 1:return r=o.sent(),i={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:r.token,fcmPushSet:r.pushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(i)];case 2:return o.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return o.sent(),[2,r.token]}})})},t.prototype.deleteToken=function(t){return Ze(this,void 0,void 0,function(){var e,n;return tn(this,function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(e=r.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}})})},t.prototype.deleteTokenFromDB=function(t){return Ze(this,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:return e=n.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return n.sent(),[2]}})})},t.prototype.getPushSubscription=function(t,e){return t.pushManager.getSubscription().then(function(n){return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})})},t.prototype.requestPermission=function(){throw Cm.create(Sm.AVAILABLE_IN_WINDOW)},t.prototype.useServiceWorker=function(t){throw Cm.create(Sm.AVAILABLE_IN_WINDOW)},t.prototype.usePublicVapidKey=function(t){throw Cm.create(Sm.AVAILABLE_IN_WINDOW)},t.prototype.onMessage=function(t,e,n){throw Cm.create(Sm.AVAILABLE_IN_WINDOW)},t.prototype.onTokenRefresh=function(t,e,n){throw Cm.create(Sm.AVAILABLE_IN_WINDOW)},t.prototype.setBackgroundMessageHandler=function(t){throw Cm.create(Sm.AVAILABLE_IN_SW)},t.prototype.delete=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},t.prototype.getNotificationPermission_=function(){return Notification.permission},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getIidModel=function(){return this.iidModel},t}(),Vm=function(t){function e(e){var n=t.call(this,e)||this;return n.bgMessageHandler=null,self.addEventListener("push",function(t){n.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){n.onSubChange(t)}),self.addEventListener("notificationclick",function(t){n.onNotificationClick(t)}),n}return Je(e,t),e.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},e.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},e.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},e.prototype.onPush_=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i,o,s;return tn(this,function(a){switch(a.label){case 0:if(!t.data)return[2];try{e=t.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return a.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=a.sent(),o=n.actions,s=Notification.maxActions,o&&s&&o.length>s&&console.warn("This browser only supports "+s+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return a.sent(),[2];case 5:return[2]}})})},e.prototype.onSubChange_=function(t){return Ze(this,void 0,void 0,function(){var t,e,n,r;return tn(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw e=i.sent(),Cm.create(Sm.UNABLE_TO_RESUBSCRIBE,{message:e});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return n=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=i.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),n;case 8:return[2]}})})},e.prototype.onNotificationClick_=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i;return tn(this,function(o){switch(o.label){case 0:return t.notification&&t.notification.data&&t.notification.data.FCM_MSG?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(e=t.notification.data.FCM_MSG).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=o.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=o.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=o.sent(),o.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=jm(Tm.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},e.prototype.getNotificationData_=function(t){if(t&&"object"==c(t.notification)){var e,n=$e({},t.notification);return n.data=$e({},t.notification.data,((e={}).FCM_MSG=t,e)),n}},e.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw Cm.create(Sm.BG_HANDLER_FUNCTION_EXPECTED);this.bgMessageHandler=t},e.prototype.getWindowClient_=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i;return tn(this,function(o){switch(o.label){case 0:return e=new URL(t,self.location.href).href,[4,Wm()];case 1:for(n=o.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},e.prototype.attemptToMessageClient_=function(t,e){return Ze(this,void 0,void 0,function(){return tn(this,function(n){if(!t)throw Cm.create(Sm.NO_WINDOW_CLIENT_TO_MSG);return t.postMessage(e),[2]})})},e.prototype.hasVisibleClients_=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return[4,Wm()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState})]}})})},e.prototype.sendMessageToWindowClients_=function(t){return Ze(this,void 0,void 0,function(){var e,n,r=this;return tn(this,function(i){switch(i.label){case 0:return[4,Wm()];case 1:return e=i.sent(),n=jm(Tm.PUSH_MSG_RECEIVED,t),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return i.sent(),[2]}})})},e.prototype.getSWRegistration_=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return[2,self.registration]})})},e.prototype.getPublicVapidKey_=function(){return Ze(this,void 0,void 0,function(){var t,e;return tn(this,function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=n.sent()))throw Cm.create(Sm.SW_REGISTRATION_EXPECTED);return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(e=n.sent())?[2,Nm]:[2,e]}})})},e}(Bm);function Wm(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function jm(t,e){return(n={})[Em.TYPE_OF_MSG]=t,n[Em.DATA]=e,n;var n}var Km=function(t){function e(e){var n=t.call(this,e)||this;return n.registrationToUse=null,n.publicVapidKeyToUse=null,n.manifestCheckPromise=null,n.messageObserver=null,n.tokenRefreshObserver=null,n.onMessageInternal=kn(function(t){n.messageObserver=t}),n.onTokenRefreshInternal=kn(function(t){n.tokenRefreshObserver=t}),n.setupSWMessageListener_(),n}return Je(e,t),e.prototype.getToken=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(e){switch(e.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return Ze(this,void 0,void 0,function(){var t,e;return tn(this,function(n){switch(n.label){case 0:if(!(t=document.querySelector('link[rel="manifest"]')))return[2];n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch(t.href)];case 2:return[4,n.sent().json()];case 3:return e=n.sent(),[3,5];case 4:return n.sent(),[2];case 5:if(!e||!e.gcm_sender_id)return[2];if("103953800507"!==e.gcm_sender_id)throw Cm.create(Sm.INCORRECT_GCM_SENDER_ID);return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return e.sent(),[2,t.prototype.getToken.call(this)]}})})},e.prototype.requestPermission=function(){return Ze(this,void 0,void 0,function(){var t;return tn(this,function(e){switch(e.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?Cm.create(Sm.PERMISSION_BLOCKED):Cm.create(Sm.PERMISSION_DEFAULT)}})})},e.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw Cm.create(Sm.SW_REGISTRATION_EXPECTED);if(null!=this.registrationToUse)throw Cm.create(Sm.USE_SW_BEFORE_GET_TOKEN);this.registrationToUse=t},e.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw Cm.create(Sm.INVALID_PUBLIC_VAPID_KEY);if(null!=this.publicVapidKeyToUse)throw Cm.create(Sm.USE_PUBLIC_KEY_BEFORE_GET_TOKEN);var e=Om(t);if(65!==e.length)throw Cm.create(Sm.PUBLIC_KEY_DECRYPTION_FAILED);this.publicVapidKeyToUse=e},e.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},e.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},e.prototype.waitForRegistrationToActivate_=function(t){var e=t.installing||t.waiting||t.active;return new Promise(function(n,r){if(e)if("activated"!==e.state)if("redundant"!==e.state){e.addEventListener("statechange",function i(){if("activated"===e.state)n(t);else{if("redundant"!==e.state)return;r(Cm.create(Sm.SW_REG_REDUNDANT))}e.removeEventListener("statechange",i)})}else r(Cm.create(Sm.SW_REG_REDUNDANT));else n(t);else r(Cm.create(Sm.NO_SW_IN_REG))})},e.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw Cm.create(Sm.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:t.message})}).then(function(e){return t.waitForRegistrationToActivate_(e).then(function(){return t.registrationToUse=e,e.update(),e})}))},e.prototype.getPublicVapidKey_=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,Nm]})})},e.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data[Em.TYPE_OF_MSG]){var n=e.data;switch(n[Em.TYPE_OF_MSG]){case Tm.PUSH_MSG_RECEIVED:case Tm.NOTIFICATION_CLICKED:var r=n[Em.DATA];t.messageObserver&&t.messageObserver.next(r)}}},!1)},e}(Bm);function Qm(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}!function(t){var e={isSupported:Qm};Qn.INTERNAL.registerService("messaging",function(t){if(!Qm())throw Cm.create(Sm.UNSUPPORTED_BROWSER);return self&&"ServiceWorkerGlobalScope"in self?new Vm(t):new Km(t)},e)}();var Hm="https://firebasestorage.googleapis.com",Gm="https://firebasestorage.googleapis.com",zm="/v0",Ym="/v0",Xm=12e4,Jm=6e4,$m=-9007199254740991,Zm=function(){function t(t,e){this.code_=eg(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return eg(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),tg={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function eg(t){return"storage/"+t}function ng(){return new Zm(tg.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function rg(){return new Zm(tg.CANCELED,"User canceled the upload/download.")}function ig(){return new Zm(tg.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function og(t,e,n){return new Zm(tg.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function sg(){return new Zm(tg.APP_DELETED,"The Firebase app was deleted.")}function ag(t,e){return new Zm(tg.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function ug(t){throw new Zm(tg.INTERNAL_ERROR,"Internal error: "+t)}var cg={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function hg(t){switch(t){case cg.RAW:case cg.BASE64:case cg.BASE64URL:case cg.DATA_URL:return;default:throw"Expected one of the event types: ["+cg.RAW+", "+cg.BASE64+", "+cg.BASE64URL+", "+cg.DATA_URL+"]."}}var lg=function(t,e){this.data=t,this.contentType=e||null};function fg(t,e){switch(t){case cg.RAW:return new lg(pg(e));case cg.BASE64:case cg.BASE64URL:return new lg(dg(t,e));case cg.DATA_URL:return new lg(function(t){var e=new mg(t);return e.base64?dg(cg.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw ag(cg.DATA_URL,"Malformed data URL.")}return pg(e)}(e.rest)}(e),new mg(e).contentType)}throw ng()}function pg(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);r<=127?e.push(r):r<=2047?e.push(192|r>>6,128|63&r):55296==(64512&r)?n<t.length-1&&56320==(64512&t.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):e.push(239,191,189):56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function dg(t,e){switch(t){case cg.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw ag(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case cg.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw ag(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var s;try{s=atob(e)}catch(e){throw ag(t,"Invalid character found")}for(var a=new Uint8Array(s.length),u=0;u<s.length;u++)a[u]=s.charCodeAt(u);return a}var yg,mg=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw ag(cg.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r,i=e[1]||null;null!=i&&(this.base64=(r=";base64",(n=i).length>=r.length&&n.substring(n.length-r.length)===r),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=t.substring(t.indexOf(",")+1)},gg={STATE_CHANGED:"state_changed"},vg={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},bg={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function _g(t){switch(t){case vg.RUNNING:case vg.PAUSING:case vg.CANCELING:return bg.RUNNING;case vg.PAUSED:return bg.PAUSED;case vg.SUCCESS:return bg.SUCCESS;case vg.CANCELED:return bg.CANCELED;case vg.ERROR:default:return bg.ERROR}}function wg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Eg(t,e){for(var n in t)wg(t,n)&&e(n,t[n])}function Tg(t){if(null==t)return{};var e={};return Eg(t,function(t,n){e[t]=n}),e}function Sg(t){return new Promise(t)}function Ig(t){return Promise.resolve(t)}function Cg(t){return null!=t}function Ng(t){return void 0!==t}function Dg(t){return"function"==typeof t}function Ag(t){return"object"==c(t)}function kg(t){return Ag(t)&&null!==t}function Rg(t){return"string"==typeof t||t instanceof String}function Og(t){return Pg()&&t instanceof Blob}function Pg(){return"undefined"!=typeof Blob}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(yg||(yg={}));var Lg=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=yg.NO_ERROR,this.sendPromise_=Sg(function(e,n){t.xhr_.addEventListener("abort",function(n){t.errorCode_=yg.ABORT,e(t)}),t.xhr_.addEventListener("error",function(n){t.errorCode_=yg.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(n){e(t)})})}return t.prototype.send=function(t,e,n,r){var i=this;if(this.sent_)throw ug("cannot .send() more than once");return this.sent_=!0,this.xhr_.open(e,t,!0),Cg(r)&&Eg(r,function(t,e){i.xhr_.setRequestHeader(t,e.toString())}),Cg(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw ug("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw ug("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw ug("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){Cg(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){Cg(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),Mg=function(){function t(){}return t.prototype.createXhrIo=function(){return new Lg},t}();function xg(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return Ag(n=e)&&!Array.isArray(n)?e:null}var Fg=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n,r;try{n=t.makeFromUrl(e)}catch(n){return new t(e,"")}if(""===n.path)return n;throw r=e,new Zm(tg.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")},t.makeFromUrl=function(e){for(var n=null,r=[{regex:new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i"),indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://firebasestorage\\.googleapis\\.com/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],i=0;i<r.length;i++){var o=r[i],s=o.regex.exec(e);if(s){var a=s[o.indices.bucket],u=s[o.indices.path];u||(u=""),n=new t(a,u),o.postModify(n);break}}if(null==n)throw function(t){return new Zm(tg.INVALID_URL,"Invalid URL '"+t+"'.")}(e);return n},t}();function Ug(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function qg(t){return Hm+zm+t}function Bg(t){return Hm+Ym+t}function Vg(t){var e=encodeURIComponent,n="?";return Eg(t,function(t,r){var i=e(t)+"="+e(r);n=n+i+"&"}),n=n.slice(0,-1)}function Wg(t,e){return e}var jg=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||Wg},Kg=null;function Qg(t,e,n){var r=xg(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var s=n[o];r[s.local]=s.xform(r,e[s.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new Fg(n,r);return e.makeStorageReference(i)}})}(r,t),r}(t,r,n)}function Hg(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function Gg(t){if(!t||!Ag(t))throw"Expected Metadata object.";for(var e in t){var n=t[e];if("customMetadata"===e){if(!Ag(n))throw"Expected object for 'customMetadata' mapping."}else if(kg(n))throw"Mapping for '"+e+"' cannot be an object."}}function zg(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}var s,a,u,c,h,l;if(!(r<=n.length&&n.length<=i))throw s=r,a=i,u=t,c=n.length,s===a?(h=s,l=1===s?"argument":"arguments"):(h="between "+s+" and "+a,l="arguments"),new Zm(tg.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+u+"`: Expected "+h+" "+l+", received "+c+".");for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?og(o,t,e.message):og(o,t,e)}}var Yg=function(t,e){var n=this;this.validator=function(e){n.optional&&!Ng(e)||t(e)},this.optional=!!e};function Xg(t,e){function n(t){if(!Rg(t))throw"Expected string."}var r,i,o;return t?(i=n,o=t,r=function(t){i(t),o(t)}):r=n,new Yg(r,e)}function Jg(t){return new Yg(Gg,t)}function $g(){return new Yg(function(t){if(!(function(t){return"number"==typeof t||t instanceof Number}(t)&&t>=0))throw"Expected a number 0 or greater."})}function Zg(t,e){return new Yg(function(e){if(!(null===e||Cg(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)},e)}function tv(t){return new Yg(function(t){if(null!==t&&!Dg(t))throw"Expected a Function."},t)}var ev=function(){function t(t,e){var n=0,r="";Og(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(Og(this.data_)){var r=(o=e,s=n,(i=this.data_).webkitSlice?i.webkitSlice(o,s):i.mozSlice?i.mozSlice(o,s):i.slice?i.slice(o,s):null);return null===r?null:new t(r)}var i,o,s;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(Pg()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Pg())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}.apply(null,r))}var i=e.map(function(t){return Rg(t)?fg(cg.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var s=new Uint8Array(o),a=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)s[a++]=t[e]}),new t(s,!0)},t.prototype.uploadData=function(){return this.data_},t}();function nv(t,e){return-1!==t.indexOf(e)}var rv=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function iv(t){if(!t)throw ng()}function ov(t,e){return function(n,r){var i=Qg(t,r,e);return iv(null!==i),i}}function sv(t){return function(e,n){var r,i,o;return 401===e.getStatus()?r=new Zm(tg.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(o=t.bucket,r=new Zm(tg.QUOTA_EXCEEDED,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,r=new Zm(tg.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.setServerResponseProp(n.serverResponseProp()),r}}function av(t){var e=sv(t);return function(n,r){var i,o=e(n,r);return 404===n.getStatus()&&(i=t.path,o=new Zm(tg.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),o.setServerResponseProp(r.serverResponseProp()),o}}function uv(t,e,n){var r=qg(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new rv(r,"GET",ov(t,n),i);return o.errorHandler=av(e),o}function cv(t,e,n){var r=qg(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new rv(r,"GET",function(t,e){return function(n,r){var i=Qg(t,r,e);return iv(null!==i),function(t,e){var n=xg(e);if(null===n)return null;if(!Rg(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map(function(e){var n=t.bucket,r=t.fullPath;return function(t){return Gm+zm+t}("/b/"+i(n)+"/o/"+i(r))+Vg({alt:"media",token:e})})[0]}(i,r)}}(t,n),i);return o.errorHandler=av(e),o}function hv(t,e,n){var r=Tg(n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var lv=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function fv(t,e){var n;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){iv(!1)}return iv(nv(e||["active"],n)),n}var pv=function(t,e,n){if(Dg(t)||Cg(e)||Cg(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},dv=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function yv(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Ig(!0).then(function(){t.apply(null,e)})}}var mv=function(){function t(t,e,n,r,i,o){void 0===o&&(o=null);var s=this;this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=vg.RUNNING,this.errorHandler_=function(t){s.request_=null,s.chunkMultiplier_=1,t.codeEquals(tg.CANCELED)?(s.needToFetchStatus_=!0,s.completeTransitions_()):(s.error_=t,s.transition_(vg.ERROR))},this.metadataErrorHandler_=function(t){s.request_=null,t.codeEquals(tg.CANCELED)?s.completeTransitions_():(s.error_=t,s.transition_(vg.ERROR))},this.promise_=Sg(function(t,e){s.resolve_=t,s.reject_=e,s.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n,r){t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return t.size()>262144},t.prototype.start_=function(){this.state_===vg.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then(function(n){switch(e.state_){case vg.RUNNING:t(n);break;case vg.CANCELING:e.transition_(vg.CANCELED);break;case vg.PAUSING:e.transition_(vg.PAUSED)}})},t.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s=hv(e,r,i),a={name:s.fullPath},u=Bg(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},h=Hg(s,n),l=t.maxUploadRetryTime(),f=new rv(u,"POST",function(t,e){var n;fv(t);try{n=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){iv(!1)}return iv(Rg(n)),n},l);return f.urlParams=a,f.headers=c,f.body=h,f.errorHandler=sv(e),f}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new rv(n,"POST",function(t,e){var n,i=fv(t,["active","final"]);try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){iv(!1)}var o=parseInt(n,10);return iv(!isNaN(o)),new lv(o,r.size(),"final"===i)},i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=sv(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);t.request_=i,i.getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new lv(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var o;try{o=function(t,e,n,r,i,o,s,a){var u=new lv(0,0);if(s?(u.current=s.current,u.total=s.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new Zm(tg.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;i>0&&(h=Math.min(h,i));var l=u.current,f=l+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(l,f);if(null===d)throw ig();var y=e.maxUploadRetryTime(),m=new rv(n,"POST",function(t,n){var i,s=fv(t,["active","final"]),a=u.current+h,c=r.size();return i="final"===s?ov(e,o)(t,n):null,new lv(a,c,"final"===s,i)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=a||null,m.errorHandler=sv(t),m}(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(e){return t.error_=e,void t.transition_(vg.ERROR)}var s=t.authWrapper_.makeRequest(o,i);t.request_=s,s.getPromise().then(function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(vg.SUCCESS)):t.completeTransitions_()},t.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_(function(e){var n=uv(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.transition_(vg.SUCCESS)},t.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();s["Content-Type"]="multipart/related; boundary="+a;var u=hv(e,r,i),c="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Hg(u,n)+"\r\n--"+a+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+a+"--",l=ev.getBlob(c,r,h);if(null===l)throw ig();var f={name:u.fullPath},p=Bg(o),d=t.maxUploadRetryTime(),y=new rv(p,"POST",ov(t,n),d);return y.urlParams=f,y.headers=s,y.body=l.uploadData(),y.errorHandler=sv(e),y}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(vg.SUCCESS)},t.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case vg.CANCELING:case vg.PAUSING:this.state_=t,null!==this.request_&&this.request_.cancel();break;case vg.RUNNING:var e=this.state_===vg.PAUSED;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case vg.PAUSED:this.state_=t,this.notifyObservers_();break;case vg.CANCELED:this.error_=rg(),this.state_=t,this.notifyObservers_();break;case vg.ERROR:case vg.SUCCESS:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case vg.PAUSING:this.transition_(vg.PAUSED);break;case vg.CANCELING:this.transition_(vg.CANCELED);break;case vg.RUNNING:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=_g(this.state_);return new dv(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,r){void 0===e&&(e=void 0),void 0===n&&(n=void 0),void 0===r&&(r=void 0);var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=tv(!0).validator,s=Zg(null,!0).validator;function a(t){try{return void o(t)}catch(t){}try{if(s(t),!(Ng(t.next)||Ng(t.error)||Ng(t.complete)))throw"";return}catch(t){throw i}}zg("on",[Xg(function(e){if(t!==gg.STATE_CHANGED)throw"Expected one of the event types: ["+gg.STATE_CHANGED+"]."}),Zg(a,!0),tv(!0),tv(!0)],arguments);var u=this;function c(t){return function(e,n,i){null!==t&&zg("on",t,arguments);var o=new pv(e,n,r);return u.addObserver_(o),function(){u.removeObserver_(o)}}}var h=[Zg(function(t){if(null===t)throw i;a(t)}),tv(!0),tv(!0)];return Ng(e)||Ng(n)||Ng(r)?c(null)(e,n,r):c(h)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e,n,r;n=t,-1!==(r=(e=this.observers_).indexOf(n))&&e.splice(r,1)},t.prototype.notifyObservers_=function(){var t,e=this;this.finishPromise_(),(t=this.observers_,Array.prototype.slice.call(t)).forEach(function(t){e.notifyObserver_(t)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(_g(this.state_)){case bg.SUCCESS:yv(this.resolve_.bind(null,this.snapshot))();break;case bg.CANCELED:case bg.ERROR:yv(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(_g(this.state_)){case bg.RUNNING:case bg.PAUSED:null!==t.next&&yv(t.next.bind(t,this.snapshot))();break;case bg.SUCCESS:null!==t.complete&&yv(t.complete.bind(t))();break;case bg.CANCELED:case bg.ERROR:null!==t.error&&yv(t.error.bind(t,this.error_))();break;default:null!==t.error&&yv(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){zg("resume",[],arguments);var t=this.state_===vg.PAUSED||this.state_===vg.PAUSING;return t&&this.transition_(vg.RUNNING),t},t.prototype.pause=function(){zg("pause",[],arguments);var t=this.state_===vg.RUNNING;return t&&this.transition_(vg.PAUSING),t},t.prototype.cancel=function(){zg("cancel",[],arguments);var t=this.state_===vg.RUNNING||this.state_===vg.PAUSING;return t&&this.transition_(vg.CANCELING),t},t}(),gv=function(){function t(t,e){this.authWrapper=t,this.location=e instanceof Fg?e:Fg.makeFromUrl(e)}return t.prototype.toString=function(){return zg("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return function(){if(Kg)return Kg;var t=[];t.push(new jg("bucket")),t.push(new jg("generation")),t.push(new jg("metageneration")),t.push(new jg("name","fullPath",!0));var e=new jg("name");e.xform=function(t,e){return function(t){return!Rg(t)||t.length<2?t:Ug(t=t)}(e)},t.push(e);var n=new jg("size");return n.xform=function(t,e){return Cg(e)?+e:e},t.push(n),t.push(new jg("timeCreated")),t.push(new jg("updated")),t.push(new jg("md5Hash",null,!0)),t.push(new jg("cacheControl",null,!0)),t.push(new jg("contentDisposition",null,!0)),t.push(new jg("contentEncoding",null,!0)),t.push(new jg("contentLanguage",null,!0)),t.push(new jg("contentType",null,!0)),t.push(new jg("metadata","customMetadata",!0)),Kg=t}()},t.prototype.child=function(t){zg("child",[Xg()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new Fg(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0==t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new Fg(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new Fg(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return Ug(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),zg("put",[new Yg(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Pg()&&t instanceof Blob))throw"Expected Blob or File."}),Jg(!0)],arguments),this.throwIfRoot_("put"),new mv(this,this.authWrapper,this.location,this.mappings(),new ev(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=cg.RAW),zg("putString",[Xg(),Xg(hg,!0),Jg(!0)],arguments),this.throwIfRoot_("putString");var r=fg(e,t),i=Tg(n);return!Cg(i.contentType)&&Cg(r.contentType)&&(i.contentType=r.contentType),new mv(this,this.authWrapper,this.location,this.mappings(),new ev(r.data,!0),i)},t.prototype.delete=function(){zg("delete",[],arguments),this.throwIfRoot_("delete");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=function(t,e){var n=qg(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new rv(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=av(e),i}(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.getMetadata=function(){zg("getMetadata",[],arguments),this.throwIfRoot_("getMetadata");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=uv(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.updateMetadata=function(t){zg("updateMetadata",[Jg()],arguments),this.throwIfRoot_("updateMetadata");var e=this;return this.authWrapper.getAuthToken().then(function(n){var r=function(t,e,n,r){var i=qg(e.fullServerUrl()),o=Hg(n,r),s=t.maxOperationRetryTime(),a=new rv(i,"PATCH",ov(t,r),s);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=o,a.errorHandler=av(e),a}(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()})},t.prototype.getDownloadURL=function(){zg("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=cv(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then(function(t){if(null===t)throw new Zm(tg.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new Zm(tg.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},t}(),vv=function(){function t(t){this.promise_=function(t){return Promise.reject(t)}(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){void 0===t&&(t=!1)},t}(),bv=function(){function t(){this.map_={},this.id_=$m}return t.prototype.addRequest=function(t){var e=this.id_;this.id_++,this.map_[e]=t;var n=this;function r(){delete n.map_[e]}t.getPromise().then(r,r)},t.prototype.clear=function(){Eg(this.map_,function(t,e){e&&e.cancel(!0)}),this.map_={}},t}(),_v=function(){function t(e,n,r,i,o){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var s=this.app_.options;Cg(s)&&(this.bucket_=t.extractBucket_(s))}this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=o,this.service_=i,this.maxOperationRetryTime_=Xm,this.maxUploadRetryTime_=Jm,this.requestMap_=new bv}return t.extractBucket_=function(t){var e=t.storageBucket||null;return null==e?null:Fg.makeFromBucketSpec(e).bucket},t.prototype.getAuthToken=function(){return null!==this.app_&&Cg(this.app_.INTERNAL)&&Cg(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(t){return null}):Ig(null)},t.prototype.bucket=function(){if(this.deleted_)throw sg();return this.bucket_},t.prototype.service=function(){return this.service_},t.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},t.prototype.makeRequest=function(t,e){if(this.deleted_)return new vv(sg());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},t.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},t.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},t.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},t.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},t}(),wv=function(){function t(t,e,n,r,i,o,s,a,u,c,h){this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=s,this.errorCallback_=a,this.progressCallback_=c,this.timeout_=u,this.pool_=h;var l=this;this.promise_=Sg(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,s=n.xhr;if(n.wasSuccessCode)try{var a=t.callback_(s,s.getResponseText());Ng(a)?i(a):i()}catch(t){o(t)}else null!==s?((r=ng()).setServerResponseProp(s.getResponseText()),t.errorCallback_?o(t.errorCallback_(s,r)):o(r)):n.canceled?o(r=t.appDelete_?sg():rg()):o(r=new Zm(tg.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new Ev(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,s=0;function a(){return 2===s}var u=!1;function c(){u||(u=!0,e.apply(null,arguments))}function h(e){i=setTimeout(function(){i=null,t(l,a())},e)}function l(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];u||(t?c.apply(null,arguments):a()||o?c.apply(null,arguments):(r<64&&(r*=2),1===s?(s=2,e=0):e=1e3*(r+Math.random()),h(e)))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(s=2),clearTimeout(i),h(0)):t||(s=1)))}return h(0),setTimeout(function(){o=!0,p(!0)},n),p}(function(e,n){if(n)e(!1,new Ev(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===yg.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var s=nv(t.successCodes_,o);e(!0,new Ev(s,n))}else{var a=n.getErrorCode()===yg.ABORT;e(!1,new Ev(!1,null,a))}})}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}},e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=nv([408,429],t),r=nv(this.additionalRetryCodes_,t);return e||n||r},t}(),Ev=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function Tv(t,e,n){var r=Vg(t.urlParams),i=t.url+r,o=Tg(t.headers);return function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==Qn?Qn.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new wv(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var Sv=function(){function t(t,e,n){if(this.bucket_=null,this.authWrapper_=new _v(t,function(t,e){return new gv(t,e)},Tv,this,e),this.app_=t,null!=n)this.bucket_=Fg.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new Fg(r,""))}this.internals_=new Iv(this)}return t.prototype.ref=function(t){if(zg("ref",[Xg(function(t){if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new gv(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},t.prototype.refFromURL=function(t){return zg("refFromURL",[Xg(function(t){if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{Fg.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new gv(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){zg("setMaxUploadRetryTime",[$g()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this.authWrapper_.maxOperationRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxOperationRetryTime=function(t){zg("setMaxOperationRetryTime",[$g()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),Iv=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Ig(void 0)},t}();function Cv(t,e,n){return new Sv(t,new Mg,n)}return function(t){var e={TaskState:bg,TaskEvent:gg,StringFormat:cg,Storage:Sv,Reference:gv};Qn.INTERNAL.registerService("storage",Cv,e,void 0,!0)}(),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Qn},"object"==c(e)&&void 0!==t?t.exports=u():void 0===(a="function"==typeof(s=u)?s.call(e,n,e,t):s)||(t.exports=a)}).call(this,n(12).setImmediate,n(0),n(3))},function(t,e,n){var r=n(6);"string"==typeof r&&(r=[[t.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(10)(r,i);r.locals&&(t.exports=r.locals)},function(t,e,n){var r=n(7);(t.exports=n(8)(!1)).push([t.i,"/*\n0 - 600px:      Phone\n600 - 900px:    Tablet portrait\n900 - 1200px:   Tablet landscape\n[1200 - 1800] is where our normal styles apply\n1800px + :      Big desktop\n\n$breakpoint arguement choices:\n- phone\n- tab-port\n- tab-land\n- big-desktop\n\nORDER: Base + typography > general layout + grid > page layout > components\n\n1em = 16px\n*/\n*,\n*::after,\n*::before {\n  margin: 0;\n  padding: 0;\n  box-sizing: inherit; }\n\nhtml {\n  font-size: 62.5%; }\n  @media only screen and (max-width: 75em) {\n    html {\n      font-size: 56.25%; } }\n  @media only screen and (max-width: 56.25em) {\n    html {\n      font-size: 50%; } }\n  @media only screen and (min-width: 112.5em) {\n    html {\n      font-size: 75%; } }\n\nbody {\n  box-sizing: border-box;\n  padding: 0;\n  background-color: #FBFBFF; }\n  @media only screen and (max-width: 56.25em) {\n    body {\n      padding: 0; } }\n\n::selection {\n  background-color: #1b9443;\n  color: #fff; }\n\n::-webkit-scrollbar {\n  width: 0px;\n  background: transparent;\n  /* make scrollbar transparent */ }\n\n@keyframes from-transparent-black {\n  0% {\n    opacity: 0; }\n  100% {\n    opacity: 1; } }\n\n@keyframes from-transparent-blur-down {\n  0% {\n    opacity: 0;\n    filter: blur(5px);\n    transform: translateY(2rem); }\n  100% {\n    opacity: 1;\n    filter: blur(0);\n    transform: translateY(0); } }\n\nhtml {\n  overflow-y: hidden; }\n\n.scroll-track {\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 0%;\n  height: .5rem;\n  background-image: linear-gradient(to right, #20BF55 0%, #0e5325 10%);\n  opacity: 1;\n  transition: all 0.5s ease; }\n\n.outer-header {\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 100vh;\n  background-image: linear-gradient(to top right, #083b52, #0d6185);\n  perspective: 100rem;\n  z-index: 100;\n  -webkit-touch-callout: none;\n  /* iOS Safari */\n  -webkit-user-select: none;\n  /* Safari */\n  -moz-user-select: none;\n  /* Firefox */\n  -khtml-user-select: none;\n  /* Konqueror HTML */\n  -ms-user-select: none;\n  /* Internet Explorer/Edge */\n  user-select: none;\n  /* Non-prefixed version, currently supported by Chrome and Opera */ }\n\n.heading-primary {\n  top: 55% !important;\n  width: 100rem;\n  max-width: 90%;\n  color: #01BAEF;\n  font-size: 7.5rem;\n  font-family: 'Lobster', cursive;\n  position: absolute;\n  perspective: 50rem;\n  top: 100%;\n  filter: blur(40px);\n  opacity: 0;\n  left: 50%;\n  transform: translate(-50%, 50%) translateZ(150rem);\n  text-align: center;\n  transition: all 1s cubic-bezier(0, 0, 0, 1.04);\n  text-shadow: 10px 10px 10px #00000069; }\n\n.heading-primary-shown {\n  opacity: 1 !important;\n  top: 40% !important;\n  filter: blur(0px) !important;\n  transform: translate(-50%, -50%) translateZ(0) !important; }\n\n.heading-primary__inner {\n  transform-origin: -100rem;\n  transform: rotateX(90deg);\n  transition: all 1s cubic-bezier(0.52, 0.01, 0.64, 0.73); }\n\n.heading-primary-shown__inner {\n  transform: rotateX(0); }\n\n.heading-secondary {\n  position: absolute;\n  top: 30%;\n  left: 50%;\n  transform: translate(-50%, 50%);\n  transition: all 1.5s; }\n  @media only screen and (max-height: 37.5em) {\n    .heading-secondary {\n      top: 20%; } }\n  .heading-secondary__letter {\n    transform: translateY(-50vh);\n    transition: all 0.75s cubic-bezier(0.53, 1.49, 0.49, 0.89);\n    display: inline-block;\n    min-width: 1rem;\n    opacity: 0; }\n  .heading-secondary__letter-show {\n    transform: translateY(-50%);\n    opacity: 1; }\n  .heading-secondary__letter-inner {\n    font-size: 3rem;\n    color: #dadada;\n    font-family: 'Lobster', cursive;\n    text-shadow: 10px 10px 10px #00000069; }\n\n.arrow-down {\n  font-size: 70px;\n  color: #ffffff7d;\n  display: block;\n  position: absolute;\n  bottom: 1rem;\n  right: 50%;\n  transition: 0.3s;\n  transform: translateX(50%);\n  transform-origin: center;\n  z-index: -1; }\n\n.blinds-container {\n  height: 100%;\n  width: 100%;\n  display: block; }\n\n.blind-unit {\n  background-color: #162329;\n  animation-name: from-transparent-black;\n  animation-duration: .3s;\n  animation-timing-function: cubic-bezier(0, 0, 0.56, 0.99);\n  transition: all .25s ease-out;\n  position: absolute;\n  top: 0;\n  right: 0;\n  height: 100%;\n  width: 100%; }\n\n.blind-unit-outer {\n  display: inline-block;\n  height: 100%;\n  width: 5%;\n  position: relative; }\n\n.heading-background {\n  background-image: linear-gradient(to right bottom, rgba(8, 59, 82, 0.8), rgba(5, 35, 48, 0.8)), url("+r(n(1))+");\n  background-size: cover;\n  height: 90vh;\n  background-size: cover;\n  height: 75vh;\n  box-shadow: 0 0px 3px 3px #00000047; }\n\n.centerize-x {\n  transform: translateX(-50%);\n  position: absolute;\n  top: 54%;\n  left: 50%; }\n\n.heading-tertiary {\n  font-size: 2rem;\n  font-family: 'Assistant', sans-serif;\n  color: white;\n  display: none;\n  transition: all .5s;\n  direction: rtl;\n  text-align: center;\n  text-shadow: 10px 10px 10px #00000069;\n  animation: from-transparent-blur-down 0.5s cubic-bezier(0, 0.36, 0.26, 1.04); }\n\n.about-section {\n  display: block;\n  height: 68rem;\n  width: 100%;\n  position: relative; }\n\n.about-container {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 80%;\n  background-color: white;\n  padding: 5rem;\n  display: none; }\n\n.about-img {\n  float: left;\n  background-image: url("+r(n(2))+");\n  height: 42rem;\n  width: 50rem;\n  background-size: contain;\n  background-repeat: no-repeat; }\n\n.about-text {\n  direction: rtl;\n  font-size: 2.6rem;\n  float: right;\n  text-align: right;\n  width: 50%;\n  font-family: 'Assistant', sans-serif;\n  color: grey;\n  padding: 9% 0; }\n\n.i-about-container {\n  display: block;\n  font-size: 5rem;\n  position: absolute;\n  color: #02baef;\n  left: 50%;\n  top: -2.5rem;\n  transform: translateX(-50%); }\n\n.capabilities-section {\n  background-attachment: fixed;\n  background-size: cover;\n  background-image: linear-gradient(rgba(8, 59, 82, 0.75), rgba(5, 35, 48, 0.75)), url("+r(n(9))+"); }\n\n.capabilities-container {\n  position: relative; }\n\n.i-capabilities-container {\n  display: block;\n  font-size: 3rem;\n  height: 5rem;\n  width: 5rem;\n  position: absolute;\n  color: white;\n  background-color: #20BF55;\n  left: 50%;\n  top: -2.5rem;\n  transform: translateX(-50%);\n  border-radius: 50%; }\n\n.fa-chart-bar {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%); }\n\n.ca-progress-container {\n  height: 45rem;\n  padding: 5rem 25rem; }\n\n.ca-progress-unit {\n  font-family: 'Assistant', sans-serif;\n  font-size: 1.8rem;\n  line-height: 4.3rem;\n  color: white;\n  position: relative; }\n\n.ca-progress-unit::before {\n  height: 2rem;\n  width: 80rem;\n  background-color: white;\n  content: '';\n  top: 1rem;\n  left: 20rem;\n  position: absolute;\n  border-radius: 1rem; }\n\n.ca-progress-unit::after {\n  height: 2rem;\n  width: 10rem;\n  background-color: #0096c0;\n  content: '';\n  top: 1rem;\n  left: 20rem;\n  position: absolute;\n  border-radius: 1rem; }\n\n.u-showup {\n  animation: from-transparent-blur-down .5s ease-out; }\n\n.u-showup-onscroll {\n  animation: from-transparent-blur-down .5s ease-out;\n  display: none; }\n",""])},,,function(t,e,n){t.exports=n.p+"src/images/mixer-unspalsh.jpg"},,,,,function(t,e,n){"use strict";n.r(e);n(5);var r=n(4);console.log("I try something");r.initializeApp({apiKey:"AIzaSyBBjAt47tBjCoGqZcSQLc6BiQpckA7mGnU",authDomain:"my-website-543dc.firebaseapp.com",databaseURL:"https://my-website-543dc.firebaseio.com",projectId:"my-website-543dc",storageBucket:"my-website-543dc.appspot.com",messagingSenderId:"172038972046"});var i=!1,o=!1;n(1),n(2);window.onload=function(){var t=document.querySelector("html");!function(){if(!o){o=!0,console.log("show name");var t=document.querySelector(".heading-secondary"),e=!0,n=!1,r=void 0;try{for(var i,s="Zvi Kantor"[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var a=i.value;t.innerHTML+="<span class = 'heading-secondary__letter'><span class='heading-secondary__letter-inner'>"+a+"</span></span>"}}catch(t){n=!0,r=t}finally{try{e||null==s.return||s.return()}finally{if(n)throw r}}setTimeout(function(){var t=document.querySelectorAll(".heading-secondary__letter"),e=0,n=!0,r=!1,i=void 0;try{for(var o,s=function(){var t=o.value;setTimeout(function(){t.classList.add("heading-secondary__letter-show")},150*e++)},a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)s()}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}},.1)}}(),setTimeout(function(){!function(){if(!i){i=!0,console.log("show main");var t=document.querySelector(".heading-primary"),e=document.querySelector(".heading-primary__inner");e.innerHTML+="Full Stack Web Developer",setTimeout(function(){t.classList.add("heading-primary-shown"),e.classList.add("heading-primary-shown__inner")},.05)}}()},1500),setTimeout(function(){!function(){var t=document.querySelector(".blinds-container");t.innerHTML="";for(var e=0;e<20;e++)t.innerHTML+="<div class='blind-unit-outer'><div class='blind-unit'></div></div>";var n=document.querySelectorAll(".blind-unit"),r=0;setTimeout(function(){document.querySelector(".outer-header").style.backgroundImage="none";var t=!0,e=!1,i=void 0;try{for(var o,s=function(){var t=o.value;setTimeout(function(){t.style.width=0},50*r++)},a=n[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)s()}catch(t){e=!0,i=t}finally{try{t||null==a.return||a.return()}finally{if(e)throw i}}},350)}()},2500),setTimeout(function(){document.querySelector(".heading-tertiary").style.display="block",document.querySelector(".about-container").style.display="block",t.style.overflowY="scroll";setInterval(function(){var t=document.querySelectorAll(".u-showup-onscroll"),e=!0,n=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;s.parentElement.getBoundingClientRect().y-window.innerHeight<=0&&(s.style.display="block")}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}},100);var e=document.querySelectorAll(".ca-progress-unit"),n=document.head.appendChild(document.createElement("style")),r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var u=s.value.getAttribute("value-data");n.innerHTML+='.ca-progress-unit[value-data="'+u+'"]::after{width:'+.8*u+"rem!important;} \n"}}catch(t){i=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}},3300)},window.onbeforeunload=function(){window.scrollTo(0,0)}}]);